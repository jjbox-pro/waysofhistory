<script type="text/plain" id="tabs.tab">
    {{
		var tab = it;
		var tabIcon = tab.getIcon();
		var tabHref = tab.getHref();
	}}

	<a class="tabs-btn {{=tab.getCls()}} {{?tab.isClickable()}}{{=tab.getLinkClass()}}{{?}}" data-tab="{{=tab.name}}" {{=tab.getAttrs()}} {{?tabHref}}href="{{=tabHref}}"{{?}}>
		{{?tabIcon}}
			<span class="tabs-icon">{{=tabIcon}}</span>
		{{?}}
		<span class="tabs-title {{?!it.tabTitle}}-empty{{?}}">{{=it.tabTitle}}</span>
	</a>
</script><script type="text/plain" id="iMap.main">
	<div class="interface-map">
		<div class="map-loadIndicator-wrp"></div>
		<div class="map-clock-wrp"></div>
		<div class="map-back-wrp"></div>
		<div class="panel-map-admin-wrp"></div>
		<div class="map-mini-wrp"></div>
		<div class="map-smmenu-wrp"></div>
		<div class="map-mapTL-wrp"></div>
		<div class="map-mapR-wrp"></div>
	</div>
</script>


	<script type="text/plain" id="iMap.alert.noAccess">
		<p>Карта будет доступна при <b>установленном</b> и <b>подтвержденнном e-mail</b> в <a class="link" href="{{=HashMgr.getHref('#/options/')}}">настройках</a> аккаунта.</p>
		<p>Когда e-mail был указан при регистрации, тогда нужно найти в почтовом ящике письмо и пройти по указанной в нем ссылке.</p>
		<p>Если письмо не нашлось, возможно следует проверить папку для <b>спама</b>.</p>
	</script>


	<script type="text/plain" id="iMap.back">
		<div class="map-back {{?iMap.isSimplified()}}-simple{{?}}">
			<canvas id="map-canvasW" class="map-canvas map-canvasW"></canvas>
			<canvas id="map-canvas" class="map-canvas" aria-labelledby="tooltip-voiceHelperCont"></canvas>
			<div class="back-cursorButtons-wrp"></div>
			<div class="back-arrows-wrp"></div>
		</div>
	</script>


		<script type="text/plain" id="iMap.back.cursorButtons">
			{{?it.show}}
				<div class="map_cursorButtons effect-appear">
					{{var zoomCls = '';}}
					
					<style>
						{{?iMap.isSimplified()}}
							.map_cursorBut{margin-top: {{=-it.dispY/(1+it.zoom)}}px;}
						{{?}}
                        
						{{?it.zoom > 0}}
							{{
								var zoom = Math.min(1, it.zoom);
								zoomCls = '-type-zoom';
							}}
							.map_cursorBut.{{=zoomCls}}{margin-top: {{=(15*zoom) + (iMap.isSimplified() ? -5 : 0)}}px;}
							.map_cursorBut.{{=zoomCls}}.-type-enter{margin-left: {{=-1*zoom}}px;}
							.map_cursorBut.{{=zoomCls}}.-type-army{margin-left: {{=11*zoom}}px;}
							.map_cursorBut.{{=zoomCls}}.-type-buildRoute{margin-left: {{=23*zoom}}px;}
							.map_cursorBut.{{=zoomCls}}.-type-resSend{margin-left: {{=-11*zoom}}px;}
							.map_cursorBut.{{=zoomCls}}.-type-resStream{margin-left: {{=-23*zoom}}px;}
						{{?}}
					</style>
					
					{{?it.show.impLinks}}
						{{@it.show.impLinks: impLink }}
							<a class="map_cursorBut mapButton -type-imp {{?!impLink.isActive}}-type-inactive{{?}}" data-dir="{{=impLink.dir}}" data-index="{{=impLink.index}}" style="left: {{=impLink.pos.x}}px; top: {{=impLink.pos.y}}px;" data-title="{{?impLink.isActive}}Отключить использование улучшения{{??}}Включить использование улучшения{{?}}"></a>
						{{@}}
					{{?}}
					
					{{?it.show.enter}}
						<a class="map_cursorBut mapButton -type-enter {{=zoomCls}}" 
								data-action="enter" 
								href="{{=hashMgr.getTownHref(it.town, it.acc)}}" 
								data-title="Войти в город">
						</a>
					{{?}}
					{{?it.show.army}}<a class="map_cursorBut mapButton -type-army {{=zoomCls}}" data-action="army" href="{{=HashMgr.getHref('#/sendArmy/target='+it.town)}}" data-title="Отправить войска"></a>{{?}}
					{{?it.show.resSend}}<a class="map_cursorBut mapButton -type-resSend {{=zoomCls}}" data-action="resSend" href="{{=HashMgr.getHref('#/send/target='+it.town)}}" data-title="Транспортировать ресурсы"></a>{{?}}
					{{?it.show.resStream}}<a class="map_cursorBut mapButton -type-resStream {{=zoomCls}}" data-action="resStream" href="{{=HashMgr.getHref('#/stream/'+it.town)}}" data-title="Начать снабжение"></a>{{?}}
					{{?it.show.depFree}}<a class="map_cursorBut mapButton -type-depFree" data-action="depFree" data-title="Освободить месторождение"></a>{{?}}
					{{?it.show.depEnemy}}<a class="map_cursorBut mapButton -type-depEnemy" data-action="depEnemy" data-title="Чужое месторождение. Колонизировать нельзя."></a>{{?}}
					{{?it.show.depColonize}}<a class="map_cursorBut mapButton -type-depColonize" data-action="depColonize" data-title="Колонизировать месторождение"></a>{{?}}
					{{?it.show.depError}}<a class="map_cursorBut mapButton -type-depError" data-action="depColonize" data-title="Невозможно колонизировать"></a>{{?}}
					{{?it.show.spy}}<a class="map_cursorBut mapButton -type-spy" data-action="spy" data-title="Разведать территорию"></a>{{?}}
					{{?it.show.townFound}}<a class="map_cursorBut mapButton -type-townFound" data-action="townFound" data-title="Город"></a>{{?}}
					{{?it.show.townError}}<a class="map_cursorBut mapButton -type-townError" data-action="townFound" data-title="Город"></a>{{?}}
					{{?it.show.tileRoutes}}
						<div class="map_cursorBut mapButton {{?wofh.account.isPremium()}}-type-tileRoutes{{??}}-type-tileRoute-noRoute{{?}} crP -type-buildRoute {{=zoomCls}}" data-type="{{=iMap.mode.type.makeRoute}}" data-title="Просчитать путь">
							{{?wofh.account.isPremium()}}
								<div class="map_cursorBut-routeMode-wrp">
									{{=tmplMgr.iMap.back.cursorButtons.routeMode({routeMode:it.map.routeMode})}}
								</div>
							{{?}}
						</div>
					{{?}}
					
					{{?it.show.mapRoutes || it.show.routesLoading}}
						<div class="map_cursorBut_route">
							{{?it.show.routesLoading}}
								<a class="map_cursorBut mapButton -type-tileRoute-land -loading"></a>
							{{??}}
								{{
									var noRoute = true;
									var mapRoutes = it.show.mapRoutes;
									var route;
									var path;
								}}
								{{route = mapRoutes.getLand();}}
								{{?route}}
									{{noRoute = false;}}
									{{path = Trade.roundDistance(route.path);}}
									<a class="mapButton -type-tileRoute -type-tileRoute-land {{?route.active}}-active{{??}}-disabled{{?}}" data-type="{{=route.type}}" data-title="{{=mapRoutes.mode.titleReceived}} составляет {{=utils.escapeHtml(snip.pathIcon()) + path}}">
										<span class="mapButton-small -type-routeMode" data-mode="{{=mapRoutes.mode.id}}"></span>
										{{=snip.nobr(path, false, 'mapButtonText lenLim')}}
									</a>
								{{?}}
								{{route = mapRoutes.getWater();}}
								{{?route}}
									{{noRoute = false;}}
									{{path = Trade.roundDistance(route.path);}}
									<a class="mapButton -type-tileRoute -type-tileRoute-water {{?route.active}}-active{{??}}-disabled{{?}}" data-type="{{=route.type}}" data-title="Мелководный путь составляет {{=utils.escapeHtml(snip.pathIcon()) + path}}">
										{{=snip.nobr(path, false, 'mapButtonText lenLim')}}
									</a>
								{{?}}
								{{route = mapRoutes.getDeepWater();}}
								{{?route}}
									{{noRoute = false;}}
									{{path = Trade.roundDistance(route.path);}}
									<a class="mapButton -type-tileRoute -type-tileRoute-deepWater {{?route.active}}-active{{??}}-disabled{{?}}" data-type="{{=route.type}}" data-title="Глубоководный путь составляет {{=utils.escapeHtml(snip.pathIcon()) + path}}">
										{{=snip.nobr(path, false, 'mapButtonText lenLim')}}
									</a>
								{{?}}

								{{?noRoute}}
									<a class="mapButton -type-tileRoute-noRoute" data-title="Невозможно проложить такой путь"></a>
								{{?}}
							{{?}}
						</div>
					{{?}}
				</div>
			{{?}}
		</script>
		
		<script type="text/plain" id="iMap.back.cursorButtons.routeMode">
			<div class="map_cursorBut mapButton-small -type-routeMode crP js-routeModes" data-mode="{{=it.routeMode.id}}" data-title="{{=it.routeMode.title}}" data-tooltip-possqr='{"bottom": 40}'>
				<div class="map_cursorBut_routeModes">
					{{@Route.modes: mode}}
						<a class="mapButton-small -type-routeMode {{?it.routeMode.id == mode.id}}-active{{?}} js-changeRouteMode" data-mode="{{=mode.id}}" data-title="{{=mode.title}}"></a>
					{{@}}
				</div>
			</div>
		</script>

		<script type="text/plain" id="iMap.back.arrows">
			{{@it.arrows: arrow: pos}}
				<a class="map-arrow -relation-{{=utils.cnstName(Tile.relation, arrow.relation)}}" 
						style="left: {{=arrow.pos.x}}px; top: {{=arrow.pos.y}}px; transform: rotate({{=arrow.angle}}rad);"     
						data-id="{{=pos}}"
						href="#o={{=arrow.tile.posTMT.o}}&x={{=arrow.tile.posTMT.x}}&y={{=arrow.tile.posTMT.y}}">
				</a>
			{{@}}
		</script>

	<script type="text/plain" id="iMap.mini">
		<div class="minimap_wrp">
			{{?debug.isTest('later')}}
				<div class="minimap_centering">
					<label>
						<input class="js-minimap-setCentering" type="checkbox" {{?ls.getMapCentering(false)}}checked="checked"{{?}}> Центрировать карту
					</label>
				</div>
			{{?}}
			
			<div class="minimap_brdCntr">
				<div class="minimap_brdRight"></div>
				<div class="minimap_brdTop"></div>
				<div class="minimap_brdCorner"></div>
			</div>
			
			<div class="minimap_imgCrop">
				<div class="minimap_back"></div>
				<div class="minimap_imgCntr">
					<div class="minimap_imgSize">
						<div class="minimap_map"></div>
						<div class="minimap_map minimap_repeat -type-left"></div>
						<div class="minimap_map minimap_repeat -type-right"></div>
						<div class="minimap_img_wrp">
							<img class="minimap_img">
							<img class="minimap_img minimap_repeat -type-left">
							<img class="minimap_img minimap_repeat -type-right">
							<div class="minimap_view"></div>
						</div>
					</div>
				</div>
			</div>

			<div class="minimap_btns">
				<button class="minimap_bigbut"></button>
				<button class="minimap_typebut" data-type="clim" data-title="Климатическая карта"></button>
				<button class="minimap_typebut" data-type="pol" data-title="Политическая карта"></button>
			</div>
			<a class="townbut link {{?!ls.getMapToggleMenu(true)}}-type-opened{{?}}" href="{{=HashMgr.getHref('#town')}}"><span class="townbut-scroll">В город</span></a>
		</div>
	</script>

	<script type="text/plain" id="iMap.mapTL">
		<div class="map-mapTL">
			<div class="mapTL-zoom-wrp"></div>
			<div class="mapTL-mode-wrp"></div>
			<div class="mapTL-filters-wrp"></div>
		</div>
	</script>
	
		<script type="text/plain" id="iMap.mapTL.zoom">
			{{?it.show}}
				<div class="map_zoom">
					<button class="map_zoom_plus"></button>
					<div class="map_zoom_slider"></div>
					<button class="map_zoom_minus"></button>
				</div>
			{{?}}
		</script>
		
		<script type="text/plain" id="iMap.mapTL.mode">
			<div class="map_mode">
				<div>
					{{=tmplMgr.iMap.mapTL.mode.map()}}

					{{?it.showBuildBtn}}
						<button class="btnMapMode -type-build" data-id="{{=iMap.mode.type.build}}" data-title="Строительство дорог и улучшений"></button>
					{{?}}
				</div>
				
				{{?it.showBuildBtn}}
					{{=tmplMgr.iMap.mapTL.mode.build(it)}}
				{{?}}
			</div>
		</script>
			
			<script type="text/plain" id="iMap.mapTL.mode.map">
				<div class="map_mode_versWrp -hidden">
					<button 
							class="btnMapMode map_mode_vers -type-view {{?iMap.isFull()}}-type-simple{{?}}" 
							data-id="{{=iMap.mode.type.view}}" 
							data-title="{{?iMap.isSimplified()}}Обзорная карта{{??}}Упрощённая карта{{?}}">
					</button> 
				</div>
				
				<button 
						class="btnMapMode -type-view {{?iMap.isSimplified()}}-type-simple{{?}} map_mode_main active" 
						data-id="{{=iMap.mode.type.view}}" 
						data-title="{{?iMap.isSimplified()}}Упрощённая карта{{??}}Обзорная карта{{?}}">
				</button> 

				<button class="map_mode_versBtn"></button>
			</script>
			
			<script type="text/plain" id="iMap.mapTL.mode.build">
				<div class="map_mode_panel build -hidden">
					<div class="map_mode_imp_tabs">
						{{?it.canRoadBuild}}
							<button class="map_mode_imp_tab" data-type="road" data-title="Дороги и тоннели"></button> 
						{{?}}

						{{~it.env: imp}}
							<button class="map_mode_imp_tab" data-type="env" data-id="{{=imp.getId()}}" data-title="{{=imp.getName()}}"></button> 
						{{~}}
					</div>
					
					<div class="map_mode_imp_panels">
						{{?typeof(it.colonists) != 'undefined'}}
							<div class="map_mode_imp_panel town -hidden">
								<div class="map_mode_imp_title">Город</div>
								<span class="map_mode_imp_cost nobr {{?it.need>it.colonists}}clr0{{?}}">
									<img class="unit u{{=Unit.ids.settler}}" src="https://test.waysofhistory.com/img/_.gif" data-title="{{=lib.units.list[Unit.ids.settler].name}}" />&nbsp;{{=it.need}}
								</span>
							</div> 
						{{?}}

						{{?it.canRoadBuild}}
							<div class="map_mode_imp_panel road -hidden"></div> 
						{{?}}

						{{~it.env: imp}}
							<div class="map_mode_imp_panel env{{=imp.getId()}} -hidden"></div>
						{{~}}
					</div>
				</div>
			</script>
			
			<script type="text/plain" id="iMap.mapTL.mode.modeRoad">
				<div>
					<div class="map_mode_imp_title">{{=it.road.getName()}}</div> 
					<div class="-nobr">

						<span class="{{?it.road.getUnit().getCount()>wofh.town.army.own.getCount(it.road.getUnit())}}clr0{{?}}"> 
							{{=snip.unitCount(it.road.getUnit())}}
						</span> 

						{{=snip.resBigListCheck(it.road.getCost())}}
					</div>
					<div class="map_mode_imp_time"> {{=timeMgr.fPeriod(it.time)}}</div>
				</div>
			</script>

			<script type="text/plain" id="iMap.mapTL.mode.modeImp">
				<div>
					<div class="map_mode_imp_title">{{=it.imp.getName()}}</div>
					<div class="map_mode_imp_effect">{{=snip.mapImpEffect(it.imp)}}</div>
					<div class="map_mode_imp_cost -nobr">
						<span class="{{?!it.imp.isEnoughWorkers()}}clr0{{?}}"> 
							{{=snip.unitCount(it.imp.getWorkers())}}
						</span> 
						{{=snip.resBigListCheck(it.imp.getCost())}}
					</div>
					<div class="map_mode_imp_hint">{{= it.imp.getHint()}}</div>
					<div class="map_mode_imp_time"> {{=timeMgr.fPeriod(it.time)}}</div>
				</div>
			</script>
			
		<script type="text/plain" id="iMap.mapTL.filters">
			<div class="map_filter_wrap">
				<div class="panel-filters-aura-wrp"></div>
				<div class="panel-filters-iface-wrp"></div>
				<div class="panel-filters-filter-wrp"></div>
			</div>
		</script>
			
			<script type="text/plain" id="iMap.mapTL.filters.aura.header">
				<span class="map_filter_icon"></span>
				<span class="map_filter_text">Ауры</span>
			</script>
			
			<script type="text/plain" id="iMap.mapTL.filters.aura">
				<ul>
					<li>
						<label>
							<input type="checkbox" name="aura" {{?it.activeAura.town}}checked="checked"{{?}} value="town"/><span></span> Основание города
						</label>
					</li>
					<li>
						<label>
							<input type="checkbox" name="aura" {{?it.activeAura.cnt}}checked="checked"{{?}} value="cnt"/><span></span> Страна
						</label>
					</li>
					<li>
						<label>
							<input type="checkbox" name="aura" {{?it.activeAura.trw}}checked="checked"{{?}} value="trw"/><span></span> Морская торговля
						</label>
					</li>
					<li>
						<label>
							<input type="checkbox" name="aura" {{?it.activeAura.air}}checked="checked"{{?}} value="air"/><span></span> Авиация
						</label>
					</li>
					<li>
						<label class="fakelink" data-title="Показывает радиус возможного действия ПВО твоих городов">
							<input type="checkbox" name="aura" {{?it.activeAura.aad}}checked="checked"{{?}} value="aad"><span></span> ПВО
						</label>
					</li>
					{{?wofh.country && (wofh.account.isHead() || wofh.account.isMarshal())}}
						<li>
							<label class="fakelink" data-title="Показывает радиус возможного действия ПВО городов твоей страны">
								<input type="checkbox" name="aura" {{?it.activeAura.aadc}}checked="checked"{{?}} value="aadc"><span></span> ПВО страны
							</label>
						</li>
					{{?}}
				</ul>
			</script>
			
			<script type="text/plain" id="iMap.mapTL.filters.iface.header">
				<span class="map_filter_icon"></span>
				<span class="map_filter_text">Интерфейс</span>
			</script>
			
			<script type="text/plain" id="iMap.mapTL.filters.iface">
				<ul>
					{{?iMap.isFull()}}
						<li><label><input type="checkbox" name="filter" value="{{=LS.mapIFace.grid}}" {{?it.settings[LS.mapIFace.grid]}}checked{{?}}/><span></span> Сетка</label></li>
					{{?}}
					<li><label><input type="checkbox" name="filter" value="{{=LS.mapIFace.colonization}}" {{?it.settings[LS.mapIFace.colonization]}}checked{{?}} /><span></span> Колонизация</label></li>
					<li><label><input type="checkbox" name="filter" value="{{=LS.mapIFace.zoom}}" {{?it.settings[LS.mapIFace.zoom]}}checked{{?}} /><span></span> Масштаб</label></li>
					<li><label><input type="checkbox" name="filter" value="{{=LS.mapIFace.navigation}}" {{?it.settings[LS.mapIFace.navigation]}}checked{{?}} /><span></span> Навигация</label></li>
					<li><label><input type="checkbox" name="filter" value="{{=LS.mapIFace.depLinks}}" {{?it.settings[LS.mapIFace.depLinks]}}checked{{?}} /><span></span> Связи</label></li>
				</ul>
			</script>

			<script type="text/plain" id="iMap.mapTL.filters.filter.header">
				<span class="map_filter_icon"></span>
				<span class="map_filter_text">Фильтры</span>
				{{?!utils.isEqual(it.filterDefault, it.settings)}}
					{{=snip.alert('Фильтры объектов местности настроены нестандартно. Будете внимательны', {cls: 'map_filter_alert'})}}
				{{?}}
			</script>
			
			<script type="text/plain" id="iMap.mapTL.filters.filter">
				{{@it.settings: mask: param}}
					{{var opt = {title: '', iconCls: ''};}}

					{{?param == LS.mapFilter2.mount}}
						{{opt.show = true;}}

						{{?!utils.inMask(wMapFilter.filter.mount.show, mask)}}
							{{opt.title = 'Горы'; opt.iconCls = 'iconMount';}}
						{{??!utils.inMask(wMapFilter.filter.mount.spec, mask)}}
							{{opt.title = 'Горы вокруг твоих городов'; opt.iconCls = 'iconMount -type-blue';}}
						{{??}}
							{{opt.title = 'Горы скрыты'; opt.iconCls = 'iconMount -type-cross';}}
						{{?}}
					{{??param == LS.mapFilter2.hill}}
						{{opt.show = true;}}

						{{?!utils.inMask(wMapFilter.filter.hill.show, mask)}}
							{{opt.title = 'Холмы'; opt.iconCls = 'iconHill';}}
						{{??!utils.inMask(wMapFilter.filter.hill.spec, mask)}}
							{{opt.title = 'Xолмы под и вокруг своих городов'; opt.iconCls = 'iconHill -type-blue';}}
						{{??}}
							{{opt.title = 'Холмы скрыты'; opt.iconCls = 'iconHill -type-cross';}}
						{{?}}
					{{??param == LS.mapFilter2.town}}
						{{opt.show = true;}}

						{{?mask == Tile.relation.none}}
							{{opt.title = 'Все города'; opt.iconCls = 'iconTown -rel-none';}}
						{{??mask == 127 - (1<<Tile.relation.none)}}
							{{opt.title = 'Нейтральные города'; opt.iconCls = 'iconTown -rel-none';}}
						{{??mask == 127}}
							{{opt.title = 'Все города скрыты'; opt.iconCls = 'iconTown -type-cross';}}
						{{??mask == 127 - (1<<Tile.relation.self)}}
							{{opt.title = 'Мои города'; opt.iconCls = 'iconTown -rel-self';}}
						{{??mask == 127 - (1<<Tile.relation.country)}}
							{{opt.title = 'Города страны'; opt.iconCls = 'iconTown -rel-country';}}
						{{??mask == 127 - (1<<Tile.relation.ally)}}
							{{opt.title = 'Города союзников'; opt.iconCls = 'iconTown -rel-ally';}}
						{{??mask == 127 - (1<<Tile.relation.enemy)}}
							{{opt.title = 'Города врагов'; opt.iconCls = 'iconTown -rel-enemy';}}
						{{??mask == 127 - (1<<wMapFilter.filter.town.barb)}}
							{{opt.title = 'Города варваров'; opt.iconCls = 'iconTown -type-barb';}}
						{{??mask == 127 - (1<<wMapFilter.filter.town.build)}}
							{{opt.title = 'Основываемые города'; opt.iconCls = 'iconTown -type-build';}}	
						{{??mask == 127 - (1<<Tile.relation.self) - (1<<Tile.relation.country) - (1<<Tile.relation.ally) - (1<<Tile.relation.enemy)}}
							{{opt.title = 'Города страны, союзников и врагов'; opt.iconCls = 'iconTown -type-mix2';}}
						{{??mask == 127 - (1<<Tile.relation.self) - (1<<Tile.relation.country) - (1<<Tile.relation.ally)}}
							{{opt.title = 'Города страны и союзников'; opt.iconCls = 'iconTown -type-mix1';}}
						{{??mask == 127 - (1<<Tile.relation.self) - (1<<wMapFilter.filter.town.barb)}}
							{{opt.title = 'Мои города и варвары'; opt.iconCls = 'iconTown -type-barb';}}
						{{??mask == 127 - (1<<Tile.relation.self) - (1<<Tile.relation.country) - (1<<Tile.relation.ally) - (1<<Tile.relation.enemy) - (1<<wMapFilter.filter.town.barb) - (1<<wMapFilter.filter.town.build)}}
							{{opt.title = 'Разные города'; opt.iconCls = 'iconTown -type-blue';}}	
						{{??}}
							{{opt.title = 'Разные города'; opt.iconCls = 'iconTown -type-blue';}}
						{{?}}
					{{??param == LS.mapFilter2.mapimp}}
						{{opt.show = true;}}

						{{?!utils.inMask(wMapFilter.filter.mapImp.build, mask)}}
							{{var mapImpBuild = {title: 'Строящиеся улучшения', iconCls: 'iconMapImp -type-build'};}}
						{{?}}

						{{?!utils.inMask(wMapFilter.filter.mapImp.show, mask)}}
							{{opt.title = 'Все улучшения местности'; opt.iconCls = 'iconMapImp';}}
						{{??!utils.inMask(wMapFilter.filter.mapImp.spec, mask)}}
							{{opt.title = 'Улучшения у моих городов'; opt.iconCls = 'iconMapImp -type-blue';}}
						{{??mapImpBuild}}
							{{opt.title = mapImpBuild.title; opt.iconCls = mapImpBuild.iconCls;}}

							{{mapImpBuild = false;}}
						{{??}}
							{{opt.title = 'Все улучшения местности скрыты'; opt.iconCls = 'iconMapImp -type-cross';}}
						{{?}}

						{{?mapImpBuild}}
							{{opt.title += ', ' + mapImpBuild.title;}}
						{{?}}
					{{??param == LS.mapFilter2.road}}
						{{opt.show = true;}}

						{{?utils.inMask(Road.ids.dirt, mask) && utils.inMask(Road.ids.highway, mask) && utils.inMask(Road.ids.railway, mask) && utils.inMask(Road.ids.maglev, mask) && utils.inMask(Road.ids.tunnel, mask)}}
							{{opt.title = 'Дороги скрыты'; opt.iconCls = 'iconRoad -type-cross';}}
						{{??}}
							{{opt.title = 'Дороги'; opt.iconCls = 'iconRoad';}}
						{{?}}
					{{??param == LS.mapFilter2.deposit}}
						{{opt.show = true;}}

						{{?!utils.inMask(wMapFilter.filter.deposit.build, mask)}}
							{{var depositBuild = {title: 'Колонизируемые месторождения', iconCls: 'iconDeposit -type-build'};}}
						{{?}}

						{{?!utils.inMask(wMapFilter.filter.deposit.show, mask)}}
							{{opt.title = 'Все месторождения'; opt.iconCls = 'iconDeposit';}}
						{{??!utils.inMask(wMapFilter.filter.deposit.spec, mask)}}
							{{opt.title = 'Видны подходящие для колонизации'; opt.iconCls = 'iconDeposit -type-blue';}}
						{{??depositBuild}}
							{{opt.title = depositBuild.title; opt.iconCls = depositBuild.iconCls;}}

							{{depositBuild = false;}}
						{{??}}
							{{opt.title = 'Все улучшения местности скрыты'; opt.iconCls = 'iconDeposit -type-cross';}}
						{{?}}

						{{?depositBuild}}
							{{opt.title += ', ' + depositBuild.title;}}
						{{?}}
					{{?}}

					{{?opt.show}}
						{{opt.title = utils.upFirstLetter(opt.title.toLowerCase());}}

						<button class="button4 {{?mask != it.filterDefault[param]}}-type-filterChanged{{?}}" data-title="{{=opt.title}}"><span class="{{=opt.iconCls}}"></span></button>
					{{?}}
				{{@}}
			</script>
			
	<script type="text/plain" id="iMap.mapR">
		<div class="map_panelR">
			<a class="map_panelR_toggle"></a>
			<a class="map_panelR_toggleAll">
				<span class="map_panelR_saveMap button1">Сохранить карту</span>
			</a>
			
			<div class="mapR-towns-wrp"></div>
			<div class="mapR-tile-wrp"></div>
			<div class="mapR-comments-wrp"></div>
	
			<div class="mapR-nav-wrp"></div>
			<div class="mapR-events-wrp"></div>
		</div>
	</script>
	
		<script type="text/plain" id="iMap.mapR.towns">
			<div class="map_panelR_towns">
				<div class="map_panelR_towns_title">
					/*
					<span>Мои города</span>
					<span>Избранное</span>
					*/
				</div>

				<div class="map_scroll_wrp">
					<ol>
						{{@it.towns: town}}
							{{var active = town.id == wofh.town.id;}}
							<li class="map-pR-town {{?active}}-active{{?}}">
								<span class="js-tooltip -lenLim -inline -noHint" style="width: 80px;" data-tooltip-wnd="town" data-id="{{=town.id}}">
									{{?!active}}
										<a class="link map-panelR-towns-set" data-id="{{=town.id}}">
											<b>{{=town.name}}</b>
										</a>
									{{??}}
										<b>{{=town.name}}</b>
									{{?}}
								</span>
								<div class="map_pR_townButtons">
									<a href="{{=hashMgr.getMapHref(it.links[town.id].link)}}" class="map_pR_button center" data-title="Показать на карте"></a>
									{{?!active}}
										<a href="{{=HashMgr.getHref('#/sendArmy/target='+town.id)}}" class="map_pR_button getArmy" data-title="Отправить войска"></a>
										<a href="{{=HashMgr.getHref('#/send/target='+town.id)}}" class="map_pR_button marketSend" data-title="Отправить ресурсы"></a>
										{{?Account.hasAbility(Science.ability.money)}}
											<a href="{{=HashMgr.getHref('#/stream/'+town.id)}}" class="map_pR_button marketStream" data-title="Начать снабжение ресурсами"></a>
										{{?}}
									{{?}}
								</div>
								<div class="map-pR-town-stock"></div>
							</li>
						{{@}}
					</ol>
				</div>
			</div>
		</script>

		<script type="text/plain" id="iMap.mapR.towns.stock">
			<div>
				{{?it.unit}}
					<div>{{=snip.unitCountLink(it.unit)}}</div>
				{{?}}
				{{?it.resources}}
					{{=snip.resList(it.resources, {tmpl: function(res){return '<div>'+snip.resBigCount(res)+'</div>'} })}}
				{{?}}
			</div>
		</script>
		
		<script type="text/plain" id="iMap.mapR.tile">
			<div class="map_panelR_tile">
                <div class="map_panelR_dist">
                    {{?wofh.account.isAdmin()}}
                        <p style="float:right">{{=it.tile.posTMT.x}} : {{=it.tile.posTMT.y}}</p>
                    {{?}}
                    <p>
                        {{?it.tile.dist}}{{=snip.distance(it.tile.dist)}}{{?}}
                    </p>
                    <p>
                        {{=it.tile.climate.name}}
                        {{?it.tile.climate.id != Tile.climateIds.water && it.tile.climate.id != Tile.climateIds.deepwater}}
                             - {{?it.tile.river}}Река{{??}}{{=it.tile.terrain.name}}{{?}}
                        {{?}}
                    </p>
                    {{?!(it.tile.tile[Tile.param.dep] != lib.map.nodeposit || it.tile.tile[Tile.param.climate] == Tile.climateIds.water || it.tile.tile[Tile.param.terrain] == Tile.terrainIds.mountains)}}
                        <div class="map_panelR_slots">{{=snip.townSlots(it.tile.slots)}}</div>
                    {{?}}
                    <p style="padding-top: 6px;">{{=tmplMgr.snipet.clipboard({tag: 'm' + it.tile.posTMT.o + '/' + it.tile.posTMT.x + '/' + it.tile.posTMT.y})}}</p>
                </div>

                <div class="map_panelR_objects">
                    {{?it.tile.town}}
                        {{?it.tile.town.pop}}<div class="map_panelR_pop">{{=snip.pop(~~it.tile.town.pop.hasall)}}</div>{{?}}
                        <p>{{=snip.townLink(it.tile.town, {rel: it.tile.diplomacy})}}</p>
                        {{?it.tile.town.attacks}}<p><a class="town-attacks link">Атаки ({{=it.tile.town.attacks}})</a></p>{{?}}
                        {{?debug.isAdmin()}}<p class="aR"><a class="link clr6 map_panelR_admin">Сводка</a></p>{{?}}
                    {{?}}
                    {{?it.tile.deposit}}
                        <div class="-parag">
                            <div class="fR">
                                {{@it.tile.deposit.getRes().getList(): res}}
                                    {{=snip.resEffect(res.id)}}
                                {{@}}
                            </div>

                            {{=snip.depositLink(it.tile.deposit)}}

                            {{?it.tile.deposit.strength}}
                                &nbsp;{{=utils.stages(utils.toInt(it.tile.deposit.strength))}} {{=snip.hint('Прочность ресурсной колонии - ' + utils.stages(~~it.tile.deposit.strength) + '. Зависит только от количества городов хозяина.')}}
                            {{?}}
                        </div>
                    {{?}}
                    {{?it.tile.player}}<p>{{=snip.accLink(it.tile.player)}}</p>{{?}}
                    {{?it.tile.country}}<p>{{=snip.countryLink(it.tile.country)}}</p>{{?}}
                    {{?it.tile.wonder}}<p>{{=snip.buildLink(it.tile.wonder)}}</p>{{?}}
                    {{?Town.hasDefMoment(it.tile.town)}}<p>{{=snip.defMoment(it.tile.town.defmoment)}}</p>{{?}}
                    {{~it.tile.improves: imp}}
                        <p><span class="map_panelR_impName -lenLim">{{=snip.mapImpLevel(imp)}}</span></p>
                        {{?imp.getEffect()}}
                            <div class="-parag -canBr aR">
                                <span class="{{?imp.allowLuckBonus()}}fakelink{{?}}" {{?imp.allowLuckBonus()}}data-title="Без учета бонуса МУ"{{?}}>
                                    {{=snip.nobr(snip.mapImpEffect(imp) + ' ('+ snip.accIcon() + it.tile.mapImpUsers + '×' + snip.mapImpEffect(imp, it.tile.mapImpUsers, {noEffectIcon:true}) +')')}}
                                </span>
                                {{?imp.getEffectUngrown()}}
                                    <br>
                                    {{=snip.nobr(snip.mapImpEffectUngrown(imp, {effect:imp.calcRealEffect()}) + ' ('+ snip.accIcon() + it.tile.mapImpUsers + '×' + snip.mapImpEffectUngrown(imp, {effect:imp.calcRealEffect(it.tile.mapImpUsers)})+')')}}
                                {{??imp.getEffectProd()}}
                                    <br>
                                    {{=snip.nobr(snip.mapImpEffectProd(imp, {effect:imp.calcRealEffect(), fixed: 1, postFix: '%'}) + ' ('+ snip.accIcon() + it.tile.mapImpUsers + '×' + snip.mapImpEffectProd(imp, {effect:imp.calcRealEffect(it.tile.mapImpUsers), fixed: 1, postFix: '%'})+')')}}
                                {{?}}
                            </div>
                        {{?}}
                    {{~}}
                    {{=snip.roads(it.tile.tile, '-parag')}}
                </div>
			</div>
		</script>
		
		<script type="text/plain" id="iMap.mapR.comments">
			<div class="map_comm">
				{{?it.tile}}
					<p class="map_comm_title">Комментарии ({{=it.tile.comments? it.tile.comments.length: 0}})</p>
                    
					{{?it.canComment}}
						<div class="map_comm_add_block">
							<textarea class="map_comm_add_text" maxlength="{{=lib.map.postmaxlen}}"></textarea>
							<a class="map_comm_butAccept button1 -type-green">{{?it.tile.comment}}Заменить{{??}}Добавить{{?}}</a>
							<a class="map_comm_butReject button1 -type-red">Отменить</a>
						</div>
					{{?}}
                    
					<div class="map_scroll_wrp">
						<ul>
							{{~it.tile.comments: comment}}
								<li{{?comment.account.id == wofh.account.id}} class="map_comm_self"{{?}}>
									{{?comment.account.id == wofh.account.id}} <button class="map_comm_delBut"></button>{{?}}
									<div class="map_comm_text">{{=TextParser.prepare(comment.text)}}</div>
									<span class="enLim map_comm_acc bgLight lenLim">{{=snip.accLink(comment.account)}}</span>
									<div class="map_comm_time">{{=timeMgr.fMoment(comment.time)}}</div>
								</li>
							{{~}}
						</ul>
					</div>
                    
					{{?it.canComment}}
						<div class="map_comm_toggleBlock">
							{{var blink = new Quest(63).isStatusActive();}}

							<span class="button1-blinkWrp">
								<a class="map_comm_butToggle button1 -type-brown">
									{{?it.tile.comment}}Заменить комментарий{{??}}Добавить комментарий{{?}}
								</a>
								{{?blink}}
									<a class="map_comm_butToggle button1 button1-blink -type-gold -type-gold -anim-blink">
										{{?it.tile.comment}}Заменить комментарий{{??}}Добавить комментарий{{?}}
									</a>
								{{?}}
							</span>
							
							<span class="map_comm_alert">
								{{var text = '';}}
								
								{{?lib.mode.winmode != 0}}
									{{text = 'Количество комментариев на карте ограничено. Для месторождений максимум ' + 1 + ', для остальных мест не более ' + lib.map.maxposts + '. При добавлении комментария при превышении лимита — самый старый твой комментарий будет удален.';}}
								{{?}}
								
								{{?it.tile.comment}}
									{{text = 'Твое предыдущее объявление здесь будет заменено новым. ' + text;}}
								{{?}}
								
								{{?text}}
									{{=snip.hint(text)}}
								{{?}}
							</span>
						</div>
					{{?}}
				{{?}}
			</div>
		</script>


		<script type="text/plain" id="iMap.mapR.nav">
			{{?it.enabled}}
				<div class="map_nav">
					<button class="map_nav_top" data-dir="1"></button>
					<button class="map_nav_rgt" data-dir="3"></button>
					<button class="map_nav_btm" data-dir="5"></button>
					<button class="map_nav_lft" data-dir="7"></button>
					<button class="map_nav_cnt" data-dir="8"></button>
					<button class="map_nav_town" data-dir="-1">
						{{=snip.townIcon(false, Account.calcRelation(wofh.account))}}
					</button>
				</div>
			{{?}}
		</script>
		

		<script type="text/plain" id="iMap.mapR.events">
			<div class="map-events">
				{{@it.events.getList(): event}}
					<a class="map-event {{?event.hover}}-hover{{?}}" href="#o={{=wofh.account.map.o}}&x={{=event.data.x}}&y={{=event.data.y}}" data-id="{{=event.id}}">
						{{?event.type==EventCommon.type.maketown}}
							<span class="eventIcon -type-town"></span>
						{{??event.type==EventCommon.type.makeres}}
							<span class="eventIcon -type-deposit"></span>
						{{??event.type==EventCommon.type.explore}}
							<span class="eventIcon -type-explore"></span>
						{{??}}
							<span class="eventIcon -type-mapImp"></span>
						{{?}}
						<span class="map-event-time">
							{{=snip.wrp('fakelink', snip.timer(event.getTime(), 'dec'))}}
						</span>
					</a>
				{{@}}
			</div>
		</script>


		<script type="text/plain" id="iMap.tooltip">
			<div class="map_tooltip_main {{?!it.comments && !it.other}}-type-single{{?}} {{?it.town}}-rel-{{=utils.cnstName(Tile.relation, it.town.relation)}}{{?}}">
				<div class="map_tooltip_main_back"></div>
				{{?Town.hasDefMoment(it.town)}}<span class="map_tt_icon pigeon"></span>{{?}}

				{{?wofh.account.isAdmin() && it.posTMT}}<div>{{=it.posTMT.x}} : {{=it.posTMT.y}}</div>{{?}}
				{{?it.selectedPlace}}<div>Отмеченное место</div>{{?}}
				{{?it.town}}<div>{{=snip.town(it.town, it.player, it.country)}}</div>{{?}}
				{{?it.deposit}}
					<div>
						<div class="{{?it.deposit.isUndefined()}}-warn{{?}}">{{=snip.deposit(it.deposit)}}</div>
						{{?!it.town}}
							{{?it.deposit.isUndefined()}}
								<div class="-warn">Тебе недоступно для колонизации до изучения необходимой {{=snip.scienceIcon('науки')}}</div>
							{{??}}
								{{var err = it.deposit.calcColonizeErrors();}}
								<div>
									{{@it.deposit.getRes().getList(): res}}
										{{=snip.resEffect(res.id)}}{{=utils.toPercent(res.getCount())}}% 
									{{@}}
								</div>
								{{?err.faraway}}<div class="-warn -type-brown">Далеко от города</div>{{?}}
								{{?err.sea}}<div class="-warn -type-red">Город должен быть на берегу</div>{{?}}
								{{?!err.faraway && !err.sea}}<div class="-warn -type-green">Можно колонизировать</div>{{?}}
							{{?}}
						{{?}}
					</div>
				{{?}}
				{{?it.player}}<div>{{=snip.acc(it.player)}}</div>{{?}}
				{{?!it.player && it.town}}<div><img  src="https://test.waysofhistory.com/img/_.gif" class="icon_player" />Варвары</div>{{?}}
				{{?it.country}}<div>{{=snip.country(it.country)}}</div>{{?}}
				{{?it.wonder}}<div>{{=snip.build(it.wonder)}}</div>{{?}}
				{{~it.improves: imp}}
					<div>{{=snip.mapImpLevel(imp, {link: false, lenLim: 100})}}</div>
				{{~}}
				{{=snip.roads(it.tile)}}
				{{?it.terrain && it.terrain.id}}<div><img src="https://test.waysofhistory.com/img/_.gif" class="map_tt_icon empty" />&nbsp;{{=it.terrain.name}}</div>{{?}}
				{{?it.river}}
					<div><img src="https://test.waysofhistory.com/img/_.gif" class="map_tt_icon empty">&nbsp;Река</div>
				{{?}}
				{{@it.events && it.events.getList(): event}}
					{{? event.type == EventCommon.type.maketown}}
						<div>
							Основание Нового города из {{=snip.town(wofh.world.getTown(event.getTown1()))}}
							, через {{=snip.timer(event.getTime(), 'dec')}}
						</div>
					{{?? event.type == EventCommon.type.makeres}}
						<div>
							Колонизация месторождения {{=snip.deposit(event.data.type)}}
							, через {{=snip.timer(event.getTime(), 'dec')}}
						</div>
					{{?? event.type == EventCommon.type.makeroad}}
						<div>
							Цель: <b>{{=new Road(event.data.level).getName()}}</b>
							 из {{=snip.town(wofh.world.getTown(event.getTown1()))}}
							, через {{=snip.timer(event.getTime(), 'dec')}}
						</div>
					{{?? event.type == EventCommon.type.makeimp}}
						<div>
							Цель: <b>{{=new MapImp(event.data.type).getName()}}</b>
							 из {{=snip.town(wofh.world.getTown(event.getTown1()))}}
							, через {{=snip.timer(event.getTime(), 'dec')}}
						</div>
					{{?? event.type == EventCommon.type.explore}}
						<div>
							Цель: <b>Разведка местности</b>
							, через {{=snip.timer(event.getTime(), 'dec')}}
						</div>
					{{?}}
				{{@}}
			</div>

			{{?it.comments || it.other}}
				<div class="tooltip-divider"></div>
				<div class="map_tooltip_comments">
					<ul>
					{{~it.comments: comment}}
						<li>
							<img src="https://test.waysofhistory.com/img/_.gif" class="icon_player" data-race="{{=comment.account.race.id}}" data-sex="{{=comment.account.sex}}" />
							&nbsp;<a class="lenLim" href="{{=HashMgr.getHref('#/account/'+comment.account.id)}}">{{=comment.account.name}}</a><br/>
							<div class="lenLim" style="max-width:100%;">{{=TextParser.prepare(comment.text)}}</div>
						</li>
					{{~}}
					</ul>
					{{?it.commentsHidden>0}}<div class="map_tooltip_hidcomments">и ещё {{=it.commentsHidden}} комментариев...</div>{{?}}
					{{?it.other}}{{=it.other}}{{?}}
				</div>
			{{?}}
		</script>




		<script type="text/plain" id="iMap.cursorPopup">
			<div class="map_curPop">
				{{?it.cls == 'depColonize'}}
					<div class="map_curPop_title">{{=snip.deposit(it.id)}}</div>
					<div class="map_curPop_text">
						<div>{{=snip.depositRes(it.id)}}</div>
						<div class="map_curPop_dep_text">Займет  {{=snip.time(timeMgr.fPeriod(it.time))}}</div>
						<div class="map_curPop_dep_text">Для колонизации месторождения<br> в городе {{=snip.townLink(wofh.town)}}</div>
						{{?!it.errors.noWorkers}}
							<div>
								<span class="map_curPop_dep_param">{{=utils.upFirstLetter('потребуется ')}} {{=snip.unitCount(it.cost.unit)}}</span>
								<span class="iconOk"></span>
							</div>
						{{?}}
						{{@it.errors: val :error}}
							<div>
								<span class="map_curPop_dep_param">
									{{?error == 'noWorkers'}}{{=utils.upFirstLetter('не хватает ')}}{{=snip.unitCount(it.cost.unit.id, it.cost.unit.getCount() - wofh.town.army.own.getCount(it.cost.unit))}} из {{=snip.unitCount(it.cost.unit)}}{{=snip.hint('Внимание!<br/>Рабочие уже не вернутся<br/>обратно в город.')}}
									{{??error == 'faraway'}}Далеко от города
									{{??error == 'undefined'}}Неизвестное месторождение
									{{??error == 'townBusy'}}Город уже имеет месторождение
									{{??error == 'sea'}}Этот город не на побережье
									{{?}}
								</span>
								<span class="iconCancel"></span>
							</div>
						{{@}}
					</div>
					<div class="map_curPop_btns">
						<button class="button1 {{?utils.sizeOf(it.errors)}}-disabled{{??}}map_curPop_dep_sbm{{?}}">Колонизировать</button>
					</div>
				{{??it.cls == 'depFree'}}
					<div class="map_curPop_title">Действительно освободить месторождение?</div>
					<div class="map_curPop_text">
						Внимание!<br/>
						После освобождения в городе прекратится добыча ресурса, получаемого с данного месторождения.<br/>
						Рабочие уже не вернутся<br/>
						обратно в город!<br/>
					</div>
					<div class="map_curPop_btns">
						<button class="button1 map_curPop_depFree_sbm">Да</button>
						<button class="button1 map_curPop_cls">Нет</button>
					</div>
				{{??it.cls == 'townFound'}}
					<div class="map_curPop_title">Основать новый город?</div>
					<div class="map_curPop_text">
						{{?!it.err.cantReach}}
							<div class="m0500">
								Займет  {{=snip.time(timeMgr.fPeriod(it.time))}}
								<br>
								Съедят за время пути{{=snip.resList(it.res)}}
							</div>
							{{?!it.err.colonists}}
								<div>
									<span class="map_curPop_dep_param">{{=utils.upFirstLetter('потребуется ')}} {{=snip.unitCount(it.cost.unit)}}</span>
									<span class="iconOk"></span>
								</div>
							{{?}}
						{{?}}
						
						{{@it.err: val :error}}
							{{var hideCancel;}}
							
							<div>
								<span class="map_curPop_dep_param">
									{{?error == 'colonists'}}
										{{?!it.err.cantReach}}
											{{=utils.upFirstLetter('не хватает ')}}{{=snip.unitCount(it.cost.unit.id, it.cost.unit.getCount() - wofh.town.army.own.getCount(it.cost.unit))}} из {{=snip.unitCount(it.cost.unit)}}{{=snip.hint('Внимание!<br/>Поселенцы уже не вернутся<br/>обратно в город.')}}
										{{??}}
											{{hideCancel = true;}}
										{{?}}
									{{??error == 'dist'}}
										Слишком далеко
									{{??error == 'cantReach'}}
										Невозможно добраться
									{{??error == 'complex'}}
										Сложный рельеф
									{{??error == 'cantBuiidOnImp' && !it.err.cantReach}}
										Необходимо наличие незастроенной местности
									{{?}}
								</span>
								
								<span class="iconCancel {{?hideCancel}}-hidden{{?}}"></span>
							</div>
						{{@}}
					</div>
					
					<div class="map_curPop_btns">
						<button class="button1 {{?utils.sizeOf(it.err)}}-disabled{{??}}button1 map_curPop_town_sbm{{?}}">Основать</button>
					</div>
				{{??it.cls == 'roadBuild'}}
					<div class="map_curPop_title">{{=it.road.getName()}}</div> 
					<div class="map_curPop_text">
						{{?it.warn.dep}}<div class="map_mode_imp_warn">{{=snip.alert()}}Внимание! Сложный рельеф.<br>Стоимость строительства увеличена.</div>{{?}}
						<div class="-nobr">
							{{=snip.unitCount(it.road.getUnit())}}
							{{=snip.resList(it.road.getCost())}}
						</div>
						<div class="map_mode_imp_time"> {{=timeMgr.fPeriod(it.time)}}</div>

						<p>
							{{?!it.err}}Проложить дорогу?
							{{??}}Нельзя построить.<br/>
								{{?it.err.unit}}Недостаточно рабочих.<br/>{{?}}
								{{?it.err.res}}Недостаточно ресурсов.<br/>{{?}}
							{{?}}
						</p>
						<br>
						<br>
					</div>

					<div class="map_curPop_btns">
						{{?!it.err}}<button class="button1 map_curPop_road_sbm">Да</button>{{?}}
						<button class="button1 map_curPop_move">Перейти</button>
						<button class="button1 map_curPop_cls">Нет</button>
					</div>
				{{??it.cls == 'impBuild'}}
					<div class="map_curPop_title">{{=it.imp.getName()}}</div>
					<div class="map_curPop_text">
						<div>
							<span class="{{?!it.imp.isEnoughWorkers()}}clr0{{?}}"> 
								{{=snip.unitCount(it.imp.getWorkers())}}
							</span>
							{{=snip.resBigListCheck(it.cost.res, wofh.town)}}
						</div>
						<div class="map_mode_imp_time">{{=timeMgr.fPeriod(it.time)}}</div>
						{{?utils.sizeOf(it.conflicts)}}
							<div class="-warn" style="margin:10px 0">
								{{=snip.mapImpLevel(it.imp)}}<br>
								 заменит собой <br>
								{{@it.conflicts: imp}}
									{{=snip.mapImpLevel(imp)}}<br>
								{{@}}
							</div>
						{{?}}
						{{?!it.err.isOk()}}
							Нельзя построить.<br/>
							{{?it.err.has(MapImp.buildErr.distance)}}Далеко от города<br/>{{?}}
							{{?it.err.has(MapImp.buildErr.relief)}}Сложный рельеф<br/>{{?}}
							{{?it.err.has(MapImp.buildErr.unit)}}Недостаточно рабочих.<br/>{{?}}
							{{?it.err.has(MapImp.buildErr.res)}}
								<div class="slotnew-info-warn -type-red m0500">
									Недостаточно ресурсов.
									<div>
										{{=snip.resBigList(it.cost.res.diffList(wofh.town.stock.getHasList()).onlyPositive().ceil())}}
									</div>
								</div>
							{{?}}
							{{?it.err.has(MapImp.buildErr.science)}}
								Не изучена 
								{{var imp = it.imp;}}
								
								{{=snip.scienceLink(imp.getScience(), {highlight:true})}}
								
								{{while(imp.canUp()){}}
									{{imp = imp.getUp();}}
									 или 
									{{=snip.scienceLink(imp.getScience(), {highlight:true})}}
								{{};}}
								
								
							{{?}}
							{{?it.err.has(MapImp.buildErr.level)}}Максимально возможный уровень улучшения уже построен.{{?}}
						{{?}}
					</div>
						<div class="map_curPop_btns">
							{{?it.err.isOk()}}
								<button class="button1 map_curPop_imp_sbm">Да</button>
								<button class="button1 map_curPop_cls">Нет</button>
							{{??}}
								<button class="button1 map_curPop_cls">Закрыть</button>
							{{?}}
						</div>
				{{??it.cls == 'spy'}}
					{{?!it.err}}
						<div class="map_curPop_title">Разведать территорию?</div>
						<div class="map_curPop_text">
							Займет  <img src="https://test.waysofhistory.com/img/_.gif" class="stimer"/> {{=timeMgr.fPeriod(it.time)}}<br/>
							Потребуется  
								{{~it.cost.units: unit}}
									<span class="nobr {{?unit.count > unit.have}}clr0{{?}}">
										<img class="unit u{{=unit.id}}" src="https://test.waysofhistory.com/img/_.gif" data-title="{{=lib.units.list[unit.id].name}}" /> {{=unit.count}}
									</span>
								{{~}}
							<br/>
							Внимание!<br/>
							Разведчики уже не вернутся<br/>
							обратно в город.<br/>
						</div>
						<div class="map_curPop_btns">
							<button class="button1 map_curPop_spy_sbm">Да</button>
							<button class="button1 map_curPop_cls">Нет</button>
						</div>
					{{??}}
						<div class="map_curPop_title">Невозможно разведать территорию</div>
						<div class="map_curPop_text">
							Не хватает разведчиков<br>
							{{~it.cost.units: unit}}
								<span>Потребуется  </span>
								<span class="-warn">
									{{=snip.unitCount(unit.id, unit.count)}}
								</span>
								<br>
								<span>Необходимо еще  </span>{{=snip.unitCount(unit.id, unit.count - unit.have)}}
								<br>
							{{~}}
						</div>
						<div class="map_curPop_btns">
							<button class="button1 map_curPop_cls">Закрыть</button>
						</div>
					{{?}}
				{{?}}
			</div>
		</script><script type="text/plain" id="noTowns">
    <div class="noTowns-wrp">
        <div class="noTowns-cont">
            <div class="noTowns-title">У вас не осталось ни одного города...</div>
            <div class="noTowns-block">
                <div class="noTowns-list-title">Это могло случиться, если:</div>
                <ul class="noTowns-list">
                    <li>Все твои города были разрушены врагом;</li>
                    <li>Ты достаточно долго не посещал игру;</li>
                    <li>Аккаунт был поставлен на удаление и с тех пор прошло 3 дня;</li>
                    <li>Ты был заблокирован за нарушение правил и срок блокировки закончился.</li>
                </ul>
                <div class="noTowns-link-wrp">
                    <a href="{{=appl.getOriginHost()}}/logout{{=location.search}}" class="link noTowns-link">Попробуй начать все сначала.</a>
                </div>
            </div>
        </div>
    </div>
</script><script type="text/plain" id="iTown">
    <div class="interface-town">
		<div class="town-loadIndicator-wrp"></div>
        <div class="town-town-wrp"></div>
        <div class="town-oldtown-wrp"></div>
		<div class="town-swapSlot-wrp"></div>
        <div class="town-mmenu-wrp"></div>
		<div class="town-right-wrp">
			<div class="panel-town-stock-wrp"></div>
			<div class="panel-town-garrison-wrp"></div>
			<div class="panel-town-bldqueue-wrp"></div>
		<div>
		<div class="panel-town-systmenu-wrp"></div>
        <div class="panel-town-admin-wrp"></div>
		<div class="panel-town-adminAddition-wrp"></div>
        <div class="town-questlist-wrp"></div>
        <div class="town-chat-wrp"></div>
        <div class="town-slots-wrp"></div>
        <div class="town-friends-wrp"></div>
		<div class="town-clock-wrp"></div>
    </div>
</script>

<script type="text/plain" id="loadIndicator">
	<div class="if-loadIndicator -hidden">Идёт загрузка данных...</div>
</script><script type="text/plain" id="bldqueue.header">
	{{?it.first}}
		{{=Slot.actions[it.first.getAction()].title}}
	{{?}}
</script>

<script type="text/plain" id="bldqueue">
	<div class="view-bldqueue">
		<div class="bldqueue-list-wrp"></div>
	</div>
</script>

<script type="text/plain" id="bldqueue.list">
	{{?it.first}}
		{{var actionId = it.first.getAction();}}
		
		<div class="bldqueue-list">
			<div>
				{{
					var slot = it.first.getBuildSlot();
					var slotApply = slot.applyEvents();
				}}
				
				<div class="bldqueue-first">
					<div class="bldqueue-first-back -type-{{?actionId == Slot.actionsIds.build}}build{{??actionId == Slot.actionsIds.rebuild}}rebuild{{??}}destroy{{?}}"></div>
					<div class="bldqueue-first-name -lenLim">
						{{?actionId == Slot.actionsIds.destroy}}
							{{=slot.getName()}}
						{{??}}
							{{=slotApply.getName()}}
						{{?}}
					</div>
					<div class="bldqueue-first-imgBack" data-type="0" href="build?pos={{=slotApply.getPos()}}">
						<div class="bldqueue-first-img" style="background-image:url({{=snip.buildImgBigPath(slotApply)}})"></div>
						<div class="bldqueue-first-progress" id="bldqueue-progress"></div>
						<div class="bldqueue-first-level">{{=slotApply.getLevel()}}</div>
						<a class="bldqueue-first-imgLink js-bldqueue-slot" href="{{=hashMgr.getWndHref('slot', slotApply.getPos())}}" data-title="Прогресс с учётом всего затраченного времени">
							<div class="bldqueue-first-perc" id="bldqueue-perc"></div>
						</a>
					</div>
					{{?slot.canImm()}}
						<a class="button2 -type-immediate" id="bldqueue-imm" data-title='{{=tmplMgr.bldqueue.alert.immediate({popUp:true})}}'></a>
					{{?}}
					
					<a class="button2 -type-delete" id="bldqueue-cancel" data-title="Отменить"></a>
					
					<div class="bldqueue-first-timeWrp">
						через  <span class="bldqueue-first-time">{{=snip.timer(it.first.getTime(), 'dec')}}</span>
						 в <span class="bldqueue-first-time">{{=timeMgr.fMoment(it.first.getTime(), true)}}</span>
					</div>
				</div>
				
				{{?it.queue}}
					{{~it.queue.getList(): event: pos}}
						{{slot = event.getBuildSlot();}}
						{{?pos>0}}
							<div class="bldqueue-queue-divider"></div>
						{{?}}
						<div class="bldqueue-queue-item" data-pos="{{=pos+1}}">
							<div class="bldqueue-queue-itemIcon" data-type="{{=event.getAction()}}"></div>
							<a class="bldqueue-queue-cancelBut button2-small -type-cancel" id="bldqueue-cancel"></a>
							<a class="js-bldqueue-slot" href="{{=hashMgr.getWndHref('slot', slot.getPos())}}">
								{{?event.getAction() == Slot.actionsIds.destroy || event.getAction() == Slot.actionsIds.destroylevel}}
									<span class="bldqueue-queue-itemName -lenLim">{{=slot.getName()}}</span>({{=slot.getLevel()}})
								{{??}}
									{{slotApply = slot.applyEvents();}}
									<span class="bldqueue-queue-itemName -lenLim">{{=slotApply.getName()}}</span>({{=slotApply.getLevel()}})
								{{?}}
							</a>

							<span class="fR">до {{=timeMgr.fMoment(event.getTime(), true)}}</span>
						</div>
					{{~}}
				{{?}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="bldqueue.alert.immediate">
	Моментально выполнить строительные работы.<br>
	{{var err = wofh.town.slots.canBuildUp();}}
	{{?err.has(ErrorX.ids.WEnoLuck)}}{{=tmplMgr.snipet.noCoins({popUp:(it||{}).popUp})}}
	{{??err.has(ErrorX.ids.WElimit)}}В настоящее время ускорение еще недоступно для этого города. Подожди еще {{=timeMgr.fPeriod(wofh.town.slots.calcBuildUpTime())}}
	{{??}}Завершить немедленно за {{=lib.luckbonus.buildupcost}} Монет Удачи. Сейчас в данном городе можно использовать бонус {{=utils.toInt(wofh.town.slots.calcImmCount())}} раз
	{{?}}
</script>


<script type="text/plain" id="bldqueue.alert.cancel">
	{{
		var action = it.event.getAction();
		var pos = +it.event.getBldQueuePos();
	}}

	{{?action == Slot.actionsIds.build}}
		Отменить строительство?
		{{?!pos}} Часть ресурсов уже не вернется.{{?}}
	{{??action == Slot.actionsIds.rebuild}}
		Отменить перестройку?
		{{?!pos}} Часть ресурсов уже не вернется.{{?}}
	{{??action == Slot.actionsIds.destroy}}
		Ты уверен, что хочешь отменить снос здания?
	{{??action == Slot.actionsIds.destroylevel}}
		Ты уверен, что хочешь отменить снос здания?
	{{?}}
</script>
			
			<script type="text/plain" id="chat.main">
	<div class="view-chat panel3" data-size="{{=it.size}}">
		<div class="chat-styles-wrp"></div>
		
		{{=tmplMgr.wnd.borders()}}
		
		<div class="panel3-cnt chat-cont">
			<div class="chat-announce-wrp"></div>
			<div class="chat-size-wrp"></div>
			<div class="chat-channels-wrp"></div>
			<div class="chat-mainCont">
				<div class="chat-invites-wrp"></div>
				<div class="chat-messages-wrp"></div>
				<div class="chat-answer-wrp"></div>
			</div>
			<div class="chat-chanInfo-wrp"></div>
			<div class="chat-smile-wrp"></div>
		</div>
	</div>
</script>
	
	<script type="text/plain" id="chat.styles">
		<style>
			.panel3 .wnd-borders-wrp > *{background-color: rgba({{=it.bgcolor+','+it.alpha}});}
			.view-chat:not([data-size="min"]) .chat-messages,
			.view-chat:not([data-size="min"]) .chat-messages-syst,
			.view-chat:not([data-size="min"]) .chat-invites{font-size: {{=it.fontSize}}pt;}
			.view-chat:not([data-size="min"]) .chat-messages-date{font-size: {{=it.fontSize*0.916}}pt;}
			.view-chat:not([data-size="min"]) .chat-messages-time{font-size: {{=it.fontSize*0.916}}pt;}
			.view-chat:not([data-size="min"]) .chat-answ-channel{font-size: {{=it.fontSize*0.916}}pt;}
			.view-chat:not([data-size="min"]) .chat-answ{font-size: {{=it.fontSize*0.916}}pt;}
			.view-chat:not([data-size="min"]) .chat-messages-wrp2,
			.view-chat:not([data-size="min"]) .chat-message{bottom: {{=15 + (it.fontSize - 9)}}pt;}
			.view-chat:not([data-size="min"]) .chat-answ-wrp{
				border: 2px solid rgba(144, 141, 134, 1);
				background-image: url(https://test.waysofhistory.com/img/gui/chat/chat_5.png), linear-gradient(to right, rgba({{=it.bgcolor}},{{=it.alpha}}) 90%, rgba(0,0,0,{{=it.alpha}}));
			}
		</style>
	</script>
	
	<script type="text/plain" id="chat.size">
		{{?it.invite}}
			{{?it.inviteExt}}
				<span class="chat-tabs-item -invite" style="margin-top: -3px">
					<span class="chat-tabs-item-back"></span>
					<a class="chat-tabs-item-link">Приглашения</a>
				</span>
			{{??}}
				<a class="chat-btn0 -type-invite chat-inviteBtn"></a>
			{{?}}
		{{?}}
		
		{{=tmplMgr.chat.search()}}
		
		<button class="chat-btn0 -type-sizeMin chat-size -for-min" data-size="min" data-title="Свернуть"></button>
		<button class="chat-btn0 -type-sizeMed chat-size -for-min -for-med" data-size="med" data-title="Свернуть"></button>
		<button class="chat-btn0 -type-sizeMed chat-size -for-med -for-max" data-size="med" data-title="Развернуть"></button>
		<button class="chat-btn0 -type-sizeMax chat-size -for-max" data-size="max" data-title="Развернуть"></button>
	</script>
	
	<script type="text/plain" id="chat.search">
		{{?wofh.account.isAdmin()}}
			<div class="chat-searchWrp -hidden">
				<input class="chat-search">
				
				<button class="chat-searchSet chat-tabs-new-ok" data-title="Подтвердить"></button>
			</div>
			
			<a class="chat-btn0 -type-search chat-searchBtn"></a>
		{{?}}
	</script>
	
	<script type="text/plain" id="chat.announce">
		<div>
			<div class="announce-message-wrp"></div>
		</div>
	</script>
	
		<script type="text/plain" id="chat.announce.message">
			<div>
				{{?it}}
					<div class="chat-announce -lenLim bgDark {{?it.icon==98||it.icon==99}}-type-nuc{{??it.account.id == Account.admin.id}}-type-adm{{?}}">
						<a class="chat-announce-text" href="{{=HashMgr.getHref('#/announce/')}}" data-title="Показать все объявления"></a>
						<img class="event ae{{=it.icon}}" src="https://test.waysofhistory.com/img/_.gif" />
						<span class="chat-ann-auth">{{=snip.accLink(it.account)}}:&nbsp;</span>
						{{=$('<div>'+TextParser.prepare(it.text)+'</div>').text()}} 
					</div>
				{{?}}
			</div>
		</script>
	

	<script type="text/plain" id="chat.channels.main">
		<div class="chat-channels">
			<button class="chat-channels-left"></button>
			<div class="chat-tabs-wrp">
				<ul class="chat-tabs">
					{{~it.list: item}}
						{{?item.new}}
							<li class="chat-tabs-item -new">
								<span class="chat-tabs-item-back"></span>
								<form class="chat-tabs-new">
									<input class="chat-tabs-new-name" maxlength="{{=lib.chat.maxchannelname}}"/>
									<div class="chat-microBtn-wrp -disabled">
										<button class="chat-microBtn -type-ok" data-title="Подтвердить"></button>
									</div>
									<button class="chat-microBtn -type-cancel" data-title="Отменить"></button>
								</form>
								<a class="chat-tabs-item-link" data-title="Создать новый чат"></a>
							</li>
							{{?debug.isTest('later')}}
								<li class="chat-tabs-item">
									<a href="{{=hashMgr.getWndHref('discord')}}" class="link bgDark" style="padding-left: 2px; vertical-align: -2px;">discord</a>
								</li>
							{{?}}
						{{??!item.disabled}}
							<li class="chat-tabs-item" data-name="{{=utils.escapeHtmlChat(item.name)}}" {{?item.color}}style="color: {{=snip.colorRGB(item.color)}}"{{?}}>
								<span class="chat-tabs-item-back"></span>
								
								<a class="chat-tabs-item-link {{?item.countryId}}-type-country{{?}} lenLim">{{=snip.hintWrp(item.title, item.title)}}</a>
								
								{{?item.type == cnst.chatChannelTypes.other && item.complex != true}}
									<a class="chat-tabs-item-del" data-title="Закрыть вкладку"></a>
								{{?}}
							</li>
						{{?}}
					{{~}}
				</ul>
			</div>
			<button class="chat-channels-right"></button>
		</div>
	</script>
	
	<script type="text/plain" id="chat.messages.main">
		<div class="chat-messages-wrp2">
			<div class="chat-messages -sel" id="chat-messages"></div>
		</div>
	</script>
	
		<script type="text/plain" id="chat.messages.block">
			<div class="chat-messages-block"></div>
		</script>
		
			
			<script type="text/plain" id="chat.messages.item">
				{{?it.syst==1}}
					<div class="chat-messages-date" data-id="{{=it.time}}">{{=it.text}}</div>
				{{??it.syst==2}}
					<div class="chat-messages-syst">
						<div class="chat-messages-nameTextWrp">
							<span class="chat-messages-time">({{=timeMgr.fMomentTime(it.time, true)}}) </span>
							{{=it.text}}
						</div>
					</div>
				{{??it.syst==3}}
					<div class="chat-messages-syst -type-red">{{=it.text}}</div>
				{{??}}
					<div class="chat-messages-item" data-id="{{=it.time}}" data-channel="{{=utils.escapeHtmlChat(it.channel)}}" {{?it.color}}style="color: rgb({{=it.color[0]}},{{=it.color[1]}},{{=it.color[2]}})"{{?}}>
						<div class="chat-messages-nameTextWrp -type-{{?it.account.id==wofh.account.id}}this{{??}}odd{{?}}">
							<span class="-nobr">
								<span class="chat-messages-time">({{=timeMgr.fMomentTime(it.time, true)}}) </span>
								<a class="chat-messages-name js-tooltip" data-tooltip-wnd="account" data-id="{{=it.account.id}}">
									{{=snip.accIcon(it.account)}}
									{{=it.account.name}}
								</a>:&nbsp;
							</span>
							
							<span class="chat-messages-text bgDark">{{=TextParser.prepare(it.text)}}</span>
						</div>
						<span class="chat-messages-butWrp">
							{{?it.account.id != Account.admin.id}}
								<a class="chat-messages-but -info" data-title="Информация об игроке" href="{{=HashMgr.getHref('#/account/'+it.account.id)}}"></a>
								<button class="chat-messages-but -ban" data-title="{{=tmplMgr.snipet.chat.ban({})}}"></button>
							{{?}}
							{{?wofh.account.isAdmin()}}<button class="chat-messages-but -del" data-title="Удалить сообщение"></button>{{?}}
						</span>
					</div>
				{{?}}
			</script>

		<script type="text/plain" id="chat.messages.standart">
			<div class="chat-message-syst bgDark">
				{{?it.type == ChatMgr.commandGet.channelInfo2 || it.type == ChatMgr.commandGet.noAccess}}
					У тебя недостаточно прав для нахождения в чате <b>{{=it.channel.title}}. </b><br>
					Обратись к {{=snip.chatUser(ChatMgr.userStatus.admin, 'Повелителю этого чата')}} — <b>{{=snip.accLink(it.channel.admin)}}</b> 
					{{var moderatorsCount = utils.sizeOf(it.channel.moderators);}}
					{{?moderatorsCount}}
						 или к 
						{{?moderatorsCount > 1}}
							любому 
						{{?}}
						{{=snip.chatUser(ChatMgr.userStatus.moderator, 'Надсмотрщику')}}
						 
						{{?moderatorsCount > 1}}
							из 
						{{?}}
						<b>{{=snip.list(it.channel.moderators, snip.accLink)}}</b>
						
					{{?}}
				{{??it.type == ChatMgr.commandGet.channelAddUser}}
					{{?it.action}}
						{{=snip.accLink(it.acc)}} присоединился к чату
					{{??}}
						{{=snip.accLink(it.acc)}} покинул <b>{{=it.channel.title}}</b>
					{{?}}
				{{??it.type == ChatMgr.commandGet.channelAddModer}}
					{{?it.action}}
						{{=snip.accLink(it.acc)}} был повышен до <b>{{=snip.chatUser(ChatMgr.userStatus.moderator, 'Надсмотрщика в чате')}}</b>
					{{??}}
						{{=snip.accLink(it.acc)}} был освобожден от обязанностей <b>{{=snip.chatUser(ChatMgr.userStatus.moderator, 'Надсмотрщика в чате')}}</b>
					{{?}}
				{{??it.type == ChatMgr.commandGet.channelAddAdmin}}
					{{=snip.accLink(it.acc)}} сложил с себя обязанности <b>{{=snip.chatUser(ChatMgr.userStatus.admin, 'Повелителя')}}</b> и отправился в добровольное изгнание на пост простого <b>{{=snip.chatUser(ChatMgr.userStatus.moderator, 'Надсмотрщика в чате')}}</b>
				{{??it.type == ChatMgr.commandGet.enter}}
					Будь вежлив в общении и соблюдай игровые <a class="link" href="{{=HashMgr.getHref('#/help/rules')}}">правила</a> в полном объеме.
				{{?}}
			</div>
		</script>
		
	
	<script type="text/plain" id="chat.answer.main">
		<form class="chat-message">
			<div class="chat-answ-wrp">
				<span class="chat-answ-channel"></span>
				<span class="chat-answ">
					<span class="chat-answ-text" contenteditable="true"></span>
				</span>
				<button class="chat-answ-smile" type="button"></button>
			</div>
			<button class="button7 -type-green chat-send">Отправить</button>
		</form>
	</script>
	
	
	<script type="text/plain" id="chat.smile.main">
		<div class="chat-smileWrp -hidden">
			<div class="backClick"></div>
			<div class="chat-smilePan">
				<div class="chat-smilePan-list">
					<!--{{@it.list: group: groupName}}
						{{@group: smile: code}}
						<a class="chat-smilePan-smile">{{=snip.smile(smile, code, groupName)}}</a>
						{{@}}
					{{@}}-->
				</div>
				<div class="chat-smilePan-buts">
					<button class="chat-smilePan-but" data-type="star"></button>
					<button class="chat-smilePan-but" data-type="emo"></button>
					<button class="chat-smilePan-but" data-type="res"></button>
					/*<button class="chat-smilePan-but" data-type="stock"></button>*/
				</div>
				<div class="chat-smilePan-arrow">
			</div>
		</div>
	</script>
	
		
		<script type="text/plain" id="chat.smile.item">
			<a class="chat-smilePan-smile">{{=snip.smile(it.smile, it.code, it.group)}}</a>
		</script>
		
	<script type="text/plain" id="chat.chanInfo.main">
		<div class="chat-info">
			<div class="chanInfo-list-wrp"></div>
			<div class="chanInfo-invite-wrp"></div>
		</div>
	</script>

		<script type="text/plain" id="chat.chanInfo.list.main">
			{{var itemTmpl = tmplMgr.chat.chanInfo.list.item;}}
			<div>
				{{?it.channel.admin}}
					{{=itemTmpl({channel: it.channel, acc: it.channel.admin, status: ChatMgr.userStatus.admin})}}
				{{?}}
				{{@it.channel.moderators: acc}}
					{{=itemTmpl({channel: it.channel, acc: acc, status: ChatMgr.userStatus.moderator})}}
				{{@}}
				<div class="chat-info-divider"></div>
				<div class="chat-info-usersList">
					{{@it.channel.users: acc}}
						{{=itemTmpl({channel: it.channel, acc: acc, status: ChatMgr.userStatus.user})}}
					{{@}}
				</div>
				<div class="chat-info-actionsWrp"></div>
			</div>
		</script>


			<script type="text/plain" id="chat.chanInfo.list.item">
				<div class="chat-info-user -type-{{?it.status == ChatMgr.userStatus.admin}}admin{{??it.status == ChatMgr.userStatus.moderator}}moderator{{??}}user{{?}}" {{?it.acc}}style="color: {{=snip.colorRGB(it.acc.color)}}!important"{{?}}>
					{{=snip.chatUser(it.status)}}
					
					<a class="chat-info-user-link" data-id="{{=it.acc ? it.acc.id : ''}}" data-status="{{=it.status}}">{{=snip.accLink(it.acc, {link: false, lenLim: 115})}}</a>
				</div>
			</script>

			<script type="text/plain" id="chat.chanInfo.list.actions">
				<div class="chat-info-actions bgDark">
					<a class="chat-microBtn -type-cancel chat-info-actions-close"></a>
					{{=snip.accLink(it.acc)}}

					{{?it.status < it.channel.myStatus}}
						{{?it.channel.myStatus == ChatMgr.userStatus.admin}}
							<button class="button7 -type-blue chat-info-action -type-up">Повысить</button>
						{{?}}
						{{?it.status == ChatMgr.userStatus.moderator}}
							<button class="button7 -type-red chat-info-action -type-down">Понизить</button>
						{{?}}
						<button class="button7 -type-red chat-info-action -type-exit">Изгнать</button>
					{{?}}
					
					{{?it.acc.id == wofh.account.id && (!it.channel.isAdminQuit() || it.channel.canClose())}}
						<button class="button7 -type-red chat-info-action -type-quit">Выйти</button>
					{{?}}
				</div>
			</script>

		<script type="text/plain" id="chat.chanInfo.invite">
			{{?it.canShow}}
				<form class="chat-info-invite">
					<input placeholder="Имя игрока" class="chat-info-invite-name" />
					<a class="chat-microBtn -type-cancel chat-info-invite-close"></a>
					<div class="chat-info-invite-alert -warn"></div>
					<button class="button7 -type-grey chat-info-invite-submit">Пригласить</button>
				</form>
			{{?}}
		</script>

	<script type="text/plain" id="chat.invites">
		{{?it.show}}
			<div class="chat-invites">
				{{@it.list: invite}}
					<div class="chat-invites-item" data-name="{{=invite}}">
						Приглашение в <b>#{{=invite}}</b>. 
						<a class="link chat-invites-accept">Принять</a> или 
						<a class="link chat-invites-reject">Отказаться</a>?
					</div>
				{{@}}
			</div>
		{{?}}
	</script>
	
	
<script type="text/plain" id="discord.header">
	discord
</script>

<script type="text/plain" id="discord">
    <div class="view-discord">
		<iframe src="https://test.waysofhistory.com/other?file=test" width="350" height="500" allowtransparency="true" frameborder="0"></iframe>
	</div>
</script><script type="text/plain" id="clock">
    <div class="view-clock">
        <a class="clock-timerWrp" data-title="Изменить часовой пояс">
			<span class="clock-timer">{{=snip.timer(0, 'now')}}</span>
		</a>
        <select class="clock-select">
            {{
                var timezone = wofh.account.getTimeZone();
                for(var i = -12; i<=13; i++){}}
                <option value="{{=i}}" {{?timezone == i}} selected{{?}}>UTC{{?i}} {{=i>0?'+'+i:i}}:00{{?}}</option>
            {{}}}
        </select>
    </div>
</script>

<script type="text/plain" id="friends.list">
    <a class="friends-toggle"></a>
    <a class="friends-new">Пригласи друга</a>
    <div class="friends-listWrp">
        <ul class="friends-list">
            {{@ it.users: user}}
                {{?user.empty}}
                    <li class="friends-item -empty">
                        Пригласи друга
                        <a class="friends-link friends-empty"></a>
                    </li>
                {{??}}
                    <li class="friends-item {{?user.id==wofh.account.id}}-active{{?}}">
                        <div class="friends-photo" style="background-image: url({{= user.photo }})"></div>
                        <div class="friends-name -lenLim" data-title="{{= user.first_name }} {{= user.last_name }}">{{= user.first_name }} {{= user.last_name }}</div>
                        {{?user.rate}}<div class="friends-rate">{{= snip.pop(user.rate) }}</div>{{?}}
                        {{?user.id}}
                            <a class="friends-link" href="{{=HashMgr.getHref('#/account/'+user.id)}}"></a>
                        {{?}}
                    </li>
                {{?}}
            {{@}}
        </ul>
    </div>
    {{?utils.sizeOf(it.users) > it.maxLen}}
        <a class="friends-left -disabled"></a>
        <a class="friends-right"></a>
    {{?}}
</script>

<script type="text/plain" id="friends.main">
    <div class="view-friends {{?ls.getFriendsShow(true)}}-expanded{{?}}" id="view-friends">
        <div class="friends-cont">
        </div>
    </div>
</script><script type="text/plain" id="garrison.header">
	Войска
</script>

<script type="text/plain" id="garrison">
    <div class="view-garrison">
        <div class="garrison-list-scroll">
            <div class="garrison-garrison-wrp"></div>
        </div>
    </div>
</script>

<script type="text/plain" id="garrison.footer">
	{{?Quest.isAvail(lib.quest.ability.sendarmy)}}
		<a href="{{=hashMgr.getWndHref('army')}}" class="button1 garrison-armyLink" data-title="Открыть все военные дела города">Военные дела</a>
	{{?}}
</script>

<script type="text/plain" id="garrison.garrison.main">
    <ul id="garrison-list" class="garrison-list{{?it.full}} -full{{?}}">
        {{@it.list.getList(): unit}}
            <li>
                <span class="garrison-unit-text">
                    {{=snip.nobr(snip.unitCountLink(unit) + (it.full? ' '+unit.getName(): ''))}}
                </span>
            </li>
        {{@}}
    </ul>
</script><script type="text/plain" id="mmenu">
	<div class="view-mmenu">
		<div class="mmenu-wrp">
			<div class="mmenu-back"></div>
			<div class="mmenu-cont">
				<div class="mmenu-btns-wrp"></div>
				<div class="mmenu-row2">
					<div class="mmenu-pop-wrp"></div>
					<div class="mmenu-afterPop">
						<div class="mmenu-towns-wrp"></div>
						<div class="mmenu-trade-wrp"></div>

						<div class="mmenu-attacks-wrp"></div>
					</div>
				</div>

				<div class="town-defence-wrp"></div>

				<div class="mmenu-luck-wrp"></div>
			</div>
		</div>

		<div class="mmenu-trCorner">
			<div class="town-bonus-wrp"></div>
			<div class="mmenu-toggleIf-wrp"></div>
		</div>

		<div class="mmenu-mute-wrp"></div>
	</div>
</script>

<script type="text/plain" id="mmenu.luck">
	<div class="mmenu-luck {{?it.alarm || it.alarmSpec}}-alarm -anim-blink2{{?}}">
		{{?it.galaxy}}
			<a class="mmenu-luck-chest" href ="{{=hashMgr.getWndHref(wofh.account.isAdmin() ? 'bonus' : 'chest')}}">
				{{=tmplMgr.chest.galaxy()}}
			</a>
		{{??}}
			<a href="{{=HashMgr.getHref('#/bonus')}}" class="mmenu-luck-back" data-title="Удача это улучшение интерфейса, увеличение производства, культуры, прироста населения и еще масса возможностей"></a>
		{{?}}
		<a href="{{=HashMgr.getHref('#/bonus')}}" class="mmenu-luck-cont" data-title="Удача это улучшение интерфейса, увеличение производства, культуры, прироста населения и еще масса возможностей">
			{{?it.alarm}}
				{{=snip.alert('Пора продлить бонус')}}
			{{??it.alarmSpec}}
				{{=snip.alert('У тебя есть кто-то новый из Великих Граждан. Может, пора поселить его в город?')}}
			{{?}}
			Удача
		</a>
	</div>
</script>

<script type="text/plain" id="mmenu.bonus">
	{{?!utils.isEmpty(it.bonuses)}}
		{{@it.bonuses: bonus: bonusId}}
			<div class="mmenu-bonus">
				<a 
						class="luckTambourine {{?!it.action}}-type-bonuses{{?}}" 
						data-title="{{?it.action}}{{=it.actionTitle[bonusId]}}{{??}}Получи преимущество{{?}}" 
						data-id={{=bonusId}}>
					<span class="luckTambourine-title">Получи</span>
					{{?bonusId == bMMenu_bonus.luck}}
						<div class="luckTambourine-circle-small -type-luck">
							<div class="luckTambourine-roller"></div>
							<span class="luckTambourine-bonus">{{=snip.luckBig({noTitle:true})}}<br>{{=bonus.sum}}</span>
						</div>
						<span class="luckTambourine-time">{{=snip.timer(bonus.time, 'dec')}}</span>
					{{??bonusId == bMMenu_bonus.specialist}}
						<div class="luckTambourine-circle-small -type-specialist">
							<span class="luckTambourine-text -top">в подарок</span>
							<div class="luckTambourine-blink"></div>
							<span class="luckTambourine-text -bottom">Великого Гражданина</span>
						</div>
						<span class="luckTambourine-time">{{=snip.timer(bonus.time, 'dec')}}</span>
					{{??}}
						<div class="luckTambourine-circle -type-{{=utils.cnstName(LuckBonus.ids, bonusId)}}">
							<span class="luckTambourine-effect">
								{{?bonusId == LuckBonus.ids.accountPremium}}
									<span class="luckTambourine-effect-main">Царь</span>
									аккаунт
								{{??}}
									{{var effect = bonus.getTypedEffectUp();}}
									{{?bonusId == LuckBonus.ids.grown}}
										Население
										<span class="luckTambourine-effect-main">+{{=~~effect}}</span>
									{{??bonusId == LuckBonus.ids.culture}}
										Культура
										<span class="luckTambourine-effect-main">+{{=~~effect}}</span>
									{{??bonusId == LuckBonus.ids.science || bonusId == LuckBonus.ids.sciencePack}}
										Знания
										<span class="luckTambourine-effect-main">+{{=~~effect.count}}</span>
									{{??bonusId == LuckBonus.ids.production || bonusId == LuckBonus.ids.productionPack}}
										<div class="luckTambourine-prodRes">{{=snip.resList(effect.sortByCount(), {filter: 'prepCount'})}}</div>
									{{??bonusId == LuckBonus.ids.traders}}
										Торговцы
										<span class="luckTambourine-effect-main">+{{=~~effect}}</span>
									{{??bonusId == LuckBonus.ids.war}}
										Бонус
										<span class="luckTambourine-effect-main">Войны</span>
									{{?}}
								{{?}}
							</span>
						</div>
						{{?bonusId == LuckBonus.ids.accountPremium || !bonus.isMomental()}}
							<span class="luckTambourine-perc">
								{{?bonusId == LuckBonus.ids.accountPremium}}<b>удобство</b>
								{{??bonusId == LuckBonus.ids.war}}<b>+{{=Math.round(bonus.getEffectUp()*100)}}%</b>
								{{??}}(<b>+{{=Math.round(bonus.getEffectUp()*100)}}%</b>)
								{{?}}
							</span>
						{{?}}
						<span class="luckTambourine-period {{?bonusId != LuckBonus.ids.accountPremium && bonus.isMomental()}}-type-momental{{?}}">
							{{?bonusId == LuckBonus.ids.accountPremium}}на неделю
							{{??bonus.isMomental()}}мгновенно
							{{??!bonus.isWeekly()}}на неделю
							{{??}}за неделю
							{{?}}
						</span>
					{{?}}
				</a>
				{{?!(bonusId == bMMenu_bonus.luck || bonusId == bMMenu_bonus.specialist)}}<a class="luckTambourine-close"></a>{{?}}
			</div>
		{{@}}
	{{?}}
</script>

<script type="text/plain" id="mmenu.pop">
    {{var blink = it.ext.townWorkPop <= 0.9;}}
    
    <div class="mmenu-pop {{?it.ext.lessPop}}-extended{{?}} {{?it.ext.blink && wofh.town.pop.has < 100}}-type-rainbow{{?}}">
        {{?it.ext.blink}}
            {{?wofh.town.pop.has >= 100}}
                <div class="mmenu-pop-animWhite" style="animation-duration: {{=(it.ext.townWorkPop/0.9*3+1).toFixed(1)}}s;"></div>
            {{?}}
        {{??it.ext.maxWorkPop > utils.toInt(it.has)}}
            <div class="mmenu-pop-animZzz" data-title="В городе не хватает людей чтобы занять простаивающие рабочие места"></div>
        {{??it.ext.maxWorkPop < utils.toInt(it.has)}}
            <div class="mmenu-pop-animZzz2" data-title="В городе не хватает рабочих мест, чтоб занять всех безработных"></div>
        {{?}}
        
        <a class="mmenu-pop-link" href="{{=HashMgr.getHref('#/economics/rule')}}" data-title="Распределение населения города">
            {{?it.ext.lessPop}}
                <span class="mmenu-pop-info">
                    {{?it.ext.lessPopLimit != bMMenu_pop.lessPopLimitIds.no}}
                        {{=snip.alert(bMMenu_pop.lessPopLimit[it.ext.lessPopLimit].text, {cls:'mmenu-pop-limitAlert', blink:it.ext.lessPopAlarm})}}
                    {{?}}

                    {{=tmplMgr.mmenu.pop.has(it)}}
                </span>
                <br>
            {{??}}
                {{=tmplMgr.mmenu.pop.has(it)}}
                <br>
            {{?}}

            <span data-color="{{=it.incReal<0?'red':(it.incReal==0?'grey':'green')}}" data-title="Прирост населения в день{{?it.has >= it.culture}}. Население не растет, ибо достигнут предел культуры{{?}}">
                {{=utils.signFixed(it.incReal, 1)}}
            </span>

            {{?it.ext.lessPop}}<span class="mmenu-pop-title">Распределить</span>{{?}}

            {{var res = wofh.town.calcFeatureRes();}}
            <span class="mmenu-pop-ind">
                {{?res}}{{=snip.resBig(res)}}
                {{??}}<span class="mmenu-pop-indEmpty"></span>
                {{?}}
            </span>
        </a>
    </div>
</script>

<script type="text/plain" id="mmenu.pop.has">
	<span 
			data-color="{{?it.has>=it.culture}}white{{??it.has+it.incReal>=it.culture}}blue{{??it.incReal<0}}red{{??}}green{{?}}" 
			data-title="Население города без учета армии / Культурный предел города по населению.{{?it.incReal>0}}<br>Предел будет достигнут через {{=timeMgr.fPeriod((it.culture-it.has)/it.incReal*24*3600)}}{{?}}">
		{{=snip.pop(utils.toInt(it.has))}}/{{=utils.stages(utils.toInt(it.culture))}}
	</span>
</script>

<script type="text/plain" id="mmenu.defence">
	<div class="mmenu-defence">
		{{?it.defmoment}}
			<a class="mmenu-peace" data-title="Действует защита от любых нападений других игроков">
				{{=snip.timer(it.defmoment, 'dec', false, false, {cls: 'mmenu-defence-text'})}}
			</a>
		{{?}}
		{{?it.attacks}}
			<a class="mmenu-war" href="{{=HashMgr.getHref('#/attacks')}}" data-title="Все нападения на все города"><div class="mmenu-defence-text">{{=it.attacks}}</div></a>
		{{?}}
	</div>
</script>

<script type="text/plain" id="mmenu.defence.alert.peace">
	<div class="paragraphs" style="padding: 30px 20px; text-align: left;">
		<p>Первое время после начала игры на твой город действует защита от нападений других игроков.</p>
		<br>
		<p>Потрать это время с умом. Развивайся, укрепляй и отстраивай свой город, находи новых друзей.</p>
		<br>
		<p>Внимательно проходи начальные задания. Они помогут тебе правильно обустроиться в этом мире.</p>
		<br>
		<p>В <b>{{=timeMgr.fMoment(wofh.town.army.defmoment)}}</b> защита твоего города закончится и тогда все будет зависеть уже только от тебя.</p>
		<p>Готовься...</p>
		<p>Тебе осталось <b>{{=timeMgr.fPeriod(wofh.town.army.defmoment - timeMgr.getNow())}}</b>...</p>
	</div>
</script>

<script type="text/plain" id="mmenu.towns">
	{{?Quest.isAvail(Quest.ids.townRename)}}
		<form class="mmenu-towns" tabindex="1">
			<div class="mmenu-towns-cont mmenu-towns-item">
				{{=snip.townIcon(false, Tile.relation.self)}} <span class="mmenu-towns-name">{{=wofh.town.name}}</span>
				{{?utils.sizeOf(wofh.towns) != 1}}
					<button class="mmenu-towns-expand" type="button"></button>
				{{?}}
				
				{{=tmplMgr.mmenu.towns.rename()}}
			</div>
			{{?utils.sizeOf(wofh.towns) > 1}}
				<a class="mmenu-towns-sel"></a>
				
				<ul class="mmenu-towns-list">
					{{@it.towns: town}}
						<li>
							<a data-id="{{=town.id}}" class="mmenu-towns-item {{?wofh.town.id==town.id}}-active{{?}}">
								{{=snip.town(town)}}
								{{?wofh.account.isPremium()}}
									{{var res = town.calcFeatureRes();}}
									{{?res}}
										<span class="mmenu-towns-featureRes">{{=snip.res(res)}}</span>
									{{?}}
								{{?}}
							</a>
						</li>
					{{@}}
					{{?wofh.account.isPremium() && utils.sizeOf(it.towns) > 1}}
						<li>
							<div class="mmenu-towns-item switchTownHint">
								<div class="switchTown -type-left" onclick="wofh.account.switchTown(true); return false;">← + Ctrl</div>
								<div class="switchTown -type-right" onclick="wofh.account.switchTown(); return false;">Ctrl + →</div>
							</div>
						</li>
					{{?}}
				</ul>
			{{?}}
		</form>
	{{?}}
</script>

<script type="text/plain" id="mmenu.towns.rename">
	{{?Quest.isAvail(Quest.ids.townRename) && utils.sizeOf(wofh.towns)<3}}
		<a class="mmenu-towns-edit {{?Quest.isActive(Quest.ids.townRename)}}-active{{?}}" href="{{=hashMgr.getWndHref('economics', 'rule')}}" data-title="Переименовать город"></a>
	{{?}}
</script>

<script type="text/plain" id="mmenu.trade">
	<div class="mmenu-trade">
		{{var marketDisplayInfo = wMarket.getDisplayInfo();}}
		
		{{?marketDisplayInfo.name}}
			<a class="iconMarket -type-market" href="{{=hashMgr.getWndHref(marketDisplayInfo.name)}}" data-title="{{=marketDisplayInfo.title}}"></a>
		{{?}}
		
		{{=tmplMgr.mmenu.trade.send()}}
		
		<a class="iconMarket -type-traders -color-black {{?wofh.account.isPremium()}}-wide{{?}}" href="{{=hashMgr.getWndHref('tradersMove')}}" data-title="Передвижение торговцев">
			{{?wofh.account.isPremium()}}
				<span data-title="Свободные торговцы">{{=wofh.town.traders.count-wofh.town.traders.busy}}</span>/<span data-title="Общее количество торговцев">{{=wofh.town.traders.count}}</span>
			{{?}}
		</a>
	</div>
</script>

<script type="text/plain" id="mmenu.trade.send">
	<a class="iconMarket -type-send" href="{{=hashMgr.getWndHref('send')}}" data-title="Транспортировка ресурсов"></a>
</script>

<script type="text/plain" id="mmenu.btns">
	<div class="mmenu-btns {{?it.ext}}-extended{{?}}">
		{{=tmplMgr.mmenu.btns.cont(it)}} 
	</div>
</script>

<script type="text/plain" id="mmenu.btns.cont">
	{{@it.btns: btn}}
		{{?btn.canDisplay()}}{{=btn.getTmpl()}}{{?}}
	{{@}}
	<div class="btns-money-wrp"></div>
	<div class="btns-science-wrp"></div>
</script>

<script type="text/plain" id="mmenu.btns.money">
	{{?it.btn.canDisplay()}}
		{{=it.btn.getTmpl()}}
	{{?}}
</script>

<script type="text/plain" id="mmenu.btns.btn.money.cont">
	{{?!it.isExt()}}
		{{var money = it.getParent().data.money;}}
		<span class="mmenu-money-has">{{=snip.coloredNum(money.treasury, {noPosSignColor:true, int:true, KM:true})}}</span>
		<span class="mmenu-money-inc -type-{{?money.inc>=0}}up{{??}}down{{?}}">{{=snip.sign(utils.toInt(money.inc), utils.KMFloor(utils.toInt(money.inc)))}}</span>
	{{?}}
</script>

<script type="text/plain" id="mmenu.btns.science">
	{{?it.btn.canDisplay()}}
		{{=it.btn.getTmpl()}}
	{{?}}
</script>

<script type="text/plain" id="mmenu.btns.btn.science.cont">
	{{var science = it.getParent().data.science;}}
	
	{{?it.isExt()}}
		{{=snip.scienceImgHoverBig(science)}}
		<span class="mmenu-sci-extTitle">Наука</span>
	{{??}}
		{{=snip.scienceImgHover(science)}}
	{{?}}
	
	<span class="mmenu-btn-inner">
		{{var perc = science.getProgressPerc(true);}}
		
		<span class="mmenu-sci-prog" style="width: {{=100 - Math.min(100, perc)}}%"></span>
		
		{{?!science.isEmpty()}}
			<span class="mmenu-sci-perc -nobr lenLim">
				{{?wofh.country && wofh.country.isScienceDipOff()}}
					{{=snip.alert('Недостаточно Очков Дипломатии.<br>Наука не изучается.')}}
				{{?}}
				{{?science.isDebt()}}
					{{=utils.KMFloor(utils.toInt(science.getCost()))}}
				{{??}}
					{{=perc}}%
				{{?}}
			</span>
			
			{{var timeLeft = science.getTimeLeft(true) * 3600;}}
			
			{{?timeLeft}}
				<span class="mmenu-sci-timer">{{=snip.time2()}}{{=snip.timer(timeLeft + timeMgr.getNow(), 'dec')}}</span>
			{{?}}
		{{?}}
	</span>
</script>

<script type="text/plain" id="mmenu.btns.btn">
	<a class="mmenu-btn{{?it.isExt()}}Big{{?}} -type-{{=it.getType()}} {{=it.getCls()}}" href="{{=it.getHref()}}" data-title="{{=it.getTitle()}}" {{=it.getAttrs()}}>
		{{=it.getContTmpl()}}
	</a>
</script>

<script type="text/plain" id="mmenu.btns.btn.cont">
	{{?it.isExt()}}
		{{=it.getTitle()}}
	{{?}}
</script>

<script type="text/plain" id="mmenu.btns.btn.contCountry">
	{{?wofh.country}}
		<span class="mmenu-country-flag" style="background-image: url({{=snip.countryFlagPath(wofh.country, true)}})"></span>
		
		{{?!it.isExt() && wofh.country.hasAttackIn()}}
			<span class="mmenu-country-attack -anim-blink">{{=snip.eventIconArmy('a', 'i')}}</span>
		{{?}}
	{{?}}
	
	{{=tmplMgr.mmenu.btns.btn.cont(it)}}
	
	{{=tmplMgr.mmenu.btns.btn.invite()}}
</script>

<script type="text/plain" id="mmenu.btns.btn.invite">
	{{?wofh.account.invites.length}}
		<span class="mmenu-invite {{?wofh.account.getLastInvite()>servBuffer.serv.lastEnter.countryJoin}}-anim-blink{{?}}">
			{{=snip.icon(snip.c.anyIcon, 'countryInvite')}}
		</span>
	{{?}}
</script>

		
<script type="text/plain" id="mmenu.toggleIf">
	{{?Quest.isAvail(Quest.ids.bldHouse3)}}
		<button class="mmenu-toggleIf js-mmenu-toggleIf" data-title="Скрыть интерфейс"></button>
	{{?}}
</script>
		
<script type="text/plain" id="mmenu.mute">
	<button class="buttonMute {{?it.active}}-active{{?}} mmenu-mute"></button>
</script>

<script type="text/plain" id="mmenu.attacks">
	{{=tmplMgr.mmenu.attacks.before(it)}}
	
	<div class="mmenu-attacks">
		{{?Quest.isAvail(lib.quest.ability.sendarmy)}}
			<a class="mmenu-attacks-back" href="{{=HashMgr.getWndHref('army')}}"></a>
		{{?}}
		<ul class="mmenu-attacks-list">
			{{=tmplMgr.mmenu.attacks.label({data:it, type:'attackIn', title:"Атака на город"})}}
			
			{{=tmplMgr.mmenu.attacks.label({data:it, type:'attackOut'})}}
			
			{{=tmplMgr.mmenu.attacks.label({data:it, type:'defenceIn'})}}
			
			{{=tmplMgr.mmenu.attacks.label({data:it, type:'defenceOut'})}}
		</ul>
	</div>
	
	{{=tmplMgr.mmenu.attacks.after(it)}}
</script>

<script type="text/plain" id="mmenu.attacks.label">
	{{var event = it.data[it.type];}}
    
	{{?event}}
		<li class="iconAttacks -type-{{=it.type}}" {{?it.title}}data-title="{{=it.title}}"{{?}}>
			×{{=event.count}}{{=snip.timer(event.time, 'dec', false, false, {cls: 'iconAttacks-timer', attrs: utils.makeDataAttrStr({alerttime: 60})})}}
		</li>
	{{?}}
</script>

<script type="text/plain" id="mmenu.attacks.battle">
	{{?it.battle.state != EventCommon.battleState.delete}}
		<div class="mmenu-attacks-bigItem bgDark -type-battle">
			<div class="mmenu-attacks-bigText">
				{{?it.battle.state == EventCommon.battleState.active}}
					Бой у города 
					{{?it.battle.session != lib.war.nodefsession}}
						<a class="link js-battleLink" target="_blank" href="{{=snip.getBattleLink({session: it.battle.session, secret: it.battle.secret, town: wofh.town.id})}}">Смотреть</a>
					{{?}}
				{{??it.battle.state == EventCommon.battleState.enter || it.battle.state == EventCommon.battleState.wait}}Бой у города начинается
				{{??it.battle.state == EventCommon.battleState.finished}}Бой у города завершается
				{{?}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="mmenu.attacks.before">
	{{=tmplMgr.mmenu.attacks.battle(it)}}
</script>

<script type="text/plain" id="mmenu.attacks.after">
</script>





<script type="text/plain" id="smmenu">
	<div class="view-smmenu {{?it.opened}}-type-opened{{?}}">
		<div class="smmenu-toggle"></div>
		<div class="smmenu-wrps">
			<div class="smmenu-btns-wrp"></div>
			<div class="smmenu-trade-wrp"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="smmenu.btns">
	<div class="smmenu-btns">
		{{=tmplMgr.mmenu.btns.cont(it)}}
	</div>
</script>

<script type="text/plain" id="smmenu.btns.money">
	{{=tmplMgr.mmenu.btns.money(it)}}
</script>

<script type="text/plain" id="smmenu.btns.science">
	{{=tmplMgr.mmenu.btns.science(it)}}
</script>

<script type="text/plain" id="smmenu.trade">
	{{=tmplMgr.mmenu.trade(it)}}
</script><script type="text/plain" id="questlist">
	{{?it}}
		<div class="view-questlist {{?it.listType == bQuestList.type.img}}-type-text{{?}} {{?it.list.hasFinished}}-hasFinished{{?}}">
			{{?it.list.length}}
				<a class="quest-roll {{?it.listType == bQuestList.type.img}}-type-text{{?}} js-quest-roll"></a>
				
				<a class="quest-btn -type-up {{?it.listType == bQuestList.type.text}}-type-text{{?}}"></a>
			{{?}}
			
			{{?it.listType == bQuestList.type.text}}
				<div class="quest-listTextWrp" style="max-height: {{=Math.max(utils.getWindowHeight(-150), 20)}}px;">
					<ul class="quest-list-text">
						{{=tmplMgr.questlist.listText(it)}}
					</ul>
				</div>
			{{??}}
				<div class="quest-listWrp {{?Quest.isUnavail(Quest.ids.attackBarb)}}-active{{?}}" style="max-height: {{=bQuestList.calcMaxHeight(it.itemHeight)}};">
					<ul class="quest-list">
						{{=tmplMgr.questlist.list(it)}}
					</ul>
				</div>
			{{?}}
			{{?it.list.length}}
				<a class="quest-btn -type-down {{?it.listType == bQuestList.type.text}}-type-text{{?}}"></a>
			{{?}}
		</div>
	{{?}}
</script>



<script type="text/plain" id="questlist.list"> 
	{{~it.list: quest}}
		<li class="quest-item js-quest-link {{?quest.isStatusBonus()}}-state-finish{{??quest.new}}-type-new{{?}}" data-id="{{=quest.getId()}}">
            <div class="quest-back">
                <div class="quest-icon -type-{{=utils.cnstName(Quest.givers, quest.getGiver())}}"></div>
                <div class="quest-giver -type-{{=utils.cnstName(Quest.givers, quest.getGiver())}}"></div>
            </div>
            
            <div class="quest-infoWrp">
                <div class="quest-info">
                    <div class="quest-name-wrp"><span class="quest-name">{{=quest.getName()}}</span></div>
                    <div class="quest-task-wrp">
                        <span class="quest-task">
                            {{?quest.isStatusActive()}}
                                Выполняется
                            {{??}}
                                <span class="button1s -type-gold">Забрать награду</span>
                            {{?}}
                        </span>
                    </div>
                </div>
            </div>
		</li>
	{{~}}
</script>

<script type="text/plain" id="questlist.listText"> 
	{{~it.list: quest}}
		<li class="quest-item-text js-quest-link {{?quest.isStatusBonus()}}-state-finish{{??quest.new}}-type-new{{?}}" data-id="{{=quest.getId()}}">
			<a>{{=quest.getName()}}</a>
		</li>
	{{~}}
</script>  <script type="text/plain" id="stock.header">
	Ресурсы
</script>

<script type="text/plain" id="stock">
	<div class="view-stock">
		<div class="stock-static-wrp"></div>
		
		<div class="stock-divider"></div>
		
		<div class="stock-list-list-wrp">
			<div class="stock-list-wrp"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="stock.footer">
	<div class="stock-capacity-wrp"></div>
</script>

<script type="text/plain" id="stock.list">
	<div id="stock-list" class="stock-list">
		{{@it.resGroups: resGroup: pos}}
			{{?resGroup.list.length}}
				<div class="stock-resGroup" data-id="{{=resGroup.id}}">
					{{@resGroup.list: res}}
						{{=tmplMgr.stock.item({data: it, res: res})}}
					{{@}}
					{{?wofh.account.isPremium() && it.resGroups.length>1}}
						<div class="stock-resGroup-move">
							{{?pos != 0}}
								<a class="stock-resGroup-moveUp">
									<span class="button4">
										<span class="iconUp"></span>
									</span>
								</a>
							{{?}}
							{{?pos != it.resGroups.length-1}}
								<a class="stock-resGroup-moveDown">
									<span class="button4">
										<span class="iconDown"></span>
									</span>
								</a>
							{{?}}
						</div>
					{{?}}
				</div>
			{{?}}
		{{@}}
	</div>
</script>

<script type="text/plain" id="stock.item">
	<div class="stock-list-item" id="res{{=it.res.getId()}}" data-id="{{=it.res.getId()}}">
		{{?it.data.showConsumpt && it.res.canConsumpt()}}
			{{?it.data.consList}}
				{{
					var isConsumed = it.data.consList.getElem(it.res.getId(), false);
					var onSending = it.data.consList.sentResList[it.res.getId()];
				}}
				
				<div class="loader-container-icon-small"></div>
			{{??}}
				{{
					var isConsumed = it.res.consBin;
				}}
			{{?}}
			
			{{=snip.checkbox1({wrpCls: 'stock-res-cons' + (onSending ? ' -state-sending' : ''), name: 'r'+it.res.getId(), checked: isConsumed, disabled: !it.data.canConsumpt && !isConsumed})}}
		{{?}}
		{{?it.res.consBin}}
			<span class="stock-res-consMark"></span>
		{{?}}

		<span class="stock-resIcon">{{=snip.resBig(it.res.getId())}}</span>
		<div class="stock-highlight {{?it.res.isGrown()}}-grown{{?}}">
			<span class="stock-rest">
				{{=tmplMgr.stock.rest(it.res)}}
			</span>
			{{?Math.abs(it.res.updateHour) != 0}} <span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(it.res)}}</span>{{?}}
			<div class="stock-scale{{?it.res.updateHour>0}} -increase{{??it.res.updateHour<0}} -decrease{{?}}">
				<span class="stock-scale-rest-wrp">{{=tmplMgr.stock.restScale({res:it.res, town:it.data.town})}}</span>
				{{var res12h = it.res.calcHasH(12);}}
				{{?it.res.has != res12h.has}}
					<div 
						class="stock-scale-alter" 
						style="left: {{=res12h.has / (it.data.town||wofh.town).getStock().getMax() * 100}}%" 
						data-title="Прогноз количества через 12 часов">
					</div>
				{{?}}
			</div>
		</div>

		{{?wofh.account.isPremium()}}
			<span class="stock-period-wrp">{{=tmplMgr.stock.period({res:it.res})}}</span>
		{{?}}
	</div>
</script>

<script type="text/plain" id="stock.period">
	{{var fillTime = it.res.calcStockFillTime();}}
	{{?fillTime}}
		<span class="stock-period {{?it.res.updateHour<0}}-warn{{?}}">
			{{=timeMgr.fPeriodShort(fillTime)}}
		</span>
	{{?}}
</script>

<script type="text/plain" id="stock.restScale">
	<div class="stock-scale-rest -bgColor-{{=utils.cnstName(snip.c.warn, snip.resStockWarnScaleColor(it.res))}}" style="width: {{=it.res.has / (it.town||wofh.town).getStock().getMax() * 100}}%"></div>
</script>

<script type="text/plain" id="stock.rest">
	{{?it.updateHour != 0}}
		{{var timerText = it.updateHour>0? 'До заполнения осталось: ': 'До исчерпания осталось: ';}}
		{{=snip.hintWrp(timerText + snip.timer(it.calcStockFillTime() + timeMgr.getNow(), 'dec'), snip.resStockWarnHas(it))}}
	{{??}}
		{{=snip.resStockWarnHas(it)}}
	{{?}}
</script>

	

<script type="text/plain" id="stock.static">
	<div class="stock-static">
		{{?Quest.isAvail(Quest.ids.sciSelect)}}
			<div>
				{{var res = it.getElem(Resource.ids.science);}}
				{{=snip.resBig(res.getId())}}
				<div class="stock-static-val">
					<span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>
				</div>

				{{var bonus = wofh.town.getLuckBonus(LuckBonus.ids.science);}}
				{{?wBonusTakeNow.canShow(bonus)}}
					<a class="stock-addBonus -type-science btnAddBonus-small" data-type="{{=bonus.id}}"></a>
				{{?}}
			</div>
		{{?}}
		{{?wofh.account.knowsMoney()}}
			<div>
				{{var res = it.getElem(Resource.ids.money);}}
				{{=snip.resBig(res.getId())}}

				<div class="stock-static-val">
					<span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>
				</div>
			</div>
		{{?}}
		
		{{var res = it.getElem(Resource.ids.food);}}
		<div class="stock-food" id="res{{=res.id}}">
			{{=snip.resBig(res.getId())}}
			<div class="stock-static-val stock-highlight -grown">
				<span class="stock-rest">
					{{var val = utils.formatNum(res.has, {floor: true, stages: true});}}
					{{?res.updateHour < 0}}
						{{=snip.hintWrp('До исчерпания осталось: ' + snip.timer(res.calcStockFillTime() + timeMgr.getNow(), 'dec'), val)}}
					{{??}}
						{{=val}}
					{{?}}

				</span>
				{{?res.updateHour}} <span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>{{?}}
			</div>
			{{?debug.isTest('later')}}
				<a class="stock-foodPriority iconSettings"></a>
			{{?}}
		</div>
		
		{{var bonus = wofh.town.getLuckBonus(LuckBonus.ids.production);}}
		{{?wBonusTakeNow.canShow(bonus)}}
			<a class="stock-addBonus -type-production btnAddBonus-small" data-type="{{=bonus.id}}"></a>
		{{?}}
	</div>
</script>

<script type="text/plain" id="stock.capacity">
	{{?Quest.isAvail(Quest.ids.buildHut)}}
		<div class="stock-capacity">
			<a class="stock-capacity" href="{{=HashMgr.getHref('#/send')}}" data-title="Суммарная вместимость всех складских зданий этого города">
                {{=snip.capacityIcon()}}{{=utils.formatNum(wofh.town.stock.getMax(), {int:true, stages:true})}}
            </a>
		</div>
	{{?}}
</script><script type="text/plain" id="swapSlot">
    <div class="view-swapSlot">
		<div class="swapSlot-town text-shadow">
			{{=snip.town(wofh.town)}}
		</div>
		
		<div class="swapSlot-text-wrp">
			<div class="swapSlot-text text-shadow">
				Перепланировка 
				
				{{?it.slot}}
					{{?it.slot.isHillType()}}
						холмовых
					{{??it.slot.isWater()}}
						водных
					{{??}}
						равнинных
					{{?}}
				{{?}}
				
				 кварталов
			</div>
			<div class="swapSlot-text-helper"></div>
		</div>
		
		<div class="swapSlot-exit">
			<button class="button1 js-swapSlot-exit">
				Завершить<span class="js-swapSlot-timer"></span>
			</button>
		</div>
    </div>
</script><script type="text/plain" id="systmenu.header">
	Меню
</script>
	
<script type="text/plain" id="systmenu">
	<div class="view-smenu">
		<ul class="smenu-list">
			{{?wofh.platform.fullscreenbutton}}
				<li>
					<a class="smenu-itemBtn button1 js-toggleFrame-btn">Полный экран</a>
					&nbsp;
					<a class="js-toggleFrame-btn">
						{{=snip.icon(snip.c.smenu, 'fsc')}}
					</a>
				</li>
			{{?}}
			{{?Ability.announce()}}
				<li>
					<a class="smenu-itemBtn button1" href="{{=HashMgr.getHref('#/announce/')}}">Объявления</a>
					<a href="{{=HashMgr.getHref('#/announce/')}}">
						{{=snip.icon(snip.c.smenu, 'ann')}}
					</a>
				</li>
			{{?}}
			{{?Ability.simulator()}}
				{{var blink = Quest.isActive(Quest.ids.simulator);}}
				<li {{?blink}}class="-active -slow"{{?}}>
					{{=snip.blinkButton1({href: HashMgr.getHref('#/simbattle'), text: 'Симулятор боя', noBlink: !blink})}}
					<a href="{{=HashMgr.getHref('#/simbattle')}}">
						{{=snip.icon(snip.c.smenu, 'sim')}}
					</a>
				</li>
			{{?}}
			<li>
				<a class="smenu-itemBtn button1" href="{{=HashMgr.getHref('#/help')}}">Энциклопедия</a>
				<a href="{{=HashMgr.getHref('#/help')}}">
					{{=snip.icon(snip.c.smenu, 'hlp')}}
				</a>
			</li>
			{{var blink = Quest.isActive(Quest.ids.introduce);}}
			<li {{?blink}}class="-active -slow"{{?}}>
				{{=snip.blinkButton1({href: HashMgr.getHref('#/options/'), text: 'Настройки', noBlink: !blink})}}
				<a href="{{=HashMgr.getHref('#/options/')}}">
					{{=snip.icon(snip.c.smenu, 'opt')}}
				</a>
			</li>
			{{?Ability.forum()}}
				<li>
					<a class="smenu-itemBtn button1 js-smenu-community" href="{{=lib.main.community[wofh.platform.id]}}" target="_blank">Сообщество</a>
					<a class="js-smenu-community" href="{{=lib.main.community[wofh.platform.id]}}" target="_blank">
						{{=snip.icon(snip.c.smenu, 'frm')}}
					</a>
				</li>
			{{?}}
			{{var link = lib.main.support[wofh.platform.id];}}
			{{?Ability.support() && link}}
				{{?link == "default"}}
					{{link = HashMgr.getHref('#/support');}}
				{{??}}
					{{var isTargetBlank = true;}}
				{{?}}

				<li class="{{?wofh.account.newtickets}}-active{{?}}">
					<a class="smenu-itemBtn button1 {{?wofh.account.newtickets}}-type-gold{{?}}" href="{{=link}}" {{?isTargetBlank}}target="_blank"{{?}}>Поддержка</a>
					<a href="{{=link}}" {{?isTargetBlank}}target="_blank"{{?}}>
						{{=snip.icon(snip.c.smenu, 'sup')}}
					</a>
				</li>
			{{?}}
			<li>
				<a class="smenu-itemBtn button1 js-smenu-logout">Выход</a> 
				<a class="js-smenu-logout">
					 {{=snip.icon(snip.c.smenu, 'ext')}}
				</a>
			</li>
			{{=tmplMgr.systmenu.additional(it)}}
		</ul>
	</div>
</script>

<script type="text/plain" id="systmenu.additional"></script>

<script type="text/plain" id="systmenu.footer">
	{{?!wofh.platform.fullscreenbutton}}
		<a class="text-shadow" href="{{=hashMgr.getWndHref('help', 'changelog')}}">v. {{=lib.main.version}}</a>
	{{?}}
</script>

<script type="text/plain" id="town">
	<div class="view-town">
		<canvas class="town-canvas" id="town-canvas0" aria-labelledby="tooltip-voiceHelperCont"></canvas>
		<canvas class="town-canvas" id="town-canvas" aria-labelledby="tooltip-voiceHelperCont"></canvas>
		<div class="town-zoom"></div>
	</div>
</script>

<script type="text/plain" id="town.clickerM">
	<div style="position: absolute; z-index: 100; transition: all 1s cubic-bezier(0.25,0,0.5,1); cursor: default;">{{=snip.resBig(it)}}</div>
</script>


<script type="text/plain" id="town.clickerE">
	<div class="town2-clickerE">
		<div class="town2-clickerE-part -type-1">{{=it}}</div>
		<div class="town2-clickerE-part -type-2">{{=it}}</div>
		<div class="town2-clickerE-part -type-3">{{=it}}</div>
		<div class="town2-clickerE-part -type-4">{{=it}}</div>
		<div class="town2-clickerE-part -type-5">{{=it}}</div>
		<div class="town2-clickerE-part -type-6">{{=it}}</div>
	<div>
</script>

<script type="text/plain" id="town.bldEvents">
	<div class="town2-bldEvents -noSel" data-title="{{=snip.slotTitle(it.slot)}}">
		{{@it.slot.getActions().getList(): event}}
			{{
				var eventPos = event.getBldQueuePos();
				var action = Slot.actions[event.getAction()];
			}}

			<div class="town2-bldEvent {{?eventPos==0}}-type-first{{?}}">
				<div class="town2-bldEvent-topic">
					<span class="town2-bldEvent-icon">
						{{?eventPos==0}}
							<span class="town2-bldEvent-icon slotAction -type-{{=action.name}}"></span>
						{{??}}
							{{=+eventPos+1}}&nbsp;<span class="bldqueue-queue-itemIcon -type-{{=action.name}}"></span>
						{{?}}
					</span>
					<span class="town2-bldEvent-timer">{{=snip.timer(event.getTime(), 'dec')}}</span>
				</div>
				<div class="town2-bldEvent-time">
					до {{=timeMgr.fMoment(event.getTime())}}
				</div>
				{{?eventPos == 0 && it.slot.canImm()}}
					<a class="town2-bldEvent-imm button2 -type-immediate" data-title='{{=tmplMgr.bldqueue.alert.immediate({popUp:true})}}'></a>
				{{?}}
				<a class="town2-bldEvent-del button2 -type-delete" data-title="Отменить" data-pos="{{=eventPos}}"></a>
			</div>
		{{@}}
	</div>
</script>
        
        
<script type="text/plain" id="otStock.main">
    <div id="view-otStock">
        <ul id='myres'>
            {{var res = wofh.town.stock.getElem(Resource.ids.science);}}
            <li>
                <div class="fL">
                    {{=snip.res(res)}}
                    <i>+{{=~~res.updateHour}}</i>
                    <span class="lbtm">  в час</span>
                </div> 
                <div class='cB'></div>
            </li>
            {{?Account.hasAbility(Science.ability.money)}}
                {{var res = wofh.town.stock.getElem(Resource.ids.money);}}
                <li>
                    {{=snip.res(res)}}
                    <i>{{=(res.updateHour>=0?'+':'')+(utils.toFixed(res.updateHour, 1))}}</i>
                    <span class="lbtm">  в час</span>
                </li>
            {{?}}

            <li>
                <br>
                <center>
                    <b>
                        <a title="Объем хранилища указан для каждого вида ресурсов этого города" style="display:inline;cursor:help;color:#000">
                            Вместимость хранилища: <span id="storemax">{{=~~wofh.town.getStock().getMax()}}</span>
                        </a>
                    </b>
                </center><br>
            </li>
        </ul>

        {{@it.resGroups: resGroup}}
            <div style="position: relative; margin: 15px 0;">
                {{?resGroup.food}}
                    {{var res = wofh.town.stock.getElem(Resource.ids.food);}}
                    {{?res.has >= 1 || ~~res.updateHour!=0}}
                        <div style="position: absolute; width:100px; height: 100%; background: url(https://test.waysofhistory.com/img/gui/trash/e0/storage-brace-1_3.png) 0px 50% no-repeat; right: 10px;" class="js-stock-res{{=res.getId()}}">
                            <div class="crH" style="margin-left: 15px; width:80px; position: relative;top: 50%;margin-top: -6px;">
                                {{=snip.res(res)}}<span class="js-stock-rest">{{=snip.resStockWarnHas(res)}}</span>
                                {{?res.updateHour}}
                                    <br/>
                                    <span>{{=(~~res.updateHour>=0?'+':'')+(~~res.updateHour)}}</span>
                                    <span class="lbtm">  в час</span>
                                {{?}}
                            </div>
                        </div>
                    {{?}}
                {{?}}

                <ul id="myres">
                    
                    {{~resGroup.list: res}}
                        {{?res.has >= 1 || ~~res.updateHour != 0}}
                            {{?!~~res.updateHour}}
                                <li class="js-stock-res{{=res.getId()}}">
                                    {{=snip.res(res)}}<span class="js-stock-rest">{{=snip.resStockWarnHas(res)}}</span>
                                </li>
                                <div class='resscale' style="background-position: -0px -{{=(1-res.has/wofh.town.getStock().getMax())*100}}px"></div>
                            {{??}}
                                <li class="js-stock-res{{=res.getId()}}">
                                    {{=snip.res(res)}}
                                    <i><span class="js-stock-rest">{{=snip.resStockWarnHas(res)}}</span></i>&nbsp;
                                    <i>{{=(~~res.updateHour>=0?'+':'')+(~~res.updateHour)}}</i>
                                    <span class="lbtm">  в час</span>
                                </li>
                                <div class='resscale' style="background-position: -0px -{{=(1-res.has/wofh.town.getStock().getMax())*100}}px">
                                    <img class='resforecast' src="https://test.waysofhistory.com/img/_.gif" style="background-position: {{=Math.max(0, Math.min(((res.updateHour>0?1.02:0)+(res.has + res.updateHour*12)/wofh.town.getStock().getMax())*100, 202))}}px 0px;marign-left:0" />
                                </div>
                            {{?}}
                        {{?}}
                    {{~}}

                </ul>
            </div>
        {{@}}
    </div>
</script><script type="text/plain" id="oldtown">
	<div class="view-oldtown">
		<div class="town-cont">
			<div class="town-plate"></div>
			<div class="oldtown-back-wrp"></div>
			<div class="oldtown-slots-wrp"></div>
			<div class="oldtown-links-wrp"></div>
			<div class="oldtown-clickers-wrp"></div>
		</div>
	</div>
</script>


<script type="text/plain" id="oldtown.back">
	<div class="town-back{{?it.hill}} -hills{{?}} -climate-{{=utils.cnstName(Tile.climateIds, it.climate)}} -water-{{=it.water}}">
		<div class="town-back-hill"></div>
		<div class="town-back-wonder"></div>
		<div class="town-back-top"></div>
		<div class="town-back-center"></div>
		<div class="town-back-beach"></div>
	</div>
</script>



<script type="text/plain" id="oldtown.slots">
	<ul class="town-slots">              
		{{@it.slots.getList(): slot}}
			{{?!slot.canShow()}}
				{{continue;}}
			{{?}}
			
			<li class="town-slots-item -pos{{=slot.getPos()}}">
				{{var slotPos = bckTownOld.slotPos[slot.getPos()];}}
				{{slot = slot.dispPrepare();}}
				{{?slot.isNeedPay()}}
					{{?Account.hasAbility(Science.ability.money)}}
						<div style="margin:-30px">
							<img src='https://test.waysofhistory.com/img/town1/slots/{{=slot.getSlotType()}}+.png'>
						</div>
					{{?}}
				{{??slot.isEmpty()}}
					<div style="margin:-30px">
						<img src='https://test.waysofhistory.com/img/town1/slots/{{=slot.getSlotType()}}.png'>
					</div>
				{{??}} 
					<img 
						style="margin:{{=Build.lib[slot.getId()].d[1]}}px 0 0 {{=Build.lib[slot.getId()].d[0]}}px"
						src="https://test.waysofhistory.com/img/buildings1/{{=slot.getId()}}_{{=Build.lib[slot.getId()].levels[slot.getLevel()? slot.getLevel()-1: 0]}}_1.png"/>
					<div 
						class="town-slots-level" 
						style="margin:{{=Build.lib[slot.getId()].td[1] + Build.lib[slot.getId()].d[1]}}px 0 0 {{=Build.lib[slot.getId()].td[0] + Build.lib[slot.getId()].d[0]}}px" 
						data-type="{{=(slot.getId()!=0 && slot.getPos()!=0 && !slot.active)? 3: (slot.getLevel()==lib.build.maxlevel? 2: (slot.getLevel() >= (wofh.account.research.build[slot.getId()]||0)? 1: 0))}}">
							{{=slot.getLevel()}}
					</div>
				{{?}}
			</li>
		{{@}}
		{{?wofh.gameEvent.has(GameEvent.ids.newYear1Stage)}}
			<li class="town-slots-item -obj2">
				<span class="town-slots-tree"></span>
			</li>
			<li class="town-slots-item -obj3">
				<span class="town-slots-snowman"></span>
			</li>
		{{?}}
		{{?wofh.gameEvent.has(GameEvent.ids.newYear2Stage)}}
			<li class="town-slots-item -obj1">
				<span class="town-slots-sledge"></span>
			</li>
			<li class="town-slots-item -obj2">
				<span class="town-slots-tree -type-2"></span>
			</li>
			<li class="town-slots-item -obj3">
				<span class="town-slots-snowman"></span>
			</li>
		{{?}}
		{{?wofh.gameEvent.has(GameEvent.ids.newYear3Stage)}}
			<li class="town-slots-item -obj2">
				<span class="town-slots-tree -type-3"></span>
			</li>
			<li class="town-slots-item -obj3">
				<span class="town-slots-snowman -type-2"></span>
			</li>
		{{?}}
	</ul>


</script>


<script type="text/plain" id="oldtown.links">
	<div class="town-links">
		<img src="https://test.waysofhistory.com/img/_.gif" usemap="#Map" class="town-links-img">
		
		<map name="Map" id="Map">
			{{@it.slots.getList(): slot}}
				{{?!slot.canShow()}}{{continue;}}{{?}}
				
				<area class="town-area" shape="poly" coords="{{=vOldTown_links.coords[slot.getPos()]}}" href="{{=hashMgr.getWndHref('slot', slot.getPos())}}" data-title="{{=utils.htmlToText(snip.slotTitle(slot))}}">
			{{@}}
		</map>
	</div>
</script>
		
<script type="text/plain" id="oldtown.clickers">
	{{@it: click}}
		<a data-pos="{{=click.i}}" class="town-clickers-item -res{{=click.res.getId()}} -pos{{=click.pos}}" data-title="{{=click.res.getName()}}"></a>
	{{@}}
</script><script type="text/plain" id="panel.wrp">
	<div class="{{=it.panel.getTypeClass()}} {{=it.panel.getBaseType()}}-{{=it.panel.getName()}} {{=it.panel.getTmplClass()}} {{=it.panel.getExtClass()}}">
		{{=tmplMgr.panel.expButton(it)}}
		
		{{=tmplMgr.panel.header(it)}}
		
		{{=tmplMgr.panel.cont(it)}}
		
		{{=tmplMgr.panel.footer(it)}}
	</div>
</script>

<script type="text/plain" id="panel.expButton">
	{{?it.panel.options.expanded}}
		<div class="panel-expand-wrp">
			<span class="panel-expand-button" data-dir="togup" data-title="Развернуть"></span>
			<span class="panel-expand-button" data-dir="togdown"  data-title="Свернуть"></span>
		</div>
	{{?}}
</script>

<script type="text/plain" id="panel.header">
	{{?it.panel.hasHeader()}}
		<div class="panel-header-wrp">
			<div class="panel-header {{?it.panel.options.hidden}}-type-active{{?}}">
				{{=it.panel.getHeaderCont()}}

				{{?it.panel.options.hidden}}
					<span class="panel-hidden-button"></span>
				{{?}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="panel.cont">
	<div class="panel-cont-wrp">
		{{=it.cont}}
	</div>

	<div class="panel-bottom"></div>
</script>

<script type="text/plain" id="panel.footer">
	{{?it.panel.hasFooter()}}
		<div class="panel-footer-wrp{{?it.panel.isFooterLarge()}} -type-large{{?}}">{{=it.panel.getFooterCont()}}</div>
	{{?}}
</script><script type="text/plain" id="snipet.wonderParams">
	{{var wonderData = it.slot.getWonderData();}}
	{{@it.slot.getWonderData(): wonder: wonderId}}
		{{?wonderId == WonderEffect.ids.grown}}
			{{?wonder.global}}<!--висяки-->
				{{=snip.growEffect()}}+{{= (wonder.getLocal() + wonder.getCountry() + wonder.getGlobal()).toFixed(1) }} городу,<br>
				{{=snip.growEffect()}}+{{= (wonder.getCountry() + wonder.getGlobal()).toFixed(1) }} каждому городу страны {{=snip.hint("Эффект дается один раз,<br/>независимо от количества этих<br/>Чудес Света в стране")}},<br>
				{{=snip.growEffect()}}+{{= (wonder.getGlobal()).toFixed(1) }} каждому городу мира (но не более 
				{{=snip.growEffect()}}{{= (wonder.getGlobal() * wonder.maxglobal).toFixed(1) }})
			{{??}}
				{{=snip.growEffect()}} +{{= wonder.effect }}  в день
			{{?}}<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.res}}
			{{=snip.resEffect(wonder.resid)}} +{{= wonder.effect }}  в час<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.resForBuild}}
			{{=snip.resEffect(wonder.resid)}}+{{= wonder.effect }} в час каждому городу страны за каждый уровень строения 
			{{=snip.buildLink(wonder.buildid)}}</a>
			 в нем {{=snip.hint("Эффект дается один раз,<br/>независимо от количества этих<br/>Чудес Света в стране")}}.<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.cult}}
			{{?wonder.global}}<!--пирамида-->
				{{=snip.cultEffect()}} +{{= wonder.local + wonder.country + wonder.global }} городу,<br>
				{{=snip.cultEffect()}} +{{= wonder.country + wonder.global }} каждому городу страны {{=snip.hint("Эффект дается один раз,<br/>независимо от количества этих<br/>Чудес Света в стране")}},<br>
				{{=snip.cultEffect()}} +{{= wonder.global }} каждому городу мира (но не более {{=snip.cultEffect()}}
				{{var maxglobal = wonder.maxglobal;}}
				{{?(wofh.account && wofh.account.getAuraWonders(TownAura.getAura(it.slot.getId()))) || (wofh.country && wofh.country.getAuraWonders(TownAura.getAura(it.slot.getId())))}}
					{{--maxglobal;}}
				{{?}}
				{{=wonder.global * (maxglobal)}}
				)
			{{??}}
				{{=snip.cultEffect()}} +{{= wonder.effect }}
			{{?}}
            <br>
		{{?}}
		{{?wonderId == WonderEffect.ids.traders}}
			{{=snip.trader()}} +{{= wonder.effect }}<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.train}}
			{{?it.slot.getId() == 9}}<!--терракотовая армия-->
				{{= new Build(wonder.buildid).getName()}}  обучает войска в {{= wonder.effect }} раза быстрее
			{{??it.slot.getId() == 11}}<!--жертвенник-->
				Двойная эффективность бойцовской ямы.
				<br>
				+5% скорость тренировки в казарме
			{{??it.slot.getId() == 95}}<!--царь-пуша-->
				{{=snip.unitIconLink(wonder.units[0])}}, {{=snip.unitIconLink(wonder.units[1])}} и {{=snip.unitIconLink(wonder.units[2])}} этого города производятся вдвое быстрее, а их содержание вдвое меньше
			{{??it.slot.getId() == 98}}<!--тамплиеры-->
				
				{{=snip.unitIconLink(wonder.unit1)}}Рыцари и 
				{{=snip.unitIconLink(wonder.unit2)}}Латники города обучаются в 
				{{=utils.formatNum(wonder.effect)}} раза быстрее.
			{{??it.slot.getId() == 99}}<!--сунцзы-->
				{{=snip.unitIconLink(wonder.unit)}}Самураи города обучаются в два раза быстрее.
			{{??it.slot.getId() == 108}}<!--брадервороты-->
				Увеличивает скорость обучения военной пехоты этого города на {{= Math.round((wonder.effect-1)*100) }}%
			{{?}}<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.warbonus}}
			+{{= Math.round(wonder.effect*100) }}% военный бонус города<br/>
		{{?}}
		{{?wonderId == WonderEffect.ids.oracle}}
			Владельцу Чуда показывает численность атакующей армии (не более {{= snip.pop(wonder.effect)}}) на любой его город. Работает только в субботу и воскресенье.<br>
		{{?}}
		{{?wonderId == WonderEffect.ids.maxDefence}}
			В городе с Мачу-Пикчу нельзя разрушить строения (кроме фортификационных, систем ПВО и ПРО и муляжа) на последние {{= wonder.struct }} ед. урона, последних {{=snip.pop()}}{{= wonder.pop }} нельзя убить.
		{{?}}
		{{?wonderId == WonderEffect.ids.slotCost}}
			Цена каждого платного места для строительства в городе равна {{=snip.resBigCount(new Resource(Resource.ids.money, wonder.effect))}}.
		{{?}}
		{{?wonderId == WonderEffect.ids.damageDefenceWood}}
			{{=snip.pop()}} {{=wonder.effect}} урона после боя при городе войскам вражеской армии, 
			{{?wonder.unitsList}}
				состоящим преимущественно из древесины:
				<div>{{=snip.army(wonder.unitsList(), {tmpl:snip.unitIconLink})}}</div>
			{{??}}
				состоящим преимущественно из древесины
			{{?}}
		{{?}}
		{{?wonderId == WonderEffect.ids.lasvegas}}
			Забирает {{=snip.resBig(Resource.ids.money)}}{{= parseInt(wonder.effect * 1000, 10) }} в час с каждых {{=snip.pop()}}1000 со всех городов на расстоянии не более {{= wonder.distance }}.
		{{?}}
		{{?wonderId == WonderEffect.ids.space}}
			Для победы в мире
		{{?}}
		{{?wonderId == WonderEffect.ids.tradespeed}}
			Любой путь между городами с активированными 
			{{=snip.wonderIcon(true)}}
			Грузовыми аэропортами, при условии 
			{{=snip.icon(snip.c.anyIcon, 'fuel')}}
			ускорения доставки за 
			{{=snip.resBig(Resource.ids.fuel)}}
			, не учитывает рельеф местности и проходит напрямую со скоростью увеличенной в 
			{{=(new ResList(lib.trade.fuelaspeed)).getFirst().getCount()}}
			 раз.
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="snipet.buildParams_item">
	{{?it.short}}
		{{@it.arr: item}}
			<tr class="pedia-build-info -type-short">
				<td>
					{{?item.iconText}}
						{{=item.iconText}}
					{{??item.icon}}
						{{=snip.icon(snip.c.anyIcon, item.icon)}}
					{{?}}
				</td>
				<td>
					{{=item.effect}}
				</td>
			</tr>
		{{@}}
	{{??}}
		{{var up = it.up && !it.slot.isWonder();}}
		{{@it.arr: item}}
			<tr class="pedia-build-info {{?up}}-type-up{{?}}">
				<td class="pedia-label">
					{{?item.title}}
						{{=item.title}}
					{{??item.icon}}
						{{=snip.c.anyIcon[item.icon].title}}
					{{?}}
				</td>
				<td class="p0005">
					{{?item.iconText}}
						{{=item.iconText}}
					{{??item.icon}}
						{{=snip.icon(snip.c.anyIcon, item.icon)}}
					{{?}}
				</td>
				<td>
					<div class="{{?up}}-nobr{{?}}">
						{{=item.effect}}
					</div>
				</td>
			</tr>
		{{@}}

		{{?it.slot.isWonder()}}
			<tr>
				<td colspan="3" style="padding-top: 5px;">
					<span class="speciale">
						Дает свой эффект только после активации на 20 уровне. 
					</span>
					{{=snip.pediaLinkBtn('wonder')}}
				</td>
			</tr>
		{{?}}
	{{?}}
</script>


<script type="text/plain" id="snipet.wndPanel">
	<div class="PANEL-panel-tl"></div>
	<div class="PANEL-panel-tr"></div>
	<div class="PANEL-panel-bl"></div>
	<div class="PANEL-panel-br"></div>
	<div class="PANEL-panel-t"></div>
	<div class="PANEL-panel-b"></div>
	<div class="PANEL-panel-l"></div>
	<div class="PANEL-panel-r"></div>
	<div class="PANEL-panel-c"></div>
</script>
		
<script type="text/plain" id="snipet.marketTrans">
	/* Перенести стили в main.css */
	<div class="view-marketTrans">
		<select class="marketTrans-towns select1">
			<option value="0">Все города</option>
			
			{{@wofh.towns: town}}
				<option value="{{=town.id}}">{{=town.name}}</option>
			{{@}}
		</select>
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100), 200)}}px;">
			<table class="s-tbl tbl-marketTrans">
				<colgroup>
					<col class="marketTrans-col1">
					<col class="marketTrans-col2">
					<col class="marketTrans-col3">
					<col class="marketTrans-col4">
					<col class="marketTrans-col5">
					<col class="marketTrans-col6">
					<col class="marketTrans-col7">
					<col class="marketTrans-col8">
					<col class="marketTrans-col9">
				</colgroup>
			
				<thead>
					<tr>
						<td>Время</td>
						<td>Отправитель</td>
						<td>Получатель</td>
						<td colspan="3">Передано</td>
						<td colspan="3">Получено</td>
					</tr>
				</thead>
				<tbody class="js-marketTransData"></tbody>
				<tfoot>
					<tr>
						<td colspan="9"><a class="marketTrans-add crP">Загрузить ещё!</a></td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.marketTransData">
	{{~it.list: item: pos}}
		{{?!timeMgr.isSameDate(it.time, item.time) }}
			{{it.time = item.time;}}
			<tr class="row{{=pos%2}}">
				<td colspan="9">
					<span style="border-top: 1px solid; width:45%;display: inline-block; margin-top: 6px; float: left;"></span>
					<span>{{=timeMgr.fMomentDate(item.time)}}</span>
					<span style="border-top: 1px solid; width:45%;display: inline-block; margin-top: 6px; float: right;"></span>
				</td>
			</tr>
		{{?}}
		<tr class="row{{=pos%2}}">
			<td>{{=timeMgr.fMomentTime(item.time, true)}}</td>
			<td class="marketTrans-colTownAcc {{?item.town1.account.id==wofh.account.id}}-type-own{{?}}">
				{{?item.town1.account.id == wofh.account.id || item.town1.account.isBarbarian()}}
					{{=snip.townLink(item.town1)}}
				{{??}}
					{{=snip.townAccUnder(item.town1)}}
				{{?}}
			</td>
			<td class="marketTrans-colTownAcc {{?item.town2.account.id == wofh.account.id}}-type-own{{?}}">
				{{?item.town2.account.id==wofh.account.id || item.town2.account.isBarbarian()}}
					{{=snip.townLink(item.town2)}}
				{{??}}
					{{=snip.townAccUnder(item.town2)}}
				{{?}}
			</td>
			<td></td>
			<td class="marketTrans-colRes {{?item.town1.account.id != wofh.account.id}}-type-own{{?}}">
				{{@item.res1.getList(): res}}
					{{res = res.sciToLuck();}}
					
					{{?res.getId() == Resource.ids.money && res.getCount() <= 1}}
						<span class="res-empty">{{=utils.formatNum(res.getCount(), {fixed: 0})}}</span>
					{{??}}
						{{=snip.resCount(res)}}
					{{?}}
				{{@}}
				
				{{?!item.res1.getLength()}}
					<span class="res-empty">0</span>
				{{?}}
			</td>
			<td></td>
			<td></td>
			<td class="marketTrans-colRes {{?item.town2.account.id != wofh.account.id}}-type-own{{?}}">
				{{@item.res2.getList(): res}}
					{{res = res.sciToLuck();}}
					
					{{?res.getId() == Resource.ids.money && res.getCount() <= 1}}
						<span class="res-empty">{{=utils.formatNum(res.getCount(), {fixed: 0})}}</span>
					{{??}}
						{{=snip.resCount(res)}}
					{{?}}
				{{@}}
				{{?!item.res2.getLength()}}
					<span class="res-empty">0</span>
				{{?}}
			</td>
			<td></td>
		</tr>
	{{~}}
</script>


<script type="text/plain" id="snipet.resFilter">
	{{
		it.excluded = it.excluded||[];
		it.select = it.select == ResList.filter.resType.all ? false : it.select;
		it.active = utils.isArray(it.active) ? utils.arrToObj(it.active, true, true) : it.active||{};
	}}
	<div class="resFilter {{?it.select}}-active{{?}} js-resFilter" data-type="{{=utils.cnstName(ResList.filter.type, it.type)}}">
		<ul>
			{{?it.showLuck}}
				<li>
					{{=snip.resFilter.res({res:new Resource(Resource.ids.luck), select:it.select, disabled:it.disabled})}}
				</li>
			{{?}}
			{{?it.showFood}}
				<li>
					{{=snip.resFilter.res({res:new Resource(Resource.ids.food), select:it.select, disabled:it.disabled})}}
				</li>
			{{?}}
			{{@ResList.getAll().getList(): res}}
				{{?res.isStockable() && !utils.inArray(it.excluded, res.getId())}}
					<li>
						{{=snip.resFilter.res({res:res, select:it.select, disabled:it.disabled})}}
					</li>
				{{?}}
			{{@}}
		</ul>
		{{?utils.hasMask(it.type, ResList.filter.type.extend)}}
			{{=snip.resFilter.resType({resType: ResList.groupType.grown, select: it.select})}}
			{{=snip.resFilter.resType({resType: ResList.groupType.cult, select: it.select})}}
		{{?}}
		{{?utils.hasMask(it.type, ResList.filter.type.default | ResList.filter.type.extend)}}
			{{=snip.resFilter.resAll({select: it.select, active: it.active})}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="snipet.resFilter.inline">
	{{
		it.resGroups = it.resGroups||ResList.getAll().getGroups({exclude:[ResList.groupType.special]});
		it.select = it.select == ResList.filter.resType.all ? false : it.select;
		it.active = utils.isArray(it.active) ? utils.arrToObj(it.active, true, true) : it.active||{};
	}}
	
	<div class="resFilter-inline {{?it.select || it.active['filter']}}-active{{?}} js-resFilter-inline js-resFilter" data-type="{{=utils.cnstName(ResList.filter.type, it.type)}}">
		{{?it.showLuck}}
			<div class="resFilter-inlineGroup">
				{{=snip.resFilter.res({res:new Resource(Resource.ids.luck), select:it.select, disabled:it.disabled})}}
			</div>
		{{?}}
		{{?it.showFood}}
			<div class="resFilter-inlineGroup">
				{{=snip.resFilter.res({res:new Resource(Resource.ids.food), select:it.select, disabled:it.disabled})}}
			</div>
		{{?}}
		{{@it.resGroups: resGroup: groupType}}
			<div class="resFilter-inlineGroup">
				{{?utils.hasMask(it.type, ResList.filter.type.extend)}}
					{{=snip.resFilter.resType({resType: groupType, select: it.select})}}
				{{?}}
				{{@resGroup.getList(): res}}
					{{=snip.resFilter.res({res:res, select:it.select, resbin: it.resbin, disabled:it.disabled})}}
				{{@}}
			</div>
		{{@}}
		{{?it.showAll}}
			<div class="resFilter-inlineGroup">
				{{=snip.resFilter.resAll({cls:'resb', select: it.select, active: it.active})}}
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="snipet.resFilter.res">
	/*
		Для воспроизведения текста голосовой программой у тегов у которых есть псевдоэлементы, 
		необходимо установить атрибут role="button" и поместить в тело тега какой-нибуть текстовый символ, к примеру пробел.
	*/
	<a 
		role="button" 
		data-title="{{=it.res.getHint()}}" 
		data-res="{{=it.res.getId()}}" 
		data-type="{{=it.res.getType()}}" 
		data-disabled="{{?it.disabled && utils.inArray(it.disabled, it.res.getId())}}1{{??}}0{{?}}" 
		class="resFilter-res resb {{?it.disabled && utils.inArray(it.disabled, it.res.getId())}}disabled{{??it.select==it.res.getId() || utils.inMask(it.res.getId(), it.resbin) || ((it.select == ResList.filter.resType.grown && it.res.isGrown()) || (it.select == ResList.filter.resType.cult && it.res.isCult()))}}-active{{?}} js-resb">
		 
	</a>
</script>

<script type="text/plain" id="snipet.resFilter.resType">
	{{?it.resType == ResList.groupType.grown}}
		<a role="button" data-title="Рост" data-res="{{=ResList.filter.resType.grown}}" class="resFilter-res resExt {{?it.select == ResList.filter.resType.grown}}-active{{?}} js-resb"> </a>
	{{?}}
	{{?it.resType == ResList.groupType.cult}}
		<a role="button" data-title="Культура" data-res="{{=ResList.filter.resType.cult}}" class="resFilter-res resExt {{?it.select == ResList.filter.resType.cult}}-active{{?}} js-resb"> </a>
	{{?}}
</script>

<script type="text/plain" id="snipet.resFilter.resAll">
	<a role="button" data-title="Выбрать все" data-res="{{=ResList.filter.resType.all}}" class="resFilter-res {{=it.cls||''}} {{?it.select == ResList.filter.resType.all || it.active[ResList.filter.resType.all]}}-active{{?}} js-resb"> </a>
</script>	

<script type="text/plain" id="snipet.noCoins">
	/*Во всплывашке текст другой*/
	{{?(it||{}).popUp}}
		Внимание! Не хватает твоих текущих {{=snip.resBig(Resource.ids.luck)}} для этого.
	{{??}}
		Недостаточно {{=snip.resBig(Resource.ids.luck)}}Монет удачи.
		<br>
		{{?wofh.account.canuseshop}}
			Но, ты можешь прямо сейчас пополнить их запас в <a class="link js-popup-close" href="{{=HashMgr.getHref('#/shop')}}">магазине</a>.
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="snipet.townAttacks">
	<div class="view-townAttacks">
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100), 250)}}px;">
			<table class="tbl-townAttacks def_table_cw">
				<colgroup>
					<col class="townAttacks-col1">
					<col class="townAttacks-col2">
					<col class="townAttacks-col3">
				</colgroup>
			
				<thead>
					<tr class="cw_head_tr">
						<td rowspan="2"></td>
						<td rowspan="2">Время</td>
						<td rowspan="2">Город</td>
						<td colspan="2">Армия</td>
						<td colspan="2">Потери</td>
						<td rowspan="2">Грабеж</td>
					</tr>
					<tr class="cw_head_tr">
						<td>Атака</td>
						<td>Защита</td>
						<td>Атака</td>
						<td>Защита</td>
					</tr>
				</thead>

				<tbody>
					{{@it: battle: row}}
						<tr class="trow{{=row%2}}">
							<td>
								<a href="{{=HashMgr.getHref('#/report/'+battle.report)}}" data-title="Отчёт"><img class="event ae8" src="https://test.waysofhistory.com/img/_.gif"></a>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">{{=timeMgr.fMoment(battle.time)}}</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{?battle.town && battle.town.id}}
										{{=snip.townLink(battle.town)}}
									{{?}}
								</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{@battle.attack.getList(): unit}}
										{{=snip.unitCountLink(unit)}}
									{{@}}
								</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{@battle.defence.getList(): unit}}
										{{=snip.unitCountLink(unit)}}
									{{@}}
								</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{@battle.attack_die.getList(): unit}}
										{{=snip.unitCountLink(unit)}}
									{{@}}
								</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{@battle.defence_die.getList(): unit}}
										{{=snip.unitCountLink(unit)}}
									{{@}}
								</div>
							</td>
							<td>
								<div class="t_cw_sep_l_attacks">
									{{=snip.resList(battle.robbed)}}
								</div>
							</td>
						</tr>
					{{@}}
				</tbody>
			</table>
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.warBonusWarn">
	{{=snip.alert()}} Внимание! В боевых действиях учитывается только целая часть значения военного бонуса. Здесь она составляет — {{=utils.toInt(it.count)}}.
</script>

<script type="text/plain" id="alert.def">
	<b>
		Ой №
		{{?it===undefined}}
			{{=utils.formatNum(Math.PI, {fixed:7})}}
		{{??}}
			{{=it}}
			{{?debug.isAdmin()}}
				{{=' '+snip.nobr('('+ErrorX.getName(it)+')')}}
			{{?}}
		{{?}}
		
	</b>
	<br>
	Явно произошло что-то необычайное...
	<br>
	Пожалуйста, сообщи об этой ситуации в службу поддержки.
</script>

<script type="text/plain" id="confirm.consoleErrors">
	{{var consoleErrors = ls.getConsoleErrors([]).sort(function(a, b){return b.time - a.time;});}}
	
	<div class="consoleErrors-cont">
		{{?consoleErrors.length}}
			<div class="consoleErrors-title">Пожалуйста отправь эту информацию в службу поддержки, нажав кнопку под текстом ошибки</div>
			
			{{@consoleErrors: error}}
				{{
					var clipboardText = '';

					try{clipboardText = utils.escapeHtml(JSON.stringify(error))}catch(e){};
				}}
				<div class="consoleError-wrp">
					<div class="consoleError -type-brief nobr -sel js-clipboard-tag-block" data-time="{{=error.time}}" data-clipboard-text="{{=clipboardText}}">
						{{@error: val: key}}
							<div>
								{{?key == 'time'}}
									{{=timeMgr.fMoment(val)}} <span class="js-clipboard-status"></span>
								{{??key == 'stack' && val}}
									{{=val.split('\n').join('<br>')}}
								{{??}}
									{{=key}}: {{=val}}
								{{?}}
							</div>
						{{@}}
					</div>
					
					<button class="consoleError-send button1s -type-green">Отправить в службу поддержки</button>
					<button class="consoleError-del button1s -type-red">Удалить</button>
					<button class="consoleError-detail button1s">Подробнее</button>
				</div>
			{{@}}
		{{??}}
			Empty
		{{?}}
	</div>
</script>

<script type="text/plain" id="confirm.def">
	Нужно подтверждение.
	<br>
	Полная уверенность? Точно?
</script>

<script type="text/plain" id="alert.login">
	{{?it.data}}
		{{?it.data.time && it.data.reason}}
			Аккаунт заблокирован и будет удален через {{=timeMgr.fPeriod(it.data.time, {format: Timer.format.full, noZero: true})}} {{=it.data.reason}}.
		{{??}}
			Доступ к аккаунту закрыт на {{=timeMgr.fPeriod(it.data.time, {format: Timer.format.full, noZero: true})}} 
		{{?}}
	{{??}}
		Отказано в регистрации
	{{?}}
</script>

<script type="text/plain" id="snipet.clipboard">
	{{it.btnText = it.btnText||'Скопировать';}}
	<span class="clipboard-tag-block {{?it.active}}-active{{?}} js-clipboard-tag-block {{?!it.onbr}}nobr{{?}}" data-clipboard-text="{{=it.brackets === false?it.tag:'['+it.tag+']'}}">
		<span class="clipboard-tag -sel js-clipboard-tag">{{=it.tagText||''}}
			{{?!it.noTagCodeText}}
				{{=it.brackets === false?it.tag:'['+it.tag+']'}}
			{{?}}
		</span>
		&nbsp;
		<span class="clipboard-button js-clipboard-button">
			<span class="clipboard-button-text">{{=it.btnText}}</span>
			&nbsp;
			<span class="clipboard-status js-clipboard-status"></span>
			{{?!it.noHint}} {{=snip.hint('Ты можешь вставить это, к примеру, в письмо или описание')}}{{?}}
		</span>
	</span>
</script>

<script type="text/plain" id="confirm.delAcc">
	Будет начат процесс удаления твоего аккаунта.
	<br>
	Это займет {{=lib.account.deletetime/3600/24}} дня.
	<br>
	Учти, что это удаление полное и необратимое. Но если в течении этого времени ты войдешь в свой аккаунт — удаление будет отменено.
	<br>
	Ты согласен начать?
</script>

<script type="text/plain" id="snipet.specialist">
	<div class="specialistInfo">
		<div class="specialistInfo-icon" {{?!it.noTitle}}data-title="Из расчета на {{=utils.escapeHtml(snip.accIcon()) + Specialist.base}} изучивших"{{?}}>	
			{{?!it.noCount}}<span class="specialistInfo-count">{{=utils.formatNum(it.specialist.getCount(), {int: true, stages: true, sign: !it.noSign})}}</span>{{?}}
			{{=snip.icon(snip.c.specialistIcon, it.specialist.getType(), false, false, '-type-big')}}
		</div>
		<br>
		<span class="specialistInfo-name {{?!it.noTooltip}}js-tooltip{{?}} link" data-tooltip-wnd="specialist" data-id="{{=it.specialist.getId()}}">{{=utils.upFirstLetter(it.specialist.getName())}}</span>
	</div>
</script>

<script type="text/plain" id="snipet.specialistList">
	{{?it.science.specialistList.getLength()}}
		<dl>
			<dt>Великие Граждане, которые родятся в мире:</dt>
			<dd>
				{{@it.science.specialistList.getList(): specialist }}
					{{=snip.specialist({specialist:specialist})}}
				{{@}}
			</dd>
		</dl>
	{{?}}
</script>

<script type="text/plain" id="snipet.chat.ban">
	Проголосовать за блокировку {{?it.accName}}<b>{{=it.accName}}</b>{{??}}игрока{{?}} на канале?
	<br>
	 Но знай, что беспочвенное использование данной функцией будет караться...
</script>

<script type="text/plain" id="snipet.blinkButton1">
	<span class="button1-blinkWrp">
		<{{=it.tag||'a'}} class="smenu-itemBtn button1 {{=it.btnType||''}} {{=it.cls||''}}" {{?it.href !== undefined}}href="{{=it.href}}"{{?}}>{{=it.text}}</{{=it.tag||'a'}}>
		{{?!it.noBlink}}
			<{{=it.tag||'a'}} class="smenu-itemBtn button1 button1-blink {{=it.btnTypeBlink||'-type-gold'}} -anim-blink {{=it.cls||''}}" {{?it.href !== undefined}}href="{{=it.href}}"{{?}}>{{=it.text}}</{{=it.tag||'a'}}>
		{{?}}
	</span>
</script>

<script type="text/plain" id="snipet.socket.disconnect">
	<div class="socket-disconnect-wrp">
		<div class="socket-disconnect-block">
			Внимание! Потеряна связь с ГЛАВНЫМ сервером.
			<br>
			Для продолжения игры необходимо <a class="bgDark link js-reconnect">восстановить</a> связь.
			<br>
			<br>
			<button class="button1 -type-blue js-reconnect">Восстановить связь 
				{{?it.time}}
					({{=snip.timer(it.time + timeMgr.getNow(), 'dec', timeMgr.fPeriod(it.time))}})
				{{?}}
			</button>
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.countryExcludeError">
	{{=snip.acc(it.account)}}
	 не может покинуть 
	{{=snip.country(wofh.country)}}
	 во время полета КК, если в его городах активирован ЦУП
</script>

<script type="text/plain" id="snipet.specialistsSelectSld">
	<div class="sld-carousel-block">
		<div class="sld-carousel -type-spec">
			<div class="sld-carousel-list">
				{{@it.specialists: specialist: index}}
					<div class="sld-carousel-item -type-spec {{?specialist.getId() == it.selectedSpec.getId()}}-type-selected{{?}}" data-index="{{=index}}" data-id="{{=specialist.getId()}}">
						{{=snip.specialist({specialist:specialist, noTitle:true, noCount:true})}}
					</div>
				{{@}}
			</div>

			<div class="sld-carousel-arrow-block">
				<div class="sld-carousel-arrow -type-left -type-spec"></div>
				<div class="sld-carousel-arrow -type-right -type-spec"></div>
			</div>

			<input type="hidden" name="spec" value="{{=it.selectedSpec.getId()}}">
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.specialistsSelect">
	<div class="select-specialists">
		<div class="select-specialists-list">
			{{@it.specialists: specialist: index}}
				<div class="select-specialists-item -specialist-highlight" data-index="{{=index}}" data-id="{{=specialist.getId()}}">
					{{=snip.specialist({specialist:specialist, noTitle:true, noCount:true})}}
				</div>
			{{@}}
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.townImg">
    {{var town = it.town, wonder = town.getWonder(), isSimpleMap = iMap.isSimplified();}}
    
	<div class="map-layers -type-{{=it.sizeType||'mini'}} {{?isSimpleMap}}-type-simple{{?}}">
		<div class="map-climate -id-{{=town.climate}}"></div>
        
		{{?town.getType().hill == 3}}
			<div class="map-hill -climate-{{=town.climate}} {{?town.getType().water > 1}}-type-bottom{{?}}"></div>
		{{?}}
        
		{{?town.getType().water > 1}}
			{{?isSimpleMap}}
                <div class="map-bank -type-{{=town.getType().water}}"></div>
			{{??}}
				<div class="map-bank -climate-{{=town.climate}}"></div>
			{{?}}
		{{?}}

		{{?town.getType().water == 1}}
			{{?isSimpleMap}}
				<div class="map-river -dir-0"></div>
				<div class="map-river -dir-4"></div>
			{{??}}
				<div class="map-river -id-1"></div>
			{{?}}
		{{?}}
        
		<div class="map-town {{?!isSimpleMap && !wonder.isEmpty()}}-wonderArea{{?}} {{?town.account.isBarbarian()}}-barbarian{{?}} -size-{{=town.getLevel()}} {{?town.getType().water == 1}}-offsetTop{{?}}"></div>
        
		{{?!wonder.isEmpty()}}
			<div class="map-wonder {{?wonder.isActive()}}-type-active{{?}} -id-{{=wonder.id}}"></div>
		{{?}}
	</div>
    
	{{?it.showDeposit && town.deposit && !town.deposit.isEmpty()}}
        <div class="map-layers -type-{{=it.sizeType||'mini'}} {{?isSimpleMap}}-type-simple{{?}}" data-title="{{=town.deposit.getName()}}">
            {{?!town.deposit.isUndefined()}}
                <div class="map-climate -id-{{=town.deposit.getClimate()}}"></div>
            {{?}}
            
            <div class="map-deposit -id-{{=town.deposit.getId()}} -type-colonized"></div>
        </div>
	{{?}}
</script>

<script type="text/plain" id="snipet.smplSelect">
	<div class="smplSelect {{=it.cls||''}}">
		<input type="hidden" class="smplSelect-input" name="{{=it.name||''}}">
		
		<span class="smplSelect-text"></span>
	</div>
</script>

<script type="text/plain" id="snipet.resGroupSelect">
	<div class="resGroupSelect">
		{{@it.resGroups: resGroup}}
			<div class="resGroupSelect-group">
				{{=tmplMgr.snipet.resSelect({resList:resGroup})}}
			</div>
		{{@}}
	</div>
</script>

<script type="text/plain" id="snipet.resSelect">
	<div class="resSelect">
		{{@it.resList.getList(): res}}
			{{=tmplMgr.snipet.resSelect.res({res:res})}}
		{{@}}
	</div>
</script>

<script type="text/plain" id="snipet.resSelect.res">
	<div class="resSelect-res {{?it.res.disabled}}-disabled{{?}} {{?it.res.tooltip}}js-tooltip{{?}}" data-id="{{=it.res.getId()}}" {{?it.res.tooltip}}data-tooltip-wnd="text" data-tooltip-text="{{=utils.escapeHtml(it.res.tooltip)}}"{{?}} tabindex="-1">
		<div class="resSelect-res-alert-wrp"></div>
		<div class="resSelect-res-input-wrp">
			<span class="resSelect-res-icon">{{=snip.resBig(it.res)}}</span>
			{{=snip.input1({cls: 'resSelect-res-input spinbox', name: 'r'+it.res.getId(), value: it.res.getCount()||'', attrs: {'data-id': it.res.getId()}, autocomplete: 'off', readonly: it.res.disabled})}} 
			<span class="resSelect-res-limit-wrp"></span>
		</div>
		<div class="resSelect-res-slider-wrp">
			<div class="resSelect-res-slider">
				<div class="slider"></div>
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="snipet.resSelect.res.limit">
	(<span class="resSelect-res-limit">{{=utils.toInt(it.limit)}}</span>)
</script>

<script type="text/plain" id="snipet.slider">
</script>	

<script type="text/plain" id="snipet.slider.label">
	<span class="slider-label-wrp -nobr">
		<span class="slider-label-icon js-slider-label-icon">{{=it.icon}}</span> <span class="slider-label-value js-slider-label-value">{{=it.value}}</span>
	</span>
</script>

<script type="text/plain" id="snipet.resIncome">
	{{?it.resources && !it.resources.isEmpty()}}
		{{var food = it.resources.calcFood();}}
		{{?food.count}}
			{{=snip.resCount(food)}}&nbsp;
			{{var resList = it.resources.clone().filter(function(res){return res.isGrown()});}}
			({{=snip.resList(resList, {tmpl: snip.resIncome.res})}})&nbsp;
		{{?}}
		{{var resList = it.resources.clone().filter(function(res){return !res.isGrown()});}}
		{{=snip.resList(resList, {tmpl: snip.resIncome.res})}}
	{{?}}
</script>

<script type="text/plain" id="snipet.resIncome.res">
	{{var resStock = wofh.town.getRes(it.id);}}
	{{var overflow = it.count + resStock.has - wofh.town.stock.max;}}
	{{?overflow > 0}}
		{{=snip.nobr(snip.title(snip.resBig(it)+snip.warnBg(it.count, snip.c.warn.red), 'Возможные излишки, которые не поместятся в складских помещениях и будут утеряны безвозвратно, составят ' + utils.formatNum(overflow, {mixed:true, fixed:1}) + ' единиц'))}}
	{{??}}
		{{=snip.resBigCount(it)}}
	{{?}}
</script>

<script type="text/plain" id="alert.offerSpeedUp">
	Для этой операции, возможно, будет недостаточно выбранного ресурса ускорения, и расчетное время доставки составит 
	<span class="clr6">{{=timeMgr.fPeriod(it.noSpeedUpTime)}}</span>
	.
</script>

<script type="text/plain" id="confirm.stock.full">
	<div>
		Внимание. Текущей <span class="iconCapacity"></span>
		вместимости хранилища города не хватит, чтобы вместить весь объем залога. Будет потеряно безвозвратно {{=snip.resCount(it.res, utils.toInt(it.count))}}.
		<br>
	</div>
</script>

<script type="text/plain" id="confirm.army.btlStartOperation">
	<div>
		Эта Военная Операция может присоединится к текущему бою или подождать и вступить в бой после его окончания.
		<br>
	</div>
</script>

<script type="text/plain" id="alert.tactics.overflow">
	{{=snip.alert()}}
	Внимание! 
	{{?it.count > 0}}
		Превышено
	{{??it.count == 0}}
		Достигнуто
	{{?}}
	 допустимое количество тактик.
	{{?it.noPremium}}
		<br>
	{{??}}
		 
	{{?}}
	Ты не сможешь создавать
	{{?it.count > 0}}
		 и редактировать
	{{?}}
	 тактики пока не удалишь лишние
	{{?it.count > 0}}
		 
		{{=it.count}}
	{{?}}
	.
	{{?!it.noPremium && !wofh.account.isPremium()}}
		<br>
		Или ты можешь увеличить их максимальное количество 
		{{=snip.link('', 'активировав Царь-Аккаунт', 'link js-getPremium')}}
	{{?}}
</script>

<script type="text/plain" id="snipet.alertTmpl.blocked">
	Эта возможность ограничена до  {{=timeMgr.fMoment(it.time)}}
	{{?it.reason}}
		
	{{?}}
</script>

<script type="text/plain" id="snipet.alertTmpl.blocked.message">
	{{=snip.alertTmpl.blocked({time: wofh.account.messageblock})}}
</script>

<script type="text/plain" id="alert.leaveCountry">
	Ты не можешь покинуть 
	{{=snip.country(wofh.country)}}
	 из-за ее Космической Программы. Легкомысленное отношение к Космической программе недопустимо. Стыдись! 
	{{=snip.link(hashMgr.getWndHref('help', 'win'), 'Подробнее')}}
</script><script type="text/plain" id="snipet.table">
	{{it = it||{};}}
	
	<div class="tbl {{=it.cls||''}}">
</script>

<script type="text/plain" id="snipet.table.end">
	</div>
</script>

	<script type="text/plain" id="snipet.table.thead">
		{{it = it||{};}}
			
		<div class="tbl-thead {{=it.cls||''}}">
	</script>
	
	<script type="text/plain" id="snipet.table.thead.end">
		</div>
	</script>
	
	<script type="text/plain" id="snipet.table.tbody">
		{{it = it||{};}}
		
		<div class="tbl-tbody {{=it.cls||''}}" style="{{=it.style||''}}">
	</script>
	
	<script type="text/plain" id="snipet.table.tbody.end">
		</div>
	</script>
	
		<script type="text/plain" id="snipet.table.tr">
			{{it = it||{};}}
			
			<div class="tbl-tr {{=it.cls||''}}">
		</script>

		<script type="text/plain" id="snipet.table.tr.end">
			</div>
		</script>
			
			<script type="text/plain" id="snipet.table.th">
				{{it = it||{};}}
				
				<div class="tbl-th {{=it.cls||''}}">
			</script>

			<script type="text/plain" id="snipet.table.th.end">
				</div>
			</script>
			
			<script type="text/plain" id="snipet.table.td">
				{{it = it||{};}}
				
				<div class="tbl-td {{=it.cls||''}}">
			</script>
			
			<script type="text/plain" id="snipet.table.td.end">
				</div>
			</script>
			
			
			
<script type="text/plain" id="snipet.sTable">
	{{it = it||{};}}
	
	<table class="s-tbl {{=it.cls||''}}">
</script>

<script type="text/plain" id="snipet.sTable.end">
	</table>
</script>

	<script type="text/plain" id="snipet.sTable.thead">
		{{
			it = it||{};
			
			var clss = it.cls ? 'class="'+it.cls+'"' : '';
		}}
		
		<thead {{=clss}}>
	</script>
	
	<script type="text/plain" id="snipet.sTable.thead.end">
		</thead>
	</script>
	
	<script type="text/plain" id="snipet.sTable.tbody">
		{{
			it = it||{};
			
			var clss = (it.cls ? 'class="'+it.cls+'"' : '');
		}}
		
		<tbody {{=clss}}>
	</script>
	
	<script type="text/plain" id="snipet.sTable.tbody.end">
		</tbody>
	</script>
	
		<script type="text/plain" id="snipet.sTable.tr">
			{{
				it = it||{};
				
				var clss = it.cls ? 'class="'+it.cls+'"' : '';
			}}
			
			<tr {{=clss}}>
		</script>

		<script type="text/plain" id="snipet.sTable.tr.end">
			</tr>
		</script>
			
			<script type="text/plain" id="snipet.sTable.th">
				{{
					it = it||{};
					
					var clss = it.cls ? 'class="'+it.cls+'"' : '';
				}}
				
				<th {{=clss}}>
			</script>

			<script type="text/plain" id="snipet.sTable.th.end">
				</th>
			</script>
			
			<script type="text/plain" id="snipet.sTable.td">
				{{
					it = it||{};
					
					var clss = it.cls ? 'class="'+it.cls+'"' : '';
				}}
				
				<td {{=clss}}>
			</script>
			
			<script type="text/plain" id="snipet.sTable.td.end">
				</td>
			</script>		
	<script type="text/plain" id="wnd.tooltip">
	<div class="tooltip">
		<div class="tooltip-brd tooltip-brd-tl"></div>
		<div class="tooltip-brd tooltip-brd-tr"></div>
		<div class="tooltip-brd tooltip-brd-bl"></div>
		<div class="tooltip-brd tooltip-brd-br"></div>
		<div class="tooltip-brd tooltip-brd-t"></div>
		<div class="tooltip-brd tooltip-brd-b"></div>
		<div class="tooltip-brd tooltip-brd-l"></div>
		<div class="tooltip-brd tooltip-brd-r"></div>
		<div class="tooltip-brd-c"></div>

		<div class="tooltip-cnt">{{=it.cont}}</div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.label">
	<div class="tooltip-label tooltip-colorBlock -type-{{=it.highlight||'blank'}}">
		<div class="tooltip-brd tooltip-brd-tl"></div>
		<div class="tooltip-brd tooltip-brd-tr"></div>
		<div class="tooltip-brd tooltip-brd-bl"></div>
		<div class="tooltip-brd tooltip-brd-br"></div>

		<div class="tooltip-label-cnt">{{=it.text}}</div>
		<div class="tooltip-label-helper"></div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.unit">
	{{=tmplMgr.wnd.tooltip.label({text:snip.unitIcon(it.unit), highlight:'head'})}}
	<div class="tooltip-cont">
		<div class="tooltip-colorBlock -type-head">{{=utils.upFirstLetter(it.unit.getName())}}</div>

		{{?it.unit.isTemplate() || it.unit.isFort() || it.unit.isAny()}}
			</div>
			{{return out;}}
		{{?}}

		<div class="tooltip-divider"></div>
		<div class="tooltip-colorBlock -type-blank">
			{{?wofh.country}}
				<div>
					{{@Unit.countryPayments: countryPayment}}
						{{var countryPay = it.unit.getCountryPayment(countryPayment.name);}}

						{{?countryPay}}
							<div class="pb02">
								{{=countryPayment.text}}
								{{=snip.res(Resource.ids.money)}}
								{{=utils.formatNum(countryPay, {stages: true})}}
							</div>
						{{?}}
					{{@}}
				</div>
			{{?}}

			<div>
				{{?it.unit.getCapacity()}}
					<span class="-nobr tooltip-param-info">{{=snip.icon(snip.c.anyIcon, 'unitCapacity')}} {{= it.unit.getCapacity() }}</span>
				{{?}}
				<span class="-nobr tooltip-param-info">{{=snip.icon(snip.c.anyIcon, 'speed')}} {{=Math.round(it.unit.getSpeed() * 3600) }}</span>
				<span class="-nobr tooltip-param-info">{{=snip.icon(snip.c.anyIcon, 'rent')}} {{=snip.resList(it.unit.getPay())}}</span>
			</div>

			{{?it.unit.getTags()}}
				<div>
					<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'features')}}</span>
					<span class="tooltip-param-val">
						{{=snip.unitTags(it.unit)}}
					</span>
				</div>
			{{?}}

			{{?it.unit.hasAbilities()}}
				<div>
					<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'abilities')}}</span>
					<span class="tooltip-param-val">
						{{= snip.list(it.unit.getAbilitiesArr(), function(item, i){
							return '<a class="link" href="'+HashMgr.getHref('#/help/unit')+'">'+Unit.getAbilityName(+i+1)+'</a>'
						})}}
					</span>
				</div>
			{{?}} 

			{{?!it.unit.getRaces().hasAll()}}
				<div>
					<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'race')}}</span>
					<span class="tooltip-param-val">
						{{?wofh.account && wofh.account.race}}
							{{= snip.list(it.unit.getRaces().getList(), function(race){return '<span class="clr'+(wofh.account.race.id == race.id?2:1)+'">'+ race.getName() +'</span>';})}}
						{{??}}
							{{= snip.list(it.unit.getRaces().getList(), function(race){return race.getName();})}}
						{{?}}
					</span>
				</div>
			{{?}}

			<div>
				<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'science')}}</span>
				<span class="tooltip-param-val">
					{{~ it.unit.getSciences().getSortList('cost', true).getList() : science }}
						{{ var known = science.getKnown(); }}
						<a class="clr{{?known == Science.known.unavail}}0{{??known == Science.known.avail}}1{{??}}2{{?}} link" href="{{=HashMgr.getHref('#/scienceinfo/'+science.getId())}}"> {{= science.getName() }} </a>&nbsp;
					{{~}}
				</span>
			</div>

			<div>
				<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'cost')}}</span>
				<span class="tooltip-param-val">
					{{= timeMgr.fPeriod(it.unit.getTrainTime())}} {{=snip.pop(it.unit.getPopCost())}} {{=snip.resList(it.unit.getCost())}}
				</span>
			</div>

			<div>
				<span class="tooltip-param-icon">{{=snip.icon(snip.c.anyIcon, 'place')}}</span>
				<span class="tooltip-param-val">
					{{= snip.list(it.unit.getTrainingSlots().getList(), function(slot){
						return snip.buildLink(slot, false, {level: false});
					})}}
				</span>
			</div>
		</div>

	</div>
</script>

<script type="text/plain" id="wnd.tooltip.science.label">
	<div class="scienceImgIcon" style="background-image: url(https://test.waysofhistory.com/img/help/sciences/{{=it.science.id}}.png);" data-title="'+it.science.getName()+'"></div>
</script>

<script type="text/plain" id="wnd.tooltip.science">
	{{=tmplMgr.wnd.tooltip.label({text:tmplMgr.wnd.tooltip.science.label(it), highlight:'head'})}}
	<div class="tooltip-cont">
		<div class="tooltip-colorBlock -type-head">{{=snip.scienceLink(it.science, {highlight: true, lenLim: 140})}}</div>
		<div class="tooltip-divider"></div>

		<div class="tooltip-colorBlock -type-blank">
			<div style="height: 20px;">
				<span style="line-height: 20px;">{{= snip.res(Resource.ids.science)}}{{=utils.stages(~~it.science.getCost())}}
				<span style="float: right;">
					{{=snip.scienceIcons(it.science)}}
				</span>
			</div>

			<div>
				{{~it.science.need:science}}
					{{science = new Science(science);}}
					{{?!science.isEmpty() && !science.isKnown()}}
						{{=snip.scienceLink(science, {highlight: true, lenLim: 155})}}<br/>
					{{?}}
				{{~}}
			</div>

			<div>
				{{@ it.science.units.getList(): unit }}
					{{=snip.unitIconLink(unit)}}&nbsp;
				{{@}}
			</div>

			<div>
				{{@ it.science.builds.getList() : build}}
					{{=snip.slotMini(build)}}
				{{@}}
			</div
		</div
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.build">
	{{=tmplMgr.wnd.tooltip.label({text: snip.slotIcon(it.slot, {cls: '-type-tooltip'}), highlight:'head'})}}
	
	<div class="tooltip-cont -type-build">
		<div class="tooltip-colorBlock -type-head">{{=it.head||it.slot.getName()}}</div>
		
		{{?!it.slot.isEmpty()}}
			<div class="tooltip-divider"></div>
			
			<div class="tooltip-colorBlock -type-blank">
				<div style="margin: 0 -4px; padding-bottom: 5px;">
					<table>
						{{=snip.buildParams(it.slot, it.up, true)}}
					</table>
				</div>

				<div>
					{{@ it.slot.getTrainUnits().getList() : unit}}
						{{=snip.unitIcon(unit, {checkAvail: true})}}&nbsp;
					{{@}}
				</div>

				<div>
					{{~it.slot.getSciences().getList(): science}}
						{{ var known = Account.isLogin() ? science.getKnown() : Science.known.done; }}
						<a class="link clr{{?known == Science.known.unavail}}0{{??known == Science.known.avail}}1{{??}}2{{?}}" href="{{=HashMgr.getHref('#/scienceinfo/'+science.getId())}}">
							{{=snip.scienceIcon()}} {{= snip.lenlim(science.getName(), {lenLim:110})}}
						</a>
						&nbsp;+{{= science.getBuildLevel(it.slot.getId()) }}<br>
					{{~}}
				</div>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.params">
	
</script>

<script type="text/plain" id="wnd.tooltip.town">
	<div class="tooltip-cont -type-town">
		{{var rel = wofh.country && it.town.account.country? wofh.country.getRelStatus(it.town.account.country.id): Tile.relation.none;}}
		<div class="tooltip-colorBlock -countryRel-{{=utils.cnstName(Tile.relation, rel)}}">
			{{=snip.town(it.town)}}
			<span class="fR ml05 mt05">{{=snip.townSlots(it.town)}}</span>
		</div>
		<div class="tooltip-divider"></div>
		<div class="tooltip-colorBlock -type-blank">
			<div style="text-align: right">
				{{=snip.distance(it.town.distance)}}
			</div>
			<div>{{=snip.acc(it.town.account)}}</div>
			{{?it.town.pop}}
				<div>{{=snip.pop(utils.toInt(it.town.pop.hasall))}}</div>
			{{?}}
			{{?it.town.deposit && !it.town.deposit.isEmpty()}}
				<div>{{=snip.deposit(it.town.deposit)}}</div>
			{{?}}
			{{?it.town.account.country}}
				<div>{{=snip.lenlim(snip.country(it.town.account.country), {lenLim:155})}}</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.account">
	<div class="tooltip-cont -type-account">
		{{var rel = wofh.country && it.account.country ? wofh.country.getRelStatus(it.account.country.id): Tile.relation.none;}}
		<div class="tooltip-colorBlock -countryRel-{{=utils.cnstName(Tile.relation, rel)}}">
			{{=snip.acc(it.account)}} 
			<span class="fR ml05">{{=snip.postsIcon(it.account.power)}}</span>
		</div>
		<div class="tooltip-divider"></div>
		<div class="tooltip-colorBlock -type-blank">
			{{?it.account.rate}}
				{{var ratePointsList = new RatePointsList(it.account.rate.points);}}
				{{?ratePointsList.getLength()}}
					<div class="nobr">
						{{@ratePointsList.getList(): points}}
							{{=snip.ratePoint(points.count, points.id)}} 
						{{@}}
					</div>
				{{?}}
			{{?}}
			<div>{{=snip.townIcon()}}{{=it.account.towns}}</div>
			<div>
				{{=snip.pop(it.account.pop)}}&nbsp;
				{{?it.account.towns>1}}
					({{=Math.round(it.account.pop/it.account.towns)}})
				{{?}}
			</div>
			{{?it.account.country}}
				<div>{{=snip.lenlim(snip.country(it.account.country), {lenLim:155})}}</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.country">
	{{var rel = wofh.country ? wofh.country.getRelStatus(it.country.id): Tile.relation.none;}}

	{{=tmplMgr.wnd.tooltip.label({text:snip.countryFlag(it.country, {flag:'normal'}), highlight:utils.cnstName(Tile.relation, rel)})}}
	
	<div class="tooltip-cont">	
		<div class="tooltip-colorBlock -countryRel-{{=utils.cnstName(Tile.relation, rel)}}">{{=it.country.name}}</div>
		<div class="tooltip-divider"></div>
		{{?it.country.isUnknown()}}
			<div class="tooltip-colorBlock -type-blank aC">
				Империи не вечны. Развеяны многие прахом истории по ветрам времен. Остались только байки о славных победах у солдатского костра, да соромные истории про бывшего Императора...<br>Была ли такая страна или это все чаянья простого люда о Великом и Справедливом уже и не узнать...
			</div>
		{{??}}
			<div class="tooltip-colorBlock -type-blank" style="text-align: center">
				<div>
					<span class="tooltip-country-row">{{=snip.accIcon()}}{{=it.country.getAccCount()}}</span>
					<span class="tooltip-country-row">{{=snip.townIcon()}}{{=it.country.towns}}</span>
					<span class="tooltip-country-row">{{=snip.pop(utils.toInt(it.country.pop))}}</span>
				</div>
				<div>
					<span class="tooltip-country-row">{{=snip.pop()}}/{{=snip.accIcon()}}{{=Math.round(it.country.pop/it.country.players)}}</span>
					<span class="tooltip-country-row">{{=snip.pop()}}/{{=snip.townIcon()}}{{=Math.round(it.country.pop/it.country.towns)}}</span>
				</div>
			</div>
			{{
				var relAlly = it.country.getCountriesByRel(Tile.relation.ally);
				var relEnemy = it.country.getCountriesByRel(Tile.relation.enemy);
			}}
			{{?utils.sizeOf(relAlly) || utils.sizeOf(relEnemy)}}
				<div class="tooltip-divider"></div>
				
				<div class="tooltip-colorBlock -type-blank">
					<div class="tooltip-country-rel cl-green">
						{{@relAlly: country}}
							{{?country.isActive()}}
								<div>{{=snip.lenlim(snip.country(country), {lenLim:80})}}</div>
							{{?}}
						{{@}}
					</div>
					<div class="tooltip-country-rel cl-red">
						{{@relEnemy: country}}
							{{?country.isActive()}}
								<div>{{=snip.lenlim(snip.country(country), {lenLim:80})}}</div>
							{{?}}
						{{@}}
					</div>
				</div>
			{{?}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.tradeAlly">
	<div class="tooltip-cont">
		<div class="tooltip-colorBlock -type-head">{{=it.ally.name}}</div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.specialist">
	{{=tmplMgr.wnd.tooltip.label({text:snip.icon(snip.c.specialistIcon, it.specialist.getType()), highlight:'head'})}}
	<div class="tooltip-cont">
		<div class="tooltip-colorBlock -type-head">{{=it.specialist.getName('full')}}</div>
		<div class="tooltip-divider"></div>
		<div class="tooltip-colorBlock -type-blank">
			{{=it.specialist.getDescription()}}
		</div>
		{{?it.prob !== undefined}}
			<div class="tooltip-divider"></div>
			<div class="tooltip-colorBlock -type-blank">
				Шанс получить ― 1 к {{=utils.formatNum(1/it.prob, {int: true, stages: true})}}
				{{?it.num}}
					<br>
					Ты претендуешь на {{=utils.formatNum(it.num * Specialist.inverseBase, {int: true, stages: true})}} еще не родившихся Великих Граждан
				{{?}}
			</div>
	   {{?}}
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.tactic">
	<div class="tooltip-cont -type-tactic">
		{{var title = it.tactic ? snip.tactic(it.tactic, {postText:' ('+it.tactic.getWaves().getLength()+')'}) : 'Такой тактики не существует';}}

		<div class="tooltip-colorBlock -type-head">{{=title}}</div>
		<div class="tooltip-divider"></div>

		{{?!it.tactic}}
			</div>
			{{return out;}}
		{{?}}

		<div class="tooltip-colorBlock -type-blank aC">
			Правил: {{=it.tactic.getRules().getLength()}}
			<br>
			В резерве: {{=it.tactic.getReserve2().getArmy().getLength()}}
		</div>
		<div class="tooltip-divider"></div>
		<div class="tooltip-colorBlock -type-blank -type-minHeight aC">
			{{@it.tactic.getRules().getList():rule}}
				{{?rule.getIndex() > 4}}{{break;}}{{?}}
				{{?rule.getConds().getLength()}}
					{{=snip.unitIcon(rule.getConds().getFirstElem().getUnit())}}
				{{?}}
			{{@}}
		</div>
	</div>
</script>

<script type="text/plain" id="wnd.tooltip.text">
	{{?it.label}}
		{{=tmplMgr.wnd.tooltip.label({text:it.label})}}
	{{?}}

	<div class="tooltip-cont -type-text">
		<div class="tooltip-colorBlock -type-blank">
			{{=it.text||''}}
		</div>
	</div>
</script><script type="text/plain" id="ability">
	<div class="view-ability view-wndAbil -state-hidden" data-type="{{=utils.cnstName(Ability.ids, it.id)}}">
        <div class="wndAbil-ext">
            <div class="wndAbil-top">
                <div class="wndAbil-subttl">{{=it.title||'Ты получил новую возможность'}}</div>
                <div class="wndAbil-ttl">{{=it.name}}</div>
            </div>

            <div class="wndAbil-center js-toggle">
                <div class="wndAbil-img -type-{{=it.img||utils.cnstName(Ability.ids, it.id)}}"></div>
            </div>

            <div class="wndAbil-bottom bgDark">
                <div class="wndAbil-descr">{{=it.about}}</div>
                <div class="wndAbil-buttons {{?it.link}}-extended{{?}}">
                    {{?it.link}}
                        <a class="link wndAbil-about" href="{{=it.link}}">Подробнее</a>
                    {{?}}
                    <a class="link wndAbil-toggle js-toggle">{{=it.toggleText||'Хорошо. '}}<span class="js-timer"></span></a>
                </div>
            </div>
        </div>
    </div>
</script>
<script type="text/plain" id="account.header">
    <span class="account-header js-account-header -sel"></span>
</script>

<script type="text/plain" id="account">
	<div class="view-account">
		<div class="account-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="account.view">
	<div>
		{{?it.country && it.country.id}}
			<div class="account-country-info bgDark">
				{{=snip.countryLink(it.country)}} {{=snip.postsIcon(it.power)}}
			</div>
		{{?}}
		
		<div class="block1">
			<div class="account-info block1-cont">
				<div class="account-brief">
					{{?it.rate}}
						{{var ratePointsList = new RatePointsList(it.rate.points);}}
						{{?ratePointsList.getLength()}}
							Очки рейтинга: 
							{{@ratePointsList.getList(): points}}
								{{=snip.ratePoint(points.count, points.id)}} 
							{{@}}
							<br>
						{{?}}
					{{?}}
					Раса:  {{=snip.accIcon(it)}} {{=it.race.getName()}}<br>
					Население:  {{=snip.pop(it.pop)}}<br>
				</div>

				<div class="account-actions">
					{{?it.towns}}
						<a href="{{=hashMgr.getWndHref('messages', 'write&player='+it.id)}}" class="mapButton -type-message fR" data-title="Отправить письмо"></a>

						{{?wofh.account.bonus && wofh.account.isPremium()}}
							<div class="mapButton -type-note fR crP" data-title="Заметка об игроке"></div>
						{{?}}
						{{?wofh.account.id != it.id}}
							{{?Account.isKnownMoney()}}
								<div class="mapButton -type-sendmoney fR crP" data-title="Перевести деньги"></div>
							{{?}}
							{{?wofh.country && wofh.account.isHead()}}
								{{?it.country && it.country.id == wofh.country.id}}
									<div class="mapButton -type-dipUninv fR crP" data-title="Исключить из состава страны"></div>
								{{??wofh.country.invited[it.id]}}
									<div class="mapButton -type-dipUninv fR crP" data-title="Отменить приглашение в страну"></div>
								{{??}}
									<div class="mapButton -type-dipInv fR crP" data-title="Пригласить в страну"></div>
								{{?}}
							{{?}}
						{{?}}
						{{?it.showAllyBtn}}
							<div class="mapButton -type-ally fR crP" data-title="Включить в союз"></div>
						{{?}}
						{{?debug.isAdmin()}}
							{{=tmplMgr.account.enterTown(it)}}
						{{?}}
					{{??wofh.account.bonus && wofh.account.isPremium() && wofh.account.id != it.id}}
						<div class="mapButton -type-note fR crP" data-title="Заметка об игроке"></div>
					{{?}}
				</div>
			</div>
		</div>
		
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-175, 0), 300)}}px;">
			<div class="account-text-wrp">
				<div class="account-text">
					{{=TextParser.prepare(it.about)}}
				</div>
				
				{{=snip.link('', 'Показать всё', 'acc-showFullText ' + snip.getFakelinkCls({type: 'green'}))}}
			</div>
			
			{{?it.admin}}
				{{=tmplMgr.account.admin(it)}}
			{{?}}
			
			<div class="account-towns">
				{{@it.townslist: town: index}}
					<div class="accWrapper">
						<div class="accNumberWrp">
							<span class="accNumber">{{=(+index + 1)}}</span>
							<div class="accNumberBg"></div>
						</div>
                        
						<div class="accTownImgWrp">
							{{=tmplMgr.account.town({town: town})}}
						</div>
                        
						<div class="accTownInfoWrp">
							<div class="accTownInfo">

								<div class="accTownInfoName lenLim">
									{{=snip.townLink(town)}}
								</div>
								<div class="accTownInfoPop">
									{{=snip.pop(utils.toInt(town.pop.hasall))}}
								</div>

								{{?town.distance && wofh.account.bonus && wofh.account.isPremium()}}
									<div class="accTownInfoDistance">
										<span class="nobr"> 
											{{=snip.distance(town.distance)}}
										</span>
									</div>
								{{?}}

							</div>
						</div>
						{{?town.climate && town.terrain}}
							<div class="accTownButtonWrp">
								{{?wofh.town && ((town.id != wofh.town.id && wofh.town.army.intown.getLength()) || Account.hasAbility(Science.ability.tactics)) && !Town.hasDefMoment(town.army)}}
									<div class="mapButton -type-army fL" title="Отправить войска"><a class="dlink" href="{{=HashMgr.getHref('#/sendArmy/target='+town.id)}}"></a></div>
								{{?}}
								{{?town.pos}}
									<div class="mapButton -type-map fL" title="Центрировать карту"><a class="dlink" href="{{=HashMgr.getHref('#map/o='+town.pos.o+'&x='+town.pos.x+'&y='+town.pos.y)}}"></a></div>
								{{?}}

								{{?town.distance && (town.distance.land || town.distance.deepwater || town.distance.water)}}
									{{?wofh.town && town.id != wofh.town.id}}
										{{?town.distance.air < lib.trade.distance || Account.hasAbility(Science.ability.longTrade)}}
											{{?Account.hasAbility(Science.ability.money)}}
												<div class="mapButton -type-resStream fL" title="Начать снабжение"><a class="dlink" href="{{=HashMgr.getHref('#/stream/'+town.id)}}"></a></div>
											{{?}}
											{{?wofh.town.traders.count > 0}}
												<div class="mapButton -type-resSend fL" title="Транспортировать ресурсы"><a class="dlink" href="{{=HashMgr.getHref('#/send/target='+town.id)}}"></a></div>
											{{?}}
										{{?}}
									{{?}}
								{{?}}
							</div>
						{{?}}
					</div>
				{{@}}
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="account.town">
    {{?it.town.climate && it.town.terrain}}
        {{=snip.townImg({town: it.town, showDeposit: true})}}
    {{??}}
        <div class="accTownImg map-town -empty"></div>
    {{?}}
</script>

<script type="text/plain" id="account.sendMoney">
	Сделать перевод для  <b>{{=it.account.name}}</b>
	<br>
	<br>
	<img src="https://test.waysofhistory.com/img/_.gif" class="res r1">
	{{=snip.input1({cls: 'account-sendMoney', value: it.sum, name: 'money'})}}
	<br>
	<br>
</script>

<script type="text/plain" id="account.exclude">
	<input type='hidden' name='confirmation'>
	<p class='linehh'>Ты действительно хочешь <br>
		исключить <b>{{=it.name}}</b><br>
		из страны <b>{{=wofh.country.name}}</b>?
	</p>
</script>

<script type="text/plain" id="account.note">
	<form class="view-accountNote js-account-saveNote">
		<textarea class="accountNote-text textarea1" maxlength="{{=lib.account.notemaxlen}}">{{=it.text}}</textarea>
		
		<div style="margin: 5px 0">
			<button class="button1 -type-green">Сохранить</button>
			<button type="button" class="button1 -type-red but_close">Закрыть</button>
		</div>
	</form>
</script>

<script type="text/plain" id="account.allys">
	<form id="joinAlly">
		Включить в 
		<br>
		<select class="mb05 select1">
			{{~it: ally}}
				<option value="{{=ally.id}}">{{=ally.name}}</option>
			{{~}}
		</select>
	</form>
</script><script type="text/plain" id="ally.header">
	Торговые союзы
</script>

<script type="text/plain" id="ally">
	<div class="view-ally">
		<div class="ally-wrp">
			<div class="ally-list-wrp js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100, 0), 200)}}px;">
				<div class="js-ally-list-wrp"></div>
			</div>
			<div class="ally-info-wrp js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100, 0), 200)}}px;">
				<div class="js-ally-info-wrp"></div>
			</div>
		</div>
		<div class="ally-create">
			<button class="button1 js-create-ally">Создать новый торговый союз</button>
			<span class="js-maxOwn">{{=snip.hint('Слишком много торговых союзов')}}</span>
		</div>
	</div>
</script>

<script type="text/plain" id="ally.list">
	{{?wofh.tradeAllies.getCountryAlly()}}
		<ul class="ally-list">
			<li class="ally-list-item ally-list-country">
				{{=snip.countryFlag(wofh.country, {flag: 'normal'})}} Союз твоей страны {{=snip.hint('Союз был создан автоматически. В него входят все члены твоей страны')}}
			</li>
		</ul>
	{{?}}

	{{?wofh.tradeAllies.getMyCount()}}
		<div class="ally-list-title">Твои торговые союзы</div>
		<ul class="ally-list">
			{{@wofh.tradeAllies.getList(): ally}}
				{{?ally.my}}
					<li data-id="{{=ally.id}}" class="{{?(it.allyInfo||{}).id == ally.id}}-active{{?}} ally-list-item crP js-allyInfo">
						{{=snip.tradeAllyLink(ally, { aOpt:{showOverflow:true} })}}
					</li>
				{{?}}
			{{@}}
		</ul>
	{{?}}

	{{?wofh.tradeAllies.getConsistCount()}}
		<div class="ally-list-title">Ты в торговых союзах</div>
		<ul class="ally-list">
			{{@wofh.tradeAllies.getList() : ally}}
				{{?!ally.my && !ally.country}}
					<li data-id="{{=ally.id}}" class="{{?(it.allyInfo||{}).id == ally.id}}-active{{?}} ally-list-item crP js-allyInfo">
						{{?!ally.incCountry}}
							<button class="button2-small -type-delete ally-out js-out-ally"></button>
						{{?}}
						
						{{=snip.tradeAllyLink(ally, { aOpt:{showOverflow:true} })}}
						
						{{?ally.incCountry}}
							&nbsp;
							{{=snip.tradeUnionCountry()}}
						{{?}}
					</li>
				{{?}}
			{{@}}
		</ul>
	{{?}}
</script>

<script type="text/plain" id="ally.info">
	{{?it.allyInfo}}
		<div class="ally-info">
			<form class="trade_ally_change">
				<div>
					<div class="ally-info-name">{{=snip.tradeAlly(it.allyInfo, {showOverflow:true})}}</div>
					<div class="ally-info-owner">{{?!it.allyInfo.owner.isCountry}}{{=snip.accLink(new Account(it.allyInfo.owner))}}{{?}}</div>
					<div class="ally-info-text">{{=it.allyInfo.text}}</div>
				</div>

				{{?it.allyInfo.owner.self}}
					<p><button class="button1 js-edit-ally">Редактировать</button></p>
				{{?}}
				
				<ul class="ally-memberList">
					{{@it.allyInfo.accounts: member}}
						{{var hasActions = it.allyInfo.owner.self && it.allyInfo.owner.id != member.id;}}
				
						<li data-id="{{=member.gid}}" class="ally-memberList-item {{?hasActions}}ally-hasActions{{?}} {{?it.allyInfo.owner.id == member.id}}owner{{?}}">
							{{=snip.accLink(new Account(member))}}
							
							{{?hasActions}}
								<a class="ally-member-delIcon js-del-member"></a>
								<a class="ally-member-ownerIcon js-set-owner"></a>
							{{?}}
						</li>
					{{@}}
				</ul>
				
				{{?it.allyInfo.countries.length}}
					<div class="ally-memberList-separator"></div>
					<ul class="ally-memberList -type-countries">
						{{@it.allyInfo.countries: member}}
							{{var hasActions = it.allyInfo.owner.self;}}
					
							<li data-id="{{=member.gid}}" class="ally-memberList-item {{?hasActions}}ally-hasActions{{?}}">
								{{=snip.countryLink(new Country(member))}}
								
								{{?it.allyInfo.owner.self}}
									<a class="ally-member-delIcon js-del-member"></a>
								{{?}}
							</li>
						{{@}}
					</ul>
				{{?}}

				{{?it.allyInfo.owner.self}}
					<p><a class="link js-del-ally">Прекратить существование союза</a></p>
				{{?}}
			</form>
		</div>
	{{?}}
</script>

<script type="text/plain" id="ally.setAlly">
	<div class="ally-setAlly-wrp">
		<div class="ally-setAlly-params">
			<div class="ally-setAlly-param">
				<span>Название: </span> 
				
				{{=snip.input1({cls: 'ally-setAlly-name js-ally-name', name: 'name', value: it.initData.name, maxlength: lib.tradeally.namelimit[1]})}}
			</div>
			{{?it.initData.id && it.initData.accounts.length}}
				<div class="ally-setAlly-param">
					<span>Глава: </span> 
					<select class="ally-setAlly-owner select1 js-ally-owner" name="owner">
						{{~it.initData.accounts: member}}
							<option value="{{=member.id}}" {{?member.id == it.initData.owner}}selected="selected"{{?}}>{{=member.name}}</option>
						{{~}}
					</select>
				</div>
			{{?}}
			<div class="ally-setAlly-param">
				<textarea class="ally-setAlly-text textarea1 js-ally-text" name="text" maxlength="{{=lib.tradeally.descriptionmaxlen}}" >{{=it.initData.text}}</textarea>
			</div>
		</div>
		
		<button class="button1 js-save-ally">Сохранить</button>
	</div>
</script>

<script type="text/plain" id="ally.alerts">
	{{?it.type == 'removeAlly'}}
		Действительно хочешь прекратить существование <strong>{{=snip.tradeUnion(it.allyName)}}</strong>?
	{{??it.type == 'removeMeFromAlly'}}
		Действительно хочешь покинуть 
		<strong>{{=snip.tradeUnion(it.allyName)}}</strong>
		?
	{{??it.type == 'removeMember'}}
		Исключить 
		<strong>
			{{?it.member.isCountry}}
				{{=snip.country(new Country(it.member))}}
			{{??}}
				{{=snip.acc(new Account(it.member))}}
			{{?}}
		</strong>
		 из 
		<strong class="ally-alerts-allyName -lenLim">{{=snip.tradeUnion(it.allyName)}}</strong>
		?
	{{??it.type == 'changeOwner'}}
		Передать управление 
		<strong class="ally-alerts-allyName -lenLim">{{=snip.tradeUnion(it.allyName)}}</strong>
		 в руки 
		<strong>{{=snip.acc(new Account(it.member))}}</strong>
		?
	{{?}}
</script><script type="text/plain" id="announce.header">
    Объявления
</script>

<script type="text/plain" id="announce">
	<div class="view-announce">
		<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-380)}}px;">
			<div class="js-announces-wrp -sel"></div>
		</div>
		
		{{?wofh.account.isPremium()}}
			<button class="button1 ann_hide" style="margin-top: 10px;"></button>
		{{?}}
		
		<div class="js-announceForm-wrp" style="margin-top:10px"></div>
    </div>
</script>

<script type="text/plain" id="announce.announces">
	{{~it: ann}}
        {{?wofh.account.isAdmin() || ann.player.id == wofh.account.id || ann.end>timeMgr.getNow()}}
            <div class="antxt{{=ann.icon==99?3:(ann.del?2:(ann.player.isAdmin()?1:0))}}" data-id="{{=ann.id}}" data-playerid="{{=ann.player.id}}">
                <div class='ttl'>
                    <table>
                        <tbody>
                            <tr>
                                <td>
                                    <img class='event ae{{=ann.icon}}' src='https://test.waysofhistory.com/img/_.gif'>
                                    {{=snip.accCountry(ann.player)}} 
                                </td>
                                <td class='tm'>до  {{=timeMgr.fMoment(ann.end)}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="txt">
                    {{=TextParser.prepare(ann.text)}}<br>
                    {{?!ann.del && (wofh.account.isAdmin() || wofh.account.id == ann.player.id)}}
                        <button class="button1 ann_del">Удалить</button>
                    {{?}}
                    {{?(wofh.account.isAdmin()? 1: wofh.account.id) == ann.player.id}}
                        {{?ann.del}}<button class="button1 ann_restart">Повторить</button> 
                        {{??}}<button class="button1 ann_prolong">Продлить</button>{{?}}
                    {{?}}
                </div>
            </div>
        {{?}}
	{{~}}
</script>

<script type="text/plain" id="announce.form">
	<form class="announce-form" name="typing2">
		{{=tmplMgr.announce.form.cont(it)}}
		
		<div class="p1000">
			<button type="submit" class="button1 js-public -disabled">Опубликовать</button>
		</div>
	</form>
</script>

<script type="text/plain" id="announce.form.cont">
	<table class="tbl-announce create1">
		<tr valign=top>
			<td class="anicns1">
				<table class="tbl-announce-icons" id="anicns">
					{{
						var iconsGroups = wAnnounce.getIconsGroups();
					}}
					
					{{@iconsGroups: iconsGroup}}
						<tr>
							{{@iconsGroup: icon}}
								<td>
									{{=tmplMgr.announce.form.icon({icon: icon})}}
								</td>
							{{@}}
						</tr>
					{{@}}
				</table>
			</td>
			<td align="right">
				{{=tmplMgr.announce.form.text(it)}}
			</td>
		</tr>
	</table>
</script>

<script type="text/plain" id="announce.form.icon">
	<label>
		{{=snip.radio1({name: 'icon', value: it.icon, checked: it.icon==8})}}
		<span class="event ae{{=it.icon}}"></span>
	</label>
</script>

<script type="text/plain" id="announce.form.text">
	<textarea class="textarea1" name="text" cols="50" rows="7"></textarea>
	<div class='ancnbtns'>Осталось  <span id="chrleft"><span id="span2">{{= lib.announce.textlen }}</span></span>  символов.</div>
	<div class="ann_sliderblock">
		<div>
			<div class="slider" data-icon="clock">
				<a class="icnu ic1 ui-slider-handle" title="Время публикации"></a>
			</div>

			<div>
				на <span class="ann_hours"></span>
				<span class="{{?wofh.account.isAdmin()}}-hidden{{?}}">
					 за 
					{{=snip.luck()}}<span class="ann_totalPrice"></span>
					.
					&nbsp;
					<span class="ann-notice fz09">Используются только купленные Монеты Удачи</span>
				</span>
			</div>
		</div>
	</div>
</script>


<script type="text/plain" id="announce.prolong">
	<div class="ann_prolong_wnd" data-id="{{=it.id}}" data-playerid="{{=it.player}}">
		<p>Продлить объявление</p>
		<div class="slider" style="margin:0 10px 10px; padding-right: 100px;" data-icon="clock">
			<a class='icnu ic1 ui-slider-handle' title='Время публикации' style="margin:-5px -10px;"></a>
		</div>
		<div>
			на <span class="ann_hours"></span> за 
			{{=snip.luck()}}<span class="ann_totalPrice"></span>
		</div>
	</div>
</script><script type="text/plain" id="army.header">
    Военные дела
</script>

<script type="text/plain" id="army">
    <div class="view-army">
		<div class="army-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="army.view">
	<div class="page_army">
		
		<div id="page_army_head">
			<table style="width:100%;">
				<tr>
					<td class="army_one_tr">
						<div class="parmy_top_sep_l"></div>
						<div id="page_army_head_t">
							{{var bonus = wofh.town.getWarBonus()-1;}}
							<span data-title="{{=utils.formatNum(bonus, {toPercent:true, fixed:2})}}%">
								Военный бонус:  {{=utils.formatNum(bonus, {toPercent:true, int:true, servRound:true})}}%
							</span>
							{{bonus = wofh.town.getLuckBonus(LuckBonus.ids.war);}}
							{{?wBonusTakeNow.canShow(bonus)}}
								&nbsp;<a class="war-addBonus link">(+ еще {{=utils.formatNum(bonus.getTypedEffectUp(), {epsilon:true, int:true, toPercent:true})}}%)</a>
							{{?}}
						</div>
					</td>
					
					<td><div class='parmy_top_sep1'></div></td>
					
					<td>
						<div id='page_army_head_s'>
							<div id='page_army_head_t'></div>
								<div id='page_army_head_t'>
									<a href='#' id='soder_gor_text' style="color:#fff">Содержание гарнизона</a>
								</div>
							<a id='soder_gor' href='#' title='Содержание гарнизона'></a>
						</div>
					</td>
				</tr>
			</table>
		</div>

		<div style='text-align:center; padding-bottom:20px; border-bottom: #000 1px solid;font-size:11px; display: none;' id="crop_town">
		
			<div class='army_move_head' style="margin: 0; width: 100%;">Содержание</div>
			
			<b class="aC">Содержание всех войск города (в час):</b><br>
			
			{{=snip.resList(it.pay)}}
		</div>

		<div id="page_army_uhead" class="js-page-army-uhead">
			<div class="tabs tabs-wrp"></div>

			<div class="block1">
				<div class="tabs-cont block1-cont"></div>
			</div>
		</div>

		<div class="filter-wrp">
			{{
				var filters = [['reinf',0], [0,0], [0,1], [1,0], [1,1]];
				if (wofh.account.hasAbility(Science.ability.tactics) || utils.sizeOf(it.comGroups)) {
					filters.push([1,'operation',0], [0,'operation',0]);

					if (wofh.country) {
						filters.push([1,'operation',1], [0,'operation',1]);
					}
				}
			}}
			{{@filters: filter}}
				<span class="filter">
					{{
						var value = it.filter[filter[0]][filter[1]];
						if( filter[2] !== undefined ) value = value[filter[2]];

						var checkboxOpt = {};
						checkboxOpt.cls = 'filter-input';
						checkboxOpt.checked = value;
						checkboxOpt.attrs = {'data-type': filter[0], 'data-dir': filter[1]};
						if( filter[2] !== undefined ) checkboxOpt.attrs['data-subtype'] = filter[2];
					}}
					{{=snip.checkbox1(checkboxOpt)}}
					<span class="pointFilter js-pointFilter">
						{{=snip.eventIconArmy(filter[0], filter[1], filter[2])}}
					</span>
				</span>
			{{@}}
		</div>

		<div class="js-scroll-wrp">
			{{?utils.sizeOf(it.commanding)}}
				<div class="army-operation">
					<div class="listel"></div>
					
					<div class="army_move_head" style="margin: 0; width: 100%;">Военные операции</div>
					
					<div class="tbl operation-tbl">
						<div class="tbl-thead">
							<div class="tbl-tr">
								<div class="tbl-td oper-col-aim">{{=snip.btnTable('town', 'Цель')}}</div>
								<div class="tbl-td oper-col-army">{{=snip.btnTable('armies', 'Участники')}}</div>
								{{=tmplMgr.army.oper.colTime({header: true, it: it})}}
							</div>
						</div>
						<div class="tbl-tbody"></div>
					</div>
				</div>
			{{?}}
			
			{{?it.events.getLength()}}
				<div class="army-events">
					<div class="listel"></div>

					<div class="army_move_head" style="margin: 0; width: 100%;">Перемещения войск</div>
					
					{{?!it.resources.isEmpty()}}
						<div class="army-resIncome">
							<div class="resIncome-title">
								Ожидаемые ресурсы
							</div>
							:
							&nbsp;
							{{=snip.resIncome(it)}}
						</div>
					{{?}}
					
					{{=tmplMgr.army.events(it)}}
				</div>
			{{?}}

			{{?it.defin.length}}
				<div class="army-defin">
					<div class='listel'></div>

					<div class='army_move_head_in pR' style="margin: 0; width: 100%;">
						Чужие подкрепления
						<span class="cancel-reinforce-all pA dIB crP" data-title="Выдворить все подкрепления"></span>
					</div>
					<table class='def_table_cw armylist' style='width:100%'>
						<thead>
							<tr class='cw_head_tr'>
								<td class='cw_head_td'>Город</td>
								<td class='def_table_cw_th'>Войска</td>
							</tr>
						</thead>
						<tbody>
							{{~it.defin: reinf: index}}
								<tr class="trow{{=index%2}}">
									<td style="text-align: left;">
										<span class="trow_ar_s -lenLim -noHint" style="text-align: left;">
											{{=snip.townAccUnder(wofh.world.getTown(reinf.town), wofh.world.getAccountByTown(reinf.town), wofh.world.getCountryByTown(reinf.town))}}
										</span>
									</td>
									<td>
										<div class="pR">
											<div class="t_cw_sep_l">
												<div class="army-defArmy">
													<span>
														{{=snip.army(reinf.army)}}
													</span>

													{{?reinf.fleetId}}
														<span class="dB">
															<span class="army-transport -defin">
																{{=snip.unitUnknown()}}
															</span>
														</span>
													{{?}}
												</div>

												<span class="cancel-reinforce pA dIB crP" data-index="{{=index}}" data-deftype="defin" data-title="Выдворить"></span>
											</div>
										</div>
									</td>
								</tr>
							{{~}}
						</tbody>
					</table>
				</div>
			{{?}}

			{{?it.defout.length}}
				<div class="army-defout">
					<div class='listel'></div>

					<div class='army_move_head_in' style="margin: 0; width: 100%;">Подкрепления в чужих городах</div>
					<table class='def_table_cw armylist' style='width:100%'>
						<thead>
							<tr class='cw_head_tr'>
								<td style='width:110px; color:#000'>Город</td>
								<td class='def_table_cw_th'><div>Войска</div></td>
							</tr>
						</thead>
						<tbody>
							{{~it.defout: reinf: index}}
								<tr class="trow{{=index%2}}">
									<td style="text-align: left;">
										{{?reinf.town2}}
											<span style="vertical-align: top;">Из </span>
											<span class="trow_ar_s">
												{{=snip.townAccUnder(wofh.world.getTown(reinf.town), wofh.world.getAccountByTown(reinf.town), wofh.world.getCountryByTown(reinf.town))}}
											</span>
											<br>
											<span style="vertical-align: top;">в </span>
											<span class="trow_ar_s">
												{{=snip.townAccUnder(wofh.world.getTown(reinf.town2), wofh.world.getAccountByTown(reinf.town2), wofh.world.getCountryByTown(reinf.town2))}}
											</span>
										{{??}}
											<span class="trow_ar_s -lenLim -noHint">
												{{=snip.townAccUnder(wofh.world.getTown(reinf.town), wofh.world.getAccountByTown(reinf.town), wofh.world.getCountryByTown(reinf.town))}}
											</span>
										{{?}}
									</td>
									<td>
										<div class="pR">
											<div class="t_cw_sep_l">
												<div class="army-defArmy">
													<span>
														{{=snip.army(reinf.army)}}
													</span>

													{{?it.fleets[reinf.fleetId]}}
														<span class="dB">
															<span class="army-transport dIB">
																{{=snip.army(it.fleets[reinf.fleetId].transport)}}
															</span>
														</span>
													{{?}}
												</div>
												<span class="cancel-reinforce pA dIB crP" data-index="{{=index}}" data-deftype="defout" data-title="Отозвать"></span>
											</div>
										</div>
									</td>
								</tr>
							{{~}}
						</tbody>
					</table>
				</div>
			{{?}}

			{{?it.battleIn.length}}
				<div class="army-battlein">
					<div class='listel'></div>
					<div class="army_move_head" style="margin: 0; width: 100%;">Входящие бои</div>
					<table class="army-battle-tbl def_table_cw armylist">
                        <colgroup>
                            <col class="army-battleIn-col1">
                            <col class="army-battleIn-col2">
                            <col class="army-battleIn-col3">
                            <col class="army-battleIn-col4">
                            <col class="army-battleIn-col5">
                            <col class="army-battleIn-col6">
                            <col class="army-battleIn-col7">
                        </colgroup>
                    
						<thead>
							<tr class='cw_head_tr'>
								<td></td>
								<td>Войска</td>
								<td>Текущие войска</td>
								<td>Город</td>
								<td>Статус</td>
								<td>Время</td>
								<td></td>
							</tr>
						</thead>
						<tbody>
							{{~it.battleIn: battle}}
								<tr class="trow_ar_supp army-battle-row" data-type="0" data-dir="{{=+!battle.side}}">
									<td>
										<img class="atk{{?battle.side == 1}}in{{??}}out{{?}}" src="https://test.waysofhistory.com/img/_.gif" />
									</td>
									<td class="army-battle-army">
										{{=snip.army(battle.army)}}
									</td>
									<td class="army-battle-armyCurrent">
										<div class="t_cw_sep_l">
											{{=snip.army(battle.armyCurrent)}}
										</div>
									</td>
									<td>
										{{=snip.townLink(battle.town)}}
									</td>
									<td>
										{{?battle.state == EventCommon.battleState.wait}}в очереди
										{{??battle.state == EventCommon.battleState.enter}}вступление в бой
										{{??battle.state == EventCommon.battleState.active}}в бою
										{{??battle.state == EventCommon.battleState.finished}}бой окончен
										{{?}}
									</td>
									<td>{{?battle.time}}{{=timeMgr.fMoment(battle.time)}}{{?}}</td>
									<td>
										{{?battle.state == EventCommon.battleState.active && battle.session != lib.war.nodefsession}}
											<a class="link js-battleLink" target="_blank" href="{{=snip.getBattleLink({session: battle.session, secret: battle.secret, town: wofh.town.id})}}">смотреть бой</a>
										{{?}}
									</td>
								</tr>
							{{~}}
						</tbody>
					</table>
				</div>
			{{?}}
			
			{{?it.battleOut.length}}
				<div class="army-battleout">
					<div class="listel"></div>
					<div class="army_move_head" style="margin: 0; width: 100%;">Исходящие бои</div>
					<table class="army-battle-tbl def_table_cw armylist">
                        <colgroup>
                            <col class="army-battleOut-col1">
                            <col class="army-battleOut-col2">
                            <col class="army-battleOut-col3">
                            <col class="army-battleOut-col4">
                            <col class="army-battleOut-col5">
                        </colgroup>
                    
						<thead>
							<tr class='cw_head_tr'>
								<td>Войска</td>
								<td>Текущие войска</td>
								<td>Город</td>
								<td>Статус</td>
								<td></td>
							</tr>
						</thead>
						<tbody>
							{{~it.battleOut: battle}}
								<tr class="trow_ar_supp">
									<td class="army-battle-army">
										{{=snip.army(battle.army)}}
									</td>
									<td  class="army-battle-armyCurrent">
										<div class="t_cw_sep_l">
											{{=snip.army(battle.armyCurrent)}}
										</div>
									</td>
									<td class="aL">
                                        {{=snip.townAccUnder(wofh.world.getTown(battle.town), wofh.world.getAccountByTown(battle.town), wofh.world.getCountryByTown(battle.town))}}
									</td>
									<td>
										{{?battle.state == EventCommon.battleState.wait}}в очереди
										{{??battle.state == EventCommon.battleState.enter}}вступление в бой
										{{??battle.state == EventCommon.battleState.active}}в бою
										{{??battle.state == EventCommon.battleState.finished}}бой окончен
										{{?}}
									</td>
									<td>
										{{?battle.state == EventCommon.battleState.active && battle.session != lib.war.nodefsession}}
											<a class="link js-battleLink" target="_blank" href="{{=snip.getBattleLink({session: battle.session, secret: battle.secret, town: battle.town.id})}}" data-town="{{=battle.town}}">смотреть бой</a>
										{{?}}
									</td>
								</tr>
							{{~}}
						</tbody>
					</table>
				</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="army.events">
    <table class="def_table_cw armylist {{?!it.events.hasCommander()}}-state-hideCommander{{?}}" style="width:100%">
		<thead>
			<tr class="cw_head_tr">
				{{=tmplMgr.army.events.header(it)}}
			</tr>
		</thead>
		<tbody>
			{{@it.events.getSortList('time', true).getList(): event: pos}}
				<tr class="army-armyRow trow_ar_{{=event.getArmyCls()}} js-army-event" data-id="{{=pos}}" data-type="{{?event.isAttack()}}0{{??}}1{{?}}" data-dir="{{=+!event.isIncom()}}">
					{{=tmplMgr.army.event({event: event, it: it})}}
				</tr>
			{{@}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="army.events.header">
	<td id="move_city">Цель</td>
	<td style="width:80px; color:#000" class="def_table_cw_th">Время в пути</td>
	<td class="def_table_cw_th2">Прибытие</td>
	<td class="def_table_cw_th2">Скорость</td>
	<td class="army-event-commander def_table_cw_th2">Командующий</td>
	<td class="def_table_cw_th3" colspan="2">Войска и добыча</td>
</script>

<script type="text/plain" id="army.event">																																																																																																							
	<td class="aL">
		{{=tmplMgr.army.event.aim(it)}}
	</td>
	<td>
		<div class="t_cw_sep_l">
			{{=tmplMgr.army.event.time(it)}}
		</div>
	</td>
	<td>
		<div class="t_cw_sep_l">
			{{=tmplMgr.army.event.moment(it)}}
		</div>
	</td>
	<td>
		<div class='t_cw_sep_l'>
			{{=tmplMgr.army.event.speed(it)}}
		</div>
	</td>
	
	<td class="army-event-commander">
		<div class="t_cw_sep_l">
			{{=tmplMgr.army.event.commander(it)}}
		</div>
	</td>
	
	{{=tmplMgr.army.event.army(it)}}
</script>			

<script type="text/plain" id="army.event.aim">
    {{var event = it.event;	it = it.it;}}
	
	{{?event.getType() == EventCommon.type.maketown}}
		<img class='maketown' src='https://test.waysofhistory.com/img/_.gif' data-title="Основание нового города" />
		<a class="link" href="{{=hashMgr.getMapHref(it.map.o, event.data)}}">Новый город</a>
	{{??event.getType() == EventCommon.type.makeres}}
		<img class='makeres' src='https://test.waysofhistory.com/img/_.gif' data-title="Колонизация" />
		<a class="link" href="{{=hashMgr.getMapHref(it.map.o, event.data)}}">Колонизация</a>
	{{??event.getType() == EventCommon.type.makeroad}}
		<img class='makeroad' src='https://test.waysofhistory.com/img/_.gif' data-title="Строительство" />
		<a class="link" href="{{=hashMgr.getMapHref(it.map.o, event.data)}}">дорога</a>
	{{??event.getType() == EventCommon.type.makeimp}}
		<img class='makeenv' src='https://test.waysofhistory.com/img/_.gif' data-title="Улучшение местности" />
		<a class="link" href="{{=hashMgr.getMapHref(it.map.o, event.data)}}">{{=(new MapImp(event.data.type)).getName()}}</a>
	{{??event.getType() == EventCommon.type.explore}}
		<img class='spyout' src='https://test.waysofhistory.com/img/_.gif' data-title="Исследование местности" />
		<a class="link" href="{{=hashMgr.getMapHref(it.map.o, event.data)}}">место</a>
	{{??event.getType() == EventCommon.type.defence || event.getType() == EventCommon.type.armyreturn}}
		{{?event.getTown2() < 0}}
			{{=snip.eventIconArmy(true, true)}}
			<span>{{?event.getTown2() == -6}}Ждет место в гарнизоне{{??}}Улучшение местности{{?}}</span>
		{{??!event.isForTown(false, true)}}
			{{=snip.eventIconArmy(true, event.getType() != EventCommon.type.armyreturn, Army.types.water)}}

			<div style="overflow:hidden;">
				<span style="vertical-align: top;">Из </span>
				<span class="trow_ar_s -lenLim -noHint">
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown1()), wofh.world.getAccountByTown(event.getTown1()), wofh.world.getCountryByTown(event.getTown1()))}}
				</span>
				&nbsp;
				<br>
				<span style="vertical-align: top;">в </span>
				<span class="trow_ar_s -lenLim -noHint">
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown2()), wofh.world.getAccountByTown(event.getTown2()), wofh.world.getCountryByTown(event.getTown2()))}}
				</span>
			</div>
		{{??}}
			{{=snip.eventIconArmy(true, !event.isIncom(), event.getArmy().calcTypeMain())}}
			<span class="trow_ar_s -lenLim -noHint">
				{{?event.isIncom()}}
					{{?event.getTown1() == lib.town.newtownplace}}Место для города
					{{??event.getTown1() == lib.town.depositplace}}Месторождение
					{{??event.getTown1() == lib.town.roadplace}}Место для дороги
					{{??event.getTown1() == lib.town.envplace}}Место для улучшения
					{{??event.getTown1() == lib.town.exploreadarea}}Место для разведки
					{{??}}
						{{=snip.townAccUnder(wofh.world.getTown(event.getTown1()), wofh.world.getAccountByTown(event.getTown1()), wofh.world.getCountryByTown(event.getTown1()))}}
					{{?}}
				{{??}}
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown2()), wofh.world.getAccountByTown(event.getTown2()), wofh.world.getCountryByTown(event.getTown2()))}}
				{{?}}
			</span>
		{{?}}
	{{??event.isAttack()}}
		{{?event.isSpy() && !event.getCommander()}}
			<img class='spyout{{?event.getArmy().isWater()}}w{{?}}' src='https://test.waysofhistory.com/img/_.gif' data-title="Разведка" />
			<span class="trow_ar_s -lenLim -noHint">
				{{=snip.townAccUnder(wofh.world.getTown(event.getTown2()), wofh.world.getAccountByTown(event.getTown2()), wofh.world.getCountryByTown(event.getTown2()))}}
			</span>
		{{??!event.isForTown(false, true)}}
			{{=snip.eventIconArmy(false, true, Army.types.water)}}
			<div style="overflow:hidden;">
				<span style="vertical-align: top;">Из </span>
				<span class="trow_ar_s -lenLim -noHint">
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown1()), wofh.world.getAccountByTown(event.getTown1()), wofh.world.getCountryByTown(event.getTown1()))}}
				</span>
				<br/>
				<span style="vertical-align: top;">в </span>
				<span class="trow_ar_s -lenLim -noHint">
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown2()), wofh.world.getAccountByTown(event.getTown2()), wofh.world.getCountryByTown(event.getTown2()))}}
				</span>
			</div>
		{{??}}
			<img class='atk{{?event.isIncom()}}in{{??}}out{{?}}{{?event.data.type}}{{=event.data.type}}{{??}}{{?event.getArmy().isWater()}}w{{??event.getArmy().isNuclear()}}n{{??event.getArmy().isAir()}}a{{?}}{{?}}' src='https://test.waysofhistory.com/img/_.gif' data-title="{{?event.isIncom()}}Нападение врага{{??}}Атака на врага{{?}}">

			<span class="trow_ar_s -lenLim -noHint">
				{{?event.isIncom()}}
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown1()), wofh.world.getAccountByTown(event.getTown1()), wofh.world.getCountryByTown(event.getTown1()))}}
				{{??}}
					{{=snip.townAccUnder(wofh.world.getTown(event.getTown2()), wofh.world.getAccountByTown(event.getTown2()), wofh.world.getCountryByTown(event.getTown2()))}}
				{{?}}
			</span>
		{{?}}
	{{??event.getType() == EventCommon.type.invasion}}
		<img class='atkina' src='https://test.waysofhistory.com/img/_.gif' data-title="Нашествие с севера" />
		<span class="trow_ar_s -lenLim" style="vertical-align: -8px;">Нашествие с севера</span>
	{{?}}
</script>

<script type="text/plain" id="army.event.time">
	{{var event = it.event;	it = it.it;}}
	
	{{?event.getType() != EventCommon.type.invasion}}
		<div class="js-timer" data-timertype="dec" data-time="{{=event.time}}"></div>
		
		{{?wofh.account.isSuperAdmin() && !(event instanceof EventFleet)}}
			<a class="link army-events-imm">+++</a>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="army.event.moment">
	{{var event = it.event;	it = it.it;}}
	
	{{?event.getType() == EventCommon.type.invasion}}
		{{=timeMgr.fMomentDate(event.time)}}
	{{??}}
		{{=timeMgr.fMoment(event.time)}}
	{{?}}
</script>

<script type="text/plain" id="army.event.speed">
	{{var event = it.event;	it = it.it;}}
	
	{{?event.isAttack()}}
		<img class="icnu ic8" src="https://test.waysofhistory.com/img/_.gif" data-title="Скорость"> {{=event.data.speed.toFixed(1)}}
	{{??event.getType() == EventCommon.type.invasion}}
		<img class="icnu ic8" src="https://test.waysofhistory.com/img/_.gif" data-title="Скорость"> &#8734
	{{?}}
</script>

<script type="text/plain" id="army.event.commander">
	{{var event = it.event;	it = it.it;}}
	
	{{?event.data.commander}}
		{{?event.data.commander.account}}
			<snip class="-nobr">
				{{=snip.accLink(event.data.commander.account)}} 
				{{?event.data.commander.country}} {{=snip.countryFlag(event.data.commander.country)}}{{?}}
			</snip>
		{{??}}
			{{=snip.country(event.data.commander.country, {link: true, text: false, flag: 'normal'})}}
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="army.event.army">
	{{var event = it.event;	it = it.it;}}
	
	{{?event.hasTrophy()}}
		<td class="def_table_td_trophy">
			<div class="t_cw_sep_l">
				{{=snip.resList(event.data.res)}}
			</div>
		</td>
	{{?}}
	
	<td class="army-event-army" {{?!event.hasTrophy()}} colspan="2"{{?}}>
		<div class="t_cw_sep_l">
			{{=tmplMgr.army.event.armyInfo({event: event, it: it})}}
			
			{{?event.data.army}}
				{{?!event.getArmy().isEmpty()}}
					{{=snip.army(event.getArmy())}}
				{{??}}
					<span class="hUnit">{{=snip.unitUnknown()}}</span>
					{{?event.data.pop}}
						{{?event.data.pop <= WonderEffect.getEffect(97, WonderEffect.ids.oracle).effect}}
							Оракул предсказывает:  {{=snip.pop(event.data.pop)}} .
						{{??}}
							Оракул предсказывает: более  {{=snip.pop(event.data.pop - 1)}} .
						{{?}}
					{{?}}
				{{?}}

				{{?it.fleets[event.data.fleet]}}
					<span class="dB">
						<span class="army-transport dIB">
							{{=snip.army(it.fleets[event.data.fleet].transport)}}
						</span>
					</span>
				{{??event.data.fleet}}
					<span class="dB">
						<span class="army-transport -defin">
							{{=snip.unitUnknown()}}
						</span>
					</span>
				{{?}}

				<div class="army-event-actions">
					{{?event.town1 == wofh.town.id && event.canCancel()}}
						<a class="army_move_cancelLink" data-event="{{=event.id}}"><img src="https://test.waysofhistory.com/img/gui/buttons/redcross.png" height="14px" width="14px" data-title="Прервать поход и вернуть войска обратно в город"></a>
					{{?}}
					{{?event.data.commander && event.town1 == wofh.town.id}}
						<a class="army_сommanderDrop" data-event="{{=event.id}}" style="margin-left: 2px;"><img src="https://test.waysofhistory.com/img/gui/buttons/comingout.png" height="14px" width="14px" data-title="Выйти из военной операции. Войска продолжат свой поход к цели в индивидуальном порядке."></a>
					{{?}}
				</div>
			{{??}}
				<span class="hUnit">{{=snip.unitUnknown()}}</span>

				{{?event.data.pop}}
					{{?event.data.pop <= WonderEffect.getEffect(97, WonderEffect.ids.oracle).effect}} 
						Оракул предсказывает:  {{=snip.pop(event.data.pop)}} .
					{{??}} 
						Оракул предсказывает: более  {{=snip.pop(event.data.pop)}} .
					{{?}}
				{{?}}
			{{?}}
		</div>
	</td>
</script>

<script type="text/plain" id="army.event.armyInfo"></script>

<script type="text/plain" id="army.view.all">
	<div class="box visible taab1 parmy_u_cont">
		{{=snip.hint('Все войска, находящиеся сейчас в городе')}}
		<div>{{=snip.army(it.armyIntown)}}</div>

		{{var simArmy = Ability.simulator() ? it.armyIntown : new Army();}}

		<div class="cB">
			{{?simArmy.getLength()}}
				<div>
					<br>
					<br>
					<div id="ar_sob_btns">
						<span class="ar_btn_sobst">
							<a class="button1 -type-blue js-toSimbattle" data-army="{{=simArmy.toString()}}">Симулятор</a> 
						</span>
					</div>
					<div style="height: 5px;"></div>
				</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="army.view.my">
	<div class="box taab2 parmy_u_cont pR">
		{{=snip.hint('Войска, принадлежащие только этому городу')}}
		<div class="mleft" id="town-army">
			{{var myArmy = wofh.town.army.sum.clone().diffList(wofh.events.getTownTrainArmy()).onlyPositive();}}
			{{=snip.army(myArmy)}}
		</div>

		<div class="cB">
			{{
				var hasArmy = wofh.town.army.own.getLength();
				var hasTactics = Account.hasAbility(Science.ability.tactics);
				var simArmy = Ability.simulator() ? myArmy : new Army();
			}}

			{{?hasArmy || hasTactics || simArmy.getLength()}}
				<div>
					<br>
					<br>
					<div id="ar_sob_btns">
						<span class="ar_btn_sobst">
							{{?simArmy.getLength()}}
								<a class="button1 -type-blue js-toSimbattle" data-army="{{=simArmy.toString()}}">Симулятор</a> 
							{{?}}
							{{?hasTactics || utils.sizeOf(wofh.towns) > 1}}
								<a class="button1 -type-green" href="{{=HashMgr.getHref('#/sendArmy')}}">Отправить</a> 
							{{?}}
							{{?hasArmy}}
								<span class="button1 -type-red" id="army-dismiss">Уволить со службы</span>
							{{?}}
						</span>
					</div>
					<div style="height: 5px;"></div>
				</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="army.view.expected">
	<div class="box taab3 parmy_u_cont">
		{{=snip.hint('Гарнизон города, с учетом подходящих подкреплений')}}
		<div>{{=snip.army(it.armyMove)}}</div>

		<div class="cB">
			{{var simArmy = it.armyMove;}}

			{{?simArmy.getLength()}}
				<div>
					<br>
					<br>
					<div id="ar_sob_btns">
						<span class="ar_btn_sobst">
							{{?simArmy.getLength()}}
								<a class="button1 -type-blue js-toSimbattle" data-army="{{=simArmy.toString()}}">Симулятор</a> 
							{{?}}
						</span>
					</div>

					<div style="height: 5px;"></div>
				</div>
			{{?}}
		</div>
	</div>
</script>


<script type="text/plain" id="army.cancelReinforce">
	<div class="b-reinforce-ret b-reinforce-pan-new -cancelReinforce aC">
		
		{{?it.canSendBackAll}}
			<b style="display: inline-block; max-width: 220px; margin: 20px 10px 0 10px;">Выдворить все войска стоящие в подкреплении в этом городе</b>
			<div style="margin-top: 105px;">
				{{?it.canSendBackAllSpeed}}
					<label class="page_army_sendBackBySpeed">{{=snip.checkbox1({name: 'byspeed'})}}По скоростям</label>&nbsp;{{=snip.hint('Выдворить подкрепление группами с совпадающей скоростью перемещения.')}}
					<br>
				{{?}}
				<button class="cancel-all-btn button1 -type-red">Выдворить всех</button>
			</div>
		{{??it.commanderSendBack}}
			<b style="display: inline-block; max-width: 220px; margin: 20px 10px 0 10px;">Отдать приказ на завершение этой военной операции и немедленно выдворить все участвующие в ней войска по домам.</b>
			<div style="margin-top: 105px;">
				{{?it.canSendBackAllSpeed}}
					<label class="page_army_sendBackBySpeed">{{=snip.checkbox1({name: 'byspeed'})}}По скоростям</label>&nbsp;{{=snip.hint('Выдворить подкрепление группами с совпадающей скоростью перемещения.')}}
					<br>
				{{?}}
				<button class="js-sendBack button1 -type-red">Выдворить всех</button>
			</div>
		{{??it.commanderDelete}}
			<b style="display: inline-block; max-width: 220px; margin: 20px 10px 0 10px;">Отдать приказ на завершение этой военной операции?</b>
			<div style="margin-top: 105px;">
				{{?!it.empty}}
					<label class="page_army_sendBack js-sendBack">{{=snip.checkbox1({name: 'sendBack'})}}Выдворить все участвующие войска</label>
					<br>
					
					{{?it.canSendBackAllSpeed}}
						<div class="js-sendBackBySpeed -hidden">
							<label class="page_army_sendBackBySpeed">{{=snip.checkbox1({name: 'byspeed'})}}По скоростям</label>&nbsp;{{=snip.hint('Выдворить подкрепление группами с совпадающей скоростью перемещения.')}}
							<br>
						</div>
					{{?}}
				{{?}}
				
				<button class="js-cancel button1 -type-red">Завершить</button>
			</div>
		{{??}}
			<b style="margin: 0 15px;">{{=it.defTypeText}} войска</b>
			<br>
			<br>
			<span class="-lenLim -noHint" style="max-width: 150px;">
				<b>{{=snip.townLink(it.town)}}</b>
			</span>
			&nbsp;
			<span class="-lenLim -noHint" style="max-width: 150px;">
				{{=snip.accLink(it.acc)}}
			</span>
			&nbsp;
			{{?it.country}}
				<span style="vertical-align: 2px;">
					{{=snip.countryFlag(it.country, {flag: 'normal'})}}
				</span>
			{{?}}
			<br>
			<br>
			<form class="frm-reinforce-ret">
				
				<div class="reinforce-ret-units">
					
					{{@it.reinfArmy.getList(): unit}}
						<span class="-nobr reinforce-ret-unit">
							{{=snip.unitIcon(unit)}}
							
							{{?!it.hasFleet}}
								<input type="text" class="army-reinforce-cancel-input" name="u{{=unit.getId()}}" data-reinforce-cancel="{{=unit.getCount()}}" value="{{?it.oneUnit}}{{=unit.getCount()}}{{?}}"> 
							{{?}}
							
							{{?it.oneUnit || it.hasFleet}}
								<span class="reinforce-army-cancel readonly">{{=unit.getCount()}}</span>
							{{??}}
								<a href="#" class="reinforce-army-cancel link">{{=unit.getCount()}}</a>
							{{?}}
						</span>
						&nbsp;
					{{@}}
				
				</div>

				<div class="p10">
					{{?!it.hasFleet}}
						<a class="reinforce-army-all-cancel link">Выбрать всех</a>
					{{?}}
				</div>
				
				<div style="margin-top: 45px;">
					{{?it.canSendBackBySpeed && !it.oneUnit && !it.hasFleet}}
						<label class="page_army_sendBackBySpeed crDi">{{=snip.checkbox1({cls: 'crDi', name: 'byspeed', disabled: true})}}По скоростям</label>&nbsp;{{=snip.hint(it.defTypeText + ' подкрепление группами с совпадающей скоростью перемещения.')}}
						<br>
					{{?}}
					
					<button type="submit" class="reinforce-btn button1 -type-red -disabled">
						{{=it.defTypeText}}{{?!it.hasFleet}} выбранных{{?}}
					</button>
				</div>

			</form>
		{{?}}
	
	</div>
	
</script>

<script type="text/plain" id="army.armyDismiss">
	<div class="b-reinforce-ret b-reinforce-pan-new aC">
		<form class="frm-dismiss-ret">
			{{@wofh.town.army.own.getList(): unit}}
				<span class="-nobr">
					{{=snip.unitIcon(unit)}}
					<input type="text" class="army-qty-input" name="u{{=unit.getId()}}" data-qty="{{=unit.getCount()}}" value="" autocomplete="off"> 
					<a href="#" class="dismiss-army-qty link">{{=unit.getCount()}}</a>
				</span>
				&nbsp; 
			{{@}}
			
			<div class="p10">
				<a href="#" class="dismiss-army-qty-all button1">Выбрать всю армию</a>
			</div>
			
			<div class="p10">
				<button type="button" id="dismiss-calc" class="button1 -type-red">Уволить со службы</button>
			</div>
			
			<div class="-hidden js-dismiss-confirm-block">
				<p>
					Возврат населения:{{=snip.pop()}}<span id="army-dismiss-qty" class="army-dismiss-qty"></span>
				</p>
				
				<button type="submit" class="button1 -type-green js-dismiss-confirm">Подтвердить</button>
			</div>
			
			<div class="p10">
				Уволить можно свои войска приписанные к городу и находящиеся в нем.
				<br>
				Возврат 
				{{=snip.pop()}}
				 осуществляется в пределах 
				{{=snip.pop(lib.town.population.maxdismisspop)}}
				 населения города.
			</div>
			
		</form>
	
	</div>
	
</script>

<script type="text/plain" id="army.massattackinfo">
    <div class="army-operation-info">
        <div class="imgAttack"></div>
        <div class="rb-title">Армия на данный момент</div>
        <div class="rb-title">
            Живые
            <span class="report-armyPop">{{=snip.pop(it.group.armyCurrent.calcPop())}}</span>
        </div>
        <div class="rb-army">{{=snip.army(it.group.armyCurrent)}}</div>
        {{var armyDead = it.group.army.clone().diffList(it.group.armyCurrent).onlyPositive();}}
        <div class="rb-title">
            Погибшие
            <span class="report-armyPop">{{=snip.death(armyDead.calcPop())}}</span>
        </div>
        <div class="rb-army">{{=snip.army(armyDead)}}</div>
		<br>
		<a class="js-operation-updInfo button1 {{?it.updTimeLeft > 0}}-disabled{{?}}">Обновить{{?it.updTimeLeft > 0}} {{=snip.timer(it.updTimeLeft + timeMgr.getNow(), 'dec', timeMgr.fPeriod(it.updTimeLeft))}}{{?}}</a>
    </div>
</script>

<script type="text/plain" id="army.addGarrison">
    <form class="army-addGar">
        <div class="tbl">
            <div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-td" style="width: 28px;">{{=snip.checkbox1({cls: 'army-addGar-selAll', title: 'Выбрать все'})}}</div>
                    <div class="tbl-td" style="width: 170px;">Город</div>
                    <div class="tbl-td" style="width: 300px;">Войска</div>
                </div>
            </div>
            <div class="tbl-tbody js-scroll-wrp" style="max-height: 400px">
                {{@it.list: group: i}}
                    <div class="tbl-tr row{{=i%2}}">
                        <div class="tbl-td" style="width: 28px;">{{=snip.checkbox1({name: group.id})}}</div>
                        <div class="tbl-td" style="width: 170px;">{{=snip.townLink(group.town)}}</div>
                        <div class="tbl-td" style="width: 300px;">{{=snip.army(group.army)}}</div>
                    </div>
                {{@}}
            </div>
        </div>
        <br>
        <div><button class="button1 js-army-addGar-btn">Отправить войска в военную операцию</button></div>
    </form>
</script>




<script type="text/plain" id="army.operations">
    {{~it.blocks: comGroup: i}}
        <div class="army-operBlock {{?i>=it.blocksShown}}-hidden{{?}}">
            {{@comGroup.list: group}}
                <div class="tbl-tr army-operRow js-army-commanding" data-id="{{=group.id}}" data-type="{{=group.act}}" data-country="{{=group.inCountry}}">
					<div class="tbl-td oper-col2-aim">
						{{=snip.eventIconArmy(group.act, 'operation', group.inCountry)}}
						<span style="display: inline-block; margin-left: 5px">
							{{=snip.townAccUnder(group.town, false, false, {lenLim: 110})}}
						</span>

						{{?group.tactics || group.tactics === null}}
							<div class="army-oper-tactic -nobr">
								{{?group.tactics}}
									<a class="js-setTactic link">{{=snip.tactic(group.tactics.getName()||'Тактика установлена')}}</a>
								{{??}}
									<a class="js-setTactic link fB -warn -type-red">{{=snip.tactic('Выбрать тактику')}}</a>
								{{?}}
								{{?group.noTacticsChange}}
									{{=snip.alert('Нельзя изменить тактику во время боя')}}
								{{??!group.isReady && group.time - timeMgr.getNow() < lib.war.tactics.changetime}}
									{{=snip.alert('Тактику можно выставить за 4 часа до прихода войск при наличии боя в городе.')}}
								{{?}}
							</div>
						{{?}}

						{{?group.status.battle}}
							<div><a class="army-oper-linkInfo link">Обзор</a></div>
						{{?}}

						{{?group.battleinfo && group.battleinfo.state == EventCommon.battleState.active && group.battleinfo.session != lib.war.nodefsession}}
							<a class="army-oper-linkBattle link js-battleLink" target="_blank" href="{{=snip.getBattleLink({session: group.battleinfo.session, secret: group.battleinfo.secret})}}">смотреть бой</a>
						{{?}}
						
						{{=tmplMgr.army.oper.aimAddInfo({group: group, it: it})}}
					</div>

					<div class="tbl-td oper-col2-participants -lenLim js-hint-useHtml">
						{{=snip.townIcon()}}х{{=utils.sizeOf(group.joined)}}
						<br>
						{{=snip.pop(group.army.calcPop())}}

						{{?group.commanderAcc || group.commanderCountry}}
							<br>
							Командующий
							<br>
							{{?group.commanderAcc}}
								{{=snip.accCountry(group.commanderAcc)}}
							{{??}}
								{{=snip.countryLink(group.commanderCountry)}}
							{{?}}
						{{?}}
					</div>

					<div class="tbl-td oper-col2-army spoiler">
						{{=snip.army(group.army)}}
					</div>
					
					{{=tmplMgr.army.oper.colTime({group: group, it: it})}}
					
                    <div class="army-comm-details"></div>
                </div>
            {{@}}
            {{?i >= it.blocksShown -1 && i != it.blocks.length-1}}
                <div style="text-align: center" class="army-show-operBlock-wrp">
                    {{?i<it.blocks.length-it.blocksShown-1}}
                        <a class="army-show-operBlock link">Показать ещё ({{=it.blocks[+i+it.blocksShown].list.length}})</a>
                    {{?}}
                    <a class="army-show-operBlockAll link">Показать все</a>
                </div>
            {{?}}
        </div>
    {{~}}
</script>

<script type="text/plain" id="army.oper.spoiler">
    {{?it.group.commander == wofh.account.id || it.group.key}}
        <div class="army-comm-actions">
            {{?it.group.key}}
                <a class="button1 -type-green" href="{{=HashMgr.getHref('#/sendArmy/groupid='+it.group.id+'&key='+it.group.key)}}">Отправить войска</a>
            {{?}}
			{{?it.group.commander == wofh.account.id && wofh.country}}
				{{?wofh.account.canTransfOperToCountry(it.group)}}
					<button type="button" class="button1 js-countryBattleGroup" data-id="{{=it.group.id}}">Передать операцию  {{=snip.countryFlag(wofh.country, {flag: 'normal'})}}</button>
				{{??}}
					<button type="button" class="button1 -disabled">Передать операцию  {{=snip.countryFlag(wofh.country, {flag: 'normal'})}}</button> <div style="display: inline-block; vertical-align: top;">{{=snip.hint('После передачи военной операции стране, она переходит под управление главы, воеводы и его помощников. Для того, чтобы передать эту военную операцию стране, необходимо отправить для участия в ней не менее ' + snip.pop() + lib.war.countrybattlegrouppop + ' войск')}}</div>
				{{?}}
			{{?}}
			{{?wofh.account.isPremium()}}
				<a class="button1 -type-blue js-toSimbattle" data-army="{{=it.group.army.toString()}}" data-act="{{=it.group.act}}">Симулятор</a>
			{{?}}
        </div>
    {{?}}
    {{?it.group.key}}
        <div class="army-oper-link-wrp" style="display: inline-block; padding-left: 10px; font-size: 10px; width: 265px; height: 41px;">
			<div class="army-oper-link">
				{{=tmplMgr.snipet.clipboard({tag: 'g' + it.group.id + '/' + it.group.key})}}
			</div>
            <div class="aL">Ты можешь использовать этот тег для того, чтобы создать ссылку на эту Военную Операцию</div>
        </div>
    {{?}}
    <table class="army-oper-townArmy-tbl" style="width: 100%">
        {{?it.group.canJoinArmies}}
            <tr>
                <td class="army-oper-townArmy-index"></td>
                <td class="army-oper-townArmy-town"><a class="js-addGarrison link" style="font-weight: bold; ">Добавить войска в городе</a></td>
                <td class="army-oper-townArmy-army aL"></td>
                <td class="army-oper-townArmy-action"></td>
            </tr>
        {{?}}
        {{@it.group.joined: join: j}}
            <tr class="trow{{=j%2}} js-army-comm-join" data-id="{{=join.id||0}}">
                <td class="army-oper-townArmy-index"><span style="vertical-align: top; font-weight: bold">{{=+j+1}}.</span></td>
                <td class="army-oper-townArmy-town aL">
                    {{=snip.townAccUnder(join.town, join.account, false, {lenLim: 210})}}
                </td>
                <td class="army-oper-townArmy-army aL">
                    {{=snip.army(join.army)}}
                </td>
                <td class="army-oper-townArmy-action">
					{{?join.id}}
						{{var isInDef = false;}}

						{{@it.defin: def}}
							{{?def.id == join.id}}
								{{
									isInDef = true;
									break;
								}}
							{{?}}
						{{@}}

						{{?it.group.isCommander || wofh.towns[join.town.id] || isInDef}}
							{{?isInDef && !it.group.isReady}}
								{{=snip.alert('Эти подкрепления невозможно будет отозвать до начала '+snip.icon(snip.c.other, 'oper')+'Военной Операции')}}
							{{??}}
								<a class="js-army-comm-cancel"><img src="https://test.waysofhistory.com/img/gui/buttons/comingout.png" height="14px" width="14px" data-title="Выйти из военной операции. Войска продолжат свой поход к цели в индивидуальном порядке."></a>
							{{?}}
						{{?}}
					{{?}}
                </td>
            </tr>
        {{@}}
    </table>
</script>

<script type="text/plain" id="army.oper.aimAddInfo"></script>

<script type="text/plain" id="army.oper.colTime">
	{{?it.header}}
		<div class="tbl-td oper-col-time">{{=snip.btnTable('time', 'Начало операции')}}</div>
	{{??}}
		<div class="tbl-td oper-col2-time">
			{{=tmplMgr.army.oper.time(it)}}
		</div>
	{{?}}
</script>

<script type="text/plain" id="army.oper.time">
	{{var group = it.group;	it = it.it;}}
	
	{{?group.isReady}}
		<div>
			{{?group.act == wSendArmy.act.def && !group.status.battle}}
				Готова к бою&nbsp;
				{{?wArmy.canCommanderDelete(group)}}
					<a class="army-commanderDelete js-commanderDelete {{?!group.army.getLength()}}js-empty{{?}} button2-small -type-delete" data-title="Завершить"></a>
				{{?}}
			{{??}}
				{{?utils.sizeOf(group.joined) && group.joined[0].state == EventCommon.battleState.waitForNextBattle}}
					{{=snip.title('ждет окончания боя', 'У города идет другой бой')}}
					{{?group.isCommander}}
						<br>
						{{=snip.blinkButton1({text:'Начать', cls:'js-army-btl-startOperation', tag: 'button', btnType:'-type-red'})}}
					{{?}}
				{{??}}
					В бою
				{{?}}
				{{?wArmy.canCommanderDelete(group) && !group.army.getLength()}}
					<a class="army-commanderDelete js-commanderDelete js-empty button2-small -type-delete" data-title="Завершить"></a>
				{{?}}
			{{?}}
		</div>
	{{??}}
		<div class="pr05">
			Подготовка: через {{=snip.timer(group.time, 'dec', false, false, {cls: '-nobr'})}}
		</div>
		<div class="-nobr">
			{{?!group.act}}
				в {{=timeMgr.fMoment(group.time)}}
			{{?}}
			{{?!group.army.getLength() && wArmy.canCommanderDelete(group)}}
				<a class="army-commanderDelete js-commanderDelete js-empty button2-small -type-delete" data-title="Завершить"></a>
			{{?}}
		</div>
	{{?}}
	<div class="army-comm-toggle bgLight">
		<a class="js-army-comm-toggle {{=snip.getFakelinkCls({small: true})}}">Подробнее</a>
		<a class="js-army-comm-toggle -hidden {{=snip.getFakelinkCls({small: true})}}">Свернуть</a>
	</div>
</script><script type="text/plain" id="attacks.header">
	Атаки на города
</script>

<script type="text/plain" id="attacks">
	<div class="view-attacks js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100), 250)}}px;">
		<table id="attacks-list" class='def_table armylist' style="width:100%">
			<thead>
				<tr>
					<td style="width:40%;">Город <span class='helpIcon' data-title='Твой город, подвергающийся нападению'></span></td>
					<td style="width:170px;">Агрессор <span class='helpIcon' data-title='Город-агрессор. Именно из него происходит атака на твой город'></span></td>
					<td style="width:80px;">Скорость армии <span class='helpIcon' data-title='Скорость перемещения армии агрессора'></span></td>
					<td style="width:140px;">Время до атаки <span class='helpIcon' data-title='Время, необходимое городу-агрессору, чтобы совершить нападение на твой город'></span></td>
					<td style="width:80px;">Время атаки <span class='helpIcon' data-title='Момент, в который произойдет нападение города-агрессора на твой город'></span></td>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td colspan='5'></td>
				</tr>
			</tfoot>
			<tbody>
				{{@it.townsAttack: town}}
					<tr valign=top class="trow0" style="border-bottom:#000 1px solid;">
						<td>
							{{=snip.townLink(town)}}
							<br>
							<br>
							<span class="tB">{{=snip.army(town.army.intown)}}</span>
						</td>
						<td colspan=4 align=left>
							{{?town.attacks}}
								<table width=100% border=0>
									{{@town.attacks: attack}}
										<tr>
											<td align=left style="width:170px">
												<img class='atkin{{?attack.data.type}}{{=attack.data.type}}{{??}}{{?attack.getArmy().isWater()}}w{{??attack.getArmy().isNuclear()}}n{{??attack.getArmy().isAir()}}a{{?}}{{?}}' src='https://test.waysofhistory.com/img/_.gif' title="Нападение врага" style="margin-right: 5px;">
												<div style="margin-left: 30px;">
													<span class="-nobr -lenLim" style="max-width: 140px; display: inline-block;">
														{{=snip.townAccUnder(wofh.world.getTown(attack.town1), wofh.world.getAccountByTown(attack.town1), wofh.world.getCountryByTown(attack.town1))}}
													</span>
													<br>
												</div>
												{{?attack.data.pop}}
													{{?attack.data.pop <= WonderEffect.getEffect(97, WonderEffect.ids.oracle).getEffect()}}
														Оракул предсказывает:  {{=snip.pop(attack.data.pop)}} .
													{{??}}
														Оракул предсказывает: более  {{=snip.pop(attack.data.pop-1)}} .
													{{?}}
												{{?}}
											</td>
											<td style="width:80px"><img class="icnu ic8" src="https://test.waysofhistory.com/img/_.gif" title="Скорость"> {{=attack.data.speed.toFixed(1)}}</td>
											<td style="width:140px; text-align: center;">
												<div class="js-timer" data-timertype="dec" data-time="{{=attack.time}}"></div>
											</td>
											<td style="width:80px; text-align: center;">
												{{=timeMgr.fMoment(attack.time)}}
											</td>
										</tr>
									{{@}}
								</table>
							{{?}}
						</td>
					</tr>
				{{@}}
			</tbody>
		</table>
	</div>
</script><script type="text/plain" id="barter.header">
	Бартерный обмен
</script>

<script type="text/plain" id="barter">
	<div class="view-barter">
		<div class="market-panel-wrp"></div>
		
		<div class="market-tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="barter.buy">
	<form class="js-barter-buy">
		<div class="barter-buy-resFilter-wrp js-barter-buy-resFilter-wrp">
			<div class="barter-buy-resFilter-block-s js-resFilter-block">
				{{=snip.resFilter({type: ResList.filter.type.default, excluded: it.excluded, showLuck: true, select: ls.getBarterFilter(Trade.getBarterFilter()).s})}}
				<input class="js-resFilterVal" type="hidden" name="s" value="{{=ls.getBarterFilter(Trade.getBarterFilter()).s}}">
			</div>
			
			<div class="barter-buy-tradeBarter">
				<div class="barter-buy-resSell-wrp">
					<div class="barter-buy-tradeBarter-text">Продать</div>
					<span class='resb js-tradeBarter-s' data-res="{{=ls.getBarterFilter(Trade.getBarterFilter()).s}}"></span>
				</div>
				
				<div class="barter-barterIcon barter-buy-barterIcon"></div>
				
				<div class="barter-buy-resBuy-wrp">
					<div class="barter-buy-tradeBarter-text">Купить</div>
					<span class='resb js-tradeBarter-b' data-res="{{=ls.getBarterFilter(Trade.getBarterFilter()).b}}"></span>
				</div>
				
				{{?wofh.country}}
					<div class="barter-buy-onlycountry">
						<label class="crP">{{=snip.checkbox1({title:'Только в стране', name:'onlycountry', checked: ls.getBarterFilter(Trade.getBarterFilter()).onlycountry})}} Только в стране</label>
					</div>
				{{?}}
			</div>
			
			<div class="barter-buy-resFilter-block-b js-resFilter-block">
				{{=snip.resFilter({type: ResList.filter.type.extend, excluded: it.excluded, showLuck: true, select: ls.getBarterFilter(Trade.getBarterFilter()).b})}}
				<input class="js-resFilterVal" type="hidden" name="b" value="{{=ls.getBarterFilter(Trade.getBarterFilter()).b}}">
			</div>
		</div>
		
		<div class="list-page-nav-wrp">
			<a class="page-nav-prev"></a>
			<a class="page-nav-next"></a>
			
			<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-245, 0), 100)}}px;">
				<div class="buy-list-wrp"></div>
			</div>
		</div>
	</form>
</script>

<script type="text/plain" id="barter.buy.list">
	<table class="table01 barter-buy-offersTable" cellspacing="0">
		<colgroup>
			<col class="barter-offersTable-col1">
			<col class="barter-offersTable-col2">
			<col class="barter-offersTable-col3">
			<col class="barter-offersTable-col4">
			<col class="barter-offersTable-col5">
			<col class="barter-offersTable-col6">
			<col class="barter-offersTable-col7">
			<col class="barter-offersTable-col8">
			<col class="barter-offersTable-col9">
		</colgroup>
		
		<thead>
			<tr class="cw_head_tr">
				<td></td>
				<td><div>Город</div></td>
				<td><div class="t_cw_sep_l">Продает</div></td>
				<td><div class="t_cw_sep_l">Покупает</div></td>
				<td><div class="t_cw_sep_l nobr"><a class="js-profitSort"><span class="barter-buy-sorting">Выгода</span><br><img class='icsort -black' src='https://test.waysofhistory.com/img/_.gif' title='Сортировать'></a></div></td>
				<td><div class="t_cw_sep_l nobr"><a class="js-distSort"><span class="barter-buy-sorting">{{=snip.ruler()}}</span><br><img class='icsort -black' src='https://test.waysofhistory.com/img/_.gif' title='Сортировать'></a></div></td>
				<td><div class="t_cw_sep_l">Время</div></td>
				<td colspan="2"><div class="t_cw_sep_l">Предложений</div></td>
			</tr>
		</thead>
		
		<tbody class="-sel">
			{{~it.offers: offer: pos}}
				<tr class="trow js-barter-buy-offer" data-pos="{{=pos}}">
					<td class="aC">
						{{?offer.inCountry}}
							{{=snip.crown('Предложение в стране')}}
						{{?}}
					</td>
					<td>
						<div class="lenLim barter-buy-town indent">
							{{?offer.town}}
								{{=snip.townAccUnder(offer.town)}}
							{{??}}
								{{=snip.townLink()}}
							{{?}}
						</div>
					</td>
					<td>{{=snip.resCount(offer.res1, offer.sum1)}}</td>
					<td>{{=snip.resCount(offer.res2, offer.sum2)}}</td>
					<td>{{=offer.profit}}%</td>
					<td>
						<div class="lenLim indent">
							{{?offer.distance}}
								{{=snip.distPath(offer.distance, offer.path)}}
							{{??}}
								?
							{{?}}
						</div>
					</td>
					<td>
						{{?offer.time}}
							{{=timeMgr.fPeriod(offer.time)}}
						{{??}}
							?
						{{?}}
					</td>
					<td class="aR">
						<span class="-nobr">
							<span class="crP js-barter-buy-offerMaxQuantity">×{{=offer.quantity}}</span> 
							{{=snip.input1({cls: 'barter-buy-offerQuantity spinbox', name: 'quantity', value: 1})}}
						</span>
					</td>
					<td class="aC">
						<input type="button" class="barter-buy-buyOffer" value="Купить">
					</td>
				</tr>
			{{~}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="barter.sell">
    <div>
		{{var isBarterAvailable = Ability.isBarterAvailable();}}
		
		<div class="barter-sell">
			<a class="button1 {{?!isBarterAvailable}}-disabled{{?}}" href="{{=HashMgr.getHref('#/barterOffer')}}">Выставить предложение</a>
		</div>
		<div class="tbl barter-sell-offers js-barter-sell-offers {{?!isBarterAvailable}}barter-stopped{{?}}">
			<div class="tbl-thead">
				<div class="tbl-tr barter-sell-offers-tr">
					<div class="tbl-th barter-sell-offers-col0">{{=snip.btnTable('availability', snip.hint('Ручное управление присутствием предложения на рынке'),'')}}</div>
					<div class="tbl-th barter-sell-offers-col1">{{=snip.btnTable('res-sell','Продаем','')}}</div>
					<div class="tbl-th barter-sell-offers-col2">{{=snip.btnTable('res-buy','Покупаем','')}}</div>
					<div class="tbl-th barter-sell-offers-col3">{{=snip.btnTable('profit','Выгода','')}}</div>
					<div class="tbl-th barter-sell-offers-col4">{{=snip.btnTable('distance',snip.ruler(),'')}}</div>
					<div class="tbl-th barter-sell-offers-col5-6">Предложений</div>
				</div>
			</div>
			<div class="tbl-tbody js-barter-offers" style="max-height: {{=Math.max(utils.getWindowHeight(-205, 0), 100)}}px;"></div>
		</div>
    </div>
</script>

<script type="text/plain" id="barter.tableSellOffers">
	{{@it.list: offer}}
		<div class="tbl-tr barter-sell-offersData-tr js-editOffer {{?!offer.isAvail()}}-unAvail{{?}}" data-id="{{=offer.id}}">
			<div class="tbl-td barter-sell-offers-col0">
				<span class="availability-wrp">
					{{=snip.checkbox1({cls: 'js-changeOfferAvailability', attrs: {'data-id': offer.id}, checked: offer.isAvail()})}}
				</span>
			</div>
			<div class="tbl-td barter-sell-offers-col1">
				{{=snip.resCount(offer.res1, offer.count1)}}
			</div>
			<div class="tbl-td barter-sell-offers-col2">
				{{=snip.resCount(offer.res2, offer.count2)}}
			</div>
			<div class="tbl-td barter-sell-offers-col3">
				{{=offer.getProfit()}}%
			</div>
			<div class="tbl-td barter-sell-offers-col4">
				{{=offer.distance}}
			</div>
			<div class="tbl-td barter-sell-offers-col5">
				<span class="barter-sell-offerCount-wrp">
					{{?offer.ally}}стране{{?}} × 
					
					{{=snip.input1({cls: 'barter-sell-offerCount spinbox', value: offer.count, autocomplete: 'off'})}}
					
					<button class="barter-sell-editOfferCount button2 -type-accept -hidden js-editOfferCount" data-id="{{=offer.id}}"></button>
				</span>
			</div>
			<div class="tbl-td barter-sell-offers-col6">
				<button class="button2 -type-menu" data-id="{{=offer.id}}"></button>
				<button class="button2 -type-delete js-delOffer" data-id="{{=offer.id}}"></button>
			</div>
		</div>
	{{@}}
</script>





<script type="text/plain" id="barterOffer.header">
	{{?it.offer.id}}Изменение предложения{{??}}Выставить свое предложение{{?}}
</script>

<script type="text/plain" id="barterOffer">
	<form class="barterPopup-sell-offer js-barterPopup-sell-offer">
		<div class="barterPopup-luck-wrp">
			{{=snip.luck(utils.toInt(wofh.account.getCoinsBought()))}} {{=snip.hint('Количество доступных для торговли Монет Удачи. <br/>Для совершения торговых операций можно использовать только купленные, ранее не переводимые и не использованные в торговых операциях Монеты Удачи.')}}
		</div>
		<div class="barterPopup-resFilter-wrp">
			<div class="barterPopup-resFilter-block js-barterPopup-resFilter-sell js-resFilter-block">
				<p><b>Продать</b></p>

				{{=snip.resFilter({type: ResList.filter.type.select, disabled: it.disabledSell, excluded: it.excluded, select: it.offer.res1, showLuck: it.offer.id && it.offer.res1 != Resource.ids.luck ? false : true})}}
				<input class="js-resFilterVal" type="hidden" name="res1" value="{{=it.offer.res1}}">

				<div class="barterPopup-slider-wrp js-barterPopup-slider-wrp js-sell-count">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
			
			<div class="barter-barterIcon barterPopup-barterIcon"></div>
			
			<div class="barterPopup-resFilter-block js-barterPopup-resFilter-buy js-resFilter-block">
				<p><b>Купить</b></p>
				{{=snip.resFilter({type: ResList.filter.type.select, disabled: it.disabledBuy, excluded: it.excluded, select: it.offer.res2, showLuck: it.offer.id && it.offer.res2 != Resource.ids.luck ? false : true})}}
				<input class="js-resFilterVal" type="hidden" name="res2" value="{{=it.offer.res2}}">
				
				<div class="barterPopup-slider-wrp js-barterPopup-slider-wrp js-buy-count">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
		</div>
		
		<div class="barterPopup-offerCount-wrp">
			<div>Количество предложений</div>
			<div class="barterPopup-offerCount-slider js-barterPopup-offerCount-slider">
				<div class="slider">
					<input type="hidden" name="count" value="{{=it.offer.count}}">
				</div>
			</div>
		</div>
		
		<div class="barterPopup-offerDist-wrp js-barterPopup-offerDist-wrp">
			<div>
				Расстояние
			</div>
			<div class="barterPopup-offerDist-slider js-barterPopup-offerDist-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		{{?wofh.country}}
			<div class="barterPopup-offer-onlycountry">
				<label>
					{{=snip.checkbox1({name:'onlycountry', checked: it.offer.ally})}} Только в стране
				</label>
			</div>
		{{?}}
		
		<p>
			<button type='submit' class="button1 barterPopup-setOffer js-setOffer">Выставить предложение</button>
			{{?it.offer.id}} 
				<a class="button1 -type-red js-delOffer">Удалить</a>
			{{?}}
		</p>
	</form>
</script><script type="text/plain" id="battle.header">
	{{?it.town}}
		Бой у  {{=snip.townAccCountry(it.town)}}
	{{??it.replay}}
		Повтор боя
	{{??}}
		Симуляция боя
	{{?}}
</script>

<script type="text/plain" id="battle">
	<div class="view-battle js-fullScreen">
		<div class="view-battle-block">
			<iframe src="{{=it.link}}" frameborder="no" scrolling="no" class="battle-frame" onload="this.contentWindow.focus();"></iframe>
			
			<div class="battle-fullScreen-block">
				<button class="battle-fullScreen js-battle-fullScreen"></button>
			</div>
			
			<span class="battle-loading-text">Идет загрузка</span>
		</div>
	</div>
</script><script type="text/plain" id="bonus.header">
    Удача
</script>

<script type="text/plain" id="bonus">
    <div class="view-bonus js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-40, 200)}}px;">
		<div class="bonus-info-wrp"></div>
    </div>
</script>

<script type="text/plain" id="bonus.info">
	<div class="bonus-has">
		<div class="bonus-info">
			У тебя <b>{{=snip.resBigCount(Resource.ids.luck, utils.toInt(wofh.account.getCoinsAll()))}}</b> 
			({{=snip.tooltip('Тонкости перевода', 'Переводить на другие аккаунты можно только купленные и ранее непереводимые '+snip.resBig(Resource.ids.luck)+'Монеты Удачи.<br>' + snip.alert('')+'Внимание! Осуществление перевода  тобой некоторым игрокам может быть недоступно')}})
			<br>
			{{?wofh.platform.noemail || wofh.account.email}}
				<a class="link bonus-take">Подарить другу</a>
			{{?}}
		</div>
		
		<div class="dIB">
			{{?wofh.platform.name != 'fb2'}}
				{{?wofh.account.canuseshop}}
					<a class="bonus-buy" href="{{=HashMgr.getHref('#/shop')}}" data-title="Купить Монеты Удачи">
						Купить<br><span class="bonus-buy-subtitle">Монеты Удачи</span>
					</a>
				{{??}}
					<div>Нельзя купить Монеты Удачи</div>
				{{?}}
			{{?}}
		</div>
	</div>    

	<div class="bonus-add-wrp"></div>

	<div class="info-specialists-wrp"></div>

	{{?LuckBonus.subscription.isOn()}}
		{{=tmplMgr.bonusSpecial(it)}}
	{{??}}
		{{=tmplMgr.bonus.bonusTowns(it)}}
	{{?}}

	{{?!LuckBonus.subscription.isActive()}}
		{{=tmplMgr.bonus.bonusOther(it)}}
	{{?}}

	{{?!wofh.platform.noreferallinks}}
		<p>Твоя реферальная ссылка: <b class="-sel">{{=snip.referalLink()}}</b></p>

		{{?!LuckBonus.subscription.isOn()}}
			<p>
				Каждый, кто зайдет по этой ссылке, зарегистрируется и выполнит все начальные задания,
				<br>увеличит число твоих Монет Удачи на <b>{{=snip.resBigCount(Resource.ids.luck,lib.luckbonus.referalsbonus)}}</b>.
			</p>
		{{?}}

		<p><a class="link bonus-referals">Посмотреть список зарегистрировавшихся рефералов</a></p>
	{{?}}

	<div class="bonus-luckUsage-wrp"></div>
    
    {{?debug.isTest('system')}}
        <div class="fakelink bgLight dIB m10" onclick="ls.setHideDayprize(!ls.getHideDayprize()); notifMgr.runEvent(Notif.ids.accChest);">show/hide dayprize</div>
    {{?}}
</script>

<script type="text/plain" id="bonus.bonusTowns">
	<table class="bonus-table bonus-towns">
		<thead>
			{{?LuckBonus.subscription.isOn() && (it.subscription.isActive() || debug.isAdmin())}}
				<tr>
					<td colspan="7">
						Царь-бонус всех городов — {{=timeMgr.fPeriod(it.subscription.time - timeMgr.getNow())}}
					</td>
				</tr>
			{{?}}
			<tr>
				<td style="width: 151px; box-sizing: border-box;">&nbsp;</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Население ' + snip.hint('Увеличивает темпы роста населения'))}}</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Культура ' + snip.hint('Увеличивает культуру'))}}</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Наука ' + snip.hint('Увеличивает производство' + snip.res(Resource.ids.science)))}}</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Производство ' + snip.hint('Увеличивает производство всех ресурсов, кроме' + snip.res(Resource.ids.science)))}}</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Торговцы ' + snip.hint('Увеличивает число торговцев'))}}</td>
				<td style="width: 125px; box-sizing: border-box;">{{=snip.nobr('Война ' + snip.hint('Увеличивает силу армии как в атаке, так и в защите'))}}</td>
			</tr>
		</thead>
		<tbody>
			{{@it.towns: town: pos}}
				<tr class='row{{=pos%2}}'>
					<td class="bonus-towns-town bonus-town-wrp" data-town="{{=town.id}}">
						{{=tmplMgr.bonus.town.info({town: town})}}
					</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.grown})}}</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.culture})}}</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.science})}}</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.production})}}</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.traders})}}</td>
					<td class="bonus-town-wrp">{{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.war, right: true})}}</td>
				</tr>
			{{@}}
			{{?LuckBonus.subscription.isOn()}}
				<tr>
					<td colspan="7">
						{{?it.subscription.isActive() || debug.isAdmin()}}
							<div class="bonusSpecial-selection-block" data-type="{{=wBonusSpecial.selectionType.bonus}}">
								<div class="bonusSpecial-selection">
									<div class="bonusSpecial-selection-accept spage-button">Продлить</div>
								</div>
							</div>
						{{?}}
					</td>
				</tr>
			{{?}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="bonus.bonusOther">
	<table class="bonus-table bonus-other">
		<thead>
			<tr>
				<td>Бонус</td>
				<td>Состояние</td>
				<td>Стоимость</td>
				<td>Действие</td>
			</tr>
		</thead>

		<tbody>
			<tr class="row0">
				<td>
					Царь-аккаунт {{=snip.hint('Добавляет удобные инструменты')}}
					
					<a class="link bonus-other-premiumBtn">Подробнее</a>
				</td>
				<td>
					{{?wofh.account.isPremium()}}осталось {{=snip.timer(wofh.account.bonus.premium, 'dec')}}
					{{??}}выключено
					{{?}}
				</td>
				<td>{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.premiumcost)}} в неделю</td>
				<td>
					{{?wofh.account.getCoinsAll() < lib.luckbonus.premiumcost && !wofh.account.isPremium()}}
						{{=tmplMgr.snipet.noCoins({})}}
					{{??}}
						<a class="link bonus-activate" data-type="{{=LuckBonus.ids.accountPremium}}" data-act="add" data-cost="{{=lib.luckbonus.premiumcost}}">
							{{?wofh.account.isPremium()}}
								продлить
							{{??}}
								включить
							{{?}}
						</a>
						&nbsp;
						{{?wofh.account.isPremium()}}
							на {{=timeMgr.fPeriod(lib.luckbonus.period)}}
						{{??}}
							за
						{{?}} 
						{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.premiumcost)}}
					{{?}}
				</td>
			</tr>
			<tr class="row0">
				<td colspan=4>
					<div class="bonus-other-premium -hidden">
						{{=tmplMgr.bonus.premium()}}
					</div>
				</td>
			</tr>
			{{?!LuckBonus.subscription.isOn()}}
				<tr class="row1">
					<td>Немедленное строительство {{=snip.hint('Моментальное завершение строительства или разрушения здания, кроме Чуда Света')}}</td>
					<td></td>
					<td>{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.buildupcost)}}</td>
					<td></td>
				</tr>
				<tr class="row0">
					<td>Немедленные торговцы {{=snip.hint('Мгновенная доставка торговцев к цели')}}</td>
					<td></td>
					<td>{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.tradeimcost)}} за {{=lib.trade.distance}} полей</td>
					<td></td>
				</tr>
			{{?}}
			
			{{?wofh.account.bonus.teamdrop !== 0 && (!LuckBonus.subscription.isOn() || wofh.account.bonus.teamdrop)}}
				<tr class="row1">
					<td>Подселить друзей {{=snip.hint('Возможность регистрации твоих друзей рядом с тобой')}}</td>
					<td>{{?wofh.account.bonus.teamdrop === undefined}}не использован{{??}}заказано на {{=wofh.account.bonus.teamdrop}} чел.{{?}}</td>
					<td>
						{{?!LuckBonus.subscription.isOn()}}
							{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.teamdrop.cost)}}
						{{?}}
					</td>
					<td><a class="link bonus-drop">узнать подробнее</a></td>
				</tr>
			{{?}}
			<tr class="row0">
				{{var canRename = wofh.account.isAdmin() || timeMgr.getNow() - lib.luckbonus.rename.time < wofh.account.regtime;}}
				<td>Переименовать аккаунт {{=snip.hint("Услуга доступна в течение " + timeMgr.fPeriodShort(lib.luckbonus.rename.time, true) + " дней игры")}}</td>
				<td>
					{{?canRename}}доступно
					{{??}}вышел срок
					{{?}}
				</td>
				<td>{{=snip.resBigCount(Resource.ids.luck, lib.luckbonus.rename.cost)}}<br><span class="fz09">Только купленные</span></td>
				<td>
					{{?canRename}}
						{{var canPay = wofh.account.isAdmin() || (wofh.account.getCoinsBought() >= lib.luckbonus.rename.cost);}}

						<form class="bonus-rename">
							{{var opt = {name: 'name', maxlength: lib.account.namelimit[1], autocomplete: 'off'};}}
                            
							{{?!canPay}}
								{{
									opt.disabled = true;
									opt.attrs = {'data-title':'Недостаточно Монет Удачи'};
								}}
							{{?}}
							Новое имя: {{=snip.input1(opt)}}
							<br>
							{{?!wofh.platform.nopassword}}
								{{opt = {name: 'password', type: 'password', autocomplete: 'off'};}}
								{{?!canPay}}
									{{
										opt.disabled = true;
										opt.attrs = {'data-title':'Недостаточно Монет Удачи'};
									}}
								{{?}}
								Пароль: {{=snip.input1(opt)}}
								<br>
							{{?}}
							<br>
							<button class="button1 -disabled js-bonus-rButton" disabled="disabled">Переименовать</button>
						</form>
					{{?}}
				</td>
			</tr>
		</tbody>
	</table>
</script>	

<script type="text/plain" id="bonus.specialists">
	<table class="bonus-table bonus-accSpecialists">
		<thead>
			<tr>
				<td style="box-sizing: border-box;" colspan="{{=wofh.account.getSpecialists().getLength()}}">Твои свободные Великие Граждане</td>
			</tr>
		</thead>
        
		<tbody>
			<tr>
				{{@wofh.account.getSpecialists().getList(): specialist}}
					<td>
						{{=tmplMgr.bonus.specialists.specialist({specialist: specialist, hasNew: it.newSpecialists[specialist.getId()]})}}
					</td>
				{{@}}
			</tr>
		</tbody>
	</table>
</script>

<script type="text/plain" id="bonus.specialists.specialist">
	<a class="bonus-accSpecialists-block {{?it.hasNew}}-type-hasNew{{?}} js-accSpecialists js-tooltip" data-tooltip-wnd="specialist" href="{{=hashMgr.getHref('#/setSpec/id='+it.specialist.getId())}}" data-id="{{=it.specialist.getId()}}">
		{{=snip.specialist({specialist: it.specialist, noTitle: true, noSign:true})}}
	</a>
</script>

<script type="text/plain" id="bonus.specialistEffect">
	{{
		var specialist = it.specialist;
		var specialistUp = it.specialist.getUp();
		var effect = specialist.getEffect()-1;
		var effectUp = (specialistUp.getEffect()-1)-(specialist.getEffect()-1);
	}}
	
	{{?specialist.isWar()}}
		{{var tooltip = utils.escapeHtml(snip.warBonusWarn({count: utils.toPercent(effect)}));}}
	{{?}}
	
	<div class="bonus-town-specialist {{?!specialist.getCount()}}-noInTown{{?}} {{?!specialist.hasTownEffect(it.town)}}-warn{{?}}" data-id="{{=specialist.getId()}}" {{?it.town}}data-town="{{=it.town.id}}"{{?}}>
		<span class="bonus-town-specialistEffectIcon">
			{{=snip.specialistEffectIcon(specialist)}}
		</span>
		<span class="bonus-town-specialistEffect {{?tooltip}}tooltip-text{{?}}">
			{{=snip.coloredNum(effect, {uFixed:1, toPercent:true, servRound:true, noSignColor:true})}}%
		</span>
		<span class="bonus-town-specialistEffect -specAccuracyEffect">
			<span class="{{?tooltip}}tooltip-text{{?}}" {{?tooltip}}data-title="{{=tooltip}}"{{?}}>
				{{=snip.coloredNum(effect, {uFixed:2, toPercent:true, servRound:true, noSignColor:true})}}
			</span>
			<b>{{=utils.formatNum(effectUp, {uFixed:2, sign: true, toPercent:true, servRound:true})}}%</b>
		</span> 
		
		{{=snip.specialistTooltip(specialist, snip.icon(snip.c.specialistIcon, specialist.getType()))}} 
		
		<span class="bonus-town-specialistCount">
			{{=snip.coloredNum(it.first ? 0 : specialist.getCount(), {int: true, stages:true, noSignColor:true})}}
			<b class="-specUpCount">{{=utils.formatNum(1, {int: true, sign:true})}}</b>
		</span>
	</div>
</script>

<script type="text/plain" id="bonus.premium">
    <table>
        <tr><td><b>Царь-аккаунт дает различные удобные инструменты:</b></td></tr>
        <tr><td>В очередь строительства в каждом твоем городе можно добавлять на 1 строение больше.</td></tr>
        <tr><td>Доступны специальные страницы с подробной информацией по всем твоим городам и дополнительными инструментами управления.</td></tr>
        <tr><td>На странице любого города показывается общее число атак на все твои города. Так же доступна специальная страница, на которой все эти атаки расписаны более подробно.</td></tr>
        <tr><td>В рейтингах армии, науки и промышленности можно скрывать себя.</td></tr>
		<tr><td>На странице военных дел можно посмотреть содержание гарнизона города в данный момент.</td></tr>
        <tr><td>На странице города указано общее число торговцев и количество занятых.</td></tr>
        <tr><td>В торговле доступна дополнительная информация о торговцах: занятость для разных дел, расходы на снабжения, общая и доступная в данный момент вместимость торговцев.</td></tr>
		<tr><td>В информации о любом городе и на карте можно посмотреть историю о своих предыдущих атаках на выбранный город.</td></tr>
        <tr><td>Упрощенное управление обменом, торговлей, снабжением, транспортировкой.</td></tr>
        <tr><td>В списке городов любого игрока, для всех видимых городов добавляется информация о расстоянии и пути по суше и воде до них от твоего текущего города.</td></tr>
        <tr><td>Доступен специальный блокнот для любых записей. Доступ к блокноту имеeшь ты и твой заместитель.</td></tr>
        <tr><td>Прочитанные глобальные объявления можно скрывать.</td></tr>
        <tr><td>Есть возможность видеть рейтинги игроков и городов только по своей стране. </td></tr>
        <tr><td>По каждому игроку можно оставлять секретные заметки.</td></tr>
		<tr><td>Дает возможность предоставлять доступ к информации о разных аспектах своих городов и к состоянию своего аккаунта.</td></tr>
		<tr><td>Перемещение между городами при помощи клавиатуры.</td></tr>
		<tr><td>Возможность просчитывать маршруты по суше с учетом улучшений и без, а также по глубоководью и по мелоководью.</td></tr>
		<tr><td>Дает возможность скрывать чат в городе.</td></tr>		
		<tr><td>Большее количество тактик.</td></tr>
		<tr><td>Расширение возможностей массовой закупки и продажи ресурсов.</td></tr>
		<tr><td>Возможность выборочного отображения обучаемых войск.</td></tr>
		<tr><td>Большое количество всяческих интерфейсных улучшений.</td></tr>
    </table>
</script>

<script type="text/plain" id="bonus.town.info">
	{{=snip.townLink(it.town)}}
				
	{{@lib.town.specialists: spec: specId}}
		{{spec = it.town.getSpecialists().getElem(specId, false)||wofh.account.getSpecialists().getElem(specId, false);}}
		{{?spec}}
			{{=tmplMgr.bonus.specialistEffect({specialist: it.town.getSpecialists().getElem(specId), town: it.town})}}
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="bonus.town.cell">
    {{it.bonusReal = it.town.getLuckBonus(it.type);}}
    {{it.bonus = it.town.getLuckBonus(it.type);}}
	{{if (it.bonus.getLevel() == 0) it.bonus.setLevel(1);}}
	{{it.bonusImm = it.bonus.getMomentalBonus();}}
	{{var warn = it.bonusReal.isActive() && it.bonusReal.time - timeMgr.getNow() < wBonus.warnDelay;}}
	<div class="bonus-town-cell {{?it.right}}-type-right{{?}} {{?it.bonus.getUnbreakTime()}}-disabled{{?}} {{?it.bonusReal.isActive()}}{{?warn}}-warnDelay{{??}}-hasBonus{{?}}{{?}}" 
			data-town="{{=it.town.id}}" 
			data-type="{{=it.type}}">
		{{?LuckBonus.subscription.isOn()}}
			{{?it.town.hasBonus(LuckBonus.ids.subscription)}}
				<div class="bonus-town-subscription">
					+<span class="bonus-town-val">{{=utils.formatNum(it.bonusReal.getEffect(), {toPercent: true, round: true})}}</span>%
				</div>
			{{?}}
		{{??it.bonusReal.isActive() || it.bonus.getUp().hasEffect()}}
			<div class="bonus-town-cellVisib {{?it.bonusImm && !it.bonusReal.isActive()}}-hasImmBlock{{?}}">

				<div class="bonus-town-valWrp {{?it.bonusReal.isActive()}}-active{{?}}">
					+<span class="bonus-town-val">{{=utils.formatNum(it.bonus.getEffect(), {toPercent: true, round: true})}}</span>%
				</div>
				<div>
					{{?it.bonus.getUnbreakTime()}}
						будет доступно <br>через {{=snip.timer(it.bonus.getUnbreakTime(), 'dec')}} 
					{{??!it.bonusReal.isActive()}}
						<div class="bonus-town-price-add">
							за 
							{{=snip.resBigCount(Resource.ids.luck, it.bonus.getCost())}}
						</div>
						<a class="link bonus-activate" data-town="{{=it.town.id}}" data-act="add" data-type="{{=it.type}}" data-cost="{{=it.bonus.getCost()}}">включить</a>
						<div class="bonus-town-time">на {{=timeMgr.fPeriod(lib.luckbonus.period)}}</div>
					{{??}}
						<span class="{{?warn}}-warn{{?}}">
							{{=snip.timer(it.bonusReal.time, 'dec')}}
						</span>
					{{?}}
				</div>
			</div>
			<div class="bonus-town-imm">
				{{?it.town.pop.incReal >= 0 && it.bonusImm && it.bonusImm.canUpNow()}}
					<span class="bonus-town-takeNow-delimiter">или</span>
					<div class="bonus-town-takeNow-wrp" data-type="{{=it.bonusImm.id}}">
						{{?it.bonusImm.canUp()}} 
							<a 
								class="link bonus-town-takeNow" 
								data-town="{{=it.town.id}}" data-act="now" data-type="{{=it.bonusImm.id}}" 
								data-title="{{?it.bonusReal.isActive()}}Пока недоступно{{?}}"
								>получить мгновенно</a>
						{{??}}
							<div class="bonus-town-takeNow-timer">
								Мгновенный<br>
								через {{=snip.timer(it.bonusImm.time, 'dec')}}
							</div>
						{{?}}
					</div>
				{{?}}

				{{?it.bonusReal.isActive()}}
					<div class="{{?!warn}}bonus-town-price-add{{?}}">
						<br>
						<div class="bonus-town-add">
							<a class="link bonus-activate" data-town="{{=it.town.id}}" data-act="add" data-type="{{=it.type}}" data-cost="{{=it.bonus.getCost()}}">продлить</a><br>
							на {{=timeMgr.fPeriod(lib.luckbonus.period)}}
						</div>
					</div>

					{{?it.bonus.canUp()}}
						<div class="bonus-town-price-add">
							<br>
							<div class="bonus-town-up">
								<a class="link bonus-activate" data-town="{{=it.town.id}}" data-act="up" data-type="{{=it.type}}" data-cost="{{=it.bonus.getCostUp()}}">улучшить</a><br>
								на  {{=Math.round((it.bonus.getEffectUp())*100)}}%
							</div>
						</div>
					{{?}}
				{{?}}
			</div>
			<span class="bonus-town-popup"></span>
		{{?}}
		
	</div>
</script>

<script type="text/plain" id="bonus.town.popup">
	{{?it.bonus.isMomental()}}
		Мгновенно<br>получить: <br>{{=tmplMgr.bonus.town.val({typedEffect: it.bonus.getUp().getTypedEffect(), type: it.bonus.id})}}
	{{??}}
		{{?it.bonus.isActive()}}
			{{?it.action == 'add'}}
				Действует до <b>{{=timeMgr.fMomentDate(it.bonus.time)}}</b>.<br>
				 После продления до <b>{{=timeMgr.fMomentDate(it.bonus.time + LuckBonus.prolongTime)}}</b>,<br>
				 за <b>{{=snip.resBigCount(Resource.ids.luck, it.bonus.getCost())}}</b>
			{{??}}
    	       	{{?it.bonus.isWeekly()}}За неделю{{??}}Текущий бонус{{?}}:
				<br>
        	   	{{=tmplMgr.bonus.town.val({typedEffect: it.bonus.getTypedEffect(), type: it.bonus.id})}}
        	
           		{{?it.bonus.canUp()}}
               		<br><br>
	               	После улучшения:<br>{{=tmplMgr.bonus.town.val({typedEffect: it.bonus.getUp().getTypedEffect(), type: it.bonus.id})}}
    	       	{{?}}

				{{?it.action == 'up'}}
					<br>
					в неделю,<br>
					 за <b>{{=snip.resBigCount(Resource.ids.luck, Math.ceil(it.bonus.getCostUp()))}}</b>
				{{?}}
			{{?}}
		{{??}}
			После улучшения:<br>{{=tmplMgr.bonus.town.val({typedEffect: it.bonus.getUp().getTypedEffect(), type: it.bonus.id})}}
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="bonus.town.val">
    {{?it.type == LuckBonus.ids.grown}}{{=snip.pop(it.typedEffect.toFixed(1))}}
    {{??it.type == LuckBonus.ids.culture}}{{=snip.cult(it.typedEffect)}}
    {{??it.type == LuckBonus.ids.science || it.type == LuckBonus.ids.sciencePack}}{{=snip.resBigCount(it.typedEffect)}}
    {{??it.type == LuckBonus.ids.production || it.type == LuckBonus.ids.productionPack}}
		{{?it.typedEffect.isEmpty()}}0
		{{??}}
			{{=snip.resList(it.typedEffect, {filter: 'prepCount'})}}
		{{?}}
    {{??it.type == LuckBonus.ids.traders}}{{=snip.trader(it.typedEffect)}}
    {{??it.type == LuckBonus.ids.war}}{{=utils.formatNum(it.typedEffect, {epsilon:true, toPercent:true, int:true})}}%
    {{?}}
</script>


<script type="text/plain" id="bonus.alert.noCoins">
    <div> 
		Для включения необходимо {{=snip.resBigCount(Resource.ids.luck, Math.ceil(it.cost))}}<br>
		Тебе не хватает{{=snip.resBigCount(Resource.ids.luck, Math.ceil(it.cost - it.has))}}<br>
		Пора заглянуть в <a class="link js-popup-close" href="{{=HashMgr.getHref('#/shop')}}">Магазин</a>
    </div>
</script>




<script type="text/plain" id="bonus.add2.main">
	{{
		var bonuses = [];
		if (it.bonus.canUpNow()) {
			bonuses.push(it.bonus);
		}
		var bonusMom = it.bonus.getMomentalBonus();
		if (wofh.town.pop.inc>=0 && bonusMom && bonusMom.canUpNow()) {
			bonuses.push(bonusMom);
		}
	}}
	
	<div class="bonusAdd {{?bonuses.length == 2 || !bonuses.length}}-type-wide{{?}}">
		{{?bonuses.length}}
			{{
				var coinsHas = wofh.account.getCoinsAll();
				var showBtn = bonuses.length == 1 || (bonuses[0].getCostUp() <= coinsHas || bonuses[1].getCostUp() <= coinsHas);
				var bonus = bonuses[0];
			}}
			<div>
				{{?bonus.id == LuckBonus.ids.culture}}
					Для <b>{{=bonus.isForTown()? snip.town(it.bonus.town): snip.acc(wofh.account)}}</b> увеличить культуру:
				{{??bonus.id == LuckBonus.ids.grown}}
					Для <b>{{=bonus.isForTown()? snip.town(it.bonus.town): snip.acc(wofh.account)}}</b> увеличить прирост населения:
				{{??bonus.id == LuckBonus.ids.trade}}
					Для <b>{{=bonus.isForTown()? snip.town(it.bonus.town): snip.acc(wofh.account)}}</b> увеличить количество торговцев:
				{{??bonus.id == LuckBonus.ids.war}}
					Для <b>{{=bonus.isForTown()? snip.town(it.bonus.town): snip.acc(wofh.account)}}</b> увеличить эффективность как в атаке, так и в защите:
				{{??}}
					Для <b>{{=bonus.isForTown()? snip.town(it.bonus.town): snip.acc(wofh.account)}}</b>
				{{?}}
			</div>
			{{?bonuses.length == 2}}
				<div class="bonusAdd-bonus">{{=tmplMgr.bonus.add2.bonus({bonus: bonuses[1], showBtn: showBtn})}}</div>
				<div class="bonusAdd-divider {{?!showBtn}}-type-short{{?}}">или</div>
				<div class="bonusAdd-bonus">{{=tmplMgr.bonus.add2.bonus({bonus: bonuses[0], showBtn: showBtn})}}</div>
				{{?!showBtn}}
					<div class="bonus-add-noCoins">
						{{=snip.noCoins()}}
					</div>
				{{?}}
			{{??}}
				<div class="bonusAdd-bonus">{{=tmplMgr.bonus.add2.bonus({bonus: bonuses[0], showBtn:showBtn})}}</div>
			{{?}}
		{{??}}
			Это улучшение сейчас нельзя активировать для 
			{{=snip.townLink(it.bonus.town)}}
			.
			<br>
			Выбери что-нибудь другое в 
			{{=snip.link(HashMgr.getHref('#/bonus'), 'Удаче')}}
			<br><br>
			{{=snip.link(HashMgr.getHref('#/bonus'), 'Выбрать улучшение', 'button1 -type-green')}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="bonus.add2.bonus">
	<div class="bonusAdd-topic">
		{{?it.bonus.isMomental()}}Мгновенно получить: 
		{{??it.bonus.id == LuckBonus.ids.science}}Увеличить добычу {{=snip.resBig(Resource.ids.science)}}знаний:
		{{??it.bonus.id == LuckBonus.ids.production}}Увеличить выработку ресурсов:
		{{??it.bonus.id == LuckBonus.ids.traders}}Увеличить количество {{=snip.trader()}}торговцев:
		{{??it.bonus.id == LuckBonus.ids.war}}Увеличить силу армии:
		{{??it.bonus.id == LuckBonus.ids.accountPremium}}Включить Царь-аккаунт.
		{{?}}
	</div>
	{{?it.bonus.id == LuckBonus.ids.accountPremium}}
		<div class="bonusAdd-time"></div>
		<div class="bonusAdd-res">
			И получить:<br>Улучшение интерфейса,<br> дополнительная информация,<br> удобные инструменты и многое другое
		</div>
	{{??it.bonus.isMomental()}}
		<div class="bonusAdd-time"></div>
		<div class="bonusAdd-res">
			{{var typedEffect = it.bonus.getUp().getTypedEffect();}}
			{{?it.bonus.id == LuckBonus.ids.productionPack}}
				{{@typedEffect.getList(): res}}
					{{?res.isMoney() || it.bonus.town.getRes(res.id).has + res.count <= it.bonus.town.stock.max}}
						{{=snip.resCount(res)}}&nbsp;
					{{??}}
						{{=snip.resWarn(res, snip.c.warn.red, 'Не хватит места в хранилище города')}}&nbsp;
					{{?}}
				{{@}}
			{{??}}
				<div>{{=snip.resBigCount(typedEffect)}}</div>
			{{?}}
		</div>
	{{??}}
		{{var typedEffect = it.bonus.getTypedEffectUp();}}
		<div class="bonusAdd-time">{{=snip.time()}}{{=timeMgr.fPeriod(it.bonus.isActive()? it.bonus.time - timeMgr.getNow(): LuckBonus.prolongTime)}}</div>
		<div class="bonusAdd-res">
			<div>
				+<span class="-warn -type-green"><b>{{=Math.round(it.bonus.getEffectUp()*100)}}</b></span>%
				{{?it.bonus.id != LuckBonus.ids.war}}
					 ≈ <b>{{=tmplMgr.bonus.town.val({typedEffect: it.bonus.getTypedEffectUp(), type: it.bonus.id})}}</b>
					{{?it.bonus.id == LuckBonus.ids.production || it.bonus.id == LuckBonus.ids.productionPack}}{{=snip.hint('Прогноз основан на текущем производстве города')}}{{?}}
				{{?}}
			</div>
			{{?it.bonus.isWeekly()}}<div style="font-size: 10px; color: grey;">в течение недели</div>{{?}}
		</div>
	{{?}}
	<div class="bonusAdd-cost">за {{=snip.resCount(Resource.ids.luck, Math.ceil(it.bonus.getCostUp()))}}</div>
	{{?it.showBtn}}
		{{?it.bonus.getCostUp() <= wofh.account.getCoinsAll()}}
			<div style="margin: 10px;">
				<button class="button1 -type-gold bonus-takeNow-confirm" data-type="{{=it.bonus.id}}">
					{{?it.bonus.id == LuckBonus.ids.accountPremium}}включить
					{{??it.bonus.isMomental()}}Получить
					{{??}}Увеличить
					{{?}}
				</button>
				{{?it.bonus.isMomental()}}
					{{var concurentBonus = it.bonus.getConcurentBonus();}}
					{{?concurentBonus}}
						<br><br>
						<span class="bonus-takeNow-alert">
							{{=snip.alert('')}}&nbsp;{{?concurentBonus.canUp()}}Повторное использование обычного улучшения выработки знаний и ресурсов на неделю будет доступно через {{??}}Повторное использование этой возможности и обычного улучшения выработки знаний и ресурсов на неделю будет доступно через {{?}}{{=timeMgr.fPeriod(lib.luckbonus.packperiod)}}
						</span>
					{{?}}
				{{?}}
			</div>
		{{??}}
			<div class="bonus-add-noCoins">
				{{=snip.noCoins()}}
			</div>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="bonusTake.header">
    Поделись своей удачей с другом
</script>

<script type="text/plain" id="bonusTake">
    <div class="view-bonus-take">
        Переводить на другие аккаунты можно только купленные и ранее непереводимые {{=snip.resBig(Resource.ids.luck)}}Монеты Удачи.<br>
        У тебя {{=utils.toInt(wofh.account.getCoinsBought()||0)}} таких {{=snip.resBig(Resource.ids.luck)}}Монет Удачи.<br>
		
        <form class="bonus-take-form">
            <div class="bonus-take-block">
                Имя друга: {{=snip.input1({name: 'name', cls: 'bonus-take-name'})}}
            </div>
			
			<div class="bonus-take-block bonus-take-slider-wrp">
				<div class="bonus-take-slider slider"></div>
            </div>
			
			<button class="button1 bonus-take-button">Отправить</button>
            
			<div class="bonus-take-block">
				{{=snip.alert('')}}<span class="bonus-take-alert">Внимание! Осуществление перевода  тобой некоторым игрокам может быть недоступно</span>
			</div>
        </form>
	</div>
</script>

<script type="text/plain" id="bonusDrop.header">
    Подселение своих друзей
</script>

<script type="text/plain" id="bonusDrop">
    <div class="view-bonusDrop">
		<div class="bonusDrop-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="bonusDrop.view">
	{{?it.teamdrop}}
		<div class="bonus-drop-block -sel">
			<div>
				Код подселения ты можешь предоставить своему другу.<br>
				Ему необходимо будет ввести его в дополнительных настройках при регистрации в этот мир.<br>
				Каждый код можно использовать лишь единожды.<br>
				Осталось кодов подселения: <b>{{=it.list.length - it.settledCount}}</b>.
			</div>
			<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100), 250)}}px;">
				<table class="bonus-table bonus-other bonus-drop-table">
					<colgroup>
						<col width="25%">
						<col width="25%">
						<col width="35%">
						<col width="15%">
					</colgroup>
					
					<thead>
						<tr>
							<td>Игрок</td>
							<td>Время</td>
							<td>Код</td>
							<td>Состояние</td>
						</tr>
					</thead>
					
					<tbody>
						{{@it.list:offer:index}}
							<tr class="row{{=index%2}}">
								<td>
									{{?offer.acc.id}}
										{{=snip.acc(offer.acc)}}
									{{?}}
								</td>
								<td>
									{{?offer.acc.id}}
										{{=timeMgr.fMoment(offer.time)}}
									{{?}}
								</td>
								<td>
									{{?offer.acc.id}}
										{{=offer.code}}
									{{??}}
										{{=tmplMgr.snipet.clipboard({tag: offer.code, brackets: false, noHint: true, btnText: "Скопировать в буфер обмена"})}}
									{{?}}
								</td>
								<td>
									{{?offer.acc.id}}
										<span class="clr0">использован</span>
									{{??}}
										<span class="clr2">не использован</span>
									{{?}}
								</td>
							</tr>
						{{@}}
					</tbody>
				</table>
				
				{{?it.hasNoUsed}}
					<br><br><br>
					<a class="link js-dropcancel" href="#">Отменить неиспользованные коды и вернуть</a> {{=snip.resCount(Resource.ids.luck, it.dropCost)}}
				{{?}}
			</div>
		</div>
	{{??}}
		<div class="bonus-drop">
			Данной возможностью можно воспользоваться <b>только один раз</b>,
			<br>а все подселяемые игроки не будут иметь такой возможности.

        	{{?!wofh.platform.noreferallinks}}
				<br>Подселяемые игроки не будут являться рефералами.
			{{?}}
			<br>
			<br>Подселяемый игрок окажется в случайном месте карты в соответствии с заданными критериями на расстоянии от твоего первого города не более заданного радиуса.
			<br/>Места для подселения резервируются в момент заказа бонуса (со случайными параметрами местности) на случай, если рядом кончатся доступные для заселения места. Резерв мест действует только 1 сутки с момента заказа подселения.
			<br>
			<br>Бонус невозможно заказать, если число подселяемых игроков больше
			<br>доступных стартовых мест в радиусе подселения в момент заказа бонуса.
			<br/>
			<br><b {{?!it.places}}class="-warn"{{?}}>Внимание! Рядом есть {{?it.places==6}}>5{{??}}{{=it.places}}{{?}} доступных мест для подселения.</b>
			<br/>
			<br><b>Если подселенный игрок не выполняет начальных Заданий сразу после регистрации, то его аккаунт будет удален на общих основаниях.</b> При этом потраченные {{=snip.resBig(Resource.ids.luck)}}Монеты Удачи возвращены не будут.
			<br>В любой момент подселение можно остановить. При этом недоиспользованная часть цены бонуса будет возвращена. После остановки бонус уже нельзя будет использовать снова.
			<br><br>
			<p>У тебя  {{=snip.resBig(Resource.ids.luck)}}<b>{{=wofh.account.getCoinsBought().toFixed(2)}}</b>  монет удачи (для этого бонуса используются только купленные и ранее непереводимые {{=snip.resBig(Resource.ids.luck)}}Монеты Удачи)</p>

			<form>
				<div class="bonusdrop_sliders">
					<div id="pop_slider">
						<p>Количество подселяемых</p>

						<div class="sld">
							<a class="ui-slider-handle" href="#"></a>
							<a class="ui-slider-progress" href="#"></a>
						</div><br/>

						<p>Число подселяемых:  <span id="bonusdrop_pop"></span></p>
						<p>Стоимость:  {{=snip.resBig(Resource.ids.luck)}}<span id="bonusdrop_sum"></span></p>

					</div>
					<div id="rad_slider">
						<p>Максимальный радиус подселения</p>

						<div class="sld">
							<a class="ui-slider-handle" href="#"></a>
							<a class="ui-slider-progress" href="#"></a>
						</div><br/>

						<p>Радиус: <span id="bonusdrop_radius"></span></p>
						<p>Площадь: <span id="bonusdrop_area"></span> {{=snip.hint('Включая места, недоступные для заселения')}}</p>
						<p>Плотность: <span id="bonusdrop_density"></span> {{=snip.hint('Оценка числа ячеек на одного заселяемого (включая недоступные для заселения местности)')}}</p>
					</div>
				</div>

				<button class="button1 {{?!it.places}}-disabled{{?}}" {{?it.places}}type="submit"{{??}}disabled{{?}}>Купить подселение</button>
			</form>
		</div>
	{{?}}
</script>

<script type="text/plain" id="bonusReferals.header">
    Список рефералов
</script>

<script type="text/plain" id="bonusReferals">
    <div class="view-bonusReferals">
		<div class="bonusReferals-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="bonusReferals.view">
    <div id="refers">
		{{?utils.sizeOf(it.worlds)}}
			<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-100), 300)}}px;">
				<table class="table_bonus tbl">
					<thead><tr><td style="width: 30%">Игрок</td><td style='width: 30%'>Зарегистрирован</td><td style='width: 30%'>Полученный бонус</td></tr></thead>
					
					<tbody>
						{{~it.worlds: world}}
							{{=tmplMgr.bonusReferals.refer(world)}}
						{{~}}
					</tbody>
				</table>
			</div>
		{{??}}
			<p class="no_refers">
				{{var link = snip.referalLink();}}

				Играть с друзьями всегда интересней и веселее. Огромная сила скрыта в таких союзах. Просто пригласи их по своей реферальной ссылке:  <b><span class="refLink -sel" href="{{=link}}">{{=link}}</span></b> . И счастье звенящим дождем накроет вас с головой.
			</p>
		{{?}}
    </div>
</script>


<script type="text/plain" id="bonusReferals.refer">
    <tr class="trow1"><td colspan="3">{{=it.world.name}}</td></tr>
    {{@it.refers: refer: i}}
        <tr class="row{{=i%2}}">
            <td style="width: 30%">
				{{?it.world.id == lib.main.domain}}
					{{=snip.accLink(refer.account)}}
				{{??}}
					{{=snip.acc(refer.account)}}
				{{?}}
            </td>
            <td style="width: 30%">{{=timeMgr.fMoment(refer.regtime)}}</td>
            <td style="width: 30%">{{=snip.resBigCount(Resource.ids.luck, lib.mode.nofreeluck ? 0 : refer.bonus)}}</td>
        </tr>
    {{@}}
</script>





<script type="text/plain" id="bonusSpecial">
	<div class="bonusSpecial-info">
		{{?LuckBonus.subscription.isActive() && !it.subscription.isActive()}}
			{{=tmplMgr.bonusSpecial.bonus(it)}}
		{{??}}
			{{=tmplMgr.bonus.bonusTowns(it)}}
		{{?}}
		
		{{?wofh.account.bonus.teamdrop !== 0 && LuckBonus.subscription.isActive()}}
			{{=tmplMgr.bonusSpecial.settle(it)}}
		{{?}}
		
		<div class="bonusSpecial-footer-wrp"></div>
	</div>
</script>

<script type="text/plain" id="bonusSpecial.bonus">
	<div class="bonusSpecial-delimiter"></div>
	
	<div class="bonusSpecial-info-block">
		<div class="bonusSpecial-bonus-block">
			<div class="bonusSpecial-bonus-topic">
				Для всех твоих городов
			</div>
			<div class="bonusSpecial-bonus-list luckTambourine-rel">
				{{=tmplMgr.bonusSpecial.bonus.list(it)}}
			</div>
		</div>
		<div class="bonusSpecial-description-block">
			<b>Это важно!</b>
			<br>
			В этом мире действует особая система использования бонусов.
			<br>
			<br>
			<b>Только если сейчас</b> ты активируешь этот помесячный Царь-бонус, то сможешь его продлить и позднее. Но помни, что делать это надо регулярно и до момента его истечения.
			<br>
			<br>
			В противном случае тебе такая возможность <b>никогда не будет доступна</b> в этом мире.
		</div>
	</div>

	<div class="bonusSpecial-selection-block" data-type="{{=wBonusSpecial.selectionType.bonus}}">
		<div class="bonusSpecial-selection">
			<div class="bonusSpecial-selection-accept spage-button">Включить</div>
			<div class="bonusSpecial-selection-refuse">Отказаться</div>
		</div>
	</div>
</script>

<script type="text/plain" id="bonusSpecial.bonus.list">
	{{var luckBonus;}}
	<div class="bonusSpecial-bonus-group1">
		<div class="luckTambourine-circle -type-grown">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.grown];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>

		<div class="luckTambourine-circle -type-production">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.production];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>
		<div class="luckTambourine-circle -type-traders">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.traders];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>
	</div>

	<div class="bonusSpecial-bonus-group2">
		<div class="luckTambourine-circle -type-culture">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.culture];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>
		<div class="luckTambourine-circle -type-science">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.science];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>
		<div class="luckTambourine-circle -type-war">
			<span class="luckTambourine-effect">
				{{luckBonus = it.bonuses[LuckBonus.ids.war];}}

				{{=luckBonus.name}}
				<span class="luckTambourine-effect-main">
					{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
				</span>
			</span>
		</div>
	</div>
</script>

<script type="text/plain" id="bonusSpecial.settle">
	<div class="bonusSpecial-delimiter"></div>
	
	<div>
		<div class="bonusSpecial-settle-block">
			{{=tmplMgr.bonusSpecial.settle.text(it)}}
		</div>
		<div class="bonusSpecial-selection-block" data-type="{{=wBonusSpecial.selectionType.settle}}">
			{{?wofh.account.bonus.teamdrop}}
				{{=tmplMgr.bonusSpecial.selection.accepted({type:wBonusSpecial.selectionType.settle})}}
			{{??}}
				<div class="bonusSpecial-selection">
					<div class="bonusSpecial-selection-accept spage-button">Использовать</div>
					<div class="bonusSpecial-selection-refuse">Отказаться</div>
				</div>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="bonusSpecial.settle.text">
	{{?wofh.account.bonus.teamdrop || it.teamdrop}}
		<a class="bonusSpecial-decoration" href="{{=HashMgr.getHref('#/bonusDrop')}}">Подселение друзей</a>
	{{??}}
		<span class="bonusSpecial-settle">Подселение друзей</span> можно использовать <b>только сейчас.</b>
	{{?}}
</script>	

<script type="text/plain" id="bonusSpecial.footer">
	<div class="bonusSpecial-footer-offset"></div>
	
	<div class="bonusSpecial-footer">
		<button class="bonusSpecial-confirm button5">Подтвердить</button>
	</div>	
</script>

<script type="text/plain" id="bonusSpecial.selection.accepted">
	<span class="bonusSpecial-selection-accepted">
		{{?it.type == wBonusSpecial.selectionType.bonus}}
			Бонус включен!
		{{??}}
			Подселение использовано!
		{{?}}
	</span>
</script>

<script type="text/plain" id="bonusSpecial.wnd.confirm">
	<div class="bonusSpecial-wnd-confirm-block">
		<div class="bonusSpecial-wnd-confirm-topic">Для всех твоих городов</div>
		
		<div class="bonusSpecial-wnd-confirm-time">
			{{=snip.time(timeMgr.fPeriod(lib.luckbonus.subscription.period))}}
		</div>
		
		<div class="bonusSpecial-wnd-confirm-list">
			<table class="bonusSpecial-wnd-confirm-listTable">
				<tbody>
					{{@it.bonuses: luckBonus}}
						<tr>
							<td class="aR">
								{{=luckBonus.name}}
							</td>
							<td >
								{{?luckBonus.bonus}}
									<b>
										{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
									</b>
								{{?}}
							</td>
							<td>
								<span class="iconOk"></span>
							</td>
						</tr>
					{{@}}
					<tr>
						<td colspan="3"><br>За {{=snip.luck(lib.luckbonus.subscription.cost)}}</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<button class="button1 -type-gold js-setEnable">{{?it.prolong}}Продлить{{??}}Включить{{?}}</button>
	</div>
</script>

<script type="text/plain" id="bonusSpecial.wnd.confirm.refuse">
	{{?!it[wBonusSpecial.selectionType.bonus + 'Select']}}
		Ты отказался от использования Царь-бонуса. Учти, что более в этом мире ты не сможешь воспользоваться никакими бонусами за Монеты Удачи.
		<br>
		<br>
	{{?}}
	
	{{?!it[wBonusSpecial.selectionType.settle + 'Select']}}
		Отказ от подселения друзей сейчас окончателен. Более ты не сможешь воспользоваться этой возможностью в этом мире.
		<br>
		<br>
	{{?}}
</script>




<script type="text/plain" id="bonusTowns.header">
    Удача подвластна тебе
</script>

<script type="text/plain" id="bonusTowns">
    <div class="view-bonusTowns">
		{{var hasOneTown = utils.sizeOf(wofh.towns) == 1;}}
		
		<div>
			{{?hasOneTown}}
				Активируй сейчас для своего города
			{{??}}
				Активируй сейчас для своих городов
			{{?}}
		</div>
		
        <div class="luckTambourine-rel">
			{{@it.bonuses: luckBonus: luckBonusId}}
				<div class="bonusTowns-bonus-block">
					<div class="luckTambourine-circle -type-{{=utils.cnstName(LuckBonus.ids, luckBonusId)}} {{?hasOneTown}}-type-oneTown js-bonusTown{{?}}" {{?hasOneTown}}data-bonus="{{=luckBonusId}}" data-town="{{=wofh.town.id}}"{{?}}>
						<span class="luckTambourine-effect">
							{{?luckBonusId == LuckBonus.ids.accountPremium}}
								<span class="luckTambourine-effect-main">{{=luckBonus.name0}}</span>
								{{=luckBonus.name1}}
							{{??}}
								{{=luckBonus.name}}
								{{?luckBonus.bonus}}
									<span class="luckTambourine-effect-main">
										{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
									</span>
								{{?}}
							{{?}}
						</span>
					</div>
					
					{{?!hasOneTown}}
						<div class="bonusTowns-towns-block">
							{{?luckBonusId == LuckBonus.ids.accountPremium}}
								<a class="link js-bonusTown" data-bonus="{{=luckBonusId}}" data-town="{{=wofh.town.id}}">Для всех городов</a>
							{{??}}
								{{@luckBonus.towns: town}}
									<a class="link js-bonusTown js-tooltip" data-tooltip-wnd="town" data-bonus="{{=luckBonusId}}" data-town="{{=town.id}}">{{=snip.lenlim(snip.town(town), {lenLim: 100, noHint: true})}}</a><br>
								{{@}}
							{{?}}
						</div>
					{{?}}
				</div>
			{{@}}
		</div>
    </div>
</script>/* Удалить после обновления всех миров (переехало в экономику) 27.11.2018 */<!--/*На удаление 27.12.2018*/--><script type="text/plain" id="chest">
	<div class="chest-view">
		<div class="chest-backClick"></div>
		<div class="chest-hover"></div>
		
		{{=tmplMgr.chest.galaxy()}}
		
		<div class="chest-click">
			<div class="chest-item chest-ray2"></div>
			<div class="chest-item chest-shine3"></div>
			<div class="chest-item chest-ray1"></div>
			<div class="chest-bonusWrp"></div>
		</div>

		<div class="chest-fontain">
			{{for(var line=0; line<=1; line++){ }}
				{{for(var pos=1; pos<=7; pos++){ }}
					<div class="chest-lineWrp -pos-{{=pos}} -line-{{=line}}"></div>
				{{ }; }}
			{{ }; }}
		</div>
	</div>
</script>

<script type="text/plain" id="chest.fontainItem">
	{{?it.type == wChest.types.coins}}
		<div class="chest-line-item luckShine {{?!it.sum}}-type-null{{?}}"></div>
	{{??}}
		<span class="chest-line-item">{{=snip.icon(snip.c.specialistIcon, it.specialist.getType())}}</span>
	{{?}}
</script>

<script type="text/plain" id="chest.galaxy">
	<div class="chest-galaxy">
		<div class="chest-item chest-sphere4-wrp"><div class="chest-item chest-sphere4"></div></div>
		<div class="chest-item chest-sphere3-wrp"><div class="chest-item chest-sphere3"></div></div>
		<div class="chest-item chest-shine2"></div>
		<div class="chest-item chest-sphere2-wrp"><div class="chest-item chest-sphere2"></div></div>
		<div class="chest-item chest-sphere1-wrp"><div class="chest-item chest-sphere1"></div></div>
		<div class="chest-item chest-shine1"></div>
		<div class="chest-item chest-lightning-wrp">
			<div class="chest-item chest-lightning -type-4"></div>
			<div class="chest-item chest-lightning -type-3"></div>
			<div class="chest-item chest-lightning -type-2"></div>
			<div class="chest-item chest-lightning -type-1"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="chest.bonus">
	<div class="chest-bonus -type-{{=it.type}}">
		{{?it.type == wChest.types.coins}}
			<div class="chest-bonus-title">Ты получаешь</div>
			<div class="chest-bonus-img -type-{{=it.chest}}"></div>
			<div class="chest-bonus-value">
				{{?!it.sum}}
					<span class="chest-bonus-count">Заряд позитива!</span>
				{{??}}
					<span class="luckShine"></span><span class="chest-bonus-count">{{=it.sum}}</span>
				{{?}}
			</div>
		{{??}}
			<div class="chest-bonus-title">В твоих владениях родился</div>
			<br>
			<div class="chest-bonus-img aC">{{=snip.icon(snip.c.specialistIcon, it.specialist.getType(), false, false, '-type-big')}}</div>
			<div class="chest-bonus-value chest-bonus-count">{{=it.specialist.getName('prize')}}</div>
			<br>
			<div class="chest-bonus-value cl-black">{{=snip.science(it.science)}}</div>
		{{?}}
	</div>
</script><script type="text/plain" id="contacts.header">
    Контакты
</script>

<script type="text/plain" id="contacts">
    <div class="view-contacts">
		<div class="contacts-add">
			<form class="contacts-addContact" {{?!wofh.contacts.isEmpty()}}style="display: none;"{{?}}>
				<div class="addContact-wrp">
					{{=snip.input1({name: 'name', cls: 'addContact-inp', autocomplete: 'off'})}}
				</div>
				<div>
					{{@Contact.types: type: typeId}}
						<label>
							{{=snip.radio1({name: 'type', value: type.name, checked: typeId == Contact.typeIds.other})}} {{=type.title}}
						</label> 
					{{@}}
				</div>
			</form>
			<div>
				<button class="button1 contacts-addContactBtn">Добавить</button>
			</div>
		</div>
		<div class="contacts-groups">
			{{@Contact.types: type: typeId}}
				<div class="contacts-group contacts-{{=type.name}}-wrp" data-type="{{=type.name}}"></div>
			{{@}}
		</div>
		<div class="contacts-dropShadow"></div>
	</div>
</script>

<script type="text/plain" id="contacts.group">
	<h3 class="group-name">{{=it.title}}</h3>
	<ul class="contacts-list">
		{{@it.contacts.getList(): contact}}
			<li class="contacts-contact" data-id="{{=contact.id}}">
				<div class="contact-link">
					{{=snip.accLink(contact)}}
					
					{{=snip.buttonSmall({type: 'delete'})}}
				</div>
				/*
				{{?it.mode == 'tab'}}
					<a class="icon del"></a>
					<a class="icon info" href="{{=HashMgr.getHref('#/account/'+player.id)}}"></a>
				{{?}}
				*/
			</li>
		{{@}}
	</ul>
</script><script type="text/plain" id="country.header">
	<div class="country-title-block">
		{{=tmplMgr.country.header.text()}}
	</div>
</script>

<script type="text/plain" id="country.header.text">
	{{?wofh.account.isHead()}}
		<a class="country-title-flag -isHead">{{=snip.countryFlag(wofh.country, {flag:'normal'})}}</a>
	{{??}}
		<span class="country-title-flag">{{=snip.countryFlag(wofh.country, {flag:'normal'})}}</span>
	{{?}}
	<span class="country-title-name {{?wofh.account.isHead()}}-isHead{{?}} js-country-name">{{=wofh.country.name}}</span>
</script>

<script type="text/plain" id="country.header.edit">
	<input class="country-editName js-country-editName" type="text" value="{{=it.name}}" maxlength="{{=lib.country.namelimit[1]}}">
	
	{{var canMessage = wofh.account.canMessage();}}
	
	{{?canMessage}}
		{{
			var countryRenameTimer = lib.country.renameTime + it.lastRenameTime;
			var timeLeft = countryRenameTimer - timeMgr.getNow();
		}}
		{{?!(timeLeft > 0)}}
			{{?debug.isTest('later')}}
				{{=snip.button('R', {cls: 'country-random-btn js-country-randomName'})}}
			{{?}}
		{{?}}
	{{?}}
	
	<div class="country-rename-wrp -hidden">
		{{?canMessage}}
			{{?!(timeLeft > 0)}}
				<button class="button2 -type-accept country-acceptName js-country-acceptName" data-title="Подтвердить"></button>
			{{?}}
			<button class="button2 -type-delete country-cancelName js-country-cancelName" data-title="Отменить"></button>
			{{?timeLeft > 0}}
				{{=snip.alert('Переименовать страну можно будет через ' + timeMgr.fPeriod(timeLeft) + '')}}
			{{?}}
		{{??}}
			{{=snip.alert(snip.alertTmpl.blocked.message())}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="country">
	<div class="view-country">
		<div class="js-country-invite-block"></div>
		
		<div class="country-view-wrp -state-loading"></div>
	</div>
</script>

<script type="text/plain" id="country.invite">
	{{?wofh.account.invites.length}}
		<a class="country-invite mapButton -type-dipInv {{?wofh.account.getLastInvite()>servBuffer.serv.lastEnter.countryJoin}}-anim-blink{{?}}" data-title="Приглашение в страну">
			{{?wofh.account.invites.length > 1}}
				<span class="country-invite-count">{{=wofh.account.invites.length}}</span>
			{{?}}
		</a>
	{{?}}
</script>

<script type="text/plain" id="country.view">
	<div>
		<div class="tabs tabs-wrp"></div>
		<div class="country-tabs-cont tabs-cont"></div>
	</div>
</script>



<script type="text/plain" id="country.view.info">
	<div class="country-posts-block">
		{{=tmplMgr.country.info.post({post:Country.postIds.head, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.adviser, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.economics, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.science, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.war, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.warHelp1, post2:Country.postIds.warHelp2, postAccess:Country.postIds.war, title: 'Помощники воеводы', accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.accountant, accPosts:it.accPosts})}}
		{{=tmplMgr.country.info.post({post:Country.postIds.accountantHelp1, post2:Country.postIds.accountantHelp2, postAccess:Country.postIds.accountant, title: 'Помощники учётчика', accPosts:it.accPosts})}}
	</div>
	<div class="country-info-block {{?ls.getСountryInfoBrief(false)}}-brief{{?}}">
		<div class="country-mission-block">
			<div class="country-info-title">
				Миссия
				<a class="link bgDark country-info-brief js-country-info-brief"><span class="-brief-min">Свернуть</span><span class="-brief-max">Развернуть</span></a>
			</div>
			
			{{var canEditMission = wofh.account.isHead() || wofh.account.isAdviser() || wofh.account.isEconomist() || wofh.account.isScientist() || wofh.account.isMarshal();}}
			
			<div class="country-mission-cont {{?canEditMission}}js-country-mission-edit crP{{?}} js-scroll-wrp">
				{{=TextParser.prepare(wofh.country.mission_read||'')}}
			</div>
		</div>
		<div class="country-notes-block">
			<div class="country-info-title">
				События страны
				<a class="link bgDark country-info-brief js-country-info-brief"><span class="-brief-min">Свернуть</span><span class="-brief-max">Развернуть</span></a>
			</div>
			<div class="country-notes-cont js-scroll-wrp">
				<table class="country-notes-table">
					<colgroup>
						<col width="20%">
						<col width="80%">
					</colgroup>	
					<tbody>
						{{@it.dateNotes: dateNote: date}}
							<tr class="-date"><td class="aC" colspan="2">{{=date}}</td></tr>
							
							{{@dateNote: note}}
								<tr>
									<td class="aR">{{=snip.nobr(timeMgr.fMoment(note.time, true))}}</td>
									<td class="aL">{{=tmplMgr.country.info.noteEvents(note)}}</td>
								</tr>
							{{@}}
						{{@}}
					</tbody>
				</table>
			</div>
		</div>
		<div class="cB"></div>
	</div>
	
	{{=tmplMgr.country.info.accounts(it)}}
	
	<div class="country-leave-block">
		<div class="country-leave country-bigBtn -type-leave js-leave" data-title="Выйти из состава страны"></div>
	</div>
</script>

<script type="text/plain" id="country.info.post">
	<div class="country-post-block">
		<div class="country-post-name-block {{?it.post2}}-short-name{{?}}">
			{{=tmplMgr.country.info.postName({post:it.post, accPosts:it.accPosts, postAccess:it.postAccess})}}
			{{?it.post2 && (it.accPosts[it.post] || it.accPosts[it.post2]) }}
				{{?(it.accPosts[it.post] && it.accPosts[it.post2]) || wofh.account.isMarshal()}}&#044;&#032;{{?}}
				{{=tmplMgr.country.info.postName({post:it.post2, accPosts:it.accPosts, postAccess:it.postAccess})}}
			{{?}}
		</div>
		<div class="country-post -lenLim">
			{{=snip.postIcon(it.post)}}
			{{?it.title}}
				{{=it.title}}
			{{??}}
				{{=Country.posts[it.post].title}}
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="country.info.postName">
	{{it.postAccess = it.postAccess||Country.postIds.head;}}
	
	<div class="country-post-name -lenLim -noHint">
		{{var accPost = it.accPosts[it.post];}}
		{{?wofh.account.hasPost(it.postAccess)}}
			{{
				var text = '...';
				var cls = '-selectable js-setPost';
				var data = 'data-post="{{=it.post}}"';
			}}
			{{?accPost}}
				{{
					text = snip.acc(accPost);
					cls += ' js-tooltip';
					data += ' data-tooltip-wnd="account" data-id="{{=accPost.id}}"';
				}}
			{{?}}
			{{=snip.link(false, text, cls, {data:data})}}
		{{??accPost}}
			{{=snip.accLink(accPost)}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="country.info.post.select">
	<div class="country-post-select panel2">{{=snip.postsIcon(it.power)}} {{=snip.acc(it)}}</div>
</script>

<script type="text/plain" id="country.info.noteEvents">
	{{?it.type == 0}}
		<b>{{=snip.accLink(it.data.account)}}</b>{{?it.data.account.sex}} вступил{{??}} вступила{{?}} в страну
	{{??it.type == 1}}
		<b>{{=snip.accLink(it.data.account)}}</b>
		 
		
		{{?it.data.account.sex}}
			покинул
		{{??}}
			покинула
		{{?}}
		 страну
		
		{{?it.data.duty}}
			 и 
			{{?it.data.account.sex}}
				забыл
			{{??}}
				забыла
			{{?}}
			 про долг по налогам 
			{{=snip.resCount(Resource.ids.money, it.data.duty, {filter:'formatNum', int:true, stages:true})}}
			. 
		{{??}}
			. 
		{{?}}
		
		{{?it.data.deposit}}
			{{?it.data.account.sex}}
				Он
				 
				оставил
			{{??}}
				Она
				 
				оставила
			{{?}}
			 вклад 
			{{=snip.resCount(Resource.ids.money, it.data.deposit, {filter:'formatNum', int:true, stages:true})}}
		{{?}}
		{{?it.data.credit}}
			При этом не 
			{{?it.data.account.sex}}
				выплатил
			{{??}}
				выплатила
			{{?}}
			 кредит 
			{{=snip.resCount(Resource.ids.money, it.data.credit, {filter:'formatNum', int:true, stages:true})}}
		{{?}}
	{{??it.type == 2}}
		Страна переименована из «<b>{{=it.data.lastname}}</b>» в «<b>{{=it.data.newname}}</b>».
	{{??it.type == 4}}
		{{?it.data.text}}
			Из казны страны перечислено {{=snip.res(Resource.ids.money)}}<b>{{=utils.stages(it.data.sum)}}</b> игроку <b>{{=snip.accLink(it.data.account)}}</b> — «{{=TextParser.prepare(it.data.text)}}».
		{{??}}
			Из казны страны перечислено {{=snip.res(Resource.ids.money)}}<b>{{=utils.stages(it.data.sum)}}</b> игроку <b>{{=snip.accLink(it.data.account)}}</b>.
		{{?}}
	{{??it.type == 5}}
		Игрок {{=snip.accLink(it.data.account)}} перечислил в бюджет страны {{=snip.res(Resource.ids.money)}}{{=utils.stages(it.data.sum)}}.
	{{?}}
</script>

<script type="text/plain" id="country.info.accounts">
	<div class="country-accounts-block js-scroll-wrp" style="max-height: {{=tabMyCountryInfo.getAccountsMaxHeight()}}px;">
		<table class="country-accounts-table" cellpadding="0" cellspacing="0">
			{{=tmplMgr.country.info.accounts.table(it)}}
		</table>
		
		{{=tmplMgr.country.info.accounts.invited(it)}}
	</div>
</script>

<script type="text/plain" id="country.info.accounts.table">
	<thead>
		<tr>
			<td class='-border-right -country-col-visit'>
				<br>
				{{=snip.sort('online', it.sortField == 'online' ? it.sortDir : undefined)}}
			</td>
			<td class='-border-right -country-col-post'></td>
			<td class='-border-right -country-col-index'></td>
			<td class='-border-right -country-col-account'>
				<img class="icon_player middle" src="https://test.waysofhistory.com/img/_.gif" data-title="Игрок">
				<br>
				{{=snip.sort('name', it.sortField == 'name' ? it.sortDir : undefined)}}
			</td>
			<td class='-border-left -border-right'>
				<img class="icon_town middle" src="https://test.waysofhistory.com/img/_.gif" data-title="Количество городов">
				<br>
				{{=snip.sort('towns', it.sortField == 'towns' ? it.sortDir : undefined)}}
			</td>
			<td class='-border-left -border-right'>
				<span data-title="Общее и среднее на город">{{=snip.pop()}}</span>
				<br>
				{{=snip.sort('pop', it.sortField == 'pop' ? it.sortDir : undefined)}}
			</td>
			{{?it.accountsTotal.diplomacy !== undefined}}
				<td class='-border-left -border-right -country-col-diplomacy'>
					{{=snip.icon(snip.c.anyIcon, 'diplomacyPoints')}}
					<br>
					{{=snip.sort('diplomacy', it.sortField == 'diplomacy' ? it.sortDir : undefined)}}
				</td>
			{{?}}
			{{?it.accountsTotal.showScience}}
				<td class='-border-left -border-right'>
					<span class="country-head-title" data-title="Научный потенциал<br>Производство и вложение знаний в час">НП </span>
					<br>
					{{=snip.sort('inc', it.sortField == 'inc' ? it.sortDir : undefined)}}
				</td>
			{{?}}

			{{?wofh.country.useMoney()}}
				<td class='-border-left -border-right -country-col-taxis'>
					<span class="country-head-title" data-title="Сумма налогов и выплат с учетом накопляемой задолженности">Налог</span> 
					<br>
					{{=snip.sort('taxes', it.sortField == 'taxes' ? it.sortDir : undefined)}}
				</td>
				<td class='-border-left -country-col-duty'>
					<span class="country-head-title">Долг</span> 
					<br>
					{{=snip.sort('duty', it.sortField == 'duty' ? it.sortDir : undefined)}}
				</td>
			{{?}}

			{{?it.accountsTotal.showArmyPop}}
				<td class='-border-left -border-right'>
					<span class="country-head-title" data-title="Общая численность армии всех городов игрока">Армия</span>
					<br>
					{{=snip.sort('armypop', it.sortField == 'armypop' ? it.sortDir : undefined)}}
				</td>
			{{?}}

			{{?it.accountsTotal.death !== undefined}}
				<td class='-border-left -border-right'>
					<span class="country-head-title" data-title="Потери в военных операциях">Погибшие</span>
					<br>
					{{=snip.sort('death', it.sortField == 'death' ? it.sortDir : undefined)}}
				</td>
			{{?}}
		</tr>
	</thead>
	<tbody>
		{{~it.accounts:account:index}}
			<tr class='{{?account.id == wofh.account.id}}-country-owner{{?}} js-country-account' data-index="{{=index}}">
				<td class="-country-col-visit">
					{{?account.id != wofh.account.id && it.accountsTotal.online}}
						<span class="country-lastVisitBox" data-type="{{=account.online}}"></span>
					{{?}}
				</td>
				<td class="-country-col-post">{{=snip.postsIcon(account.power)}}</td>
				<td class='aR -country-col-index'>{{=index+1}}</td>
				<td class='aL lenLim -country-col-account'>
					<span class="nobr">
						{{=snip.accIcon(account)}}
						<a class="country-ulink{{?account.id == wofh.account.id}}Cur{{??it.accountsTotal.online}}{{=utils.toInt(account.online)}}{{??}}Default{{?}} js-acc-name -sel" href="{{=HashMgr.getHref('#/account/'+account.id)}}">{{=account.name}}</a>
					</span>
				</td>
				<td class='-border-left'>{{=account.towns}}</td>
				<td class='-border-left'>
					<span class="country-short-info">
						{{=snip.nobr(utils.formatNum(account.pop, {KM: true, int:true, mixed:true}))}}
						<br>
						<span data-title="среднее население">{{=snip.nobr('(' + utils.formatNum(account.pop/account.towns, {KM: true, int:true, mixed:true}) + ')')}}</span>
					</span>
					<span class="country-full-info">
						{{=snip.nobr(utils.formatNum(account.pop, {int:true, mixed:true}))}}
						<br>
						<span data-title="среднее население">{{=snip.nobr('(' + utils.formatNum(account.pop/account.towns, {int:true, mixed:true}) + ')')}}</span>
					</span>
				</td>
				{{?it.accountsTotal.diplomacy !== undefined}}
					<td class='-border-left'>
						{{?account.diplomacy == 1}}
							{{=snip.wrp('cl-red', account.diplomacy, 'b')}}
						{{??}}
							{{=snip.nobr(snip.coloredNum(account.diplomacy, {stages:true, noSignColor: true, negative:true, noZeroSign:true}))}}
						{{?}}
						<span class="country-full-info">
							<br>
							{{?account.diplomacy > 1}}
								<span data-title="Уровень Посольства">{{=snip.nobr('(' + (new Slot( account.race.is(Race.ids.africa) ? 111 : 13 ).getLevelByEffect(account.diplomacy)) + ')')}}</span>
							{{??account.diplomacy == 1}}
								{{=snip.alert('Отключено Посольство')}}
							{{?}}
						</span>
					</td>
				{{?}}
				{{?it.accountsTotal.showScience}}
					<td class='aR -border-left'>
						{{=snip.nobr(snip.coloredNum(account.inc, {mixed: true, fixed:1, noSignColor: true}))}}
						<span class="country-full-info">
							<br>
							<span data-title="Вложение знаний в час">{{=snip.nobr('(' + snip.coloredNum(account.dec, {mixed: true, fixed:1, noSignColor: true}) + ')')}}</span>
						</span>
					</td>
				{{?}}

				{{?wofh.country.useMoney()}}
					<td class='-border-left -country-col-taxis'>
						<span class="country-short-info">
							{{=snip.nobr(snip.coloredNum(account.taxesSum, {sign:true, int:true, mixed:true}))}}
						</span>
						<span class="country-full-info">
							<span data-title="Налог выплачиваемый стране">{{=snip.nobr(snip.coloredNum(-account.taxes, {sign:true, int:true, mixed:true, negative:true}))}}</span>
							<br>
							<span data-title="Выплаты страны">{{=snip.nobr(snip.coloredNum(account.budget, {sign:true, int:true, mixed:true, positive:true}))}}</span>
						</span>
					</td>
					<td class='-border-left -country-col-duty'>
						<span class="country-full-info">
							{{?wofh.account.isEconomist() || wofh.account.isHead()}}
								{{=tmplMgr.country.info.accounts.subsidyButton({})}}
							{{?}}
						</span>
						{{=snip.nobr(snip.coloredNum(account.duty, {KM:true, int:true, noSignColor: true}))}}
					</td>
				{{?}}
				{{?it.accountsTotal.showArmyPop}}
					<td class='-border-left'>
						<span data-title="Общая численность армии всех городов игрока">
							{{=snip.nobr(snip.coloredNum(account.armypop, {KM: true, int:true, mixed:true, noSignColor: true}))}}
						</span>
						<span class="country-full-info -nobr" data-title=" (сухопутные войска / флот / авиация)">
							<br>
							({{=snip.coloredNum(account.armypop - (account.fleetpop + account.airpop), {KM: true, int:true, mixed:true, noSignColor: true})}}
							&nbsp;/&nbsp;
							{{=snip.coloredNum(account.fleetpop, {KM: true, int:true, mixed:true, noSignColor: true})}}
							&nbsp;/&nbsp;
							{{=snip.coloredNum(account.airpop, {KM: true, int:true, mixed:true, noSignColor: true})}})
						</span>
					</td>
				{{?}}

				{{?it.accountsTotal.death !== undefined}}
					<td class="-border-left">
						<span class="country-short-info">
							{{=snip.nobr(snip.coloredNum(account.death, {KM: true, int:true, mixed:true, noSignColor: true}))}}
						</span>
						<span class="country-full-info">
							{{=snip.nobr(snip.coloredNum(account.death, {int:true, mixed:true, noSignColor: true}))}}
						</span>
					</td>
				{{?}}
			</tr>
		{{~}}

		<tr class='-country-result'>
			<td colspan='3'></td>
			<td class='aL'>Итого:</td>
			<td>{{=snip.nobr(it.accountsTotal.towns)}}</td>
			<td>
				{{=snip.nobr(utils.formatNum(it.accountsTotal.pop, {int:true, mixed:true}))}}
				<br>
				{{=snip.nobr('(' + utils.formatNum(it.accountsTotal.pop/it.accounts.length, {int:true, mixed:true}) + ',&nbsp;' + utils.formatNum(it.accountsTotal.pop/it.accountsTotal.towns, {int:true, mixed:true}) + ')')}}
			</td>
			{{?it.accountsTotal.diplomacy !== undefined}}
				<td>
					{{=snip.title(snip.nobr(utils.stages(~~it.accountsTotal.diplomacy)), 'Текущее количество Очков дипломатии страны')}}
					<br>
					<div class="-nobr">
						{{
							var alert = 0;
							if (it.accountsTotal.diplomacy < it.accountsTotal.dipNeedInvite){
								alert = 1;
							}
							if (it.accountsTotal.diplomacy < it.accountsTotal.dipNeedNow){
								alert = 2;
							}
						}}
						(
							{{?alert == 2}}{{=snip.alert('Очков дипломатии недостаточно. Изучение науки остановлено пока в стране не будет '+utils.stages(it.accountsTotal.dipNeedNow)+' Очков дипломатии.')}}{{?}}
							<span class="{{?alert}}-warn{{?}} -type-orange">{{=snip.title(utils.stages(it.accountsTotal.dipNeedInvite), 'Очки дипломатии необходимые для приема в страну следующего игрока')}}</span>
						)
					</div>
				</td>
			{{?}}
			{{?it.accountsTotal.showScience}}
				<td class="aR">
					<a class="bgDark link js-tabLink" data-tab="science">
						{{=utils.formatNum(it.accountsTotal.inc, {fixed:1, mixed: true})}}
						<br>
						<span data-title="Вложение знаний в час">({{=utils.formatNum(it.accountsTotal.dec, {fixed:1, mixed: true})}})</span>
					</a>
				</td>
			{{?}}

			{{?wofh.country.useMoney()}}
				<td>{{=snip.nobr(utils.formatNum(it.accountsTotal.taxesSum, {int:true, mixed:true}))}}</td>
				<td>
					{{?wofh.account.isEconomist() || wofh.account.isHead()}}
						<div style="width: 31px; height: 26px; display: inline-block; float: left;"></div>
					{{?}}
					{{=snip.nobr(utils.formatNum(it.accountsTotal.duty, {KM: true, int: true}))}}
				</td>
			{{?}}
			{{?it.accountsTotal.showArmyPop}}
				<td>
					<a class="bgDark link js-tabLink" data-tab="army">
						<span data-title="Общая численность армии всех городов игрока">
							{{=utils.formatNum(it.accountsTotal.armypop, {KM: true, int:true, mixed:true})}}
						</span>
						<br>
						{{=snip.nobr('(' + utils.formatNum(it.accountsTotal.armypop - (it.accountsTotal.fleetpop + it.accountsTotal.airpop), {KM: true, int:true, mixed:true}) + '&nbsp;/&nbsp;' + utils.formatNum(it.accountsTotal.fleetpop, {KM: true, int:true, mixed:true}) + '&nbsp;/&nbsp;' + utils.formatNum(it.accountsTotal.airpop, {KM: true, int:true, mixed:true}) + ')' )}}
					</a>
				</td>
			{{?}}
			{{?it.accountsTotal.death !== undefined}}
				<td>
					{{=snip.nobr(utils.formatNum(it.accountsTotal.death, {int:true, mixed:true}))}}
				</td>
			{{?}}
		</tr>
		<tr class="-ulink">
			<td colspan="6">
				<span class="country-full-info">
					<div class="country-ulink-block">
						{{?it.accountsTotal.online}}
							{{=tmplMgr.country.ulinkInfo()}}
						{{?}}
					</div>
				</span>
			</td>
		</tr>
	</tbody>
</script>

<script type="text/plain" id="country.info.accounts.subsidyButton">
	<div class="country-subsidy-button-block">
		<span class="country-subsidy-button panel2 js-subsidy-button" data-title="Выдать субсидию">
			{{=snip.icon(snip.c.eventIcon, 'subsidy')}}
			{{?!utils.toInt(wofh.country.money.sum)}}
				<div class="country-subsidy-buttonShadow"></div>
			{{?}}
		</span>
		<span class="js-subsidy-wrp"></span>
	</div>
</script>

<script type="text/plain" id="country.info.accounts.invited">
	{{?utils.sizeOf(it.invited)}}
		<div class="country-invitedList-block">
			<div class="country-invitedList-title">Приглашенные в страну</div>
			<div class="country-invitedList-cont">
				{{~it.invited: acc: index}}
					<div class="country-invited-block panel2">
						<div class="country-invitedAcc -lenLim -noHint -inline js-hint-useHtml">
							{{=index+1}} {{=snip.accCountry(acc)}}
						</div>
						<div class="country-invitedAccInfo -lenLim js-hint-useHtml">
							{{=snip.townIcon()}}{{=utils.formatNum(acc.towns, {int:true, stages:true})}}
							&#032;&#032;
							{{=snip.pop()}}{{=utils.formatNum(acc.pop, {int:true, stages:true})}} ({{=utils.formatNum(acc.pop/acc.towns, {int:true, stages:true})}})
						</div>
					</div>
				{{~}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="country.view.description">
	<div class="country-info-block js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-120, 0), 250)}}px;">
		<div class="country-text-block">
			<div class="country-text-cont textarea1 {{?wofh.account.isHead()}}js-country-text-edit crP{{?}}">
				{{=TextParser.prepare(wofh.country.text_read||'')}}
			</div>
		</div>
		<div class="country-briefing-block">
			<div class="country-vote-block">
				{{?it.myvote}}
					Мой кандидат 
					{{=snip.hint('Когда кандидат набирает больше голосов, чем у действующего главы, он становится новым главой этой страны')}} 
					{{=snip.hint('Заместитель не увидит мой выбор и не сможет его изменить')}} 
					<select class="select1 js-country-vote">
						{{~it.accounts:account}}
							<option value='{{=account.id}}' {{?account.id == it.myvote}}selected="selected"{{?}}>{{=account.name}}</option>
						{{~}}
					</select>
					<br>
					За меня проголосовало 
					{{=snip.accIcon()}}
					<span id="voteMe_cnt">
						{{=it.myvotes}}
					</span>
					&nbsp
					(<span id="voteMe_cntPerc">{{=utils.toPercent(it.myvotes/utils.sizeOf(it.accounts))}}%</span>)
				{{?}}
			</div>
			<div class="country-editFlag-block">
				{{?wofh.account.isHead()}}
					<a class="link" href="{{=HashMgr.getHref('#/editFlag')}}">
						{{=snip.countryFlag(wofh.country, {flag:'bigger'})}}
						<br>
						Редактор флага
					</a>
				{{??}}
					{{=snip.countryFlag(wofh.country, {flag:'bigger'})}}
				{{?}}
			</div>
			<div class="country-relations-block">
				<table class="s-tbl tbl-relations">
					<thead><tr><th>Союзники</th></tr></thead>
					<tbody>
						<tr>
							<td>
								{{~it.relations:country}}
									{{?country.relation == Tile.relation.ally && country.isActive()}}
										<div>
											{{=snip.countryLink(country)}}&nbsp;
											{{?wofh.account.isHead()}}
												<a class="link js-delRelation" data-id="{{=country.id}}">удалить </a>
											{{?}}
										</div>
									{{?}}
								{{~}}
							</td>
						</tr>
					</tbody>
					<thead><tr><th>Враги</th></tr></thead>
					<tbody>
						<tr>
							<td>
								{{~it.relations:country}}
									{{?country.relation == Tile.relation.enemy && country.isActive()}}
										<div>
											{{=snip.countryLink(country)}}&nbsp;
											{{?wofh.account.isHead()}}
												<a class="link js-delRelation " data-id="{{=country.id}}">удалить </a>
											{{?}}
										</div>
									{{?}}
								{{~}}
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="cB"></div>
	</div>
</script>


<script type="text/plain" id="country.view.money">
	<div class="country-money-cont">	
		<div class="country-money-addInfo-block">
			<div class="country-updMoneyData-block js-country-updMoneyData-block -hidden">
				Данные изменились!
				<br>
				<a class="link js-country-updMoneyData">Обновить?</a>
			</div>
			
			{{?wofh.account.isEconomist() || wofh.account.isHead()}}
				<div class="country-treasury-block">
					<div class="country-treasury-wrp">
						<table class="country-treasury-tbl" cellspacing="0" cellpadding="0">
							<thead>
								<tr>
									<td class="-type-left">Казна</td>
									<td class="-type-left -type-right">Изменение</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="-type-left">{{=snip.resBigCount(Resource.ids.money, utils.toInt(it.getMoneySum()))}}</td>
									<td class="-type-left -type-right">
										({{=snip.coloredNum(it.getMoneyBalance(), {sign:true, int:true, stages:true})}})

										{{?it.getMoneyBalance() < 0}}
											{{
												var timeLeft = it.getMoneySum()/Math.abs(it.getMoneyBalance()) * timeMgr.HtS;
												var timer = snip.timer(timeMgr.getNow() + timeLeft, 'dec');
											}}
											 хватит на 
											<span class="{{?timeLeft < timeMgr.DtS}}cl-red{{?}}">{{=timer}}</span>
											
										{{?}}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			{{?}}

			<div class="country-barterSwitch-block " data-title="Включение бартерной торговли для тех граждан страны, которым он уже недоступна. Только глава страны может осуществить включение...">
				{{=snip.checkboxBarter({name: 'switchbarter', checked: wofh.country.barter, disabled: !wofh.account.isHead()})}}
			</div>
		</div>
		
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-225, 0), 250)}}px;">
			<form id="{{?wofh.account.isEconomist()}}js-country-setTax{{?}}">
				<div class="country-money-block -type-noMargin">
					<div class="country-money-subBlock country-money-budget">
						<div class="country-money-title -budget-title">
							Бюджетные выплаты: <span data-title=" в час">{{=snip.resBigCount(Resource.ids.money, -utils.toInt(it.money.budgetSum))}}</span>
						</div>

						{{=tmplMgr.country.money.table({headCont: tmplMgr.country.money.table.head({}), bodyCont: tmplMgr.country.money.budget(it)})}}
					</div>
					
					<div class="country-money-subBlock country-money-taxes">
						<div class="country-money-title -taxes-title">
							Налоги и пошлины: <span data-title=" в час">{{=snip.resBigCount(Resource.ids.money, utils.toInt(it.money.taxes.sum))}}</span>
						</div>
						
						{{=tmplMgr.country.money.table({headCont: tmplMgr.country.money.table.head({}), bodyCont: tmplMgr.country.money.taxes(it)})}}
					</div>
				</div>
				
				<div class="country-money-block">
					<div class="country-money-subBlock country-money-deposit">
						<div class="country-money-title">
							Вклады: <span data-title=" в час">{{=snip.resBigCount(Resource.ids.money, -utils.toInt(it.money.depositPayment))}}</span>
						</div>

						{{=tmplMgr.country.money.table({bodyCont: tmplMgr.country.money.deposit.bank(it)})}}
						<br><br>
						{{=tmplMgr.country.money.table({headCont: tmplMgr.country.money.table.head({tax:'Вклад'}), bodyCont: tmplMgr.country.money.deposit(it)})}}
					</div>
					
					<div class="country-money-subBlock country-money-credit">
						<div class="country-money-title">
							Кредиты: <span data-title=" в час">{{=snip.resBigCount(Resource.ids.money, utils.toInt(it.money.creditPayment))}}</span>
						</div>
						
						{{=tmplMgr.country.money.table({bodyCont: tmplMgr.country.money.credit.bank(it)})}}
						<br><br>
						{{=tmplMgr.country.money.table({headCont: tmplMgr.country.money.table.head({tax:'Кредит'}), bodyCont: tmplMgr.country.money.credit(it)})}}
					</div>
				</div>
			</form>
		</div>
		
		{{?wofh.account.isEconomist()}}
			<div class="country-setTax-block">
				{{
					var taxTimer = lib.country.financeslimits.updateperiod + it.taxtime;
					var timeLeft = taxTimer - timeMgr.getNow();
				}}
				{{?timeLeft > 0}}
					<span class="country-setTax-timer">{{=snip.timer(taxTimer, 'dec', timeMgr.fPeriod(timeLeft), false, {notifs:[Notif.ids.timerCountryMoney]})}}</span>
					<span class="country-setTax country-bigBtn -type-treasury -disabled"></span>
				{{??}}
					<button type="submit" form="js-country-setTax" class="country-setTax country-bigBtn -type-treasury -disabled js-country-setTaxBtn" data-title="Подтверждение налогово-бюджетной политики страны"></button>
				{{?}}
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="country.money.budget">
	{{=tmplMgr.country.money.table.row({
		title: 'Производственные дотации', 
		tax: snip.link('', 'Особые', 'js-country-money-production') + '<span class="js-country-money-production-alert -hidden">'+snip.alert('Есть еще неподтвержденные изменения в налогово-бюджетной политике страны')+'</span>',
		sum: utils.toInt(it.money.budget.production)})}}
	{{=tmplMgr.country.money.table.row({
		name: 'knowledge_takes',
		title: 'На вложенное '+snip.resBigCount(Resource.ids.science, 1), 
		float: true,
		tax: it.taxes.budget.knowledgetakes,
		sum: it.money.budget.knowledgetakes,
		limit: lib.country.financeslimits.budget.knowledgeTakes})}}
	{{=tmplMgr.country.money.table.row({
		name: 'army_death',
		title: 'На '+snip.pop(1)+' мертвых войск',
		float: true,
		tax: it.taxes.budget.army.death,
		sum: it.money.budget.army.death,
		limit: lib.country.financeslimits.budget.armyDeath})}}
	{{=tmplMgr.country.money.table.row({
		title: 'На живые войска', 
		tax: '<a class="link js-country-money-budget-units">Особые</a><span class="js-country-money-budget-armyLive-alert -hidden">'+snip.alert('Есть еще неподтвержденные изменения в налогово-бюджетной политике страны')+'</span>',
		sum: it.money.budget.army.live,
		sumClass: 'js-country-money-budget-armyLive-sum',
		limit: lib.country.financeslimits.budget.armyLive})}}
	{{=tmplMgr.country.money.table.row({
		name: 'buildings_diplomacy',
		title: 'На '+snip.icon(snip.c.anyIcon, 'diplomacyPoints', false, 1)+' очко дипломатии', 
		float: true,
		tax: it.taxes.budget.buildings.diplomacy,
		sum: it.money.budget.buildings.diplomacy,
		limit: lib.country.financeslimits.budget.diplomacy})}}
	{{=tmplMgr.country.money.table.row({
		name: 'buildings_strategy',
		title: snip.title('На '+snip.resBigCount(1, 1)+' содержания стратегических строений', 'Посольства, строения ПВО и ПРО', 'fakelink crH'),
		float: true,
		tax: it.taxes.budget.buildings.strategy,
		sum: it.money.budget.buildings.strategy,
		limit: lib.country.financeslimits.budget.strategyBuildings})}}
	{{=tmplMgr.country.money.table.row({
		name: 'buildings_war',
		title: 'На '+snip.resBig(Resource.ids.money)+'1 содержания военных строений', 
		float: true,
		tax: it.taxes.budget.buildings.war,
		sum: it.money.budget.buildings.war,
		limit: lib.country.financeslimits.budget.warBuildings})}}
	{{=tmplMgr.country.money.table.row({
		name: 'buildings_science',
		title: 'На '+snip.resBig(Resource.ids.money)+'1 содержания научных строений', 
		float: true,
		tax: it.taxes.budget.buildings.science,
		sum: it.money.budget.buildings.science,
		limit: lib.country.financeslimits.budget.scienceBuildings})}}
	{{=tmplMgr.country.money.table.row({
		name: 'buildings_defence',
		title: 'На '+snip.resBig(Resource.ids.money)+'1 содержания фортификационных строений', 
		float: true,
		tax: it.taxes.budget.buildings.defence,
		sum: it.money.budget.buildings.defence,
		limit: lib.country.financeslimits.budget.defenceBuildings})}}
	{{=tmplMgr.country.money.table.row({
		title: 'Дотации членам страны', 
		tax: '<a class="link js-country-money-budget-helps">Особые</a>' + '<span class="js-country-money-budget-helps-alert -hidden">'+snip.alert('Есть еще неподтвержденные изменения в налогово-бюджетной политике страны')+'</span>',
		sum: it.money.budget.subsidy,
		sumClass: 'js-country-subsidySum',
		limit: lib.country.financeslimits.budget.subsidy})}}
	{{=tmplMgr.country.money.table.row({
		title: 'Разовые выплаты на обучение войск', 
		tax: snip.link('', 'Особые', 'link js-country-money-budget-trainUnits') + '<span class="js-country-money-budget-trainUnits-alert -hidden">'+snip.alert('Есть еще неподтвержденные изменения в налогово-бюджетной политике страны')+'</span>',
		sum: false,
		limit: lib.country.financeslimits.budget.unitTrain})}}
</script>

<script type="text/plain" id="country.money.taxes">
	{{=tmplMgr.country.money.table.row({
		title: 'Производственные налоги', 
		tax: snip.link('', 'Особые', 'js-country-money-production') + '<span class="js-country-money-production-alert -hidden">'+snip.alert('Есть еще неподтвержденные изменения в налогово-бюджетной политике страны')+'</span>',
		sum: utils.toInt(wofh.country.money.taxes.prod)})}}
	{{=tmplMgr.country.money.table.row({
		name: 'tax',
		title: snip.title('Подушный налог', 'из расчета на' + snip.pop(wofh.account.isEconomist() ? 1000 : 1), 'fakelink crH', {escape: true}), 
		tax: wofh.account.isEconomist() ? utils.toInt(it.taxes.tax.pop) : utils.formatNum(it.taxes.tax.pop*0.001, {mixed: true, fixed: 3}),
		sum: utils.toInt(it.money.taxes.pop),
		limit: lib.country.financeslimits.taxes.pop})}}
	{{=tmplMgr.country.money.table.row({
		name: 'taxtr',
		title: 'Налоги с продаж', 
		percent: true,
		tax: wofh.account.isEconomist() ? utils.toInt(it.taxes.tax.trade) : utils.formatNum(it.taxes.tax.trade, {int: true}),
		sum: utils.toInt(it.money.taxes.stream[Trade.taxes.stream.ids.sell]),
		limit: 100})}}
	{{=tmplMgr.country.money.table.row({
		title: 'Налог на месторождения', 
		tax: snip.link('', 'Особые', 'js-country-money-taxes-dep'),
		sum: utils.toInt(it.money.taxes.deposit),
		limit: lib.country.financeslimits.taxes.deposit})}}
	{{=tmplMgr.country.money.table.row({
		rowCls: '-type-wide',
		title: snip.title('Таможенные пошлины', 'Указанная доля от суммы сделки при продаже за пределы страны. Начисляется в качестве налога', 'fakelink fB crH')+(wofh.account.isEconomist() ? '<br>'+snip.link('', 'Добавить '+snip.allyIcon()+'+', 'country-money-taxes-addAlly js-country-money-taxes-addAlly') : ''), 
		tax: '',
		sum: utils.toInt(it.money.taxes.stream[Trade.taxes.stream.ids.customs]),
		limit: 100})}}
	{{=tmplMgr.country.money.table.row({
		title: 'Общие пошлины', 
		tax: snip.link('', 'Особые', 'js-country-money-taxes-ally', {data: 'data-id="'+wofh.tradeAllies.getCountryAlly().id+'"'}), 
		sum: false, 
		limit: 100})}}
	{{=tmplMgr.country.money.table.row({
		title: '', 
		tax: '', 
		sum: false, 
		rowCls: '-hidden js-country-money-taxes-ally-before'})}}
</script>

<script type="text/plain" id="country.money.deposit">
	{{@it.accounts:account}}
		{{?account.deposit}}
			{{=tmplMgr.country.money.table.row({
				title: snip.accLink(account, {lenLim: 170}), 
				tax: snip.coloredNum(utils.toInt(account.deposit), {int: true, stages: true, noSignColor: true}), 
				sum: account.depositPayment,
				rowCls: '-type-bankInfo'})}}
		{{?}}
	{{@}}
	
	{{=tmplMgr.country.money.table.row({
		title: '', 
		tax: snip.coloredNum(utils.toInt(it.money.deposites.sum), {int: true, stages: true, noSignColor: true}), 
		sum: it.money.depositPayment,
		rowCls: '-type-bankInfo fB'})}}
</script>

<script type="text/plain" id="country.money.deposit.bank">
	{{=tmplMgr.country.money.table.row.bank({
		name: 'dep_maxp',
		title: 'Предел вклада на гражданина страны',
		sum: it.taxes.deposit.maxp,
		wide: true,
		limit: lib.country.financeslimits.deposit.acc})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'dep_maxc',
		title: 'Предел вкладов для всех граждан страны',
		sum: it.taxes.deposit.maxc,
		wide: true,
		limit: lib.country.financeslimits.deposit.cou})}}
	{{=tmplMgr.country.money.table.row.bank({
		title: 'Доступно для вкладов',
		sum: snip.wrp('js-country-deposit-avail')})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'dep_rate',
		percent: true,
		title: 'Ставка в день',
		float: true,
		sum: utils.servRound(it.taxes.deposit.rate * 0.1),
		limit: lib.country.financeslimits.deposit.rate * 0.1})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'dep_reserve',
		title: snip.title('Неприкасаемый остаток казны', 'Если в казне менее этой суммы, то возврат вкладов по запросам граждан производиться не будет', 'tooltip-text'),
		sum: utils.servRound(it.taxes.deposit.reserve),
		wide: true,
		limit: 1000000 /*По факту лимита - нет*/})}}
</script>

<script type="text/plain" id="country.money.credit">
	{{@it.accounts:account}}
		{{?account.credit}}
			{{=tmplMgr.country.money.table.row({
				title: snip.accLink(account, {lenLim: 170}), 
				tax: snip.coloredNum(utils.toInt(account.credit), {int: true, stages: true, noSignColor: true}), 
				sum: account.creditPayment,
				rowCls: '-type-bankInfo'})}}
		{{?}}
	{{@}}
	
	{{=tmplMgr.country.money.table.row({
		title: '', 
		tax: snip.coloredNum(utils.toInt(it.money.credites.sum), {int: true, stages: true, noSignColor: true}), 
		sum: it.money.creditPayment,
		rowCls: '-type-bankInfo fB'})}}
</script>

<script type="text/plain" id="country.money.credit.bank">
	{{=tmplMgr.country.money.table.row.bank({
		name: 'cred_maxp',
		title: 'Предел кредита на гражданина страны',
		sum: it.taxes.credit.maxp,
		wide: true,
		limit: lib.country.financeslimits.credit.acc})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'cred_maxc',
		title: 'Предел кредитов для всех граждан страны',
		sum: it.taxes.credit.maxc,
		wide: true,
		limit: lib.country.financeslimits.credit.cou})}}
	{{=tmplMgr.country.money.table.row.bank({
		title: 'Доступно для кредитов',
		sum: snip.wrp('js-country-credit-avail')})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'cred_rate',
		percent: true,
		title: 'Cтавка в день',
		float: true,
		sum: utils.servRound(it.taxes.credit.rate * 0.1),
		limit: lib.country.financeslimits.credit.rate * 0.1})}}
	{{=tmplMgr.country.money.table.row.bank({
		name: 'cred_reserve',
		title: snip.title('Неприкасаемый остаток казны', 'Если в казне менее этой суммы, то выдача кредитов гражданам производиться не будет', 'tooltip-text'),
		sum: utils.servRound(it.taxes.credit.reserve),
		wide: true,
		limit: 1000000 /*По факту лимита - нет*/})}}
</script>

<script type="text/plain" id="country.money.table">
	<table class="country-money-info-tbl {{=it.tblCls||''}}" cellpadding="0" cellspacing="0">
		<thead>
			{{=it.headCont||''}}
		</thead>
		
		<tbody>
			{{=it.bodyCont||''}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="country.money.table.head">
	<thead>
		<tr>
			<td class="country-money-col-before"></td>
			<td class="country-money-col-title"></td>
			<td class="country-money-col-sumIcon"></td>
			<td class="country-money-col-sum">{{=it.sum||'Всего в час'}}</td>
			<td class="country-money-col-tax">{{=it.tax||'Ставка'}}</td>
			<td class="country-money-col-after"></td>
		</tr>
	</thead>
</script>

<script type="text/plain" id="country.money.table.row">
    <tr class="{{=it.rowCls||''}}">
		<td class="country-money-col-before">{{=it.before||''}}</td>
        <td class="country-money-col-title">{{=it.title||''}}</td>
		<td class="country-money-col-sumIcon">
			{{?it.sum !== false}}
				<span>{{=snip.res(Resource.ids.money)}}</span>
			{{?}}
        </td>
		<td class="country-money-col-sum nobr">
            <span class="{{=it.sumClass||''}}">
				{{?it.sum !== false}}
					{{=snip.coloredNum(utils.toInt(it.sum), {int: true, stages: true, noSignColor: true})}}
				{{?}}
            </span>
        </td>
        <td class="country-money-col-tax nobr {{=it.taxCls||''}}">
			{{?typeof(it.tax) === 'string'}}
				{{?it.tax}}({{?}}
					{{=it.tax}}
				{{?it.tax}}){{?}}
            {{??}}
				{{var attrs = {limit: it.limit};}}
				{{?it.float}}
					{{
						attrs['data-spinbox-float'] = true;
						attrs['data-spinbox-step'] = 0.01;
						attrs['data-spinbox-fixed'] = 2;
					}}	
				{{?}}
				({{=snip.input1({cls: 'spinbox', name: it.name, value: it.float ? utils.toFixed(it.tax, 2, true) : it.tax, attrs: attrs, autocomplete: 'off'})}}
				{{?it.percent}}%{{?}})
            {{?}}
        </td>
		<td class="country-money-col-after">{{=it.after||''}}</td>
    </tr>
</script>

<script type="text/plain" id="country.money.table.row.bank">
	<tr class="-type-bank {{=it.rowCls||''}}">
		<td class="country-money-col-before">{{=it.before||''}}</td>
        <td class="country-money-col-title">{{=it.title||''}}</td>
		<td class="country-money-col-sumIcon">
			{{?it.sum !== false}}
				<span>{{=snip.res(Resource.ids.money)}}</span>
			{{?}}
        </td>
		<td class="country-money-col-sum nobr">
            <span class="{{=it.sumClass||''}}">
				{{?it.name}}
					{{var attrs = {limit: it.limit};}}
					{{?it.float}}
						{{
							attrs['data-spinbox-float'] = true;
							attrs['data-spinbox-step'] = 0.1;
							attrs['data-spinbox-fixed'] = 1;
						}}	
					{{?}}
					({{=snip.input1({cls: 'spinbox ' + (it.wide ? '-type-wide' : ''), name: it.name, value: it.float ? utils.toFixed(it.sum, 1, true) : utils.toInt(it.sum), attrs: attrs, autocomplete: 'off'})}})
					{{?it.percent}}%{{?}}
				{{??}}
					{{=it.sum||''}}
				{{?}}
            </span>
        </td>
        <td class="country-money-col-tax nobr {{=it.taxCls||''}}"></td>
		<td class="country-money-col-after">{{=it.after||''}}</td>
    </tr>
</script>



<script type="text/plain" id="country.money.ally.select">
	<div class="country-ally-select panel2">{{=snip.ally(it)}}</div>
</script>

<script type="text/plain" id="country.money.taxes.allyButtonText">
	{{=snip.link('', 'Особые', 'js-country-money-taxes-ally', {data: 'data-id="'+it.ally.id+'" data-alliance-name="'+it.ally.name+'"'})}}
	{{?wofh.account.isEconomist()}}
		<span class="button2-small -type-delete country-money-taxes-delAlly js-country-money-taxes-delAlly" data-title="Отменить" data-id="{{=it.ally.id}}"></span>
	{{?}}
</script>

<script type="text/plain" id="country.money.taxes.allyButton">
	{{=tmplMgr.country.money.table.row({
		title: snip.lenlim(snip.ally(false, it.ally.name), {lenLim: 150}), 
		tax: tmplMgr.country.money.taxes.allyButtonText(it), 
		sum: false,
		taxCls: 'pR',
		rowCls: 'country-money-taxes-ally-block'})}}
</script>

<script type="text/plain" id="country.money.taxes.allyButtonList">
	{{@it.alliances: ally }}
		{{=tmplMgr.country.money.taxes.allyButton({ally:ally})}}
	{{@}}
</script>

<script type="text/plain" id="country.money.taxes.customs_">
	<div class="country-money-taxes-ally-custom js-country-money-taxes-ally-custom" data-id="{{=it.id}}">
		{{=tmplMgr.country.money.taxes.resList({name: 'out', arr: it.arr, prefix: '%'})}}
	</div>
</script>	

<script type="text/plain" id="country.money.taxes.resList">
	{{it.arr = it.arr||[];}}
	
	<div class="country-money-taxes-resListGroup">
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.money, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.wood, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.iron, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
	</div>
	<div class="country-money-taxes-resListGroup">
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.fuel, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.stone, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.horse, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.sulfur, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.uran, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
	</div>
	<div class="country-money-taxes-resListGroup">
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.fruit, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.mais, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.wheat, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.rice, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.fish, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.meat, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
	</div>
	<div class="country-money-taxes-resListGroup">
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.wine, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.jewels, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.cloth, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.films, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
		{{=tmplMgr.country.money.taxes.resItem({res: Resource.ids.books, name: it.name, arr: it.arr, prefix: it.prefix, indexOffset: it.indexOffset})}}
	</div>
</script>

<script type="text/plain" id="country.money.taxes.resItem">
	{{var index = it.res+(it.indexOffset===undefined?-1:it.indexOffset);}}
	{{=snip.res(it.res)}}{{=snip.input1({cls: 'spinbox', name: it.name+it.res, value: it.arr[index]||0, attrs: {'data-index': index}, autocomplete: 'off'})}}{{=it.prefix||''}}<br>
</script>


<script type="text/plain" id="custom.header">
    Таможенные пошлины <span class="helpIcon" data-title="Указанная доля от суммы сделки при продаже за пределы страны. Начисляется в качестве налога"></span>
</script>

<script type="text/plain" id="custom">
    <div class="view-custom country-money-cont">
		<span><b>{{=snip.ally(it.ally, it.ally.name ? '' : 'Общие пошлины')}}</b></span>
		
		<br><br>
		
		<form class="js-country-money-taxes-customs">
			{{=tmplMgr.country.money.taxes.customs_({id: it.ally.id, arr:it.customs_})}}
		
			{{?wofh.account.isEconomist()}}
				<button class="button1 -type-green js-country-money-taxes-saveCustoms" style="margin-top: 10px;">Сохранить</button>
				{{?!it.ally.country && !it.newAlly}}
					<button type="button" class="button1 -type-red js-delCustoms" style="margin-top: 10px;">Удалить</button>
				{{?}}
			{{??}}
				<button class="button1 -type-red" style="margin-top: 10px;">Закрыть</button>
			{{?}}
		</form>
    </div>
</script>





<script type="text/plain" id="production.header">
    Дотации и налоги на производство
</script>

<script type="text/plain" id="production">
    <div class="view-production">
		<div class="production-hint-wrp">
			Дотации и налоги в 
			{{=snip.res(Resource.ids.money)}}
			из расчета на 
			{{=snip.checkbox1({cls: 'js-prod-float', checked: ls.getCountryMoneyProdFloat(true), helperText: ['1000 единиц', '1 единицу']})}}
			 произведенного ресурса в час
		</div>
		
		<form class="js-country-money-production">
			<div class="tbl countryMoneyProduction-tbl">
				<div class="tbl-thead">
					<div class="tbl-tr">
						<div class="tbl-th countryMoneyProduction-colRes">Ресурс</div>
						<div class="tbl-th countryMoneyProduction-colInput">Дотации</div>
						<div class="tbl-th countryMoneyProduction-colInput">Налоги</div>
					</div>
				</div>
				<div class="tbl-tbody js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-225), 150)}}px;">
					{{@new ResList(it.budgetProd).sortByDefault().getList(): res}}
						{{?res.isFood()}}
							{{continue;}}
						{{?}}
						<div class="tbl-tr js-production-res">
							<div class="tbl-td countryMoneyProduction-colRes">
								{{=snip.resBigName(res)}}
							</div>
							<div class="tbl-td countryMoneyProduction-colInput">
								{{=tmplMgr.production.input({type: 'budget', resetType: 'taxes', resId: res.getId(), count: +res.getCount(), limit: lib.country.financeslimits.budget.prod})}}
							</div>
							<div class="tbl-td countryMoneyProduction-colInput">
								/* Устанавливаем смещение, т.к. в массиве производственных налогов нет науки ([0] - это деньги)*/
								{{?it.taxesProd[res.getId()-1] !== undefined}}
									{{=tmplMgr.production.input({type: 'taxes', resetType: 'budget', resId: res.getId()-1, count: +it.taxesProd[res.getId()-1], limit: lib.country.financeslimits.taxes.prod})}}
								{{?}}
							</div>
						</div>
					{{@}}
				</div>
			</div>
			
			<div class="wnd-footer">
				{{?wofh.account.isEconomist()}}
					<button class="button1 -type-green js-country-money-taxes-saveProduction">Сохранить</button>
				{{??}}
					<button type="button" class="button1 -type-red js-wnd-close">Закрыть</button>
				{{?}}
			</div>
		</form>
    </div>
</script>

<script type="text/plain" id="production.input">
	{{
		var data = {};
		data.cls = 'spinbox -type-' + it.type + (!it.count ? ' -type-zero' : '');
		data.value = it.count;
		data.autocomplete = 'off';
		
		data.attrs = {};
		data.attrs['data-reset-type'] = it.resetType;
		data.attrs['data-resid'] = it.resId;
		data.attrs['data-limit'] = it.limit;
		
		if( ls.getCountryMoneyProdFloat(true) ){
			data.value = utils.formatNum(data.value * 0.001, {fixed: 3});
			
			data.attrs['data-spinbox-float'] = 'true';
			data.attrs['data-spinbox-step'] = '0.01';
			data.attrs['data-spinbox-numberstep'] = '0.001';
			data.attrs['data-spinbox-fixed'] = '3';
			data.attrs['data-limit'] *= 0.001;
		}
	}}
	
	{{=snip.input1(data)}}
</script>


<script type="text/plain" id="country.view.science">
	<div class="tbl tbl-country-science">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-td country-science-col0">№</div>
				<div class="tbl-td country-science-col1">Город</div>
				<div class="tbl-td country-science-col2">{{=snip.btnTable('acc','Игрок','')}}</div>
				<div class="tbl-td country-science-col3">{{=snip.btnTable('inc','Передано знаний','')}}</div>
				<div class="tbl-td country-science-col4">{{=snip.btnTable('dec','Вложено знаний','')}}</div>
				<div class="tbl-td country-science-col5">{{=snip.btnTable('efficiency','Эффективность','')}}</div>
			</div>
		</div>
		<div class="tbl-tbody js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-120, 0), 250)}}px;"></tbody>
	</div>
</script>

<script type="text/plain" id="country.science.table">
	{{~it.list: town: index}}
		<div class="tbl-tr">
			<div class="tbl-td country-science-col0">{{=(index + 1)}}</div>
			<div class="tbl-td country-science-col1 -lenLim">{{=snip.townLink(town)}}</div>
			<div class="tbl-td country-science-col2 -lenLim">{{=snip.accLink(town.account)}}</div>
			<div class="tbl-td country-science-col3">{{=snip.resCount(Resource.ids.science, ~~town.inc)}}</div>
			<div class="tbl-td country-science-col4">{{=snip.resCount(Resource.ids.science, ~~town.dec)}}</div>
			<div class="tbl-td country-science-col5">{{=utils.toFixed(town.efficiency, 1)}}%</div>
		</div>
	{{~}}
</script>

<script type="text/plain" id="country.view.adviser"></script>

<script type="text/plain" id="country.view.army">
	<div class="filter-wrp {{?wofh.account.isGeneral()}}-type-wide{{?}}">
		{{var filters = [['a','i'], ['a','o'], ['d','i'], ['d','o'], ['all', 0]];}}
		
		{{~filters: filter}}
			<div class="filter -countryArmy">
				{{var value = it.filter[filter[0]][filter[1]];}}
				{{=snip.checkbox1({cls: 'filter-input', attrs: {'data-type': filter[0], 'data-dir': filter[1]},  checked: value})}}
				&nbsp;
				{{?filter[0] != 'all'}}
					{{=snip.eventIconArmy(filter[0], filter[1], undefined, 'noWork')}}
				{{??}}
					<span class="filterIcon -type-all" data-title="Города без событий"></span>
				{{?}}
				&nbsp;
				{{?filter[0] != 'all'}}
					{{var event = it.minTimeEvent[filter[0] + filter[1]];}}
					 
					<span class="nobr">
						{{=event.count}}
						
						{{?event.count}}
							 (<span class="js-timer" data-timertype="dec" data-time="{{=event.time}}"></span>)
						{{?}}
					</span>
				{{?}}
			</div>
		{{~}}
		
		{{?wofh.account.isGeneral()}}
			<div class="filter -countryArmy">
				{{=snip.wndLink('countryArmy', false, 'Все войска', 'button1s -type-green')}}
			</div>
		{{?}}
	</div>
	
	<div class="tbl tbl-country-army">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-th country-army-col0"></div>
				<div class="tbl-th country-army-col1">{{=snip.btnTable('time','Прибытие','Сортировка по времени вражеских атак')}}</div>
				<div class="tbl-th country-army-col2">Город</div>
				<div class="tbl-th country-army-col-online">{{=snip.btnTable('online','')}}</div>
				<div class="tbl-th country-army-col3">{{=snip.btnTable('acc','Игрок','')}}</div>
				<div class="tbl-th country-army-col4">{{=snip.btnTable('armypop','Личная армия','')}}</div>
				<div class="tbl-th country-army-col5">
					<span class="country-army-unitsText">В городе</span>
					
					{{=tmplMgr.country.army.filterUnits(it)}}
				</div>
			</div>
		</div>
		<div class="tbl-tbody js-armyList" style="max-height: {{=Math.max(utils.getWindowHeight(-170), 150)}}px;"></div>
		<div class="tbl-tfoot">
			<div class="tbl-tr">
				<div class="tbl-td country-army-col-ulink">
					{{=tmplMgr.country.ulinkInfo()}}
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="country.army.filterUnits">
    <span class="country-army-filterUnits-block">
		<label class="country-army-filterUnits">
			{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'land'},  checked: it.filterUnits.land})}}
			&nbsp;
			<span class="filterButton -type-war" data-title="Сухопутные войска"></span>
		</label>
		&nbsp;
		<label class="country-army-filterUnits">
			{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'fleet'},  checked: it.filterUnits.fleet})}}
			&nbsp;
			<span class="filterButton -type-fleet" data-title="Флот"></span>
		</label>
		&nbsp;
		<label class="country-army-filterUnits">
			{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'air'},  checked: it.filterUnits.air})}}
			&nbsp;
			<span class="filterButton -type-air" data-title="Авиация"></span>
		</label>
		&nbsp;
		<label class="country-army-filterUnits">
			{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'noattack'},  checked: it.filterUnits.noattack})}}
			&nbsp;
			<span class="filterButton -type-peace" data-title="Миротворцы"></span>
		</label>
	</span>
</script>

<script type="text/plain" id="country.army.table">
    {{@it.blocks: block: id}}
        <div class="tbl-block" data-id="{{=id}}" style="height: {{=block.height}}px"></div>
    {{@}}
</script>

<script type="text/plain" id="country.army.table.block">
	{{@it.block.list: armyData}}
		{{?armyData.show}}
			<div class="tbl-tr">
				<div class="tbl-td country-army-col0">
					{{?armyData.ai.count && it.filter.a.i}}
						<div class="country-army-event">
							{{=snip.eventIconArmy('attack', 'incom')}}
							{{=armyData.ai.count}}
						</div>
					{{?}}
					{{?armyData.ao.count && it.filter.a.o}}
						<div class="country-army-event">
							{{=snip.eventIconArmy('attack', 'outgo')}}
							{{=armyData.ao.count}}
						</div>
					{{?}}
					{{?armyData.di.count && it.filter.d.i}}
						<div class="country-army-event">
							{{=snip.eventIconArmy('defence', 'incom')}}
							{{=armyData.di.count}}
						</div>
					{{?}}
					{{?armyData.do.count && it.filter.d.o}}
						<div class="country-army-event">
							{{=snip.eventIconArmy('defence', 'outgo')}}
							{{=armyData.do.count}}
						</div>
					{{?}}
				</div>
				<div class="tbl-td country-army-col1">
					{{?armyData.ai.count && it.filter.a.i}}
						<div class="country-army-event">
							через  <span class="js-timer" data-timertype="dec" data-time="{{=armyData.ai.time}}"></span>
							<br>
							 в  {{=timeMgr.fMoment(armyData.ai.time)}} 
						</div>
					{{?}}
					{{?armyData.ao.count && it.filter.a.o}}
						<div class="country-army-event">
							через  <span class="js-timer" data-timertype="dec" data-time="{{=armyData.ao.time}}"></span>
							<br>
							 в  {{=timeMgr.fMoment(armyData.ao.time)}} 
						</div>
					{{?}}
					{{?armyData.di.count && it.filter.d.i}}
						<div class="country-army-event">
							через  <span class="js-timer" data-timertype="dec" data-time="{{=armyData.di.time}}"></span>
							<br>
							 в  {{=timeMgr.fMoment(armyData.di.time)}} 
						</div>
					{{?}}
					{{?armyData.do.count && it.filter.d.o}}
						<div class="country-army-event">
							через  {{=snip.timer(armyData.do.time, 'dec')}}
							<br>
							 в  {{=timeMgr.fMoment(armyData.do.time)}} 
						</div>
					{{?}}
				</div>
				<div class="tbl-td country-army-col2 -lenLim">{{=snip.townLink(armyData.town)}}</div>
				<div class="tbl-td country-army-col-online">
					{{?armyData.town.account.id != wofh.account.id}}
						<span class="country-lastVisitBox" data-type="{{=armyData.town.account.online}}"></span>
					{{?}}
				</div>
				<div class="tbl-td country-army-col3 -lenLim">{{=snip.accLink(armyData.town.account, {accCls:'country-ulink'+(armyData.town.account.id==wofh.account.id?'Cur':utils.toInt(armyData.town.account.online))})}}</div>
				<div class="tbl-td country-army-col4">{{=utils.stages(armyData.armypop)}}</div>
				<div class="tbl-td country-army-col5">
					{{var army=armyData.army.clone();}}
					
					{{?!it.filterUnits.noattack}}
						{{army=army.getBattleUnits();}}
					{{?}}
					
					{{army=army.filterLandUnits(false, it.filterUnits.land).filterFleetUnits(false, it.filterUnits.fleet).filterAirUnits(false, it.filterUnits.air);}}
					
					{{=snip.army(army)}}
				</div>
			</div>
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="country.view.orders"></script>

<script type="text/plain" id="country.ulinkInfo">
	<a class="country-ulinkInfo country-ulink0"><span class="country-lastVisitBox" data-type="0"></span>Сейчас в игре</a>
	<span class="country-ulinkDesc">Отсутствует в игре не более чем:</span>
	<a class="country-ulinkInfo country-ulink1"><span class="country-lastVisitBox" data-type="1"></span>1 день</a>
	<a class="country-ulinkInfo country-ulink2"><span class="country-lastVisitBox" data-type="2"></span>3 дня</a>
	<a class="country-ulinkInfo country-ulink3"><span class="country-lastVisitBox" data-type="3"></span>Неделя</a>
	<a class="country-ulinkInfo country-ulink4"><span class="country-lastVisitBox" data-type="4"></span>Более недели</a>
</script>

<script type="text/plain" id="country.view.space">
	Космическая программа
</script>

<script type="text/plain" id="country.postConfirm">
	{{?it.account}}
		Ты уверен
		{{?!wofh.account.sex}}а{{?}}
		, что готов
		{{?!wofh.account.sex}}а{{?}}
		 назначить 
		{{=snip.accLink(it.account)}}
		 на должность 
		<b>{{=it.post}}</b>
		?
	{{??}}
		Ты уверен{{?!wofh.account.sex}}а{{?}}, что эта должность будет пустовать?
	{{?}}
</script>

<script type="text/plain" id="country.subsidy">
	<div class="country-subsidy-block">
		<div class="country-subsidy-treasury">
			В казне {{=snip.countryLink(wofh.country)}}:
			<br>
			{{=snip.res(Resource.ids.money)}}
			<span class="js-treasury {{?wofh.country.money.balance<0}}cl-red{{?}}">
				{{=utils.formatNum(wofh.country.money.sum, {int: true, stages:true})}}
			</span>
			{{?wofh.country.money.balance<0}}{{=snip.alert('Баланс казны отрицательный, поэтому максимальная сумма субсидии может быть меньше указанной тут')}}{{?}}
		</div>
	
		<div class="country-subsidy-account">
			{{=snip.accLink(it.account)}}
			<br>
			 получит единовременную субсидию
		</div>
		
		<div class="country-subsidy-money">
			<div class="country-subsidy-moneySlider-block">
				<div class="country-subsidy-moneySlider slider js-country-subsidy-moneySlider" data-icon="money"></div>
			</div>
			<div class="country-subsidy-moneyInput-block">
				{{=snip.input1({value: 1, cls: 'country-subsidy-moneyInput js-country-subsidy-moneyInput'})}}
			</div>
		</div>
	
		<div class="country-subsidy-comment">
			<a class="link js-country-subsidy-comment-title">Добавить комментарий</a>
			<textarea class="country-subsidy-comment-text textarea1 js-country-subsidy-comment-text -hidden" maxlength="{{=lib.country.subsidytextmaxlen}}"></textarea>
		</div>
	
		<button class="button1 js-country-subsidy-setSubsidy">Выдать субсидию</button>
	</div>
</script>

<script type="text/plain" id="country.leave">
	<p>
		{{?wofh.account.money.credites.sum && wofh.account.money.deposites.sum}}
			Внимание!<br>
			Ох-хо-хо!<br>
			Ты выходишь из {{=snip.country(wofh.country)}}, оставляя свой вклад и непогашенный кредит.<br>
			Все равно продолжить?
		{{??wofh.account.money.credites.sum}}
			Внимание!<br>
			Ай-яй-яй!<br>
			Ты выходишь из {{=snip.country(wofh.country)}}, оставляя непогашенный кредит.<br>
			Все равно продолжить?
		{{??wofh.account.money.deposites.sum}}
			Внимание!<br>
			Ой-ёй-ёй!<br>
			Ты выходишь из {{=snip.country(wofh.country)}}, оставляя свой вклад.<br>
			Все равно продолжить?
		{{??}}
			Ты действительно хочешь выйти из состава страны {{=snip.country(wofh.country)}}?
		{{?}}
	</p>
</script>

<script type="text/plain" id="country.join">
	<p>
		Ты готов присоединиться к {{=snip.country(it.country)}}?
	</p>
</script>





<script type="text/plain" id="cMoneyHelps.header">
    Дотации
</script>

<script type="text/plain" id="cMoneyHelps">
    <div class="view-countryHelps">
		<div class="tbl-wrp"></div>
		
		<div class="wnd-footer">
			{{?wofh.account.isEconomist()}}
				<div class="countryHelps-alert">
					{{=snip.alert('Изменения будут применены только после подтверждения налогово-бюджетной политики страны.')}}Изменения будут применены только после подтверждения налогово-бюджетной политики страны.
				</div>
				
				<button class="button1 -type-green js-save">Сохранить</button>
			{{?}}
			
			<button class="button1 -type-red js-close">Закрыть</button>
		</div>
    </div>
</script>

<script type="text/plain" id="cMoneyHelps.table.wrp">
	<div class="tbl">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-th countryHelps-col0">{{=snip.btnTable('acc')}}</div>
				<div class="tbl-th countryHelps-col1">{{=snip.btnTable('sum', 'Выплата в час, '+snip.res(Resource.ids.money))}}</div>
			</div>
		</div>
		<form class="tbl-tbody" style="max-height: {{=Math.max(utils.getWindowHeight(-230), 150)}}px;"></form>
	</div>
</script>

<script type="text/plain" id="cMoneyHelps.table">
	{{var subsidyTotal = 0;}}

	{{@it.list: account: index}}
		<div class="tbl-tr countryHelps-subsidy" data-id="{{=account.id}}" data-index="{{=index}}">
			<div class="tbl-td countryHelps-col0">
				{{=snip.accLink(account)}}
				{{?wofh.account.isEconomist()}}
					<div class="countryHelps-change-wrp"></div>
				{{?}}
			</div>
			<div class="tbl-td countryHelps-col1">
				{{subsidyTotal += account.subsidy.sum||0;}}
				
				{{=snip.input1({cls: 'countryHelps-subsidySum spinbox', step: 1, min: 0, value: account.subsidy.sum||0, disabled: !wofh.account.isEconomist(), autocomplete: 'off'})}}
				
				{{?wofh.account.isEconomist()}}
					<a class="countryHelps-setDef button2-small -type-delete"></a>
				{{?}}
			</div>
		</div>
	{{@}}

	<div class="tbl-tr totals">
		<div class="tbl-td"><b>Итого</b></div>
		<div class="tbl-td">{{=snip.res(Resource.ids.money)}}<span class="js-subsidySum">{{=utils.stages(subsidyTotal)}}</span></div>
	</div>
</script>

<script type="text/plain" id="cMoneyHelps.editSubsidy">
	<input type="number" step="1" class="aR js-subsudySumEdit" value="{{=it||1}}" style="width: 65px;">
</script>





<script type="text/plain" id="country.exit">
	<div class="country-exit">
		<div class="country-exit-block">
			Ты действительно хочешь 
			{{?it.isExclude}}
				исключить {{=snip.accLink(it.account)}}
			{{??}}
				выйти
			{{?}}
			 из 
			{{=snip.countryLink(wofh.country)}}
			?
		</div>
		
		{{
			var credit = it.account.money.credites.sum;
			var deposit = it.account.money.deposites.sum;
			var duty = it.account.money.duty;
		}}
		
		{{?credit || deposit || duty}}
			<div class="country-exit-block -type-high">
				<div>Внимание!</div>
			</div>
			{{?credit}}
				<div class="country-exit-block -type-credit">
					Ай-яй-яй!
					<br>
					У 
					{{?it.isExclude}}
						{{=snip.accLink(it.account)}}
					{{??}}
						тебя
					{{?}}
					 остался непогашенный перед страной кредит в размере 
					<br>
					{{=snip.resBigCount(Resource.ids.money, utils.toInt(credit))}}
					<br>
					<label class="country-exit-conf">
						{{=snip.checkbox1()}} 
						
						{{?it.isExclude}}
							Я осознаю это. Щедрость моя безгранична
						{{??}}
							Я понимаю и это мой выбор
						{{?}}
					</label>
				</div>
			{{?}}

			{{?deposit}}
				<div class="country-exit-block -type-deposit">
					Ой-ёй-ёй!
					<br>
					У 
					{{?it.isExclude}}
						{{=snip.accLink(it.account)}}
					{{??}}
						тебя
					{{?}}
					 остался вклад в размере 
					<br>
					{{=snip.resBigCount(Resource.ids.money, utils.toInt(deposit))}}
					<br>
					<label class="country-exit-conf">
						{{=snip.checkbox1()}} 
						
						{{?it.isExclude}}
							Я понимаю и это мой выбор
						{{??}}
							Я осознаю это. Щедрость моя безгранична
						{{?}}
					</label>
				</div>
			{{?}}
			
			{{?duty}}
				<div class="country-exit-block -type-deposit">
					Ох-хо-хо!
					<br>
					Да у 
					{{?it.isExclude}}
						{{=snip.accLink(it.account)}}
					{{??}}
						тебя
					{{?}}
					 задолженность по налогам перед страной 
					<br>
					{{=snip.resBigCount(Resource.ids.money, utils.toInt(duty))}}
					<br>
					<label class="country-exit-conf">
						{{=snip.checkbox1()}} 
						
						{{?it.isExclude}}
							Да это так. Пусть живет с этим...
						{{??}}
							Да это так. Мне с этим жить...
						{{?}}
					</label>
				</div>
			{{?}}
		{{?}}

		<div>Продолжить?</div>
	</div>
</script>





<script type="text/plain" id="cMoneyUnits.header">
    Ставки для выплат
</script>

<script type="text/plain" id="cMoneyUnits">
    <div class="cMoneyUnits">
        <div class="cMoneyUnits-cont">
            <div class="fwB">Базовая ставка начисляется за {{=snip.pop(1)}} живых войск</div>
            <div class="cMoneyUnits-baseRate-wrp">
                {{=snip.resBig(Resource.ids.money)}}
				
				{{=snip.input1({cls: 'cMoneyUnits-baseRate spinbox -type-big', value: utils.formatNum(it.baseRate, {fixed:3}), placeholder: 0, attrs: {'data-spinbox-float': true, 'data-spinbox-step': 0.01}, disabled: !wofh.account.isEconomist()})}}
            </div>
            <div class="cMoneyUnits-unitHint fwB">Особые ставки заменяют собой базовую ставку на живые войска. Начисляются на 1 единицу войск.</div>
            <div class="cMoneyUnits-table tbl-wrp"></div>
            {{?!it.noArmy}}
                <br>
                <div>
                    Итого 
                    {{=snip.res(Resource.ids.money)}}<span class="cMoneyUnits-totalSum fwB"></span>
                    <span class="cMoneyUnits-alert -hidden">{{=snip.alert('Сумма примерная. Может быть основана на устаревших данных. Она может измениться в результате пересчета на актуальное количество войск в стране после подтверждения налогово-бюджетной политики.')}}</span> в час
                </div>
            {{?}}
        </div>
		
        {{?wofh.account.isEconomist()}}
            <div class="wnd-footer"><a class="cMoneyUnits-close button1 -disabled">Сохранить</a></div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="cMoneyUnits.table.wrp">
    <div class="tbl">
        <div class="tbl-thead">
            {{var colCount = it.noArmy? 2 : 3;}}
            <div class="tbl-tr">
                <div class="tbl-th cMoneyUnits-col{{=colCount}}">{{=snip.btnTable('unit', 'Войска')}}</div>
                <div class="tbl-th cMoneyUnits-col{{=colCount}}">{{=snip.btnTable('rate', 'Ставка, '+snip.res(Resource.ids.money))}}</div>
                {{?!it.noArmy}}
                    <div class="tbl-th cMoneyUnits-col{{=colCount}}">{{=snip.btnTable('sum', 'Выплата в час, '+snip.res(Resource.ids.money))}}</div>
                {{?}}
            </div>
        </div>
        <form class="tbl-tbody"></form>
    </div>
</script>

<script type="text/plain" id="cMoneyUnits.table">
    {{var colCount = it.noArmy? 2 : 3;}}
    {{~it.list: unit}}
        <div class="tbl-tr cMoneyUnits-unit" data-id="{{=unit.id}}">
            <div class="tbl-td cMoneyUnits-col{{=colCount}} aL">
                {{?it.noArmy}}
                    {{=snip.unitLink(unit)}}
                {{??}}
                    {{=snip.unitCountLink(unit)}}
                {{?}}
				{{?wofh.account.isEconomist()}}
					<div class="cMoneyUnits-change-wrp"></div>
				{{?}}
            </div>
            <div class="tbl-td cMoneyUnits-col{{=colCount}} aR">
				{{var rate = unit.rate == null ? '' : utils.formatNum(unit.rate, {fixed:3});}}
                
				{{=snip.input1({cls: 'cMoneyUnits-unitRate spinbox', value: rate, placeholder: 'Базовая', attrs: {'data-spinbox-float': true, 'data-spinbox-step': 0.01, 'data-defrate': rate}, disabled: !wofh.account.isEconomist()})}}
				
                {{?wofh.account.isEconomist()}}
                    <a class="cMoneyUnits-setDef button2-small -type-delete"></a>
					<div class="cMoneyUnits-changePay-wrp"></div>
                {{?}}
            </div>
            {{?!it.noArmy}}
                <div class="tbl-td cMoneyUnits-col{{=colCount}} aR">
                    <span class="cMoneyUnits-unitSum"></span>
                </div>
            {{?}}
        </div>
	{{~}}
    <div class="tbl-tr">
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
    </div>
</script>





<script type="text/plain" id="cMoneyDep.header">
    Налог на месторождения
</script>

<script type="text/plain" id="cMoneyDep">
    <div class="cMoneyDep">
        <div class="cMoneyDep-cont">
            <div class="cMoneyDep-table tbl-wrp"></div>
        </div>
        {{?wofh.account.isEconomist()}}
            <div class="cMoneyDep-buttons wnd-footer"><a class="cMoneyDep-save button1 -disabled">Сохранить</a></div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="cMoneyDep.table.wrp">
    <div class="tbl">
        <div class="tbl-thead">
            <div class="tbl-tr">
                <div class="tbl-th cMoneyDep-col1">{{=snip.btnTable('dep', 'Месторождение')}}</div>
                <div class="tbl-th cMoneyDep-col2">{{=snip.btnTable('rate', 'Ставка в час, '+snip.res(Resource.ids.money))}}</div>
            </div>
        </div>
        <form class="tbl-tbody"></form>
    </div>
</script>

<script type="text/plain" id="cMoneyDep.table">
    {{@it.list: deposit}}
        <div class="tbl-tr cMoneyDep-dep" data-id="{{=deposit.id}}">
            <div class="tbl-td cMoneyDep-col1 aL">
				{{=snip.depositLink(deposit, false, false, true)}}
				{{?wofh.account.isEconomist()}}
					<div class="cMoneyDep-change-wrp"></div>
				{{?}}
            </div>
            <div class="tbl-td cMoneyDep-col2 aR">
				{{=snip.input1({cls: 'cMoneyDep-depRate spinbox', value: utils.toInt(deposit.rate), disabled: !wofh.account.isEconomist()})}}
				
                {{?wofh.account.isEconomist()}}
                    <a class="cMoneyDep-setDef button2-small -type-delete"></a>
                {{??}}
					<span class="button2-small -type-empty"></span>
				{{?}}
            </div>
        </div>
	{{@}}
    <div class="tbl-tr">
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
    </div>
</script>





<script type="text/plain" id="cMoneyTrainUnits.header">
    Разовые выплаты на обучение войск
</script>

<script type="text/plain" id="cMoneyTrainUnits">
    <div class="cMoneyTrainU">
        <div class="cMoneyTrainU-cont">
			<div class="fwB">Выплата производится единовременно за одну единицу обученных войск.</div>
			<br>
            <div class="cMoneyTrainU-table tbl-wrp"></div>
        </div> 
        {{?wofh.account.isEconomist()}}
            <div class="cMoneyTrainU-buttons wnd-footer"><a class="cMoneyTrainU-save button1 -disabled">Сохранить</a></div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="cMoneyTrainUnits.table.wrp">
    <div class="tbl">
        <div class="tbl-thead">
            <div class="tbl-tr">
                <div class="tbl-th cMoneyTrainU-col1">{{=snip.btnTable('unit', 'Войска')}}</div>
                <div class="tbl-th cMoneyTrainU-col2">{{=snip.btnTable('rate', 'Выплата, '+snip.res(Resource.ids.money))}}</div>
            </div>
        </div>
        <form class="tbl-tbody"></form>
    </div>
</script>

<script type="text/plain" id="cMoneyTrainUnits.table">
    {{@it.list: unit}}
        <div class="tbl-tr cMoneyTrainU-trainU" data-id="{{=unit.id}}">
            <div class="tbl-td cMoneyTrainU-col1 aL">
				{{=snip.unitNameLink(unit)}}
				{{?wofh.account.isEconomist()}}
					<div class="cMoneyTrainU-change-wrp"></div>
				{{?}}
            </div>
            <div class="tbl-td cMoneyTrainU-col2 aR">				
				{{=snip.input1({cls: 'cMoneyTrainU-trainURate spinbox', value: unit.rate === undefined ? 0 : unit.rate, disabled: !wofh.account.isEconomist()})}}
				
                {{?wofh.account.isEconomist()}}
                    <a class="cMoneyTrainU-setDef button2-small -type-delete"></a>
                {{??}}
					<span class="button2-small -type-empty"></span>
				{{?}}
            </div>
        </div>
	{{@}}
    <div class="tbl-tr">
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
        <div class="tbl-td"></div>
    </div>
</script>





<script type="text/plain" id="countryArmy.header">
	Все войска страны
</script>

<script type="text/plain" id="countryArmy">
	<div class="countryArmy-view">
		<div class="countryArmy-tbl-wrp">
			<div class="countryArmy-filter-wrp">
				<div class="countryArmy-filterUnits">
					{{=snip.input1({cls: 'countryArmy-filterUnitName', placeholder: 'Поиск по названию'})}}

					<label class="countryArmy-filterUnit">
						{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'land'}, checked: it.filterUnits.land})}}
						&nbsp;
						<span class="filterButton -type-war" data-title="Сухопутные войска"></span>
					</label>
					&nbsp;
					<label class="country-army-filterUnit">
						{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'fleet'}, checked: it.filterUnits.fleet})}}
						&nbsp;
						<span class="filterButton -type-fleet" data-title="Флот"></span>
					</label>
					&nbsp;
					<label class="country-army-filterUnit">
						{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'air'}, checked: it.filterUnits.air})}}
						&nbsp;
						<span class="filterButton -type-air" data-title="Авиация"></span>
					</label>
					&nbsp;
					<label class="country-army-filterUnit">
						{{=snip.checkbox1({cls: 'filter-units', attrs: {'data-type': 'noattack'}, checked: it.filterUnits.noattack})}}
						&nbsp;
						<span class="filterButton -type-peace" data-title="Миротворцы"></span>
					</label>
				</div>
			</div>

			<div class="tbl">
				<div class="tbl-thead">
					<div class="tbl-tr">
						<div class="tbl-th countryArmy-col-unit">{{=snip.btnTable('era', 'По эпохам')}}</div>
						<div class="tbl-th countryArmy-col-has">{{=snip.btnTable('has', 'В строю')}}</div>
						<div class="tbl-th countryArmy-col-train">{{=snip.btnTable('train', 'Обучающиеся')}}</div>
						<div class="tbl-th countryArmy-col-all">{{=snip.btnTable('all', 'Все')}}</div>
					</div>
				</div>
				<div class="tbl-tbody" style="max-height: {{=Math.max(utils.getWindowHeight(-200), 200)}}px;"></div>
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="countryArmy.table">
    {{@it.list: unit}}
		{{?it.filterName}}
			{{?unit.getName().toLowerCase().indexOf(it.filterName.toLowerCase()) == -1}}
				{{continue;}}
			{{?}}	
		{{??(!it.filterUnits.land && unit.isLand(true)) || (!it.filterUnits.fleet && unit.isFleet()) || (!it.filterUnits.air && unit.isAir()) || (!it.filterUnits.noattack && unit.isPeaceful())}}
			{{continue;}}
		{{?}}
		
        <div class="tbl-tr">
            <div class="tbl-td countryArmy-col-unit">{{=snip.unitNameLink(unit, false, {noIcon: true, ulCls: (unit.all?'':'cl-greyi')})}}</div>
            <div class="tbl-td countryArmy-col-has">{{=snip.coloredNum(unit.has, {stages: true, noSignColor: true})}}</div>
			<div class="tbl-td countryArmy-col-train">{{=snip.coloredNum(unit.train, {stages: true, noSignColor: true})}}</div>
			<div class="tbl-td countryArmy-col-all">{{=snip.coloredNum(unit.all, {stages: true, noSignColor: true})}}</div>
        </div>
	{{@}}
</script>
<script type="text/plain" id="countryMakeOrder.header">
	Заказ ресурсов
</script>

<script type="text/plain" id="countryMakeOrder">
    <form class="view-country-makeOrder js-makeOrder">
		<div class="country-makeOrder-body">
			<div class="country-makeOrder-info {{?it.slot}}-type-slot{{?}}">
				<div class="country-makeOrder-icon">
					{{=snip.smplSelect({name:'group'})}}
				</div>
				
				<div class="country-makeOrder-town">
					{{?utils.sizeOf(it.towns) > 1}}
						<span class="vaM">{{=snip.townIconLink(it.defTown, it.defTown.account, it.defTown.country)}}</span>
						<select name="town" class="select1">
							{{@it.towns: town}}
								<option value="{{=town.id}}" {{?it.defTown.id == town.id}}selected="selected"{{?}}>{{=town.name}}</option>
							{{@}}
						</select>
					{{??}}
						{{=snip.townLink(it.defTown)}}
						<input type="hidden" name="town" class="js-send-towns-townSelect" value="{{=it.defTown.id}}">
					{{?}}
				</div>
				<div class="country-makeOrder-desc {{?it.slot}}-hidden{{?}}">
					<textarea name="text" class="country-makeOrder-text textarea1" maxlength="{{=lib.order.descriptionmaxlen}}">{{=it.text}}</textarea>
				</div>
			</div>
			
			{{?it.slot}}
				<div class="country-makeOrder-slot-wrp">
					{{?it.slotRebuild}}
						{{=tmplMgr.countryMakeOrder.slot({slot:it.slotRebuild, noIcon: true, hideLevelControl: true})}}

						{{=snip.slotBuildOrderIcon({rebuild: true})}}

						{{=tmplMgr.countryMakeOrder.slot({slot:it.slot, noIcon: true})}}
					{{??}}
						{{=tmplMgr.countryMakeOrder.slot({slot:it.slot})}}
					{{?}}

					<div class="country-makeOrder-slotCost-wrp"></div>
				</div>

				<div class="country-makeOrder-slotUseStock">
					{{=snip.title(snip.checkbox1({cls: 'js-slotUseStock-toggle', checked: wCountryMakeOrder.canUseStock()})+snip.capacityIcon()+' Учитывать текущие ресурсы в городе', '', '', {tag: 'label'})}}
				</div>
			{{?}}

			{{=snip.resGroupSelect({resGroups:it.resList.getGroups({exclude:[ResList.groupType.special], joinFoodToGrown:true})})}}
		</div>

		<div class="wnd-footer">
			<div class="country-makeOrder-reset -hidden"><span class="fakelink">Сбросить</span></div>
			<div class="country-makeOrder-makeOrderBtn-wrp">
				<button class="button1 -type-green country-makeOrder-makeOrderBtn">
					Оформить заказ
				</button>
				<span class="country-makeOrder-autoShowOrders">
					<label class="crP">
						{{=snip.checkbox1({cls: 'js-autoShowOrders', checked: ls.getAutoShowOrders(true)})}} Открыть <span class="fwB">мои заказы</span>
					</label>
				</span>
			</div>
		</div>
	</form>
</script>

<script type="text/plain" id="countryMakeOrder.slot">
	<div class="country-makeOrder-slot">
		<div>
			{{?!it.noIcon}}
				{{=snip.slotBuildOrderIcon()}}
			{{?}}
			{{=snip.slotFrame2(it.slot)}}
		</div>
		<div>{{=snip.buildLink(it.slot, snip.slotName(it.slot))+snip.slotLevelInfo(it.slot)}}</div>
		<div class="country-makeOrder-slot-lvl {{?it.hideLevelControl}}-invis{{?}}">
			С 
			{{=it.slot.getLevel()}}
			 по 
			{{=snip.input1({cls: (!it.hideLevelControl ? 'country-makeOrder-slot-nextLvl' : ''), value: Math.min(it.slot.getLevel()+1, lib.build.maxlevel)})}}
			 ур.
		</div>
	</div>
</script>

<script type="text/plain" id="countryMakeOrder.slotText">
	
	{{=it.slot.getName()}}
	 (
	{{=it.fromLvl}}
	{{?it.nextLvl-it.fromLvl}}
		-
		{{=it.nextLvl}}
	{{?}}
	)
</script>
<script type="text/plain" id="countryOrders.header">
	Заказы ресурсов {{=snip.country(wofh.country, {flag:'normal'})}}
</script>	

<script type="text/plain" id="countryOrders">
    <div class="view-country-orders">
		<div class="tabs tabs-wrp"></div>
		 
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="countryOrders.checked">
	<div>
		<div class="checked-list-wrp"></div>
		
		{{=tmplMgr.countryOrders.list.footer()}}
	</div>
</script>

<script type="text/plain" id="countryOrders.checked.list">
	<div>
		<div class="orders-list-wrp js-scroll-wrp" style="height: {{=wCountryOrders.getMaxHeight()}};">
			{{?it.list}}
				<div class="list-page-nav-wrp">
					{{=tmplMgr.countryOrders.list.nav({page:it.page, list:it.list})}}
					
					{{=tmplMgr.countryOrders.list.filter.style({filter:it.filter})}}
					
					<table class="s-tbl orders-list-tbl">
						{{=tmplMgr.countryOrders.list.colgroup({})}}
						
						{{=tmplMgr.countryOrders.list.header({filter:it.filter, sort:it.sort, defSortField:it.defSortField, showTimeStatus: true})}}
						
						<tbody>
							{{@it.list.getList(): resOrder}}
								<tr class="orders-orderRow crH js-tooltip {{?resOrder.isSendable()}}js-orders-send{{?}}" data-id="{{=resOrder.getId()}}" data-tooltip-wnd="text" data-tooltip-text="{{=utils.escapeHtml(tmplMgr.countryOrders.list.tooltip({order:resOrder}))}}">
									<td>
										{{=tmplMgr.countryOrders.timeInfo({time: resOrder.time})}}
									</td>
									<td>
										{{?resOrder.getGroup()}}
											{{=snip.buildTabIcon(resOrder.getGroup())}}
										{{?}}
									</td>
									<td>
										{{=snip.townAccUnder(resOrder.getTown())}}
									</td>
									<td class="aCi">
										{{=snip.distPath(resOrder.getDist(), resOrder.getPath(), {sep:'<br>'})}}
									</td>
									<td class="orders-text -lenHint">
										{{=resOrder.getText()}}
									</td>
									<td class="pR">
										<div class="orders-resList-wrp">
											{{=snip.resList(resOrder.getResList(), {filter:'formatNum', int:true, stages:true, resCountPostFix: function(res){
													return '<div class="orders-baseRes nobr">('+utils.formatNum(resOrder.getBaseResList().getElem(res.getId()).getCount(), {int:true, stages:true})+')</div>';
												}, 
												cls:'orders-res'
											})}}
										</div>
										<div class="orders-options-wrp">
											{{?resOrder.isSendable()}}
												<button class="button2 -type-send" data-title="Удовлетворить"></button>
											{{?}}
											{{?resOrder.isForAccount()}}
												<button class="button2 -type-delete" data-title="Удалить"></button>
											{{?}}
										</div>
									</td>
									{{var orderProgress = resOrder.calcProgress();}}
									
									<td class="aRi orders-progress" style="background: {{=utils.calcGradByPercent(orderProgress, [{from: 'ef6549', to: '86b952'}])}};">
										{{=orderProgress}}%
									</td>
								</tr>
							{{@}}
						</tbody>		
					</table>
				</div>

				{{?it.list.isEmpty()}}
					<div class="orders-list-noOrders">Как-то подозрительно все хорошо в стране с ресурсами. Ощущение такое, что у всех все есть. Нет ни одного заказа.</div>
				{{?}}
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="countryOrders.noChecked">
	<div>
		<div class="noChecked-list-wrp"></div>
	
		{{=tmplMgr.countryOrders.list.footer()}}
	</div>
</script>

<script type="text/plain" id="countryOrders.noChecked.list">
	<div>
		<div class="orders-list-wrp js-scroll-wrp" style="height: {{=wCountryOrders.getMaxHeight()}};">
			{{?it.list}}
				<div class="list-page-nav-wrp">
					{{=tmplMgr.countryOrders.list.nav({page:it.page, list:it.list})}}
					
					{{=tmplMgr.countryOrders.list.filter.style({filter:it.filter})}}
					
					<table class="s-tbl orders-list-tbl">
						{{=tmplMgr.countryOrders.list.colgroup({})}}
						{{
							var cols = {};
							cols[5] = {text: wofh.account.isAccountant() && it.list.getLength() > 1 ? tmplMgr.countryOrders.noChecked.actionsForAll() : ''};
						}}
						{{=tmplMgr.countryOrders.list.header({cols:cols, filter:it.filter, sort:it.sort, defSortField:it.defSortField})}}
                        
						<tbody>
							{{@it.list.getList(): resOrder}}
								<tr class="orders-orderRow" data-id="{{=resOrder.getId()}}">
									<td>
										{{=tmplMgr.countryOrders.timeInfo({time: resOrder.time})}}
									</td>
									<td>
										{{?resOrder.getGroup()}}
											{{=snip.buildTabIcon(resOrder.getGroup())}}
										{{?}}
									</td>
									<td>
										<div>{{=snip.townAccUnder(resOrder.getTown())}}</div>
									</td>
									<td class="aCi">
										{{=snip.distPath(resOrder.getDist(), resOrder.getPath(), {sep:'<br>'})}}
									</td>
									<td class="orders-text -lenHint">
										{{=utils.lenLim(resOrder.getText())}}
									</td>
									<td class="pR" colspan="2">
										<div class="orders-resList-wrp">
											{{=snip.resList(resOrder.getResList(), {filter:'formatNum', int:true, stages:true, cls:'orders-res'})}}
										</div>
										<div class="orders-options-wrp">
											{{?wofh.account.isAccountant()}}
												<button class="button2 -type-accept -type-one" data-title="Подтвердить"></button>
											{{?}}

											{{?resOrder.isForAccount() || wofh.account.isAccountant()}}
												<button class="button2 {{?resOrder.isForAccount()}}js-delete-order{{??}}js-reject-order{{?}} -type-delete -type-one" data-title="{{?resOrder.isForAccount()}}Удалить{{??}}Отклонить{{?}}"></button>
											{{?}}
										</div>
									</td>
								</tr>
							{{@}}
						</tbody>		
					</table>
				</div>
				
				{{?it.list.isEmpty()}}
					<div class="orders-list-noOrders">Как-то подозрительно все хорошо в стране с ресурсами. Ощущение такое, что у всех все есть. Нет ни одного заказа.</div>
				{{?}}
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="countryOrders.noChecked.actionsForAll">
    <div class="orders-actionsForAll">
        <button class="button2 -type-accept -type-all" data-title="Подтвердить всё"></button>
        <button class="button2 -type-delete -type-all" data-title="Отклонить всё"></button>
    </div>
</script>
            
<script type="text/plain" id="countryOrders.my">
	<div>
		<div class="my-list-wrp"></div>
	
		{{=tmplMgr.countryOrders.list.footer()}}
	</div>
</script>

<script type="text/plain" id="countryOrders.my.list">
	<div>
		<div class="orders-list-wrp js-scroll-wrp" style="height: {{=wCountryOrders.getMaxHeight()}};">
			{{?it.list}}
				<div class="list-page-nav-wrp">
					{{=tmplMgr.countryOrders.list.nav({page:it.page, list:it.list})}}
					
					{{=tmplMgr.countryOrders.list.filter.style({filter:it.filter})}}
					
					<table class="s-tbl orders-list-tbl">
						{{=tmplMgr.countryOrders.list.colgroup({})}}
						{{
							var cols = {};
							cols[2] = {sortList:[{field:ResOrdersList.sort.town}], sort:it.sort, text:snip.smplSelect({cls:'fakelink dIB'})};
						}}
						{{=tmplMgr.countryOrders.list.header({cols:cols, filter:it.filter, sort:it.sort, defSortField:it.defSortField})}}

						<tbody>
							{{@it.list.getList(): resOrder}}
								<tr class="orders-orderRow -status-{{=ResOrder.status[resOrder.getStatus()].name}} {{?resOrder.isConfirmed() || resOrder.isClosed()}}crH js-tooltip{{?}}" data-id="{{=resOrder.getId()}}" data-tooltip-wnd="text" data-tooltip-text="{{=utils.escapeHtml(tmplMgr.countryOrders.list.tooltip({order:resOrder}))}}">
									<td>
										{{=tmplMgr.countryOrders.timeInfo({time: resOrder.time})}}
									</td>
									<td>
										{{?resOrder.getGroup()}}
											{{=snip.buildTabIcon(resOrder.getGroup())}}
										{{?}}
									</td>
									<td>
										<div>{{=snip.townLink(resOrder.getTown(), {lenLim:120})}}</div>
										<div class="orders-orderLabel" data-status="{{=resOrder.getStatus()}}">
											{{=ResOrder.status[resOrder.getStatus()].label}}
										</div>
									</td>
									<td class="aCi">
										{{=snip.distPath(resOrder.getDist(), resOrder.getPath(), {sep:'<br>'})}}
									</td>
									<td class="orders-text -lenHint">
										{{=utils.lenLim(resOrder.getText())}} 
									</td>
									<td class="pR" colspan="2">
										<div class="orders-resList-wrp">
											{{=snip.resList(resOrder.isFinished() ? resOrder.getBaseResList() : resOrder.getResList(), {filter:'formatNum', int:true, stages:true, cls:'orders-res'})}}
										</div>
										<div class="orders-options-wrp">
											{{?!(resOrder.isClosed() || resOrder.isFinished() || resOrder.isRejected())}}
												<button class="button2 -type-delete" data-title="Удалить"></button>
											{{?}}
										</div>
									</td>
								</tr>
							{{@}}
						</tbody>		
					</table>
				</div>

				{{?it.list.isEmpty()}}
					<div class="orders-list-noOrders">Нет ни одного заказа.</div>
				{{?}}
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="countryOrders.list.colgroup">
	{{var colsWidth = it.colsWidth||[88, 22, 130, 58, 126, 485, 34];}}
	
	<colgroup>
		{{@colsWidth: colWidth}}
			<col width="{{=colWidth}}px">
		{{@}}
	</colgroup>
</script>

<script type="text/plain" id="countryOrders.list.header">
	{{it.cols = it.cols||{};}}
	
	<thead>
		<tr>
			{{=tmplMgr.countryOrders.list.header.col({tdCls: 'orders-timeHeader', sortList:[{field:it.defSortField}], sort:it.sort, text: tmplMgr.countryOrders.list.header.timeInfo({showTimeStatus: it.showTimeStatus})})}}
			{{=tmplMgr.countryOrders.list.header.col({sortList:[{field:ResOrdersList.sort.group}], sort:it.sort})}}
			{{=tmplMgr.countryOrders.list.header.col((it.cols[2]||{sortList:[{field:ResOrdersList.sort.town}, {field:ResOrdersList.sort.acc}], sort:it.sort, text:'Все заказы'}))}}
			{{=tmplMgr.countryOrders.list.header.col({sortList:[{field:ResOrdersList.sort.dist}], tdCls:'aCi', sort:it.sort, text:snip.ruler()})}}
			{{=tmplMgr.countryOrders.list.header.col({text:'Назначение'})}}
			{{=tmplMgr.countryOrders.list.header.col({text:tmplMgr.countryOrders.list.filter({filter:it.filter})})}}
			{{=tmplMgr.countryOrders.list.header.col(it.cols[5]||{})}}
		</tr>
	</thead>	
</script>

<script type="text/plain" id="countryOrders.list.header.col">
	<td class="{{=it.tdCls||''}}">
		<div class="orders-list-headerText">{{=it.text||''}}</div>
		<div class="orders-list-headerSort">
			{{@it.sortList:sort}}
				<span class="btnTbl-sort -dir-{{?it.sort.isReverse() || it.sort.isEqual(ResOrdersList.sort.no, true)}}down{{??}}up{{?}} {{?it.sort.isEqual(sort.field, true)}}-active{{?}}" data-field="{{=sort.field}}" {{?sort.title}}data-title="{{=sort.title}}"{{?}}></span>
			{{@}}
		</div>
	</td>
</script>

<script type="text/plain" id="countryOrders.list.header.timeInfo">
	<div class="orders-timeSort" data-field="{{=ResOrdersList.sort.timecreate}}">
		{{=snip.time() + ' ' + snip.wrp('flink', 'Создано')}}
	</div>

	{{?it.showTimeStatus}}
		<div class="orders-timeStatus orders-timeSort cl-grey flink" data-field="{{=ResOrdersList.sort.timestatus}}">
			{{=snip.time() + ' ' + snip.wrp('flink', 'Одобрено')}}
		</div>
	{{?}}
</script>

<script type="text/plain" id="countryOrders.list.filter">
	{{var resGroups = ResList.getAll().getGroups({exclude:[ResList.groupType.special], joinFoodToGrown:true});}}
	{{=snip.resFilter.inline({type: ResList.filter.type.resbin, resGroups:resGroups, resbin:it.filter, active:['filter', ResList.filter.resType.all], showAll:true})}}
</script>

<script type="text/plain" id="countryOrders.list.filter.style">
	{{var defFilter = ResList.getResBinFilter();}}
	
	{{?it.filter != defFilter}}
		<style>
			.orders-list-tbl .orders-res{font-weight: bold;}
			{{var filteredList = [];}}
			{{@ResList.getFromResBin(it.filter^defFilter).getList(): res}}
				{{filteredList.push('.orders-list-tbl .orders-res.-id-'+res.getId());}}
			{{@}}
			{{=filteredList.join(',')}}{font-weight: normal; opacity: 0.5}
		</style>
	{{?}}
</script>

<script type="text/plain" id="countryOrders.list.tooltip">
	Первоначальный заказ: 
	{{=snip.resList(it.order.getBaseResList(), {filter:'formatNum', int:true, stages:true})}}
	{{var sentList = it.order.getBaseResList().clone().diffList(it.order.getResList());}}
	{{?sentList.calcSum() > 0}}
		<br>
		Отправлено: {{=snip.resList(sentList, {filter:'formatNum', int:true, stages:true})}}
		<br>
		Осталось: {{=snip.resList(it.order.getResList(), {filter:'formatNum', int:true, stages:true})}}
	{{?}}
</script>

<script type="text/plain" id="countryOrders.timeInfo">
	<div class="orders-timeInfo">
		<div>
			{{=timeMgr.fMomentDate(it.time.create, true) + ' ' + timeMgr.fMomentTime(it.time.create, true)}}
		</div>
		{{?it.time.create != it.time.status}}
			<div class="cl-grey">
				{{=timeMgr.fMomentDate(it.time.status, true) + ' ' + timeMgr.fMomentTime(it.time.status, true)}}
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="countryOrders.list.nav">
	<a class="page-nav-prev {{?it.page}}-active{{?}}"></a>
	<a class="page-nav-next {{?it.list.getLength() >= wCountryOrders.pageCount}}-active{{?}}"></a>
</script>

<script type="text/plain" id="countryOrders.list.footer">
	<div class="wnd-footer">
		<div class="orders-list-footer">
			<a href="{{=hashMgr.getWndHref('countryMakeOrder')}}" class="button1 -type-green js-makeOrder">Оформить заказ</a>		
		</div>
	</div>
</script>

<script type="text/plain" id="countryOrders.control">
	<div>
		<form class="control-resList js-scroll-wrp" style="height: {{=wCountryOrders.getMaxHeight()}};">
			<table class="control-res-listTbl">
				<tbody>
					{{?wofh.account.isChiefAccountant() || wofh.account.isHead()}}
						<tr class="control-res">
							<td class="control-res-resIcon">
								<div class="control-orders-text">Включить систему заказов ресурсов для страны:</div>
							</td>
							<td class="aL">
								<div class="control-orders-sld slider {{=snip.getSliderTypeCls('checkbox')}} dIB" data-checked="{{?wofh.country.ordersAccess}}checked{{?}}"></div>
							</td>
						</tr>
					{{?}}
					<tr class="control-res">
						<td colspan="2">
							<div class="control-res-title-wrp">
								<div class="control-res-title">
									Ресурсы доступные для заказов
								</div>
							</div>
						</td>
					</tr>
					{{@it.resList.getList():res}}
						<tr class="control-res">
							<td class="control-res-resIcon">
								<div class="control-res-alert">{{=snip.alert('Этот ресурс исключен из системы заказов')}}</div>
								{{=snip.resBig(res)}}
							</td>
							<td class="aL">
								<div class="control-res-sld slider {{=snip.getSliderTypeCls('checkbox')}}" data-checked="{{?utils.inMask(res.getId(), wofh.country.ordersAccess)}}checked{{?}}" data-name="{{=res.getId()}}"></div>
							</td>
						</tr>
					{{@}}
				<tbody>
			</table>
		</form>
		
		<div class="wnd-footer {{?!(wofh.account.isChiefAccountant() || wofh.account.isHead())}}-invis{{?}}">
			<button class="control-save button1 -type-green">Сохранить</button>
			/*
			<button class="control-reset button1 -type-blue">Сбросить</button>
			*/
		</div>
	</div>
</script>



<script type="text/plain" id="countryOrders.rate">
	<div>
		<div class="rate-acc-wrp"></div>
		<div class="rate-res-wrp"></div>
	</div>
</script>

<script type="text/plain" id="countryOrders.rate.acc">
	<div>
		<div class="tbl -orders-rate">
			<div class="tbl-thead">
				<div class="tbl-tr">
					<div class="tbl-td orders-rate-colI"></div>
					<div class="tbl-td orders-rate-colAcc">{{=snip.btnTable('acc')}}</div>
					<div class="tbl-td orders-rate-colBaseRate">{{=snip.btnTable('baseRate', 'Базовый рейтинг', 'Базовый - рейтинг основанный на активности удовлетворения заказов')}}</div>
					<div class="tbl-td orders-rate-colCorrect">{{=snip.btnTable('correct', 'Коррекция')}}</div>
					<div class="tbl-td orders-rate-colRate">{{=snip.btnTable('rate', 'Рейтинг')}}</div>
				</div>
			</div>
			<div class="tbl-tbody js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-75, 0), 250)}}px;"></tbody>
		</div>
	</div>
</script>

<script type="text/plain" id="countryOrders.rate.acc.table">
	{{@it.list: acc: index}}
		<div class="tbl-tr">
			<div class="tbl-td tbl-td orders-rate-colI">{{=(+index + 1)}}</div>
			<div class="tbl-td orders-rate-colAcc">{{=snip.accLink(acc, {lenLim:120})}}</div>
			<div class="tbl-td orders-rate-colBaseRate">{{=snip.coloredNum(0, {noSignColor:true, toInt:true})}}</div>
			<div class="tbl-td orders-rate-colCorrect">
				<div class="orders-rate-correct-wrp">
					{{=snip.input1({cls: 'js-orders-rate-correct', value: utils.formatNum(2, {sign:true})})}}
					<div class="orders-rate-correctAccept-wrp -hidden">
						<div class="button2 -type-accept"></div>
					</div>
				</div>
			</div>
			<div class="tbl-td orders-rate-colRate">{{=snip.coloredNum(-3, {noPosSignColor:true, toInt:true})}}</div>
		</div>
	{{@}}
</script>

<script type="text/plain" id="countryOrders.rate.res">
	<div>
		<div class="rate-res-title">Рейтинг ресурсов</div>
		<table class="rate-res-listTbl">
			<colgroup>
				<col width="40px">
				<col width="260px">
				<col width="60px">
			</colgroup>	
			<tbody>
				{{@it.resList.getList():res}}
					<tr class="rate-res-res">
						<td class="rate-res-resIcon">
							<div class="rate-res-alert">{{=snip.alert('Этот ресурс исключен из системы заказов')}}</div>
							{{=snip.resBig(res)}}
						</td>
						<td>
							<div class="rate-res-sld slider -type-grad" data-value="50"></div>
						</td>
						<td class="aL">
							{{=snip.input1({cls: 'rate-res-val spinbox'})}}
						</td>
					</tr>
				{{@}}
			<tbody>
		</table>
		<div class="rate-res-reset-wrp">
			<button class="rate-res-reset button1 -type-blue">Сбросить</button>
		</div>
	</div>
</script>﻿<script type="text/plain" id="countryAdviser.header">
	{{?it.country}}
		{{=snip.country(it.country, {flag: 'normal'})}}. Статистика
	{{?}}
</script>

<script type="text/plain" id="countryAdviser">
    <div class="view-countryAdviser">
		<div class="countryAdviser-view-wrp"></div>
    </div>
</script>


<script type="text/plain" id="countryAdviser.view">
	<div>
		<div class="tabs tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="countryAdviser.view.town">
    <div class="countryAdviser-res">
        <div class="cAdv-town-filterWrp">
            <div>Фильтры:</div>
            <div class="cAdv-town-filter"></div>
        </div>
        <div class="tbl tbl-cAdv-town">
            <div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-th cAdv-towns-col0">#</div>
                    <div class="tbl-th cAdv-towns-col1">{{=snip.btnTable('dist',snip.ruler(),'Расстояние')}}</div>
                    <div class="tbl-th cAdv-towns-col2">{{=snip.btnTable('control','','Избранное')}}</div>
                    <div class="tbl-th cAdv-towns-col3">{{=snip.btnTable('acc','','Игрок')}}</div>
                    <div class="tbl-th cAdv-towns-col4">{{=snip.btnTable('spec','','Специализация города')}}</div>
                    <div class="tbl-th cAdv-towns-col5">{{=snip.btnTable('town','','Город')}}</div>
                    <div class="tbl-th cAdv-towns-col6">{{=snip.btnTable('terrWater','','Количество водных кварталов города')}}</div>
                    <div class="tbl-th cAdv-towns-col7">{{=snip.btnTable('terrHill','','Дополнительные холмовые кварталы города')}}</div>
                    <div class="tbl-th cAdv-towns-col8">{{=snip.btnTable('climate','','Климат города')}}</div>
                    <div class="tbl-th cAdv-towns-col9">{{=snip.btnTable('deposit','','Колония города и её климат')}}</div>
                    <div class="tbl-th cAdv-towns-col10">{{=snip.btnTable('depRes','','Ресурс, добываемый колонией города')}}</div>
                    <div class="tbl-th cAdv-towns-col11">{{=snip.btnTable('pop','Население','Население города')}}</div>
                    <div class="tbl-th cAdv-towns-col12">{{=snip.btnTable('army','Армия','Численность армии города')}}</div>
                    <div class="tbl-th cAdv-towns-col13">{{=snip.btnTable('wonder','','Чудо света')}}</div>
                    <div class="tbl-th cAdv-towns-col14">{{=snip.btnTable('aad','ПВО',"Максимально возможный урон вражеской авиации от любых построенных и работающих строений противовоздушной обороны.")}}</div>
                    <div class="tbl-th cAdv-towns-col15">{{=snip.btnTable('comment','','Комментарии')}}</div>
                </div>
            </div>
			
            <div class="tbl-tbody cAdv-town-table-data" style="max-height:450px"></div>
        </div>
    </div>
</script>

<script type="text/plain" id="countryAdviser.town.table">
    {{@it.blocks: block: id}}
        <div class="tbl-block" data-id="{{=id}}" style="height: {{=block.height}}px"></div>
    {{@}}
</script>

<script type="text/plain" id="countryAdviser.town.table.block">
    {{var prevFilter = true;}}
    {{@it.block.list: town: i}}
        {{?prevFilter != town.filter}}
            {{prevFilter = town.filter;}}
        {{?}}
        <div class="tbl-tr cAdv-towns-town {{?!town.filter}}-type-filtered{{?}}" data-id="{{=town.id}}" >
            {{var selected = it.townSelect.id == town.id;}}
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col0">{{=it.options.blockSize * it.block.i + +i + 1}}</div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col1 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-dist {{?selected}}-active{{?}}" data-title="Расстояние">
                    {{?selected}}<span class="adviserIcon -type-origin"></span>
                    {{??}}{{=town.dist.toFixed(1)}}{{?}}    
                </a>
                <a class="cAdv-towns-filter" data-field="dist">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col2 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-control adviserIcon -type-fav {{?town.control}}-active{{?}}" data-title="Выбрать"></a>
                <a class="cAdv-towns-filter" data-field="control" data-val="{{=+town.control}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col3 cAdv-towns-filter-wrp">
                {{=snip.accLink(town.account)}}
                <a class="cAdv-towns-filter -type-left" data-field="acc" data-val="{{=town.account.id}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>


            <div class="tbl-td cAdv-towns-cell cAdv-towns-col4 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-spec">
                    {{=snip.icon(snip.c.townSpec, 'townSpec'+town.specIcon)}}
                    {{?town.specRes}}
                        <span class="cAdv-towns-spec-res">{{=snip.res(town.specRes)}}</span>
                    {{?}}
                </a>
                <a class="cAdv-towns-filter" data-field="spec" data-val="{{=town.spec}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col5 cAdv-towns-filter-wrp">
                {{=snip.townLink(town)}}
                <a class="cAdv-towns-filter -type-left" data-field="town" data-val="{{=town.id}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col6 cAdv-towns-filter-wrp">
                {{var val = town.getType().water;}}
                {{?val}}
                    <span 
						class="adviserIcon -type-water{{=val}}" 
						data-title="{{?val==1}}1 водный квартал{{??val==2}}2 водных квартала{{??val==3}}3 водных квартала{{??}}4 водных квартала{{?}}">
                    </span>
                    <a class="cAdv-towns-filter" data-field="terrWater" data-val="{{=val}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col7 cAdv-towns-filter-wrp">
                {{var val = town.getType().hill;}}
                {{?val == 3}}
                    <span class="adviserIcon -type-hill" data-title="Дополнительные холмовые кварталы"></span>
                    <a class="cAdv-towns-filter" data-field="terrHill" data-val="{{=val}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col8 cAdv-towns-filter-wrp">
                <span class="adviserIcon -type-clim{{=town.climate-1}}" data-title="Климат города — {{=Tile.climate[town.climate].title}}"></span>
                <a class="cAdv-towns-filter" data-field="climate" data-val="{{=town.climate}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col9 cAdv-towns-filter-wrp">
                {{? !town.deposit.isEmpty()}}
                    <div class="nobr">
                        <span class="adviserIcon -type-depClim{{=town.deposit.getClimate()-1}}" data-title="Климат колонии — {{=Tile.climate[town.deposit.getClimate()].title}}"></span>
                        
						{{=snip.depositLink(town.deposit)}}
                    </div>
                    <a class="cAdv-towns-filter -type-left" data-field="deposit" data-val="{{=town.deposit.id}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col10">
                {{@town.deposit.getRes().getList(): res}}
                    <span class="cAdv-towns-filter-wrp">
                        {{=snip.resBig(res)}}
                        <a class="cAdv-towns-filter" data-field="depRes" data-val="{{=res.getId()}}">
                            <span class="adviserIcon -type-filter"></span>
                        </a>
                    </span>
                {{@}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col11 cAdv-towns-filter-wrp">
                {{=snip.pop(town.pop)}}
                <a class="cAdv-towns-filter" data-field="pop">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col12 cAdv-towns-filter-wrp">
                {{?town.armypop}}{{=snip.pop(town.armypop)}}{{?}}
                <a class="cAdv-towns-filter" data-field="army">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col13 cAdv-towns-filter-wrp">
                {{?town.wonder}}
                    
                    {{=snip.buildLink(town.wonder, snip.slotName(town.wonder, {level: true, lenLim: 80}))}}
                    
                    <a class="cAdv-towns-filter -type-left" data-field="wonder" data-val="{{=town.wonder.id}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col14 cAdv-towns-filter-wrp">
                {{?town.ad}}
                    {{=town.ad}}
                {{?}}
                <a class="cAdv-towns-filter" data-field="aad">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col15 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-comment -lenLim" 
                        data-title="{{?town.comment}}Открыть комментарий{{??}}Добавить комментарий{{?}}">
                    {{=town.comment||'…'}}
                </a>
            </div>
        </div>
    {{@}}
</script>

<script type="text/plain" id="countryAdviser.town.comment">
    <div style="font-weight: bold;">Комментарий</div>
    <textarea style="max-width: 100%; width: 100%; height: 80px;">{{=it.comment}}</textarea>
</script>
    
<script type="text/plain" id="countryAdviser.town.filter">
    {{@it.list: field: fieldName}}
        <div class="cAdv-towns-filter-block">
            {{?field.range}}
                <a class="cAdv-towns-filter" data-field="{{=fieldName}}">
                    {{?fieldName == 'dist'}}{{=snip.ruler()}}
                    {{??fieldName == 'pop'}}НАС.{{=snip.pop()}}
                    {{??fieldName == 'army'}}АРМ.{{=snip.pop()}}
                    {{??fieldName == 'aad'}}AAD.{{=snip.pop()}}
                    {{?}}
                    {{=field.min}} - {{=field.max}}
                </a>
            {{??}}
                {{?fieldName == 'control'}}Избранный
                {{??fieldName == 'spec'}}Специализация
                {{??fieldName == 'terrWater'}}Вода
                {{??fieldName == 'terrHill'}}Холмы
                {{?}}
                {{@field: value}}
                    <a class="cAdv-towns-filter" data-field="{{=fieldName}}" data-val="{{=value.id||value}}">
                        {{?fieldName == 'control'}}<span class="adviserIcon -type-fav {{?value}}-active{{?}}"></span>
                        {{??fieldName == 'acc'}}{{=snip.acc(value)}}
                        {{??fieldName == 'spec'}}
							{{=snip.icon(snip.c.townSpec, 'townSpec' + (Math.min(value, tblCountryAdviserTown.townSpecNormalCount)))}}
                        {{??fieldName == 'town'}}{{=snip.town(value)}}
                        {{??fieldName == 'terrWater'}}<span class="adviserIcon -type-water{{=value}}"></span>
                        {{??fieldName == 'terrHill'}}<span class="adviserIcon -type-hill"></span>
                        {{??fieldName == 'climate'}}<span class="-nobr"><span class="adviserIcon -type-clim{{=value-1}}"></span>{{=Tile.climate[value].title}}</span>
                        {{??fieldName == 'deposit'}}{{=snip.deposit(value)}}
                        {{??fieldName == 'depRes'}}{{=snip.resBigName(value)}}
                        {{??fieldName == 'wonder'}}{{=snip.slotName(value)}}
                        {{?}}
                    </a>
                {{@}}
            {{?}}
        </div>
    {{@}}
</script>

<script type="text/plain" id="countryAdviser.town.filterPeriod">
    <div class="cAdv-towns-filterRange">
        <div class="cAdv-towns-filterRange-back"></div>
        <div class="sliderRange cAdv-towns-filterRange-slider">
            <a class="ui-slider-handle"><span class="cAdv-towns-filterRange-val -type-min"></span></a>
            <a class="ui-slider-handle"><span class="cAdv-towns-filterRange-val -type-max"></span></a>
        </div>
        <br>
        <button class="button1">Ок</button>
    </div>
</script>

<script type="text/plain" id="countryAdviser.view.res">
    <div class="countryAdviser-res">
        <div class="tbl tbl-cAdv-res">
            <div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-th cAdv-res-col1">{{=snip.btnTable('res', 'Ресурс')}}</div>
                    <div class="tbl-th cAdv-res-col2">{{=snip.btnTable('prod', 'Производство')}}</div>
                    <div class="tbl-th cAdv-res-col3">{{=snip.btnTable('pop', 'Потребление населением')}}</div>
                    <div class="tbl-th cAdv-res-col4">{{=snip.btnTable('army', 'Расход на армию и строения')}}</div>
                    <div class="tbl-th cAdv-res-col5">{{=snip.btnTable('fuel', 'Ускорение снабжения')}}</div>
                    <div class="tbl-th cAdv-res-col6">{{=snip.btnTable('total', 'Итог')}}</div>
                </div>
            </div>
            <div class="tbl-tbody cAdv-town-table-data" style="max-height:450px"></div>
        </div>
        <p class="aC">Информация по производству и потреблению ресурсов в {{=snip.countryLink(wofh.country)}} в час.</p>
    </div>
</script>

<script type="text/plain" id="countryAdviser.res.table">
    {{@it.list: res}}
        <div class="tbl-tr">
            <div class="tbl-td cAdv-res-col1"><div class="sep">{{=snip.resBig(res)}}</div></div>
            <div class="tbl-td cAdv-res-col2"><div class="sep">{{=snip.defVal(utils.stages(res.inc), res.inc)}}</div></div>
            <div class="tbl-td cAdv-res-col3"><div class="sep">{{=snip.defVal(utils.stages(res.cons), res.cons)}}</div></div>
            <div class="tbl-td cAdv-res-col4"><div class="sep">{{=snip.defVal(utils.stages(res.dec), res.dec)}}</div></div>
            <div class="tbl-td cAdv-res-col5"><div class="sep">{{=snip.defVal(utils.stages(res.fuel), res.fuel)}}</div></div>
            <div class="tbl-td cAdv-res-col6"><div class="sep">{{=utils.stages(res.total)}}</div></div>
        </div>
    {{@}}
</script>

<script type="text/plain" id="countryAdviser.view.stat">
    <div class="cAdv-stat-graphsWrp">
        <div class="cAdv-stat-timeSelect">
            <span class="cAdv-stat-period"></span>
        </div>
		
        {{var hideEmpty = ls.getCountryAdvEmptyBtn(0);}}
		
        <a class="cAdv-stat-hideEmpty fakelink bgLight {{?hideEmpty == 0}}-hidden{{?}}">Скрыть пустые</a>
        <a class="cAdv-stat-hideEmpty fakelink bgLight {{?hideEmpty == 1}}-hidden{{?}}">Показать пустые</a>
		
		<div class="cAdv-stat-graphs-wrp">
			<svg height="300" width="920" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative;" id="svgintro" class="cAdv-stat-graphs">
				<defs>
					<linearGradient id="grad1" x1="0" y1="0" x2="0" y2="100%">
						<stop offset="0%" style="stop-color:rgb(255,0,0); stop-opacity:1"></stop>
						<stop offset="100%" style="stop-color:rgb(255,0,0); stop-opacity:0"></stop>
					</linearGradient>
				</defs>
			</svg>
		</div>
    </div>
    <div class="cAdv-stat-btns">
        <div class="cAdv-stat-btns-col">
            {{?wofh.country && (wofh.account.isAdviser() || wofh.account.isHead()) && it.id == wofh.country.id}}
                {{=tmplMgr.countryAdviser.stat.btn({field: 'knowledge', title: 'Вложение знаний'})}}
            {{?}}
            {{=tmplMgr.countryAdviser.stat.btn({field: 'pop', title: 'Население городов'})}}
            {{=tmplMgr.countryAdviser.stat.btn({field: 'towns', title: 'Количество городов'})}}
            {{=tmplMgr.countryAdviser.stat.btn({field: 'accounts', title: 'Количество игроков'})}}
			
			{{?wofh.country && (wofh.account.isAdviser() || wofh.account.isHead() || wofh.account.isMarshal() || wofh.account.isEconomist()) && it.id == wofh.country.id}}
				{{=tmplMgr.countryAdviser.stat.btn({field: 'train', title: 'Финансовые затраты на обучение войск'})}}
			{{?}}
        </div>
        {{?wofh.country && (wofh.account.isAdviser() || wofh.account.isHead()) && it.id == wofh.country.id}}
            <div class="cAdv-stat-btns-col">
                {{=tmplMgr.countryAdviser.stat.btn({field: 'resinc', title: 'Общее производство'})}}
                <a class="cAdv-stat-btn -type-toggle button3" data-field="res">
                    <span class="cAdv-stat-btnIcon -type-res" data-title="По ресурсам"></span>
                </a>
            </div>
            <div class="cAdv-stat-btns-resWrp"></div>
        {{?}}
        {{?wofh.country && (wofh.account.isAdviser() || wofh.account.isHead() || wofh.account.isGeneral()) && it.id == wofh.country.id}}
            <div class="cAdv-stat-btns-col">
                {{=tmplMgr.countryAdviser.stat.btn({field: 'army', title: 'Армия в населении'})}}
                <a class="cAdv-stat-btn -type-toggle button3" data-field="unit" data-title="По войскам">
                    <span class="cAdv-stat-btnIcon -type-unit"></span>
                </a>
            </div>
            <div class="cAdv-stat-btns-unitWrp-scroll">
                <div class="cAdv-stat-btns-unitWrp"></div>
            </div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="countryAdviser.stat.popup">
    <div class="cAdv-stat-popup" style="border-color: {{=it.color}}">
        <div class="cAdv-stat-popup-icon">
            <span class="cAdv-stat-btnIcon -type-{{=it.field}}"></span>
        </div>
        <div>
            <b>
                {{?it.field == 'accounts'}}Количество игроков
                {{??it.field == 'towns'}}Количество городов
                {{??it.field == 'pop'}}Население городов
                {{??it.field == 'knowledge'}}Вложение знаний
                {{??it.field == 'army'}}Армия в населении
                {{??it.field == 'resinc'}}Общее производство
				{{??it.field == 'train'}}Финансовые затраты на обучение войск
                {{?}}
            </b>
        </div>
        <div>{{=timeMgr.fMoment(it.time)}}</div>
        <div>
            {{?it.field == 'accounts'}}{{=snip.accIcon()}}
            {{??it.field == 'towns'}}{{=snip.townIcon()}}
            {{??it.field == 'pop'}}{{=snip.pop()}}
            {{??it.field == 'knowledge'}}{{=snip.resBig(Resource.ids.science)}}
            {{??it.field == 'army'}}{{=snip.pop()}}
            {{??it.field == 'res'}}{{=snip.resBig(it.param)}}
            {{??it.field == 'unit'}}{{=snip.unitIcon(it.param)}}
			{{??it.field == 'train'}}{{=snip.res(Resource.ids.money)}}
            {{?}}
            {{=utils.stages(utils.toInt(it.val))}}
        </div>
    </div>
</script>

<script type="text/plain" id="countryAdviser.stat.addBtns">
    {{var cnt = 0;}}
    {{@it.listAll.getList(): elem}}
        {{?cnt%6 == 0}}<div class="cAdv-stat-btns-col">{{?}}
        {{=tmplMgr.countryAdviser.stat.btn({field: it.type, param: elem.getId(), icon: (it.type=='unit'? snip.unitIcon(elem) : snip.resBig(elem)), disabled: !it.list.hasElem(elem)})}}
        {{?cnt%6 == 5 || cnt == it.listAll.getLength()-1}}</div>{{?}}
        {{cnt++;}}
    {{@}}
</script>

<script type="text/plain" id="countryAdviser.stat.btn">
    <a class="cAdv-stat-btn -type-graph button3 {{?it.disabled}}-disabled{{?}}" data-field="{{=it.field}}" {{?it.title}}data-title="{{=it.title}}"{{?}} {{?typeof(it.param) != 'undefined'}}data-param="{{=it.param}}"{{?}}>
        <span class="button3-wrp">
            {{?it.icon}}{{=it.icon}}
            {{??}}<span class="cAdv-stat-btnIcon -type-{{=it.field}}"></span>
            {{?}}
        </span>
    </a>
</script>
    
    
<script type="text/plain" id="countryInfo.header">
    Страна  {{=snip.wrp('countryInfo_title')}}
</script>

<script type="text/plain" id="countryInfo">
	<div class="view-countryInfo">
		<div class="countryInfo-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="countryInfo.view">
	<table class="s-tbl tbl-countryInfo tbl-countryInfo-info">
		<tbody>
			{{=tmplMgr.countryInfo.info(it)}}
		</tbody>
	</table>
	
	<br>
	
	<div class="js-scroll-wrp js-outside-scroll" style="max-height: {{=Math.max(utils.getWindowHeight(-270, 0), 300)}}px;">
		<table class="s-tbl tbl-countryInfo tbl-countryInfo-ally">
			<colgroup>
				<col class="tbl-countryInfo-ally-col1">
				<col class="tbl-countryInfo-ally-col2">
			</colgroup>
			
			<thead>
				<tr>
					<th>Союзники</th>
					<th>Враги</th>
				</tr>
			</thead>
			<tbody>
				<tr class="trow_cnt">
					<td class="aC">
						<div class="dIB aL">
							{{@it.country.relations: rel}}
								{{?rel.relation == Tile.relation.ally && rel.country.isActive()}}
									<div>{{=snip.countryLink(rel.country)}}</div>
								{{?}}
							{{@}}
						</div>
					</td>
					<td class="aC">
						<div class="dIB aL">
							{{@it.country.relations: rel}}
								{{?rel.relation == Tile.relation.enemy && rel.country.isActive()}}
									<div>{{=snip.countryLink(rel.country)}}</div>
								{{?}}
							{{@}}
						</div>
					</td>
				</tr>
			</tbody>
		</table>

		<br>

		<table class="s-tbl tbl-countryInfo tbl-countryInfo-acc">
			<colgroup>
				<col class="tbl-countryInfo-acc-col1">
				<col class="tbl-countryInfo-acc-col2">
				<col class="tbl-countryInfo-acc-col3">
				<col class="tbl-countryInfo-acc-col4">
				<col class="tbl-countryInfo-acc-col5">
				<col class="tbl-countryInfo-acc-col6">
			</colgroup>
			<thead>
				<tr>
					<th class="aL"></th>
					<th class="aR">№</th>
					<th class="aL"><span data-title="Игрок"><img class="icon_player middle" src="https://test.waysofhistory.com/img/_.gif"> <span data-title="Количество игроков в стране">{{=it.country.accountsList.length}}</span></span></th>
					<th class="aL">
						<span data-title="Население (среднее население на игрока)">
							<span class="nobr">
								<img class="res rp" src="https://test.waysofhistory.com/img/_.gif"> {{=utils.formatNum(it.country.pop, {int: true, stages: true})}}
							</span>
							 
							<span class="nobr">
								({{=utils.formatNum(it.country.pop/it.country.accountsList.length, {int: true, stages: true})}}/<img class="icon_player middle" src="https://test.waysofhistory.com/img/_.gif">)
							</span>
						</span>
					</th>
					<th class="aR"><span data-title="Количество городов"><img class="icon_town middle" src="https://test.waysofhistory.com/img/_.gif"> {{=utils.toInt(it.country.towns)}}</span></th>
					<th class="aR">
						<span data-title="Среднее население на город">
							<img class="res rp" src="https://test.waysofhistory.com/img/_.gif">/<img class="icon_town middle" src="https://test.waysofhistory.com/img/_.gif">
							 
							<span class="nobr">
								{{=utils.formatNum(it.country.pop/it.country.towns, {int: true, stages: true})}}
							</span>
						</span>
					</th>
				</tr>
			</thead>
			<tbody>
				{{@it.country.accountsList: account: accountPos}}
					<tr class='trow{{=accountPos%2}}'>
						<td>{{=snip.postsIcon(account.power)}}</td>
						<td class="aR">{{=+accountPos+1}}</td>
						<td class="aL">{{=snip.accLink(account)}}</td>
						<td class="aL">{{=utils.stages(utils.toInt(account.pop))}}</td>
						<td class="aR">{{=account.towns}}</td>
						<td class="aR">{{=utils.stages(utils.toInt(account.pop/account.towns))}}</td>
					</tr>
				{{@}}
			</tbody>
		</table>
	</div>
</script>

<script type="text/plain" id="countryInfo.info">
	<tr>
		<td class="countryInfo-info-flag vaT">
			<span class="aC">{{=snip.countryFlag(it.country, {flag:'biggest'})}}</span>
		</td>
		
		<td class="countryInfo-info-desc vaT aC">
			<div class="countryInfo-info-descText js-scroll-wrp">{{=TextParser.prepare(it.country.about)}}</div>
		</td>
		
		<td class="countryInfo-info-actions vaT aR">
			{{=tmplMgr.countryInfo.info.actions(it)}}
		</td>
	</tr>
</script>

<script type="text/plain" id="countryInfo.info.actions">
	<div style="font-size: 0;">
		<a class="mapButton -type-stat" href="{{=HashMgr.getHref('#/countryAdviser/'+it.country.id)}}"></a>
		{{?it.country.showAllyBtn}}
			<a class="mapButton -type-ally" data-title="Включить в союз"></a>
		{{?}}
		{{?wofh.account.isAdmin()}}
			<a href="{{=hashMgr.getTownHref(it.head.townslist[0], it.head.id)}}">
				<span class="mapButton -type-enter fR" data-title="Войти под этим игроком"></span>
			</a>
		{{?}}
	</div>

	{{?wofh.country && wofh.country.id != it.country.id && wofh.account.isHead()}}
		{{var relation = wofh.country.relations[it.country.id];}}
		{{?relation}}
			{{?relation == Tile.relation.ally}}
				<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.none}}">- Союзники</a>
			{{??}}
				<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.ally}}">+ Союзники</a>
			{{?}}
			<br>
			{{?relation == Tile.relation.enemy}}
				<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.none}}">- Враги</a>
			{{??}}
				<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.enemy}}">+ Враги</a>
			{{?}}
		{{??}}
			<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.ally}}">+ Союзники</a>
			<br>
			<a class="button1 setdiplomacy" href="#setdiplomacy" data-diplomacy="{{=Tile.relation.enemy}}">+ Враги</a>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="countryInfo.allys">
	<form id="joinAlly">
		Включить в <br>
		<select class="mb05 select1">
			{{~it: ally}}
				<option value="{{=ally.id}}">{{=ally.name}}</option>
			{{~}}
		</select>
	</form>
</script><script type="text/plain" id="countryNew.header">
    Страна
</script>

<script type="text/plain" id="countryNew">
	<div class="view-countryNew">
		<div class="countryNew-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="countryNew.view">
	{{
		var timeJoin = wofh.account.getNewCountryMoment();
		var canJoin = timeJoin <= timeMgr.getNow();
	}}
	
	<div class="countryWrp">
		<div class="countryCont">
			<div class="bgd pad cNew-contTop">
				<div class="cNew-img"></div>
				<div>
					Ты можешь создать свою страну и пригласить туда единомышленников<br>или вступить в уже существующую.<br><br>
					Создать новую страну можно в любом действующем {{=snip.buildLink(new Slot(Slot.ids.embassy).getAlternate(), !wofh.account.race.is(Race.ids.africa)? 'Посольстве': 'Мохоро Вождей')}} в твоем городе. {{?wofh.account.diplomacy>0 && canJoin}}Или прямо здесь и сейчас.{{?}}
				</div>
				{{?canJoin}}
					{{?wofh.account.diplomacy>0}}
						<form class="cNew-form">
							<div class="m10">
								{{=snip.input1({cls: 'cNew-input', maxlength: 25, name: 'name', placeholder: 'Название твоей страны'})}}
							</div>
							
							<button class="cNew-button button1 -type-green -disabled">Создать новую страну</button>
						</form>
					{{?}}
				{{??}}
					<br>
					<div class="-warn">{{=snip.alert()}} Создание страны возможно через {{=snip.timer(timeJoin, 'dec')}}</div>
				{{?}}
			</div>
			<div class="cNew-contBottom">
				<div>Чтобы вступить в уже существующую тебе необходимо получить приглашение от главы страны.</div>
				{{?!canJoin}}
					<br>
					<div class="-warn">{{=snip.alert()}} Но сделать ты это сможешь только через {{=snip.timer(timeJoin, 'dec')}}</div>
				{{?}}
				{{?utils.sizeOf(it.invites) > 0}}
					<div class="cNew-invite-title">Твои текущие приглашения</div>
					{{=tmplMgr.countryJoinSelect.view(it)}}
				{{?}}

				<div>
					Подробнее о создании и вступлении прочти в разделе <a class="link" href="{{=HashMgr.getHref('#/help/country')}}">Страны</a> {{=snip.nobr(snip.icon(snip.c.smenu, 'hlp')+'Энциклопедии')}}.
				</div>
			</div>
		</div>
	</div>
</script>





<script type="text/plain" id="countryJoinSelect.header">
	Приглашения в страны
</script>

<script type="text/plain" id="countryJoinSelect">
	<div class="countryJoinSelect-view-wrp"></div>
</script>

<script type="text/plain" id="countryJoinSelect.view">
	<div class="cNew-invite-block">
		{{@it.invites: invite}}
			<div class="panel2 cNew-invite-item" data-id="{{=invite.id}}">
				{{=snip.countryFlag(invite, {flag: 'big'})}}
				<div class="cNew-invite-item-text">
					<div style="font-weight: bold"> {{=snip.lenlim(snip.country(invite, {flag: false}), {lenLim:145})}}</div>
					<div>
						{{=snip.nobr(snip.accIcon()+invite.players)}}&nbsp;
						{{=snip.nobr(snip.townIcon()+invite.towns)}}&nbsp;
						{{=snip.pop(invite.pop)}}
					</div>
					<div class="button6 -type-blue cNew-invite-item-button">
						<span class="iconButton6 -type-ok">
					</div>
				</div>
			</div>
		{{@}}
	</div>
</script>





<script type="text/plain" id="countryJoin.header">
	Приглашение в страну
</script>

<script type="text/plain" id="countryJoin">
	<div class="countryJoin-view-wrp"></div>
</script>

<script type="text/plain" id="countryJoin.view">
	{{
		var timeJoin = wofh.account.getNewCountryMoment();
		var canJoin = timeJoin <= timeMgr.getNow();
	}}
	
	<div style="width: 350px; padding: 10px;">
		<div>
			{{=snip.countryFlag(it.country, {flag: 'bigger'})}}
			<div style="display: inline-block; margin-left: 10px;">
				<div>{{=snip.accLink(it.head)}}</div>
				<div>{{=snip.postIcon(Country.postIds.head)}} Глава страны</div>
				<div>{{=snip.countryLink(it.country)}}</div>
				<div>
					{{=snip.nobr(snip.accIcon()+it.country.players)}}&nbsp;
					{{=snip.nobr(snip.townIcon()+it.country.towns)}}&nbsp;
					{{=snip.pop(it.country.pop)}}
				</div>
			</div>
		</div>
		<div style="margin: 10px;">
			Предлагает тебе вступить в свою страну.<br><br>
			Учти, что после этого ты сможешь присоединиться к другой стране только через {{=timeMgr.fPeriod(lib.country.jointime)}}
		</div>
		<div>
			<button class="{{?canJoin}}cJoin-accept{{??}}-disabled{{?}} button1 -type-green">Принять предложение</button>&nbsp;&nbsp;
			<button class="cJoin-reject button1">Отвергнуть</button>
		</div>
	</div>
</script>

<script type="text/plain" id="countryJoin.reject">
	Ты действительно отказываешься от приглашения в {{=snip.countryLink(it.country)}}?<br>
	Или быть может ты хочешь пока отложить решение?
</script>
<script type="text/plain" id="countrySpace.header">
    Космическая программа
</script>

<script type="text/plain" id="countrySpace">
    <div class="view-countrySpace">
		<div class="countrySpace-view-wrp"></div>
    </div>
</script>

<script type="text/plain" id="countrySpace.view">
	<div>
		{{?it.win}}
			<div class="countrySpace-win-title">Наш космический корабль вышел на курс</div>
			<form class="countrySpace-win">
				<div class="countrySpace-win-text">
					Это — беспримерная победа человека над силами природы, величайшее завоевание науки и техники, торжество человеческого разума.<br>
					Положено начало завоевания человеком космического пространства.<br>
					В этом подвиге, который войдет в века, воплощены гений нашего народа, могучая сила нашей великой страны.<br>
					Честь и слава рабочему классу, простому крестьянству, непобедимым воителям, всему нашему народу!<br>
					Честь и слава, ученым, инженерам и техникам — создателям космического корабля!<br>
					/*
						lib.mode.winmode == 0 - обычная победа;
						lib.mode.winmode == 1 - победа по очкам рейтинга;
						lib.mode.winmode == 2 - нельзя победить.
					*/
					{{?lib.mode.winmode == 0}}
						В этот торжественный день мы обращаемся к народам и правительствам всех стран мира с прощальным словом: 
					{{?}}
				</div>

				{{?lib.mode.winmode == 0}}
					<textarea name="message" class="countrySpace-win-message" maxlength="{{=lib.spaceship.maxtextlen}}"></textarea>
					<div class="countrySpace-win-hint">Запрещено упоминание конкретных игроков и стран, не относящихся к победителям. Запрещено упоминание любых объединений стран. Данный текст будет промодерирован администрацией.</div>
				{{?}}

				<button class="button5 js-button-win">Поехали!</button>
			</form>
		{{??}}
			{{?it.otherShips.length}}
				<div class="tbl space-tbl">
					<div class="tbl-thead">
						<div class="tbl-tr">
							<div class="tbl-td space-tbl-col-icon"></div>
							<div class="tbl-td space-tbl-col-time">Запуск состоялся </div>
							<div class="tbl-td space-tbl-col-status">Статус</div>
						</div>
					</div>
					
					<div class="tbl-tbody">
						{{@it.otherShips: ship}}
							<div class="tbl-tr">
								<div class="tbl-td space-tbl-col-icon">
									{{=snip.icon(snip.c.tabIcon, 'space', false, false, '-type-small')}}
								</div>
								<div class="tbl-td space-tbl-col-time">
									{{=timeMgr.fMoment(ship.time)}}
								</div>
								<div class="tbl-td space-tbl-col-status">
									{{?ship.status == Build.spaceship.win}}
										<span style="color: green">Курс стабилен</span>
									{{??ship.status == Build.spaceship.lost}}
										<span style="color: grey">Связь потеряна</span>
									{{?}}
								</div>
							</div>
						{{@}}
					</div>
				</div>
			{{?}}
			
			{{?it.goesShips.length}}
				<div class="countrySpace-procc-mmc">
					<div class="countrySpace-procc-mmc-text">
						Действующие<br>
						Центры управления полетами<br>
						страны
					</div>

					{{=snip.slotFrame2(new Slot(Slot.ids.mcc, lib.build.maxlevel))}}

					<span class="countrySpace-procc-mmc-count">
						x{{=wofh.country.getMccCount()}}
					</span>
				</div>

				<div class="countrySpace-procc-time-title">Стабилизация курса всех наших стартовавших Космических кораблей будет через:</div>

				{{@it.goesShips: spaceship}}
					<div class="countrySpace-procc-time-timer">{{=snip.timer(spaceship.time+lib.spaceship.launchtime, 'dec')}}</div>
				{{@}}
			{{?}}
		{{?}}
	</div>
</script><script type="text/plain" id="economics.header">
    Городское управление и контроль
</script>

<script type="text/plain" id="economics">
    <div class="view-economics">
		<div class="tabs tabs-wrp"></div>
		
		{{=tmplMgr.economics.stats(it)}}
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="economics.stats">
	<div class="economics-stats-block">
		<table class="economics-stats-tbl">
			<tr>
				<td>
					<span class="lenLim">
						<span class="economics-stats-hint" data-title="Эффективность труда зависит только от численности работающего населения">Эффективность:</span>
						 
						<span class="economics-stats-hint" data-title="{{=utils.toPercent(it.efficiency, 2)}}%">{{=utils.toPercent(it.efficiency)}}%</span>
					</span>
				</td>
				<td class="economics-stats-sep">
					<span class="lenLim">
						<span class="economics-stats-hint" data-title="Зависит от числа городов и суда">Коррупция:</span>
						 
						<span class="economics-stats-hint" data-title="{{=utils.toPercent(it.corruptionData.corruption, 2)}}%">
							{{?it.corruptionData.punish > 0}}
								{{=utils.toPercent(it.corruptionData.corruption)}}% +<a title="Наказание" style="color:#fff">{{=utils.toPercent(it.corruptionData.punish)}}</a>
							{{??}}
								{{=utils.toPercent(it.corruptionData.corruption)}}
							{{?}}%
						</span>
					</span>
				</td>
				<td class="economics-stats-sep">
					{{?it.canSubmit}}
						<span class="lenLim">
							<span class="economics-stats-hint" data-title="Количество возможных к потреблению ресурсов в этом городе">Потребляемо:</span>
							 
							{{=it.consumption}}
							 
							 рес.
						</span>
					{{?}}
				</td>
                <td class="economics-strength-wrp economics-stats-sep"></td>
			</tr>
		</table>
	</div>
</script>

<script type="text/plain" id="economics.strength">
    <span class="lenLim">
        {{var  strength = wofh.town.calcStrength();}}
        <span class="economics-stats-hint" data-title="Суммарная прочность всех зданий города">Прочность города:</span>
         
        <span class="economics-stats-hint" data-title="{{=utils.formatNum(strength, {stages: true})}}">{{=utils.formatNum(strength, {KM: true, stages: true, int: true})}}</span>
    </span>
</script>
                        
<script type="text/plain" id="economics.rule">
	<div>
        <div class="rule-townRename-wrp"></div>
        
        <div class="rule-budget-wrp"></div>
	</div>
</script>

<script type="text/plain" id="economics.rule.townRename">
    <form class="economics-rule-rename">
        {{?debug.isTest('later')}}
            {{=snip.button('R', {cls: 'economics-rule-random-btn'})}}
        {{?}}

        <span class="input-blinkWrp">
            {{?Quest.isActive(Quest.ids.townRename)}}
                <span class="input-blink -anim-blink"></span>
            {{?}}

            {{=snip.input1({cls: 'economics-rule-rename-name -type-big', value: wofh.town.getName(), maxlength: lib.town.namelimit[1]})}}
        </span>

        <button class="button1 -type-green economics-rule-rename-btn">Переименовать</button>

        {{?!wofh.account.canMessage()}}
             {{=snip.alert(snip.alertTmpl.blocked.message())}}
        {{?}}
    </form>
</script>

<script type="text/plain" id="economics.stock">
	<form>
		{{var table = tblEconomicsStock.getTableLayout();}}
		
		{{=table({cls: 'tbl-econ-stock'})}}
			{{=table.thead()}}
				{{=table.tr()}}
					{{=table.th({cls: 'econ-stock-col0'})}}Ресурс{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col1'})}}Запас{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col2'})}}Добыча{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col3'})}}Расход{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col4'})}}Снабжение{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col5'})}}Прибыль{{=table.th.end()}}
					{{=table.th({cls: 'econ-stock-col6'})}}Эффект{{=table.th.end()}}
				{{=table.tr.end()}}
			{{=table.thead.end()}}
			{{=table.tbody({style: 'max-height: ' + utils.getWindowHeight(-300) + 'px;'})}}{{=table.tbody.end()}}
		{{=table.end()}}
		
		<br>
		<b>Приоритет использования ресурсов роста в качестве пищи</b>
		<ul class="econ-main-feed">
			{{@wofh.town.stock.foodpriority: resId}}
				{{var res = new Resource(resId);}}
				<li class="econ-main-feedItem-wrp">
					<a class="econ-main-feedItem-sortBtn -type-left"></a>
					<a class="econ-main-feedItem" data-id="{{=res.getId()}}">
						<div class="econ-main-feedItem-icon">{{=snip.resBig(res)}}</div>
					</a>
					<a class="econ-main-feedItem-sortBtn -type-right"></a>
				</li>
			{{@}}
		</ul>
		<input type="hidden" name="acc" value="{{=wofh.account.id}}">
		
		<button class="button1" type="submit">Подтвердить</button>
		<br><br>
	</form>
</script>

<script type="text/plain" id="economics.table.stock">
	{{
		var table = tblEconomicsStock.getTableLayout();
		var td = table.td;
	}}
	
    {{@it.list: stockRes}}
		{{=table.tr()}}
			{{=td({cls: 'econ-cell econ-stock-col0'})}}{{=snip.resName(stockRes)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col1'})}}{{=snip.defVal(utils.formatNum(stockRes.getHas(), {stages: true, int: true}), utils.toInt(stockRes.getHas()))}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col2'})}}<div data-title="{{=utils.formatNum(stockRes.incom, {fixed:3})}}">{{=snip.coloredNum(stockRes.incom, {noPosSignColor: true, stages: true, int: true, sign: stockRes.incom < 1})}}</div>{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col3'})}}<div data-title="{{=utils.formatNum(stockRes.dec, {fixed:3})}}">{{=snip.coloredNum(stockRes.dec, {noPosSignColor: true, stages: true, int: true, sign: stockRes.dec > -1})}}</div>{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col4'})}}
				{{var streamRes = stockRes.stream, streamResFuel = false;}}
				
				{{?stockRes.streamfuel}}
					{{
						streamRes = stockRes.streaminc + stockRes.streamdec;
						streamResFuel = snip.coloredNum(stockRes.streamfuel, {stages: true, int: true, sign:true, negative:true, noZeroColor:true, signPostFix:snip.icon(snip.c.anyIcon, 'fuel', '', '', 'va-5')});
					}}
				{{?}}
				<span class="econ-stock-short-info">
					<span data-title="{{=utils.formatNum(streamRes, {mixed:true,fixed:3})}}">{{=snip.coloredNum(streamRes, {noPosSignColor: true, stages: true, int: true, sign: Math.abs(streamRes) < 1})}}</span>
					{{?streamResFuel}}
						{{=snip.nobr(streamResFuel)}}
					{{?}}
				</span>
				<span class="econ-stock-full-info">
					<span data-title="{{=utils.formatNum(stockRes.streamdec, {mixed:true,fixed:3})}}">{{=snip.coloredNum(stockRes.streamdec, {stages: true, int: true, sign:true, negative:true, noZeroColor:true})}}</span>
					<span data-title="{{=utils.formatNum(stockRes.streaminc, {mixed:true,fixed:3})}}">{{=snip.coloredNum(stockRes.streaminc, {stages: true, int: true, sign: true, positive:true, noZeroColor:true})}}</span>
					{{?streamResFuel}}
						<span data-title="{{=utils.formatNum(stockRes.streamfuel, {mixed:true,fixed:3})}}">
							{{=snip.nobr('(' + streamResFuel + ')')}}
						</span>
					{{?}}
				</span>
			{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col5'})}}<div data-title="{{=utils.formatNum(stockRes.updateHour, {fixed:3})}}">{{=snip.coloredNum(stockRes.updateHour, {noPosSignColor: true, stages: true, int: true, sign: Math.abs(stockRes.updateHour) < 1})}}</div>{{=td.end()}}
			{{=td({cls: 'econ-cell econ-stock-col6'})}}
				<div class="nobr">
                    {{? stockRes.calcEffect > 0 }}
                        {{? it.canSubmit && stockRes.effectType }}
                            <label>
								{{=snip.checkbox1({name: 'r'+stockRes.getId(), checked: stockRes.consBin == 1})}}
								
                                {{var stockResEffects = [];}}
                                
                                {{?stockRes.effectType == 1}}
                                    {{stockResEffects.push({type: '0', title: 'Рост', val: stockRes.calcEffect});}}
                                {{??stockRes.effectType == 2}}
                                    {{stockResEffects.push({type: '1', title: 'Культура', val: stockRes.calcEffect});}}
                                {{??stockRes.effectType == 3}}
                                    {{stockResEffects.push({type: '2', title: 'Знания', val: stockRes.calcEffect});}}
                                {{??stockRes.effectType == 4}}
                                    {{stockResEffects.push({type: '3', title: 'Промышленность', val: stockRes.calcEffect});}}
                                {{??stockRes.effectType == 5}}
                                    {{stockResEffects.push({type: '0', title: 'Рост', val: stockRes.calcEffect});}}
                                    {{stockResEffects.push({type: '2', title: 'Знания', val: Resource.getEffectType(stockRes.getId()) == Resource.types.grownScience ? utils.toPercent(Resource.getEffect_(stockRes.getId(), 2)) : 0});}}
                                {{?}}

                                {{~stockResEffects: effect: index}}
                                    {{?index}}<br>{{?}}<img src="https://test.waysofhistory.com/img/_.gif" class="consRes -type-{{=effect.type}}" data-title="{{=effect.title}}"> <span class="sp01">+{{=effect.val}}%</span>
                                {{~}}
                            </label>
                        {{?}}
                    {{?}}
                </div>
			{{=td.end()}}
		{{=table.tr.end()}}
    {{@}}
</script>



<script type="text/plain" id="economics.prod">
	{{
		var table = tblEconomicsProd.getTableLayout();
		var th = table.th;
	}}
	
	{{=table()}}
		{{=table.thead()}}
			{{=table.tr()}}
				{{=th({cls: 'econ-prod-col0'})}}Ресурс{{=th.end()}}
				{{=th({cls: 'econ-prod-col1'})}}<span class="econ-prod-th-text">{{=snip.title('ЗН', 'Население города занятое производством этого ресурса')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col2'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col3'})}}<span class="econ-prod-th-text">{{=snip.title('ЭС', 'Средняя эффективность труда строений')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col4'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col5'})}}<span class="econ-prod-th-text">{{=snip.title('ЭТ', 'Эффективность труда города')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col6'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col7'})}}<span class="econ-prod-th-text">{{=snip.title('БП', 'Базовое Производство')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col8'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col9'})}}<span class="econ-prod-th-text">{{=snip.title('КЗ', 'Бонус климатической зоны')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col10'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col11'})}}<span class="econ-prod-th-text">{{=snip.title('БН', 'Бонус Наук')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-spec-sep'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-spec'})}}<span class="econ-prod-th-text">{{=snip.title('ВГ', 'Великие граждане')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col12'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col13'})}}<span class="econ-prod-th-text">{{=snip.title('БУ', 'Бонус Удачи')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col14'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col15'})}}<span class="econ-prod-th-text">{{=snip.title('УМ', 'Улучшения местности')}}</span>{{=th.end()}}
				{{=th({cls: 'econ-prod-col16'})}}{{=th.end()}}
				{{=th({cls: 'econ-prod-col17'})}}Итог {{=th.end()}}
			{{=table.tr.end()}}
		{{=table.thead.end()}}
		{{=table.tbody({style: 'max-height: ' + utils.getWindowHeight(-100) + 'px;'})}}{{=table.tbody.end()}}
	{{=table.end()}}
</script>

<script type="text/plain" id="economics.prod.table">
	{{
		var roundFunc = it.roundFunc;
		var defVal = it.defVal;
		var dim = it.dim;
		var tmpVal;
		
		var table = tblEconomicsProd.getTableLayout();
		var td = table.td;
	}}
	
    {{@it.list : res }}
		{{=table.tr()}}
			{{=td({cls: 'econ-cell econ-prod-col0'})}}{{=snip.res(res)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col1'})}}<img class="res rp" src="https://test.waysofhistory.com/img/_.gif"><span class="dIB">{{= res.buildPop }}</span>{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col2'})}}*{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col3'})}}<span data-title="{{=roundFunc(res.averageEfficiency, 2) + dim}}">{{=roundFunc(res.averageEfficiency) + dim}}</span>{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col4'})}}*{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col5'})}}
				<span data-title="{{=roundFunc(res.workCorruptionEfficiency, 2) + dim}}">{{=roundFunc(res.workCorruptionEfficiency) + dim}}</span>
				
				{{tmpVal = roundFunc(res.scienceEffect);}}
				{{?tmpVal != defVal}} * {{=tmpVal + dim}}{{?}}
				
				{{tmpVal = roundFunc(res.raceBonus);}}
				{{?tmpVal != defVal}} * {{=tmpVal + dim}}{{?}}
			{{=td.end()}}
			
			{{tmpVal = roundFunc(res.incBase);}}
			{{=td({cls: 'econ-cell econ-prod-col6'})}}{{=snip.defVal('*', tmpVal, defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col7'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
			
			{{tmpVal = roundFunc(res.climateBonus);}}
			{{=td({cls: 'econ-cell econ-prod-col8'})}}{{=snip.defVal('*', tmpVal, defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col9'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
			
			{{tmpVal = roundFunc(res.scienceBonus);}}
			{{=td({cls: 'econ-cell econ-prod-col10'})}}{{=snip.defVal('*', tmpVal, defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col11'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
			
			{{tmpVal = roundFunc(res.specBonus);}}
			{{=td({cls: 'econ-cell econ-prod-spec-sep'})}}{{=snip.defVal('*', roundFunc(res.specBonus), defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-spec'})}}{{=snip.title(snip.defVal(roundFunc(res.specBonus, 1) + dim, roundFunc(res.specBonus), defVal), roundFunc(res.specBonus, 2) + dim)}}{{=td.end()}}
			
			{{tmpVal = roundFunc(res.luckBonus);}}
			{{=td({cls: 'econ-cell econ-prod-col12'})}}{{=snip.defVal('*', tmpVal, defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col13'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal, '-warn -type-blue')}}{{=td.end()}}
			
			{{tmpVal = roundFunc(res.mapBonus);}}
			{{=td({cls: 'econ-cell econ-prod-col14'})}}{{= snip.defVal('*', tmpVal, defVal)}}{{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col15'})}}
				{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}
				
				{{?res.mapBonusInc}}
					{{=' + ' + utils.formatNum(res.mapBonusInc, {int:true})}}
				{{?}}
			{{=td.end()}}
			
			{{=td({cls: 'econ-cell econ-prod-col16'})}}={{=td.end()}}
			{{=td({cls: 'econ-cell econ-prod-col17'})}}
				<span data-title="{{=utils.formatNum(res.total, {mixed: true, fixed: 2})}}">{{=utils.formatNum(res.total, {stages: true, int: true})}}</span>
				{{?res.wonderEffect != 0 }}+{{=res.wonderEffect}}{{?}}
			{{=td.end()}}
		{{=table.tr.end()}}
    {{@}}
</script>



<script type="text/plain" id="economics.pop">
	<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100)}}px">
		<div class="tbl">
			<div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-th">Население</div>
                </div>
            </div>
            
			<div class="tbl-tbody">
				<div class="tbl-tr tbl-paragraph">
					<div class="tbl-td econ-cell">Рост</div>
				</div>
                
				<div class="tbl-tr">
					<div class="tbl-td econ-cell tbl-col0">Базовый рост</div>
					<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.grownUpBase)}}  в день</div>
				</div>
                
				{{?it.grownUpScience > 0}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">Научные достижения</div>
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.grownUpScience)}}  в день</div>
					</div>
				{{?}}
                
				{{@it.grownUpBuilds : build}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">
							<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                {{=build.name}}{{?build.level}} уровень {{=build.level}}{{?}}
							</a>
						</div>
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(build.effect)}}  в день</div>
					</div>
				{{@}}
				<div class="tbl-tr fwB">
					<div class="tbl-td econ-cell tbl-col0">Итого</div>
					<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.grownUpSum)}}  в день</div>
				</div>
                
                {{?it.grownDownBuilds || it.grownDownImps}}
					<div class="tbl-tr tbl-paragraph">
						<div class="tbl-td econ-cell">Спад</div>
					</div>
                    
					{{@it.grownDownBuilds: build}}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">
								<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
									{{=build.name}} уровень {{=build.level}}
								</a>
							</div>
							<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(build.effect)}}  в день</div>
						</div>
					{{@}}
                    
					{{@it.grownDownImps: imp}}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">
								{{=imp.getName()}}
							</div>
							<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(imp.effectUngrown)}}  в день</div>
						</div>
					{{@}}

					<div class="tbl-tr fwB">
						<div class="tbl-td econ-cell tbl-col0">Итого</div>
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.grownDownSum)}}  в день</div>
					</div>
                {{?}}
                
                {{?it.grownConsSum}}
					<div class="tbl-tr tbl-paragraph">
						<div class="tbl-td econ-cell">Потребление ресурсов</div>
					</div>      
                    
					{{~it.grownConsRes : res}}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">{{=snip.resName(res)}}</div>
							<div class="tbl-td econ-cell tbl-col1">{{=utils.toPercent(res.getEffect())}}%</div>
						</div>
					{{~}}
                    
					<div class="tbl-tr fwB">
						<div class="tbl-td econ-cell tbl-col0">Итого</div>
						<div class="tbl-td econ-cell tbl-col1">{{=utils.toPercent(it.grownConsSum)}}%</div>
					</div>
                {{?}}
				
				<div class="tbl-tr tbl-paragraph">
					<div class="tbl-td econ-cell">Итоговый рост населения</div>
				</div>
				
				{{=tmplMgr.economics.pop.totalGrown(it)}}
				
				{{?it.growReal < 0}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell -warn">
							{{?it.town.pop.has > it.town.pop.culture}}Население достигло культурного предела. {{?}}Происходит спад населения: {{=snip.pop(utils.formatNum(it.growReal, {uFixed: 1}))}} в день
						</div>
					</div>
				{{?}}
            </div>
        </div>
		
		<br>
		
		<div class="tbl">
			<div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-th">Культура</div>
                </div>
            </div>
            
			<div class="tbl-tbody">
				<div class="tbl-tr">
					<div class="tbl-td econ-cell tbl-col0">Базовая культура</div>
                    
					<div class="tbl-td econ-cell tbl-col1">{{=utils.formatNum(it.cultBase, {int: true, stages: true})}}</div>
				</div>
                
				{{?it.cultScience > 0}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">Научные достижения</div>
                        
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.cultScience)}}</div>
					</div>
				{{?}}
                
				{{@it.cultBuild: build}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">
							<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
								{{=build.name}}{{?build.level}} уровень {{=build.level}}{{?}}
							</a>
						</div>
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(build.effect)}}</div>
					</div>
				{{@}}
                
				<div class="tbl-tr fwB">
					<div class="tbl-td econ-cell tbl-col0">Итого</div>
					<div class="tbl-td econ-cell tbl-col1">{{=utils.toInt(it.cultUpSum)}}</div>
				</div>
				
                {{?it.cultConsSum > 0}}
					<div class="tbl-tr tbl-paragraph">
						<div class="tbl-td econ-cell">Потребление ресурсов</div>
					</div>
                    
					{{~it.cultConsRes : res}}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">{{=snip.resName(res)}}</div>
							<div class="tbl-td econ-cell tbl-col1">{{=utils.toPercent(res.getEffect())}}%</div>
						</div>
					{{~}}
                    
					<div class="tbl-tr fwB">
						<div class="tbl-td econ-cell tbl-col0">Итого</div>
						<div class="tbl-td econ-cell tbl-col1">{{=utils.toPercent(it.cultConsSum)}}%</div>
					</div>
                {{?}}
                
				<div class="tbl-tr tbl-paragraph">
					<div class="tbl-td econ-cell">Общая культура</div>
				</div>
				
				{{=tmplMgr.economics.pop.totalCult(it)}}
            </div>
		</div>
	</div>
</script>

<script type="text/plain" id="economics.pop.totalGrown">
	{{=tmplMgr.economics.pop.totalGrown.header(it)}}

	{{=tmplMgr.economics.pop.totalGrown.body(it)}}
</script>

<script type="text/plain" id="economics.pop.totalGrown.header">
	{{var table = tabEconomicsPop.getTableLayout();}}
	
	{{=table.tr({cls: '-type-tightHeader fwB'})}}
		{{=table.th({cls: 'econ-money-col5'})}}Рост{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col5'})}}Раса{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col5'})}}Ресурсы{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col5'})}}Великие граждане{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col6'})}}Месторождение{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col6'})}}Улучшение местности{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col5'})}}Удача{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col5'})}}Спад{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col6'})}}Итого в день{{=table.th.end()}}
	{{=table.tr.end()}}
</script>

<script type="text/plain" id="economics.pop.totalGrown.body">
	{{
		var roundFunc = it.roundFunc;
		var defVal = it.defVal;
		var dim = it.dim;
		var tmpVal;
		
		var table = tabEconomicsPop.getTableLayout();
		var td = table.td;
	}}
	
	{{=table.tr()}}
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.fixedHint(it.grownUpSum)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.grownRace);}}
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.defVal(roundFunc(it.grownConsSum + 1) + dim, it.grownConsSum, 1)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.defVal(snip.title(roundFunc(it.grownSpec, 1) + dim, roundFunc(it.grownSpec, 2) + dim), it.grownSpec, 1, 'fakelink')}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.grownDeposit);}}
		{{=td({cls: 'econ-cell econ-money-col6'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.grownMap, 1);}}
		{{=td({cls: 'econ-cell econ-money-col6'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.grownLuck);}}
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}-{{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col5'})}}{{=snip.fixedHint(it.grownDownSum)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}={{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col6'})}}{{=snip.fixedHint(it.grownSum, false, false, {formatFunc: snip.coloredNum})}}{{=td.end()}}
	{{=table.tr.end()}}
</script>

<script type="text/plain" id="economics.pop.totalCult">
	{{=tmplMgr.economics.pop.totalCult.header(it)}}

	{{=tmplMgr.economics.pop.totalCult.body(it)}}
</script>

<script type="text/plain" id="economics.pop.totalCult.header">
	{{var table = tabEconomicsPop.getTableLayout();}}
	
	{{=table.tr({cls: '-type-tightHeader fwB'})}}
		{{=table.th({cls: 'econ-money-col2'})}}Культура{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col2'})}}Раса{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col2'})}}Ресурсы{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col2'})}}Великие граждане{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col4'})}}Улучшение местности{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col2'})}}Удача{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col3'})}}{{=table.th.end()}}
		{{=table.th({cls: 'econ-money-col2'})}}Итого{{=table.th.end()}}
	{{=table.tr.end()}}
</script>

<script type="text/plain" id="economics.pop.totalCult.body">
	{{
		var roundFunc = it.roundFunc;
		var defVal = it.defVal;
		var dim = it.dim;
		var tmpVal;
		
		var table = tabEconomicsPop.getTableLayout();
		var td = table.td;
	}}
	
	{{=table.tr()}}
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=utils.formatNum(it.cultUpSum, {int: true, mixed: true})}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.cultRace);}}
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=snip.defVal(roundFunc(it.cultConsSum + 1) + dim, it.cultConsSum, 1)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=snip.defVal(snip.title(roundFunc(it.cultSpec, 1) + dim, roundFunc(it.cultSpec, 2) + dim), it.cultSpec, 1, 'fakelink')}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.cultMap, 1);}}
		{{=td({cls: 'econ-cell econ-money-col4'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}*{{=td.end()}}
		{{tmpVal = roundFunc(it.cultLuck);}}
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}{{=td.end()}}
		{{=td({cls: 'econ-cell econ-money-col3'})}}={{=td.end()}}
		
		{{=td({cls: 'econ-cell econ-money-col2'})}}{{=utils.formatNum(it.cultSum, {int: true, mixed: true})}}{{=td.end()}}
	{{=table.tr.end()}}
</script>

<script type="text/plain" id="economics.money">          
	<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100)}}px">
		<div class="tbl">
			<div class="tbl-tbody">
				<div class="tbl-tr tbl-paragraph">
					<div class="tbl-td econ-cell">Доход</div>
				</div>
                
				{{? it.buildEssectsInc }}
					{{@it.buildEssectsInc: build}}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">
								<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
									{{=build.name}}{{?build.level}} ур. {{= build.level }}{{?}}
								</a>
							</div>
							<div class="tbl-td econ-cell tbl-col1">{{= build.effect }} в час</div>
						</div>
					{{@}}
				{{?}}
                
				{{? it.streaminc != 0 }}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">Снабжение</div>
						<div class="tbl-td econ-cell tbl-col1">{{=it.streaminc}} в час</div>
					</div>
				{{?}}
                
				{{? it.mapBonusInc }}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">УМ</div>
						<div class="tbl-td econ-cell tbl-col1">{{=snip.fixedHint(it.mapBonusInc)}} в час</div>
					</div>
				{{?}}
                
				<div class="tbl-tr fwB">
					<div class="tbl-td econ-cell tbl-col0">Итого</div>
					<div class="tbl-td econ-cell tbl-col1">{{=snip.resCount(Resource.ids.money, it.sGet)}} в час</div>
				</div>
				
				<div class="tbl-tr tbl-paragraph">
					<div class="tbl-td econ-cell">Расход</div>
				</div>

				<div class="tbl-tr">
					<div class="tbl-td econ-cell">
						Денежное содержание строений уменьшено на {{=utils.toPercent(it.economy, 1)}}%
					</div>
				</div>
				{{? it.streamdec != 0 }}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">Снабжение</div>
						<div class="tbl-td econ-cell tbl-col1">{{= it.streamdec }} в час</div>
					</div>
				{{?}}
				{{?it.lasVegas.effect != 0}}
					<div class="tbl-tr">
						<div class="tbl-td econ-cell tbl-col0">
							<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=it.lasVegas.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+it.lasVegas.id)}}">
								Лас-Вегас
							</a>
						</div>
						<div class="tbl-td econ-cell tbl-col1">{{= it.lasVegas.effect }} в час</div>
					</div>
				{{?}}
				{{?it.buildEssectsCons}}
					{{@ it.buildEssectsCons: build }}
						<div class="tbl-tr">
							<div class="tbl-td econ-cell tbl-col0">
								<a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
									{{=build.name}} ур. {{=build.level}}</div>
								</a>
							<div class="tbl-td econ-cell tbl-col1">{{= build.effect }} в час</div>
						</div>
					{{@}}
				{{?}}
				<div class="tbl-tr fwB">
					<div class="tbl-td econ-cell tbl-col0">Итого</div>
					<div class="tbl-td econ-cell tbl-col1">{{=snip.resCount(Resource.ids.money, it.sPay)}} в час</div>
				</div>
				
				<div class="tbl-tr fwB">
					<div class="tbl-td econ-cell">
						Итого {{=snip.resCount(Resource.ids.money, it.dGetPay) }} в час
					</div>
				</div>
			</div>
		</div>
	</div>
</script>



<script type="text/plain" id="economics.info">          
	<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100)}}px">
		<form class="econ-info-acc-block js-collectData" data-type="{{=tabEconomicsInfo.types.acc}}">
			<div class="econ-info-acc-title">Научное состояние игрока</div>
			
			<div class="econ-info-repLink-wrp"></div>
			
			<div class="econ-info-comment-wrp" data-type="{{=tabEconomicsInfo.types.acc}}">
				{{=tmplMgr.economics.info.comment({text: tabEconomicsInfo.getCommentText(tabEconomicsInfo.types.acc), noMargin: true})}}
			</div>
			
			<div class="econ-info-collectBtn-wrp"></div>
		</form>
		
		<div class="econ-info-towns-block">
			{{@it.towns: town: index}}
				{{=tmplMgr.economics.info.town({town: town, townInfo: it.townInfo, index: index})}}
			{{@}}
		</div>
		{{?debug.isTest('later')}}
			<div class="econ-info-visibleTowns bgLight">
				<a class="{{=snip.getFakelinkCls({type: 'green'})}}" href="{{=hashMgr.getWndHref('visibleTowns')}}">Информация о видимых городах</a>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="economics.info.town">
	<div class="econ-info-town-block" data-town="{{=it.town.id}}">
		<div class="econ-info-town-cont">
			<div class="econ-info-town-name bgDark">{{=snip.townLink(it.town)}}</div>
			<div class="econ-info-town">
				<div class="econ-info-townPosBlock">
					<span class="econ-info-townPos">{{=(+it.index + 1)}}</span>
				</div>
				{{=snip.townImg({town:it.town, showDeposit:true})}}
			</div>
			<form class="econ-info-townInfo-block -disabled js-collectData" data-index="{{=it.index}}" data-type="{{=tabEconomicsInfo.types.town}}">
				<div class="econ-info-townInfo">
					{{@it.townInfo: tInfo}}
						<div class="econ-info-townInfo-param-block">
							{{=snip.checkbox1({cls: 'js-econ-info-townInfo-param', attrs: {'data-paramtype': tInfo.paramType}, name: 'type'+tInfo.paramType, value: tInfo.paramType, checked: tabEconomicsInfo.isTownCollectedType(it.town.id, tInfo.paramType)})}}
							
							{{=snip.wrp('fakelink js-econ-info-townInfo-paramTowns', tInfo.text)}}
							
							{{?tInfo.subParam}}
								{{?tInfo.subParam.parent == 'army'}}
									{{=snip.checkbox1({wrpCls: 'econ-info-townInfo-subParam -type-armyType', cls: 'js-econ-info-townInfo-subParam', helperText: ['в городe', 'вся'], helperTextCls: 'fakelink', attrs: {'data-paramtype': tInfo.subParam.paramType, 'data-parent': tInfo.subParam.parent}, name: 'type'+tInfo.subParam.paramType, value: tInfo.subParam.paramType, checked: tabEconomicsInfo.isTownCollectedType(it.town.id, tInfo.subParam.paramType, true)})}}
								{{?}}
							{{?}}
						</div>
					{{@}}
					
					<div class="econ-info-townInfo-param-block econ-info-comment-wrp" data-type="{{=tabEconomicsInfo.types.town}}" data-town="{{=it.town.id}}">
						{{=tmplMgr.economics.info.comment({text: tabEconomicsInfo.getCommentText(tabEconomicsInfo.types.town, {townId: it.town.id})})}}
					</div>
				</div>
				<div class="econ-info-collectBtn-wrp"></div>
			</form>
		</div>
		<div class="econ-info-repLink-wrp"></div>
	</div>
</script>

<script type="text/plain" id="economics.info.collectBtn">
	{{?it.time > timeMgr.getNow()}}
		<span class="button1 -type-gold -disabled">{{=snip.timer(it.time, 'dec')}}</span>
	{{??it.needPremium}}
		<a class="button1 -type-gold js-econ-info-buyPremium">Включить Царь-Аккаунт</a>
	{{??}}
		<button class="button1 -type-gold {{?it.town}}-disabled{{?}}">Собрать данные</button>
	{{?}}
</script>

<script type="text/plain" id="economics.info.town.repLink">
	<div class="econ-info-town-repLink">
		{{=snip.clipboardWrp(tmplMgr.snipet.clipboard({tagText: snip.link(HashMgr.getHref('#/report/'+it.repId+'-'+it.repCode), 'Отчет', 'econ-info-town-repText bgLight link') + '<br><br>', tag:'r' + it.repId + '/' + it.repCode, onbr:true}))}}
	</div>
</script>

<script type="text/plain" id="economics.info.acc.repLink">
	<div class="econ-info-acc-repLink">
		{{=snip.clipboardWrp(tmplMgr.snipet.clipboard({tagText: snip.link(HashMgr.getHref('#/report/'+it.repId+'-'+it.repCode), 'Отчет', 'econ-info-town-repText bgLight link') + '&nbsp;', tag:'r' + it.repId + '/' + it.repCode}))}}
	</div>
</script>

<script type="text/plain" id="economics.info.comment">
	{{?!it.noMargin}}
		{{=snip.checkbox1({wrpCls: '-invis', disabled: true})}}
	{{?}}
	
	{{=snip.nobr(utils.lenLim('+'+(it.text||'Комментарий'), {length: 20}), 'a', 'econ-info-comment link' + (it.text?' fwB':''))}}
</script>


<script type="text/plain" id="economics.budget">
	<form class="view-budget">
		<div class="budget-title">Распределение населения</div>
		<div class="budget-cont">
			<div class="budget-pop">
                {{=tmplMgr.economics.budget.pop(it)}}
			</div>
			{{?it.list.isEmpty()}}
				<div>В городе нет научных зданий для выработки {{=snip.res(Resource.ids.science)}}знаний или производственных сооружений для добычи какого-либо иного ресурса, а значит нет и рабочих мест.<br>Поэтому ты не можешь пока распределить своё свободное население, ибо им негде работать...</div>
			{{??}}
				<ul class="budget-sliders">
					{{@it.list.getList(): res}}
						<li data-id="{{=res.getId()}}" class="budget-sldRow">
							{{?Ability.popSpreadAuto()}}
								<label class="budget-sldName-wrp">
									{{=snip.checkbox1({cls: 'js-budget-autoinc', checked: it.stock.getElem(res.getId()).autoInc})}}
									
									<span class="budget-sldName">
										{{=res.getName()}}
									</span>
								</label>
							{{?}}
							
							<span class="budget-sld-blk">
								<div class="budget-sldWrp slider" data-res="{{=res.getId()}}">
									<div class="budget-sldShadow js-budget-sldShadow"></div>
								</div>
								
								<span class="budget-sldInfo">
									<span class="budget-sldPop">
										{{=snip.pop()}}

										<span class="js-budget-pop" data-title="Занятое на производстве этого ресурса население"></span>/<span class="-defVal" data-title="Количество рабочих мест">{{=res.getCount()}}</span>
									</span>

									<span class="budget-sldRes">
										{{=snip.res(res)}}

										<span class="js-budget-res"></span>
										<span class="-defVal"> в час</span>
									</span>
								</span>
							</span>
						</li>
					{{@}}
				</ul>
			{{?}}
			
			<div class="budget-slots js-budget-slots"></div>
		</div>
		
        {{=tmplMgr.economics.budget.footer(it)}}
	</form>
</script>
            
    <script type="text/plain" id="economics.budget.footer">
        <div class="wnd-footer">
			<a class="button1 -type-green js-budget-save -disabled">Сохранить</a>
		</div>
    </script>

    <script type="text/plain" id="economics.budget.pop">
        {{?Ability.popSpreadAuto() && !it.list.isEmpty()}}
            <span class="budget-autoInc-hint-wrp">{{=snip.hint("Сюда автоматически отправляются безработные")}}</span>
        {{?}}
        Безработные: {{=snip.pop()}}<span class="js-budget-popWork" data-title="Безработное население города"></span>  из  <span class="-defVal" data-title="Общее население города">{{=it.maxPop}}</span>
    </script>

<script type="text/plain" id="economics.budget.resInc">
	{{?it.res.isMoney()}}
		<span class="bgLight fakelink" data-title='С учетом налогов будет примерно {{=snip.resCount(it.res, utils.toFixed(it.resIncTaxed, 1))}}'>{{=utils.toFixed(it.resInc, 1)}}</span>
	{{??}}
		<span data-title="Количество производимого ресурса">{{=utils.formatNum(it.resInc, {uFixed:1})}}</span>
	{{?}}
	<span>{{=snip.effectUp(it.resAlter.toFixed(1))}}</span>
</script>

<script type="text/plain" id="economics.budget.slots">
	{{@it.now: slot: slotPos}}
		{{
			var slotWas = it.was[slotPos];
			var prodList = slot.getProductresForTown();
		}}
		<div class="budget-slot">
			<a class="budget-slotImg js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=slot.id}}" data-pos="{{=slot.pos}}" data-town="{{=wofh.town.id}}" data-head="{{=snip.slotTitle(slot)}}" href="{{=HashMgr.getHref('#/slot/'+slot.pos)}}">
				{{=snip.slotFrame(slot, snip.slotLevel(slot), {noTitle:true, grey: !prodList.getLength()})}}
			</a>
			<div class="budget-slotRes-wrp">
				{{?prodList.getLength()}}
					{{@slot.getProductresForTown().getList(): res}}
						<div class="budget-slotRes">{{=snip.resEffect(res)}}{{=snip.pop()}} {{=slot.pop.getCount(res)}} {{=snip.effectUp(slot.pop.getCount(res) - slotWas.pop.getCount(res))}}</div>
					{{@}}
				{{??}}
					<div class="budget-slotRes">Здание не может сейчас функционировать</div>
				{{?}}
			</div>
		</div>
	{{@}}
</script><script type="text/plain" id="editFlag.header">
    Флаг страны
</script>

<script type="text/plain" id="editFlag">
    <div class="view-editFlag">
		<div class="editFlag-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="editFlag.view">
	<form>
		<select class="select1" name="t" id="t">
			<option value="1">Горизонтальный</option>
			<option value="2">Вертикальный</option>
			<option value="3">Сплошной (только с доп. элементом)</option>
			<option value="4">Крест</option>
			<option value="5">Горизонтальные полосы</option>
			<option value="6">Диагональ основная</option>
			<option value="7">Диагональ побочная</option>
		</select>
		
		<select class="select1" name="p1" id="pl">
			<option value="2">2 полосы</option>
			<option value="3">3 полосы</option>
		</select>
		<select class="select1" name="p1" id="cross">
			<option value="5">Толщина  5%</option>
			<option value="10">Толщина  10%</option>
			<option value="15">Толщина  15%</option>
			<option value="20">Толщина  20%</option>
			<option value="25">Толщина  25%</option>
			<option value="30">Толщина  30%</option>
		</select>

		<select class="select1" name="p1" id="zebra">
			<option value="4">4 полосы</option>
			<option value="5">5 полос</option>
			<option value="6">6 полос</option>
			<option value="7">7 полос</option>
			<option value="8">8 полос</option>
			<option value="9">9 полос</option>
			<option value="10">10 полос</option>
		</select>

		<select class="select1" name="add" id="add">
			<option value="0">Ничего</option>
			<option value="1">Треугольник слева</option>
			<option value="2">Вертикальная полоса слева</option>
			<option value="3">Круг</option>
			<option value="4">Диагональный крест</option>
		</select>

		<select class="select1" name="c4" id="c4">
			<option value="0">-Цвет элемента-</option>
			<option value="0" style="background-color: Black;color: #FFFFFF;">Чёрный</option>
			<option value="1" style="background-color: Gray;">Тёмно-серый</option>
			<option value="2" style="background-color: DarkGray;">Серый</option>
			<option value="3" style="background-color: LightGrey;">Светло-серый</option>
			<option value="4" style="background-color: White;">Белый</option>
			<option value="5" style="background-color: Aquamarine;">Аквамариновый</option>
			<option value="6" style="background-color: Blue;">Синий</option>
			<option value="7" style="background-color: Navy;color: #FFFFFF;">Тёмно-синий</option>
			<option value="8" style="background-color: Purple;color: #FFFFFF;">Пурпурный</option>
			<option value="9" style="background-color: DeepPink;">Розовый</option>
			<option value="10" style="background-color: Violet;">Фиолетовый</option>
			<option value="11" style="background-color: Pink;">Персиковый</option>
			<option value="12" style="background-color: DarkGreen;color: #FFFFFF;">Тёмно-зеленый</option>
			<option value="13" style="background-color: Green;color: #FFFFFF;">Зеленый</option>
			<option value="14" style="background-color: YellowGreen;">Салатовый</option>
			<option value="15" style="background-color: Yellow;">Жёлтый</option>
			<option value="16" style="background-color: Orange;">Оранжевый</option>
			<option value="17" style="background-color: Red;">Красный</option>
			<option value="18" style="background-color: Brown;">Коричневый</option>
			<option value="19" style="background-color: BurlyWood;">Тёмно-бежевый</option>
			<option value="20" style="background-color: Beige;">Бежевый</option>
		</select>
		<br/>
		
		<select class="select1" name="c1" id="c1">
			<option value="0" style="background-color: Black;color: #FFFFFF;">Чёрный</option>
			<option value="1" style="background-color: Gray;">Тёмно-серый</option>
			<option value="2" style="background-color: DarkGray;">Серый</option>
			<option value="3" style="background-color: LightGrey;">Светло-серый</option>
			<option value="4" style="background-color: White;">Белый</option>
			<option value="5" style="background-color: Aquamarine;">Аквамариновый</option>
			<option value="6" style="background-color: Blue;">Синий</option>
			<option value="7" style="background-color: Navy;color: #FFFFFF;">Тёмно-синий</option>
			<option value="8" style="background-color: Purple;color: #FFFFFF;">Пурпурный</option>
			<option value="9" style="background-color: DeepPink;">Розовый</option>
			<option value="10" style="background-color: Violet;">Фиолетовый</option>
			<option value="11" style="background-color: Pink;">Персиковый</option>
			<option value="12" style="background-color: DarkGreen;color: #FFFFFF;">Тёмно-зеленый</option>
			<option value="13" style="background-color: Green;color: #FFFFFF;">Зеленый</option>
			<option value="14" style="background-color: YellowGreen;">Салатовый</option>
			<option value="15" style="background-color: Yellow;">Жёлтый</option>
			<option value="16" style="background-color: Orange;">Оранжевый</option>
			<option value="17" style="background-color: Red;">Красный</option>
			<option value="18" style="background-color: Brown;">Коричневый</option>
			<option value="19" style="background-color: BurlyWood;">Тёмно-бежевый</option>
			<option value="20" style="background-color: Beige;">Бежевый</option>
		</select>
		<select class="select1" name="c2" id="c2">
			<option value="0" style="background-color: Black;color: #FFFFFF;">Чёрный</option>
			<option value="1" style="background-color: Gray;">Тёмно-серый</option>
			<option value="2" style="background-color: DarkGray;">Серый</option>
			<option value="3" style="background-color: LightGrey;">Светло-серый</option>
			<option value="4" style="background-color: White;">Белый</option>
			<option value="5" style="background-color: Aquamarine;">Аквамариновый</option>
			<option value="6" style="background-color: Blue;">Синий</option>
			<option value="7" style="background-color: Navy;color: #FFFFFF;">Тёмно-синий</option>
			<option value="8" style="background-color: Purple;color: #FFFFFF;">Пурпурный</option>
			<option value="9" style="background-color: DeepPink;">Розовый</option>
			<option value="10" style="background-color: Violet;">Фиолетовый</option>
			<option value="11" style="background-color: Pink;">Персиковый</option>
			<option value="12" style="background-color: DarkGreen;color: #FFFFFF;">Тёмно-зеленый</option>
			<option value="13" style="background-color: Green;color: #FFFFFF;">Зеленый</option>
			<option value="14" style="background-color: YellowGreen;">Салатовый</option>
			<option value="15" style="background-color: Yellow;">Жёлтый</option>
			<option value="16" style="background-color: Orange;">Оранжевый</option>
			<option value="17" style="background-color: Red;">Красный</option>
			<option value="18" style="background-color: Brown;">Коричневый</option>
			<option value="19" style="background-color: BurlyWood;">Тёмно-бежевый</option>
			<option value="20" style="background-color: Beige;">Бежевый</option>
		</select>
		<select class="select1" name="c3" id="c3">
			<option value="0" style="background-color: Black;color: #FFFFFF;">Чёрный</option>
			<option value="1" style="background-color: Gray;">Тёмно-серый</option>
			<option value="2" style="background-color: DarkGray;">Серый</option>
			<option value="3" style="background-color: LightGrey;">Светло-серый</option>
			<option value="4" style="background-color: White;">Белый</option>
			<option value="5" style="background-color: Aquamarine;">Аквамариновый</option>
			<option value="6" style="background-color: Blue;">Синий</option>
			<option value="7" style="background-color: Navy;color: #FFFFFF;">Тёмно-синий</option>
			<option value="8" style="background-color: Purple;color: #FFFFFF;">Пурпурный</option>
			<option value="9" style="background-color: DeepPink;">Розовый</option>
			<option value="10" style="background-color: Violet;">Фиолетовый</option>
			<option value="11" style="background-color: Pink;">Персиковый</option>
			<option value="12" style="background-color: DarkGreen;color: #FFFFFF;">Тёмно-зеленый</option>
			<option value="13" style="background-color: Green;color: #FFFFFF;">Зеленый</option>
			<option value="14" style="background-color: YellowGreen;">Салатовый</option>
			<option value="15" style="background-color: Yellow;">Жёлтый</option>
			<option value="16" style="background-color: Orange;">Оранжевый</option>
			<option value="17" style="background-color: Red;">Красный</option>
			<option value="18" style="background-color: Brown;">Коричневый</option>
			<option value="19" style="background-color: BurlyWood;">Тёмно-бежевый</option>
			<option value="20" style="background-color: Beige;">Бежевый</option>
		</select>
		<hr>




		<select class="select1" name="pic" id="pic">
			<option value="0">Без изображения</option>
			/*[rarepic.html флаги для разных событий]*/
			<option value="1">Звезда</option>
			<option value="2">Звезды</option>
			<option value="3">Лучи</option>
			<option value="4">Шестерёнка</option>
			
			<option value="61">Черви</option>
			<option value="62">Пики</option>
			<option value="63">Буби</option>
			<option value="64">Трефи</option>
			<option value="6">Колба</option>
			<option value="7">Серп и молот</option>
			<option value="10">Череп</option>
			
			<option value="11">Череп с мечами</option>
			<option value="27">Череп с автоматами</option>
			<option value="25">Рыбий скелет</option>
			<option value="12">Атом</option>
			<option value="38">Роза ветров</option>
			<option value="8">3,1415926535</option>
			<option value="22">Загрязнение</option>
			
			<option value="13">Венок</option>
			<option value="14">Радиация</option>
			<option value="15">Пацифик</option>
			<option value="16">Подкова</option>
			<option value="17">Трезубец</option>
			<option value="18">Якорь</option>
			<option value="20">Штурвал</option>
			<option value="110">Анархия</option>
			<option value="19">Клевер</option>
			
			<option value="21">Солнце</option>

			<option value="23">Рука</option>
			<option value="24">Кулак</option>
			
			<option value="26">Утенок</option>
			<option value="28">Рыцарь</option>
			
			
			<option value="111">Факел</option>
			<option value="9">Костёр</option>
			<option value="112">Книга</option>
			<option value="113">Колос</option>
			<option value="114">Баран</option>
			<option value="115">Тура</option>
			<option value="116">Молния</option>
			<option value="117">Око</option>
			<option value="118">Крылатый меч</option>
			<option value="119">Тыква</option>
			<option value="120">Древо</option>
		
			<option value="127">Мёртвое древо</option>
			<option value="121">Удача</option>
			<option value="122">Весы</option>
			<option value="123">Шар удачи</option>
			<option value="124">Огненный дождь</option>
			<option value="125">Корона</option>
		
			<option value="65">Аргумент</option>
		
			<option value="126">Ракета</option>
		
			<option value="29">Спутник</option>
			<option value="30">Топоры</option>
			<option value="31">Алебарды</option>
			<option value="32">Булавы</option>
			<option value="33">Скрещённые мечи</option>
			<option value="34">Пушка</option>
			<option value="35">Мушкеты</option>
			<option value="36">Томагавк</option>
			<option value="37">АК</option>

			
			<option value="40">Справедливость</option>
			<option value="41">Скарабей</option>
			<option value="42">Паук</option>
			<option value="43">Конь</option>
			<option value="44">Черепаха</option>
			<option value="45">Дельфин</option>
			<option value="46">Рыбина</option>
			<option value="47">Морской конек</option>
			<option value="48">Слон</option>
			<option value="49">Ящерица</option>
			<option value="50">Фламинго</option>
			<option value="51">Октопус</option>
			<option value="52">Кроль</option>
			<option value="53">Рак</option>
			<option value="54">Акула</option>
			<option value="55">Жеребец</option>
			<option value="56">Дракон</option>
			<option value="57">Волк</option>
			<option value="58">Медуза</option>
			<option value="59">Наутилус</option>
			<option value="60">Скорпион</option>
			<option value="109">Черная Длань</option>
		</select>
		<span id="xy">
			Смещение по X: <input type="text" name="px" value="0" size="3">
			Смещение по Y: <input type="text" name="py" value="0" size="3">
		</span>
		<select class="select1" name="c5" id="c5">
			<option value="0" style="background-color: Black;color: #FFFFFF;">Чёрный</option>
			<option value="1" style="background-color: Gray;">Тёмно-серый</option>
			<option value="2" style="background-color: DarkGray;">Серый</option>
			<option value="3" style="background-color: LightGrey;">Светло-серый</option>
			<option value="4" style="background-color: White;">Белый</option>
			<option value="5" style="background-color: Aquamarine;">Аквамариновый</option>
			<option value="6" style="background-color: Blue;">Синий</option>
			<option value="7" style="background-color: Navy;color: #FFFFFF;">Тёмно-синий</option>
			<option value="8" style="background-color: Purple;color: #FFFFFF;">Пурпурный</option>
			<option value="9" style="background-color: DeepPink;">Розовый</option>
			<option value="10" style="background-color: Violet;">Фиолетовый</option>
			<option value="11" style="background-color: Pink;">Персиковый</option>
			<option value="12" style="background-color: DarkGreen;color: #FFFFFF;">Тёмно-зеленый</option>
			<option value="13" style="background-color: Green;color: #FFFFFF;">Зеленый</option>
			<option value="14" style="background-color: YellowGreen;">Салатовый</option>
			<option value="15" style="background-color: Yellow;">Жёлтый</option>
			<option value="16" style="background-color: Orange;">Оранжевый</option>
			<option value="17" style="background-color: Red;">Красный</option>
			<option value="18" style="background-color: Brown;">Коричневый</option>
			<option value="19" style="background-color: BurlyWood;">Тёмно-бежевый</option>
			<option value="20" style="background-color: Beige;">Бежевый</option>
		</select>
		<br>
		<hr>
		<div class="flag_try_wrp">
			<button class="flag_try button1">Посмотреть флаг</button>
		</div>
		<br>
		<img class="flag_imgS" width="11px" height="8px">&nbsp;
		<img class="flag_imgS" width="21px" height="14px">&nbsp;
		<img class="flag_imgB" style="border: 1px solid black;" width="44px" height="34px">
		<br>
		<br>
		<div style="position:relative">
			<div class="flag-cur-wrp">
				<button class="flag_cur button1">Исходный флаг</button>
			</div>
			<img class="flag-img flag_imgB">
			<div class="flag-rand-wrp">
				<button class="flag_rand button1">Случайный флаг</button>
			</div>
		</div>
		<br>
		<div class="flag_set_wrp">
			<button class="flag_set button1 ">Выбрать этот флаг для страны</button>
		</div>
	</form>

	<br>
</script><script type="text/plain" id="groundhog.header">
    День Сурка
</script>

<script type="text/plain" id="groundhog">
    <div class="view-groundhog">
        <div class="groundhog-text">
            {{?wofh.gameEvent.has(GameEvent.ids.groundhogWinter)}}
                <p>Затаив дыхание люди стояли на вершине холма. Лица их грязны. Одежды ветхи. Но глаза! Глаза полны веры и надежды...</p>
                <p><span class="help-separator groundhog-sep"></span></p>
                <p>Люди шли весь день и всю ночь. Под снегом, стаптывая пыльные сандалии по старым диким тропам. Теперь они ждали. Отцы поднимали своих детей над толпой. Они чисты... Они поймут и запомнят. Туман глухим одеялом накрыл все звуки. Даже лес затих в ожидании. Притихли птицы в ветвях. Уснули рыбы в пруду. Даже Вечный и Мудрый Бог-Енот отложил свою Великую Стирку.</p>
                <div class="groundhog-img"></div>
                <p>И вот на вершине горы, под неприметной корягой из глубины старой норы появился Он. Предвестник Весны. Древний как сам мир. Родившийся только для одного. Предвещать. И вот снова настал этот момент.</p>
                <p>Он делает свой первый шаг. Туман тает в первых лучах зимнего рассветного солнца. Легкий ветер медленно качает ветви деревьев.</p>
                <p>Шаг... еще шаг. Мир умирает на один вдох ветра. Тень Предвестника падает перед ним на землю. Он вздрагивает и одним стремительным, неразличимым движением скрывается в своей норе. <b>Зима будет долгой.</b></p>
            {{??}}
                <p>Затаив дыхание люди стояли на вершине холма. Лица их грязны. Одежды ветхи. Но глаза! Глаза полны веры и надежды...</p>
                <p><span class="help-separator groundhog-sep"></span></p>
                <p>Люди шли весь день и всю ночь. Под снегом, стаптывая пыльные сандалии по старым диким тропам. Теперь они ждали. Отцы поднимали своих детей над толпой. Они чисты... Они поймут и запомнят. Туман глухим одеялом накрыл все звуки. Даже лес затих в ожидании. Притихли птицы в ветвях. Уснули рыбы в пруду. Даже Вечный и Мудрый Бог-Енот отложил свою Великую Стирку.</p>
                <div class="groundhog-img"></div>
                <p>И вот на вершине горы, под неприметной корягой из глубины старой норы появился Он. Предвестник Весны. Древний как сам мир. Родившийся только для одного. Предвещать. И вот снова настал этот момент.</p>
                <p>Он делает свой первый шаг. Туман тает в первых лучах зимнего рассветного солнца. Легкий ветер медленно качает ветви деревьев.</p>
                <p>Шаг... еще шаг. Мир умирает на один вдох ветра. Тень Предвестника падает перед ним на землю. Величаво и спокойно выходит из норы. <b>Зима скоро отступит.</b></p>
            {{?}}    
        </div>
    </div>
</script><script type="text/plain" id="mobile.header">
    Мобильный интерфейс
</script>

<script type="text/plain" id="mobile">
    <div class="p10">
        Ты используешь мобильное устройство для игры.<br>
        Поэтому ты можешь принять участие в тестировании и доработке новой мобильной версии.<br>
        Но имей в виду, что сейчас она находится в стадии активной разработки и тестирования. Ввиду этого, многие интерфейсы будут изменяться и дорабатываться, вплоть до завершения разработки.<br>
        Просим тебя в случае нахождения какой-либо ошибки или несуразности сообщить об этом в <a class="link" href="mailto:{{=lib.main.supportemail}}">{{=snip.icon(snip.c.smenu, 'sup', false,'поддержку')}}</a> своего мира.<br>
        Переключиться на обычный интерфейс ты можешь прямо сейчас или в любой момент в <a class="link" href="{{=HashMgr.getHref('#/options')}}">{{=snip.icon(snip.c.smenu, 'opt', false, 'настройках')}}</a>. Вернуться на мобильную версию ты сможешь там же.
        <div style="text-align: center; margin-top: 15px;">
            <a class="mobile-turn button1 -type-green">Полный</a>
        </div>
    </div>
</script><script type="text/plain" id="nopremium">
	<div class="view-noPremium">
		Доступно только владельцам 
		{{=snip.nobr('Царь-Аккаунта', false, 'fwB')}}
		.
		<br>
		Но ты можешь 
		<a class="link js-popup-ok">включить</a>
		 его за 
		{{=snip.resCount(Resource.ids.luck, Math.ceil(wofh.account.getLuckBonus(LuckBonus.ids.accountPremium).getCostUp()))}}
		 сейчас.
    </div>
</script><script type="text/plain" id="freeLuck">
    <div class="view-shopModal">
		<div class="shopModal-head">Ты получаешь в подарок<button class="shopModal-close js-wnd-close"></button></div>
		
		<div class="shopModal-buttons" style="color: white">
			<div class="-nobr" style="margin-top: 125px;">
				{{=snip.luckBig()}}
				<span style="vertical-align: top; font-size: 16px; line-height: 45px;">{{=utils.toInt(wofh.account.getCoinsFree())}}</span>
			</div>
			<div>Тебе повезло, ты вступаешь в мир во время Дождя Удачи.<br>Твой старт будет легким и веселым.</div>
		</div>
	</div>
</script>
<script type="text/plain" id="help.header">
	Энциклопедия
</script>

<script type="text/plain" id="help">
	<div class="view-help -sel">
		<table class="tbl-help">
			<tbody>
				<tr>
					<td class="help-menu">
						{{=snip.input1({name: 'search', placeholder: 'Поиск'})}}
						
						<a class="help-menu-topic" href="{{=HashMgr.getHref('#/help')}}">Оглавление</a>
						<div class="help-menuWrp"></div>
					</td>
					<td class="help-body-wrp"></td>
				</tr>
			</tbody>
		</table>
	</div>
</script>

<script type="text/plain" id="help.menu">
	{{@wHelp.pages: page: pageId}}
		{{?page.agreement && page.agreement != 'default'}}
			<a class="link" href="{{=page.agreement}}" target="_blank">{{=page.name}}</a>
		{{??it.current == pageId}}
			<span style="font-weight: bold; color: black">{{=page.name}}</span>
		{{??page.name}}
			<a class="link" href="{{=HashMgr.getHref('#/help/'+pageId)}}">{{=page.name}}</a>
		{{?}}
		<br>
	{{@}}
</script>

<script type="text/plain" id="help.body">
	<div class="help_body" style="max-height: {{=utils.getWindowHeight(-70, 675)}}px;">
		<div class="help-contentWrp"></div>
		<div class="help-searchWrp -hidden"></div>
	</div>
</script>

<script type="text/plain" id="help.wrapper">
	<div class="help-page-topic">{{=it.title}}</div>
	<div class="help-page help-page-{{=it.name}}">
		{{=it.content}}
	</div>
</script>

<script type="text/plain" id="help.faq">
	<div>

		{{
			var qaList = [
				{
					q: 'Как увеличить предел '+
						snip.pop('населения')+'?',
					a: 'Предел '+
						snip.pop('населения')+' — это культура города. Её можно повысить изучением наук, повышающих культуру, или строительством некоторых зданий, например, '+
						snip.buildLink(Slot.ids.altair, 'алтаря')+' или '+
						snip.buildLink(Slot.ids.obelisk, 'обелиска')+'.',
				},
				{
					q: 'Почему не появляются таблички с ресурсами?',
					a: 'Число табличек каждый день ограничено на каждый город. Причем, таблички появляются только у отстающих игроков.',
				},
				{
					q: 'Могут ли '+
						snip.unitNameLink(Unit.ids.worker, 'рабочие')+' колонизировать месторождение для другого города?',
					a: 'Нет.',
				},
				{
					q: 'От чего зависит число необходимых '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+' для колонизации месторождения?',
					a: 'Зависит только от числа городов. Число требуемых '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+' никак не зависит от количества уже колонизированных месторождений.',
				},
				{
					q: 'У меня есть нужное число '+
						snip.unitNameLink(Unit.ids.settler, 'поселенцев')+'. Почему я не могу нигде основать новый город?',
					a: 'Скорее всего '+
						snip.unitNameLink(Unit.ids.settler, 'поселенцы')+' из разных городов. Для основания города все '+
						snip.unitNameLink(Unit.ids.settler, 'поселенцы')+' должны быть подготовлены в одном городе. Это же касается и колонизации месторождения '+
						snip.unitNameLink(Unit.ids.worker, 'рабочими')+'.',
				},
				{
					q: 'Я обучил '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+', но месторождение колонизировали до меня. Что мне теперь делать?',
					a: 'Можно «уволить со службы» '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+', чтобы вернуть затраченное на них '+
						snip.pop('население')+'.',
				},
				{
					q: 'Можно ли прописывать войска в другом городе? Например, чтобы атаковать сразу всеми войсками из одного города?',
					a: 'Нет, но можно приводить их туда в качестве подкрепления. Войска можно отправлять только из того города, в котором они были обучены и которому принадлежат. То же касается и отправки '+
						snip.unitNameLink(Unit.ids.settler, 'поселенцев')+' на основание городов и '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+' на колонизацию и строительство дорог и улучшений местности.',
				},
				{
					q: 'Можно ли меняться науками или дарить их?',
					a: 'Нельзя.',
				},
				{
					q: 'Вернут ли хотя бы часть ресурсов, если я снесу свое строение?',
					a: 'Нет.',
				},
				{
					q: 'После изучения науки, открывающей месторождения, я не увидел на карте этих месторождений. Это ошибка?',
					a: 'Видимо в пределах зоны видимости нет ни одного такого месторождения.',
				},
				{
					q: 'Если я освобожу месторождение, вернут ли мне '+
						snip.unitNameLink(Unit.ids.worker, 'рабочих')+'?',
					a: 'Не вернут.',
				},
				{
					q: 'Почему у меня в городе '+
						lib.units.list[Unit.ids.worker].popcost+' человек и есть ресурсы, но '+
						snip.unitNameLink(Unit.ids.worker, 'рабочего')+' я обучить не могу?',
					a: 'После обучения в городе должно оставаться как минимум '+lib.town.population.min+' человек.',
				},
				{
					q: 'Сохранятся ли у меня науки, изученные в стране, после того, как я выйду из страны?',
					a: 'Да.',
				},
				{
					q: 'Я колонизировал месторождение '+
						snip.depositLink(1, 'оленей')+', но производство вьючных животных не началось. Почему?',
					a: 'Месторождение только дает возможность производства. Для производства '+
						snip.res(Resource.ids.horse, {text: 'вьючных животных'})+' нужно построить '+
						snip.buildLink(Slot.ids.animalFarm, 'скотный двор')+' и распределить туда '+
						snip.pop('население')+'.',
				},
				{
					q: 'Мне дали войска после очередного Задания. Я уволил их со службы. Почему '+
						snip.pop('население')+' не добавилось?',
					a: 'Войска, выданные за задания, не потребляют пищу, а после их увольнения со службы '+snip.pop('население')+' не возвращается.',
				},
				{
					q: 'Я уволил со службы войска, но '+
						snip.pop('население')+' не вернулось в город, почему?',
					a: 'Вероятно, '+
						snip.pop('население')+' города превышает '+
						snip.pop('1000 человек')+'. А увольнение со службы войск возвращает '+
						snip.pop('население')+', затраченное на их обучение, только до этого предела.',
				},
				{
					q: 'Я случайно выбрал не ту расу/континент/климат при регистрации, можно ли изменить решение?',
					a: 'Нет.',
				},
				{
					q: 'Можно ли защищать город '+
						snip.unitNameLink(Unit.ids.worker, 'рабочими')+' или '+
						snip.unitNameLink(Unit.ids.settler, 'поселенцами')+'?',
					a: 'Да.',
				},
				{
					q: 'Вернется ли '+snip.pop('население')+', если я отменю текущее обучение войск?',
					a: 'Нет.',
				},
				{
					q: 'Производство каких ресурсов не требует колонизированного месторождения?',
					a: ''+
						snip.res(Resource.ids.wood, {text: 'Древесина'})+', '+
						snip.res(Resource.ids.fruit, {text: 'фрукты'})+', '+
						snip.res(Resource.ids.meat, {text: 'мясо'})+', '+
						snip.res(Resource.ids.iron, {text: 'металл'})+', '+
						snip.res(Resource.ids.science, {text: 'знания'})+', '+
						snip.res(Resource.ids.books, {text: 'книги'})+', '+
						snip.res(Resource.ids.films, {text: 'фильмы'})+' и '+
						snip.res(Resource.ids.money, {text: 'деньги'})+'. Города на холмах также могут производить '+
						snip.res(Resource.ids.stone, {text: 'гранит'})+', а после изучения науки '+
						snip.scienceLink(Science.ids.fishing, {text: 'Рыболовство'})+', речные и прибрежные города могут производить '+
						snip.res(Resource.ids.fish, {text: 'рыбу'})+'.',
				},
				{
					q: 'Я колонизировал месторождение '+
						snip.depositLink(1, 'хлопка')+' и изучил науку '+
						snip.scienceLink(Science.ids.monarchy, {text: 'Монархия'})+'. Почему я не могу построить '+
						snip.buildLink(Slot.ids.weaversHouse, 'дом ткача')+' в своём городе и начать производить '+
						snip.res(Resource.ids.cloth, {text: 'одежду'})+'?',
					a: 'Производство '+
						snip.res(Resource.ids.cloth, {text: 'одежды'})+' становится возможным только после изучения науки '+
						snip.scienceLink(Science.ids.fabrics, {text: 'Ткани'})+'. А без этой возможности нельзя построить '+
						snip.buildLink(Slot.ids.weaversHouse, 'дом ткача')+'.',
				},
				{
					q: 'Подсчёты показывают, что не все ресурсы облагаются производственным налогом. Почему?',
					a: 'Ресурсы, произведённые с помощью бонуса Удачи, налогом не облагаются.',
				},
				{
					q: 'У меня растёт долг и не накапливаются '+
						snip.res(Resource.ids.money, {text: 'деньги'})+'. До каких пор это будет продолжаться?',
					a: 'Если денег остается мало, то вместо выплат налогов начинает накапливаться долг. Он будет постепенно погашен по мере улучшения финансовой ситуации на аккаунте. При этом любое поступление '+
						snip.res(Resource.ids.money, {text: 'денег'})+' на аккаунт идёт на его погашение.',
				},
				{
					q: 'В городе не было армии. Я атаковал тот город, часть армии погибла от урона перед боем, но потом почему-то погибла целиком. Это ошибка?',
					a: 'В зависимости от фортификации в городе, на поле боя могут быть лагеря, способные наносить урон войскам атаки во время сражения. Даже в случае, если войск в защите нет, лагеря могут убить атакующих.',
				},
				{
					q: 'В симуляторе сражение заканчивается с одним результатом, а в бою при городе с совершенно другим. Как такое может быть?',
					a: 'Бой в симуляторе проходит иначе, нежели обычный. Так, например, в симуляторе все войска выходят на поле боя разом, а в бою — отрядами.',
				},
				{
					q: 'Я вступил в страну, когда я получу её обзор карты?',
					a: 'Когда завершится объединение — то есть, все члены страны будут знать одни и те же науки, а затем изучат хотя бы одну новую науку, неизвестную им ранее.',
				},
				{
					q: 'К нам в страну вступил новый игрок, после чего у всей страны упала эффективность передачи '+
						snip.res(Resource.ids.science, {text: 'знаний'})+'. Почему?',
					a: 'Это происходит из-за разного количества наук, улучшающих научное распределение, которые известны игрокам и стране. Те игроки, которые знают больше таких наук, чем страна, будут передавать знания менее эффективно.',
				},
			];
		}}

		{{@qaList: qa: pos}}
			<div class="help-faq-qa" data-pos="{{=pos}}">
				<div class="help-faq-qa-title">{{=qa.q}}</div>
				<div>{{=qa.a}}</div>
			</div>
		{{@}}


	</div>
</script>

<script type="text/plain" id="help.science">
	{{?wofh.account}}
		<div class="help-control">
			<div class="help-filterBlock">
				{{=snip.input1({cls: 'help-page-search', placeholder: 'Поиск науки по названию'})}}
				<br>
				<div class="help-filterWrp">
					<label class="clr2">{{=snip.checkbox1({attrs: {'data-filter': 4}, cls: 'help-sci-filter'})}} изученные</label> 
					<label class="clr1">{{=snip.checkbox1({attrs: {'data-filter': 2}, cls: 'help-sci-filter'})}} к изучению</label> 
					<label class="clr0">{{=snip.checkbox1({attrs: {'data-filter': 1}, cls: 'help-sci-filter'})}} недоступные</label>
				</div>
			</div>
			<div class="help-filterBlock -type-bonusFilter">
				<div class="help-sci-bonusFilterWrp">
					{{@it.bonusFilter: filter: field}}
						{{?filter.hide}}{{continue;}}{{?}}
						<span class="help-filter help-sci-bonusFilter {{?filter.on}}-on{{??}}-off{{?}}" data-field="{{=field}}">{{=filter.icon}}</span>
					{{@}}
				</div>
			</div>
		</div>
	{{?}}
	
	<div class="help-sci-list" style="max-height: {{=utils.getWindowHeight(-70, 675)-203}}px;">
		{{~Science.getSortedListByCost(): science}}
			<div class="help-sci-item" data-id="{{=science.id}}" data-name="{{= science.getName().toLowerCase() }}">
				<a class="help-sci-item-back"  href="{{=HashMgr.getHref('#/scienceinfo/'+science.getId())}}" ></a>
				<div class="help-sci-item-text">
					<div class="help-sci-item-name">
						{{=snip.scienceLink(science, {highlight: true})}}
					</div>
					{{?wofh.account.isAdmin()}}
						<div class="help-sci-item-adm">
							{{=tmplMgr.help.chgScience({science:science})}}
						</div>
					{{?}}
					<div class="help-sci-item-icons">
						{{=snip.scienceIcons(science)}}
					</div>
				</div>
				<div class="help-sci-item-build">
					{{@science.builds.getList(): build}}
						{{=snip.slotMini(build, {hint: build.getName()+' +'+build.getCount()+' ур.'})}}
					{{@}}
				</div>

				<div class="help-sci-item-unit">
					{{@ science.units.getList(): unit}}
						<a href="{{=HashMgr.getHref('#/unitinfo/'+unit.getId())}}"><span class="unit {{?unit.isHalf}}-unit-half{{?}} u{{= unit.getId() }}" data-title="{{= unit.getName() }}"></span></a>
					{{@}}
				</div>
			</div>
		{{~}}
	</div>


	<div class="help-sci-error">Нет подходящих наук. Возможно, ошибка?</div>
</script>

<script type="text/plain" id="help.learn">
	<div class="paragraph">
		Чтобы получать новые возможности, необходимо изучать новые {{=snip.scienceIcon('науки')}}.
	</div>

	<div class="paragraph">
		<div style="float: left; margin: 5px"><span class="qinf-mmenuBtn -type-science"></span></div> 
		В окне «Выбор наук для изучения» отображаются науки, доступные на данный момент к изучению. В любой момент можно изменить изучаемую науку. Уровень ее изученности сохранится. Можно выбрать следующую к изучению науку. Это необходимо для того, чтобы «лишние» {{=snip.nobr(snip.resBig(Resource.ids.science)+'знания')}} и {{=snip.nobr(snip.resBig(Resource.ids.science)+'знания')}} от притока были вложены в нужную науку. Если следующая наука не выбрана или передаваемых {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}} хватает на изучение нескольких наук, то далее науки выбираются автоматически. {{=snip.nobr(snip.resBig(Resource.ids.science)+100)}}% знаний идет в выбранную науку. Дополнительно, {{=snip.nobr(snip.resBig(Resource.ids.science)+Math.round(lib.science.otherlearning*100))}}% знаний равномерно разделяются на все доступные к изучению науки, кроме текущей.
	</div>

	<div class="paragraph help-subtitle">Знания</div>

	<div class="paragraph">
		Чтобы изучить выбранную науку, нужно накопить достаточно {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}}. {{=snip.nobr(snip.resBig(Resource.ids.science)+'Знания')}} вырабатываются населением города, распределенным на рабочие места в научных строениях.
	</div>

	<div class="paragraph">
		Объем передаваемых {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}} увеличивается или уменьшается в зависимости от развития города. Каждый город передает {{=snip.nobr(snip.resBig(Resource.ids.science)+'знания')}} с разной эффективностью. Эффективность наиболее научного города является наибольшей. Для остальных городов эффективность передачи {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}} спадает, и зависит от их места (среди городов игрока и его страны) по объемам передачи {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}}. После изучения определенных наук эффективность передачи {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}} для городов меняется.
	</div>

	<div class="paragraph help-subtitle">Приток знаний</div>

	<div class="paragraph">
		После изучения новой науки происходит дополнительный приток {{=snip.nobr(snip.resBig(Resource.ids.science)+'знаний')}} (в следующую науку). Его объем зависит от распространенности изученной науки в мире. Чем больше игроков знает науку, тем больше приток от её изучения.
	</div>

	<div class="paragraph help-subtitle">Исследования в стране</div>

	<div class="paragraph">
		О научных исследованиях в составе страны можно узнать в {{=snip.pediaLink('country', 'соответствующем разделе энциклопедии')}}.
	</div>
</script>


<script type="text/plain" id="help.build">
	{{?wofh.account}}
		<div class="help-control">
			<div class="help-filterBlock">
				{{=snip.input1({cls: 'help-page-search', placeholder: 'Поиск здания по названию'})}}
				<br>
				<div class="help-filterWrp">
					<label class="clr2">{{=snip.checkbox1({attrs: {'data-filter': 1<<2}, cls: 'help-build-filter'})}} известные</label> 
					<label class="clr1">{{=snip.checkbox1({attrs: {'data-filter': 1<<1}, cls: 'help-build-filter'})}} знакомые</label> 
					<label class="clr0">{{=snip.checkbox1({attrs: {'data-filter': 1<<0}, cls: 'help-build-filter'})}} неизвестные</label>
				</div>
			</div>
			<div class="help-filterBlock -type-bonusFilter">
				<div class="help-build-bonusFilterWrp">
					{{@it.bonusFilter: filter: field}}
						{{?filter.br}}<br>{{?}}
						<span class="help-filter help-build-bonusFilter {{?filter.on}}-on{{??}}-off{{?}}" data-field="{{=field}}">{{=filter.icon}}</span>
					{{@}}
				</div>
			</div>
		</div>
	{{?}}
	<div class="help-build-list" style="max-height: {{=utils.getWindowHeight(-70, 675)-180}}px;">
		<div class="help-build-wrp"></div>
	</div>
</script>

<script type="text/plain" id="help.build.info">
	<div class="buildTabs">
		{{@[1,2,3,4,5,6,7,8,0]: tabId}}
			{{var tab = it.tabs[tabId];}}
			{{?tab}}
				{{=snip.buildTab(tabId, {cls:(it.filter.tab == tabId || utils.sizeOf(it.tabs) == 1?'-active':'')})}}
			{{?}}
		{{@}}
	</div>
	{{@it.tabs: tab: tabId}}
		{{?tabId != Slot.tabIds.all && (it.filter.tab == Slot.tabIds.all || tabId == it.filter.tab)}}
			<div class="help-build-group" data-group="{{=tabId}}">
				<div class="buildTabs-bar -type-{{=tab.name}}">{{= tab.title }}</div>
				<div>
					{{@tab.builds: slot}}
						<div class="help-build-item">
							<a class="clr{{=slot.known == wHelp.buildKnown.familar ? wHelp.buildKnown.all : slot.known}} link" href="{{=HashMgr.getHref('#/buildinfo/'+slot.id)}}">
								<div class="build_icon_s"><img src="https://test.waysofhistory.com/img/buildings2/{{=slot.getId()}}_{{=slot.getPic()}}.png"></div><br />
								{{= slot.getName() }}
							</a>
						</div>
					{{@}}
				</div>
			</div>
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="help.wonder">
	<div>
		<div class="paragraph">
			Каждый город может построить одно {{=snip.nobr(snip.wonderIcon(true)+'Чудо Света')}} и только в специальном месте.<br>
			Чудеса Света строятся поуровнево до 20 уровня. Строительство Чуда Света нельзя ускорить за {{=snip.nobr(snip.resBig(Resource.ids.luck)+'Монеты Удачи')}}, но можно замедлить разведчиками. Подробнее об этом можно прочитать в разделе «<a class="link" href="{{=HashMgr.getHref('#/help/spy')}}">Разведка</a>».  На 20-м уровне Чудо Света возможно активировать и только после этого оно начнет давать свой эффект.<br><br>
			Неактивированное Чудо Света можно разрушить самостоятельно, как обычное строение. В случае атаки Чудо Света разрушается только при уничтожении самого города.<br><br>
			У каждого Чуда Света есть свое {{=snip.nobr(snip.icon(snip.c.anyIcon, 'distance')+'конкурирующее расстояние')}}. Если в пределах данного расстояния кто-то уже активировал такое же Чудо Света, то твое Чудо Света активировать не получится. Во время строительства своего Чуда Света, в окне строительства можно увидеть таблицу конкурирующих городов с Чудесами Света  и их текущие уровни.<br><br>
			<br>
		</div>
		<div>
			{{@SlotList.getSortedWonders().getList(): slot}}
				{{slot.setLevel(wofh.account ? Build.getResearchLevel(slot.getId()) : lib.build.maxlevel);}}
				
				<div class="help-build-item">
					{{=snip.slotWonder(slot, {sw: true, cls: 'link clr' + (slot.getLevel() == 0 ? 0 : (slot.getLevel() == lib.build.maxlevel) ? 2 : 1)})}}
				</div>
			{{@}}
		</div>
	</div>
</script>

<script type="text/plain" id="help.town">
	<div class="paragraph">
		{{=snip.nobr(snip.townIcon()+'Город')}} представляет собой {{=snip.pop('жителей')}}, работающих в нем, и строения, увеличивающие его эффективность. В каждом городе хранятся свои собственные <a class="link" href="{{=HashMgr.getHref('#/help/res')}}">ресурсы</a>.
	</div>

	<div class="paragraph">
		Для возведения строений существуют специальные места строительства. Они бывают следующих видов:
	</div>

	<div class="ped_twns">
		<div class="paragraph">{{=snip.emptySlot2(5)}} Одно место для строительства Чуда Света.</div>
		<div class="paragraph">{{=snip.emptySlot2(4)}} Одно место для строительства фортификаций.</div>
		<div class="paragraph">{{=snip.emptySlot2(0)}} Несколько равнинных мест строительства.</div>
		<div class="paragraph">{{=snip.emptySlot2(2)}} Одно (три для холмовых городов) место для строительства холмовых строений.</div>
		<div class="paragraph">{{=snip.emptySlot2(3)}} У прибрежных и городов на реке некоторые места строительства водные. Их может быть от 1 до 4, в зависимости от длины береговой линии около города на карте.</div>
		<div class="paragraph">{{=snip.emptySlot2(1)}} Место для строительства главного строения города.</div>
	</div>

	<div class="paragraph">
		Каждый город имеет одинаковое количество мест строительства.
	</div>

	<div class="paragraph">
		Любое строение строится только в специальном месте.
	</div>

	<div class="paragraph">
		Некоторые места строительства изначально недоступны. После изучения науки {{=snip.scienceLink(19, {text: 'Деньги'})}} их можно купить.<br>Цена каждого следующего места значительно выше предыдущего.
		<br><br>
		<style></style>
		<table class="def_table" id="helptown">
			<thead><tr class="trow1"><td colspan="5" style="height:5px"></tr></thead>
			<tbody>
				<tr class="trow1"><td>1 место</td><td>{{=snip.resBig(Resource.ids.money)}}{{= lib.town.slot.cost[0] }}</td></tr>
				<tr class="trow1"><td>2 место</td><td>{{=snip.resBig(Resource.ids.money)}}{{= lib.town.slot.cost[1] }}</td></tr>
				<tr class="trow1"><td>3 место</td><td>{{=snip.resBig(Resource.ids.money)}}{{= lib.town.slot.cost[2] }}</td></tr>
				<tr class="trow1"><td>4 место</td><td>{{=snip.resBig(Resource.ids.money)}}{{= lib.town.slot.cost[3] }}</td></tr>
				<tfoot><tr><td colspan="5" style="height:5px"></tr></tfoot>
			</tbody>
		</table>
		<br>
	</div>

	<div class="paragraph help-subtitle">Основание городов</div>

	<div class="paragraph">Для основания новых городов нужны {{=snip.unitNameLink(43, 'Поселенцы')}}</div>
	<div class="paragraph">{{=snip.unitNameLink(43, 'Поселенцы')}} обучаются в {{=snip.buildLink(0, 'алтаре')}}, {{=snip.buildLink(25, 'резиденции')}}, {{=snip.buildLink(53, 'ратуше')}}, {{=snip.buildLink(39, 'замке')}} или {{=snip.buildLink(55, 'мэрии')}}. Для возможности обучения {{=snip.unitNameLink(43, 'поселенцев')}} требуется изучить {{=snip.scienceLink(137, {text: 'Картографию'})}}.</div>
	<div class="paragraph">Для основания каждого следующего города нужно все большее число {{=snip.unitNameLink(43, 'поселенцев')}}.</div>
	<div class="paragraph">Новый город можно основать <b>на расстоянии не более {{= utils.formatNum(lib.map.colonizedistance, {fixed:1, toNum:true}) }} полей</b> от выбранного города.</div>
	<div class="paragraph">{{=snip.unitNameLink(43, 'Поселенцы')}} двигаются только по суше или только по глубоководному пути. Подробнее о перемещении войск и нахождении путей можно прочитать в разделе <a class="link" href="{{=HashMgr.getHref('#/help/move')}}">«Дороги и передвижение войск, торговцев»</a>.</div>
	<div class="paragraph">Города, основанные на холмах, имеют два дополнительных холмовых места строительства вместо двух равнинных. Города возле воды и на реке имеют от 1 до 4 водных мест строительства вместо равнинных. Число водных мест строительства зависит от протяженности береговой линии рядом с городом.</div>
	<div class="paragraph">Каждый новый город игрока увеличивает коррупцию во всех городах игрока.</div>
</script>

<script type="text/plain" id="help.specialists">
	<div class="paragraph">При изучении некоторых наук, появляется вероятность рождения Великих Граждан в мире. Великие Граждане рождаются при открытии ежедневного «облака» с вероятностью, указанной в окне «Науки и технологии». Великий Гражданин от некоторой науки может родиться только у тех игроков, которые знают эту науку.</div>
	<div class="paragraph">После получения Великого Гражданина его, в любой момент, можно навсегда поселить в любом своем городе.</div>
	<div class="paragraph">Каждый следующий поселенный в городе Великий Гражданин одного типа дает меньший эффект, чем предыдущий.</div>
	<div class="paragraph">	
		<table>
			<tbody>
				{{@lib.town.specialists: spec: specId}}
					{{spec = new Specialist(specId, 1);}}
					<tr>
						<td class="aC">
							{{=snip.specialist({specialist:spec, noTitle:true, noCount:true})}}
						</td>
						<td class="aL">
							{{=spec.getEffectDesc()}} 
						</td>
					</tr>
				{{@}}
			</tbody>
		</table>
	</div>
</script>

<script type="text/plain" id="help.unit">
	{{?wofh.account}}
		<div class="help-control">
			<div class="help-filterBlock">
				{{=snip.input1({cls: 'help-page-search', placeholder: 'Поиск по названию'})}}
				<br>
				<div class="help-filterWrp">
					<label class="clr2">{{=snip.checkbox1({attrs: {'data-filter': 1}, cls: 'help-unit-filter'})}} изученные</label> 
					<label class="clr0">{{=snip.checkbox1({attrs: {'data-filter': 2}, cls: 'help-unit-filter'})}} недоступные</label>
				</div>
			</div>
			<div class="help-filterBlock -type-bonusFilter">
				<div class="help-unit-bonusFilterWrp">
					{{@it.bonusFilter: filter: field}}
						<span class="help-filter help-unit-bonusFilter {{?filter.on}}-on{{??}}-off{{?}}" data-field="{{=field}}">{{=filter.icon}}</span>
					{{@}}
				</div>
			</div>
		</div>
	{{?}}
	<div class="help-unit-list" style="max-height: {{=utils.getWindowHeight(-70, 675)-179}}px;">
		<div class="tbl help-unit-table">
			{{@Army.getAll().getEraTacticGroups(): eraGroup}}
				<div class="tbl-tr">
					{{@eraGroup: tacticGroup}}
						<div class="tbl-td">
							{{@tacticGroup.getList(): unit}}
								<a class="clr{{=unit.isAvailAcc() ? 2 : 0}} help-unit-item" href="{{=hashMgr.getWndHref('unitinfo', unit.getId())}}" data-name="{{=unit.getName().toLowerCase()}}" data-id="{{=unit.getId()}}">
									{{=snip.unitIcon(unit)}}
									
									<div class="help-unit-name">{{=unit.getName()}}</div>
								</a>
							{{@}}
						</div>
					{{@}}
				</div>
			{{@}}
		</div>
		
		<div class="paragraph help-subtitle">Информация в бою</div>
		<div class="help-unit-battle">
			<div class="help-unit-battle-panel">
				<div class="help-unit-battle-section -type-0">— название</div>
				<div class="help-unit-battle-section -type-1">— здоровье</div>
				<div class="help-unit-battle-section -type-2">— важность, размер, скорость</div>
				<div class="help-unit-battle-section -type-3">— защита от 4 видов урона</div>
				<div class="help-unit-battle-section -type-4">— характеристики</div>
				<div class="help-unit-battle-section -type-5">— характеристики первого оружия</div>
				<div class="help-unit-battle-section -type-6">— урон по цели</div>
				<div class="help-unit-battle-section -type-7">— второе оружие</div>
				<div class="help-unit-battle-section -type-8">— третье оружие</div>
			</div>
			
			<div class="paragraph">
				<div class="help-unit-battle-icons">
					<div class="help-unit-battle-iTags">
						{{@Unit.tags: tag: tagKey}}
							{{var tagName = Unit.getTagName(tag);}}
							{{?tagName && Unit.isTacticsTag(tag)}}
								<div class="help-unit-battle-icon">
									{{=snip.icon(snip.c.unitTagIcon, tagKey) + ' — ' + utils.downFirstLetter(tagName) + ';'}}
								</div>
							{{?}}
						{{@}}
						
						<div class="help-unit-battle-icon">
							{{=snip.icon(snip.c.unitTagIcon, 'build') + ' — ' + utils.downFirstLetter('Строение') + '.'}}
						</div>
					</div>
					<div class="help-unit-battle-iOthers">
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'period')}} — период действия;</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'dist')}} — дальность действия;</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'scatter')}} — разброс;</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'damageCircle')}} — тип нанесения урона по окружности,</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'damageSector')}} — по сектору,</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'damagePoint')}} — по точке;</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'weaponDamageCrushing')}} — дробящий тип урона оружия,</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'weaponDamagePenetrating')}} — проникающий,</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'weaponDamageSecant')}} — секущий,</div>
						<div class="help-unit-battle-icon">{{=snip.icon(snip.c.battlePanelIcon, 'weaponDamageExplosive')}} — разрывной.</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="paragraph help-subtitle help-unit-anchor-abil">Особенности войск</div>
		<dl>
			<dt>Строитель</dt>
			<dd>Может колонизировать <a href="{{=HashMgr.getHref('#/help/deposit')}}" class="link">{{=snip.deposit()}}месторождения</a>, строить дороги и улучшать местность.</dd>

			<dt>Основатель</dt>
			<dd>Умеет основывать {{=snip.nobr(snip.townIcon()+'новый город')}}</dd>

			<dt>Разведчик</dt>
			<dd>Может быть отправлен на разведку местности или во вражеский город. Также защищает город от чужой разведки.</dd>

			<dt>Разрушитель</dt>
			<dd>После боя наносит урон строениям побежденного города.</dd>

			<dt>Робкий</dt>
			<dd>В открытом противостоянии робеет и не вступает в бой. Умирает, если в данный момент армия состоит только из таких войск.</dd>

			<dt>Головорез</dt>
			<dd>После боя уничтожает часть {{=snip.pop('населения')}} побежденного города.</dd>

			<dt>Транспорт</dt>
			<dd>Используется для транспортировки войск по воде.</dd>

			<dt>Мелководный</dt>
			<dd>Ходит только по рекам или вдоль берега.</dd>

			<dt>Глубоководный</dt>
			<dd>Ходит по любой воде кроме рек.</dd>

			<dt>Миротворец</dt>
			<dd>Нельзя отправить в атаку. Выходит на поле боя последним в своей группе.</dd>



			<dt>Малый радиус обороны</dt>
			<dd>Особенность авиации. Находясь в городе, участвует в оборонительных боях страны против авиации противника на расстоянии не более {{=utils.toInt(lib.war.airradius[0])}} полей.</dd>

			<dt>Средний радиус обороны</dt>
			<dd>Особенность авиации. Находясь в городе, участвует в оборонительных боях страны против авиации противника на расстоянии не более {{=utils.toInt(lib.war.airradius[1])}} полей.</dd>

			<dt>Большой радиус обороны</dt>
			<dd>Особенность авиации. Находясь в городе, участвует в оборонительных боях страны против авиации противника на расстоянии не более {{= utils.toInt(lib.war.airradius[2])}} полей.</dd>
		</dl>
	</div>
</script>

<script type="text/plain" id="help.battle">
	<div class="paragraph help-subtitle">Сухопутный бой</div>
	
	<div class="paragraph">Бой происходит только при {{=snip.nobr(snip.townIcon()+'городе')}}. Когда войска приходят атаковать город, начинается бой. Все войска защиты встают в очередь на вступление в бой. Все армии, во время боя пришедшие на защиту города, так же встают в очередь на вступление в бой. Точно так же все армии, пришедшие атаковать, встают в очередь на атаку. Очередь всегда отсортирована по размеру изначальной армии (в затраченном {{=snip.pop('населении')}}). В бой войска вступают из очереди. С периодичностью примерно раз в {{= timeMgr.fPeriod(lib.war.battlereinforcetime) }}. В исключительных случаях время между выходами может увеличиться. Это редкое, но допустимое событие. Число вступающих зависит от типов войск и разницы войск обеих сторон на поле боя. С каждой стороны одновременно в бою принимает участие не более {{= lib.war.battleunitsmax }} <a class="link" href="{{=HashMgr.getHref('#/help/unit')}}">боевых единиц</a>.</div>

	<div class="paragraph">Армия одного {{=snip.nobr(snip.accIcon()+'игрока')}}, разделенная на несколько армий считается разными армиями в очереди на бой.</div>
	<div class="paragraph">
		После изучения {{=snip.scienceLink(25)}}, армии разных игроков в бою могут быть условно объединены вместе, чтобы иметь более высокий приоритет на вступление в бой для назначения для них единой тактики боя. Подробнее ниже в разделе «Тактика».<br>
		Каждая армия воюет со своим бонусом войны, который был на момент внесения армии в очередь на бой.
	</div>
	<div class="paragraph">Победа засчитывается стороне, первой уничтожившей все строения противника на поле боя.</div>

	<div class="paragraph">Если нет армии защиты и боевых сооружений, способных наносить урон во время боя, то бой будет проходить условно и посмотреть его нельзя.</div>

	<div class="paragraph">В случае поражения атаки, она теряет по крайней мере {{=utils.toPercent(lib.war.siegelosedie)}}% осадных орудий.</div>
	
	<div class="paragraph">Владелец города, а также все участники боя, чьи армии продержались не менее  {{=timeMgr.fPeriod(lib.war.viewbattletime)}}  получают полный боевой отчет. Остальные получают краткий. Ограничение не действует при атаке на варваров.</div>
	
	
	<div class="paragraph help-subtitle">Тактика сухопутного боя</div>

	<div class="paragraph">
		Тактика закрепляет правила выхода войск на поле боя и только для военной операции. Она может быть использована как для атаки, так и для защиты.<br>
		Тактика не обязательно должна быть задана; если тактика не задана, то войска будут вступать в бой по обычному принципу. <br>
		Для каждой военной операции тактика устанавливается индивидуально. Выбрать тактику можно после создания военной операции, но до её прибытия в город-цель.<br>
		Сделать это может создатель военной операции или {{=snip.nobr(snip.postIcon(Country.postIds.head)+'глава')}} / {{=snip.nobr(snip.postIcon(Country.postIds.war)+'воевода')}} / {{=snip.nobr(snip.postIcon(Country.postIds.warHelp1)+'помощник воеводы')}}, если военная операция принадлежит стране.<br>
		Настройки выхода войск тактики делятся на два вида:  
		<ul>
			<li>Волны — строгая предустановленная последовательность формирования отрядов;  </li>
			<li>Правила — набор правил, определяющий, приоритет выхода отрядов на основании информации о текущем состоянии боя.</li>
		</ul>
		Сперва отряды, выходящие на поле, формируются на основании предустановленных волн. Если из имеющихся войск резерва не удается собрать требуемый волной отряд, то отряд будет собираться по следующей волне (если она задана).<br>
		После того, как все отряды по волнам вышли, последующие отряды собираются по правилам. Эти правила строятся на основании состава своих войск или войск противника на поле боя в текущий момент. <br>
		Правила расставлены по приоритетам от важных к неважным. Первое встреченное правило удовлетворяющее условиям и возможности собрать данный отряд будет принято для текущего выхода. Если не подошло ни одно правило, то отряд будет сформирован обычным способом (пропорционально от состава резерва). При задании тактик можно использовать как конкретные виды войск, так и шаблоны войск (например, &quot;живой стрелок&quot;, &quot;не техника и, желательно, стрелок&quot;).
	</div>
	
	
	<div class="paragraph help-subtitle">Бой на воде</div>
	
	<div class="paragraph">
		Атака на воде производится отдельно от атак другими родами войск.
		<br>
		Правила, действующие для водных боев:
		<ol>
			<li>Корабли атаки наносят урон кораблям защиты (в том числе транспортным) один раз;</li>
			<li>Все войска защиты наносят урон кораблям атаки один раз;</li>
			<li>Если выжил хотя бы один корабль атаки, то он наносит урон городу и населению города, грабит город.</li>
		</ol>
	</div>
	
	
	<div class="paragraph help-subtitle">Атака авиации</div>
	
	<div class="paragraph">
		Атака авиацией производится отдельно от атак другими родами войск. 
		Правила, действующие для авиаатак:
		<ol>
			<li>Используется кратчайший путь до цели, т.е. расстояние.</li>
			<li>Любой вылет всегда на {{= timeMgr.fPeriod(lib.war.airmovetimeadd) }} дольше расчетного времени полета (к возвращению время не добавляется).</li>
			<li>Некоторые из сухопутных и морских войск имеют особый вид урона — {{=snip.icon(snip.c.anyIcon, 'antiAirDamage', false, 'урон авиации')}}. При обороне города, они наносят данный урон вражеской авиации один раз за бой.</li>
			<li>Вся авиация в городах обороняющейся страны со способностью «<a class="link" href="{{=HashMgr.getHref('#/help/unit')}}">Малый/Средний/Большой радиус обороны</a>» участвует в бою в случае, если в момент боя находится на достаточном расстоянии от боя. Урон эта авиация так же наносит один раз за бой.</li>
			<li>Авиация обороны не получает урон от авиации атаки.</li>
			<li>Все строения ПВО обороняющейся страны, расположенные на линии полета вражеской авиации наносят урон. Урон рассчитывается и наносится в момент боя. Радиус действия строений ПВО составляет {{=lib.war.aaradius}} полей. Строительство зданий ПВО невозможно ускорить за {{=snip.nobr(snip.resBig(Resource.ids.luck)+'Монеты Удачи')}}.</li>
			<li>Во время боя часть авиации (согласно параметру уклонение) после получения полного урона  может «уклониться» от боя. Уклонившиеся считаются выжившими, но они не наносят урон городу. Уклонившиеся могут быть уничтожены, если получили полный урон снова.</li>
			<li>После боя авиация наносит урон городу, разрушая в нем здания. Урон городу наносится по правилам сухопутных и морских атак.</li>
		</ol>
		Другие особые правила для авиации:
		<ol>
			<li>Авиацию нельзя перевозить на кораблях.</li>
			<li>При атаке на город сухопутной армии и её победе, она уничтожает всю авиацию, находящуюся в городе на данный момент.</li>
		</ol>
	</div>
	
	
	<div class="paragraph help-subtitle">Урон городу</div>
	
	<div class="paragraph">
		Если атакующая армия победила, и у неё остались войска с особенностью «<a class="link" href="{{=HashMgr.getHref('#/help/unit')}}">Разрушитель</a>», то произойдет разрушение строений побежденного города. Прежде всего, они разрушат {{=snip.buildLink(105, 'муляж')}}, а затем {{=snip.nobr(snip.deposit()+'ресурсную колонию')}}, если имеют достаточно единиц урона. Во вторую очередь (только для сухопутных и морских атак) они будут разрушать системы ПВО и ПРО. Остальные городские цели для разрушения выбираются случайно. Прочность зданий равна количеству вложенных ресурсов в их строительство. Разрушение происходит поуровнево.<br>
		Если в городе не осталось строений (не считая фортификационных за исключением «{{=snip.buildLink(101, 'зенитной башни')}}»), то город считается разрушенным и становится варварским.
		<br><br>
		Так же, после победы нападающей армии, войска с особенностью «<a class="link" href="{{=HashMgr.getHref('#/help/unit')}}">Головорез</a>» производят небольшую зачистку {{=snip.pop('населения')}} побежденного города. При этом они не могут убить последние {{=snip.pop(~~lib.war.popkill.minpop)}} единиц населения. Для варварских {{=snip.nobr(snip.townIcon()+'городов')}} это ограничение не действует. Так же количество убитых не может превышать {{=utils.formatNum(lib.war.popkill.maxpercent, {toPercent:true})}}% от максимально возможных.<br>
		После боя, выжившая нападающая армия грабит город. При этом отменяется очередь строительства и, по необходимости, отменяются открывающиеся и открытые исходящие потоки снабжения.
	</div>
	
	<div class="paragraph help-subtitle">Общая информация</div>
	
	<div class="paragraph">Выполнив свои задачи, победившие армии атаки отправляются по домам.</div>
	
	<div class="paragraph">Одновременно из одного города может проводиться не более {{= lib.war.maxbattleevents }} атак и подкреплений.</div>
	
	<div class="paragraph">Войска, изученные менее чем у половины игроков страны, имеют штраф {{=utils.formatNum(lib.war.noresearchdebonus, {servRound:true})}}% военного бонуса.</div>
</script>

<script type="text/plain" id="help.spy">
	<div class="paragraph">После изучения {{=snip.scienceLink(30)}} и {{=snip.scienceLink(90)}}, в {{=snip.buildLink(13, 'посольствах')}} (в {{=snip.buildLink(111, 'Мохоро вождей')}} у африканцев) можно обучать {{=snip.unitNameLink(Unit.ids.spy, 'разведчиков')}}. Они необходимы для проведения разведывательных операций во вражеских городах.</div>
	<div class="paragraph">На разведку разведчики отправляются только без участия иных войск. Город, являющийся их целью не видит эту операцию до ее окончания.</div>
	<div class="paragraph">В разведывательные операции {{=snip.unitNameLink(Unit.ids.spy, 'разведчики')}} ходят напрямик через любые препятствия на местности.</div>
	<div class="paragraph">По прибытии в город, они сражаются с вражеской разведкой. При этом умирает только атакующая разведка. За каждых {{= lib.war.spyeskillk}} разведчиков в защите умирает 1 разведчик атаки.</div>
	<div class="paragraph">Если в разведываемом городе строится {{=snip.nobr(snip.wonderIcon(true)+'Чудо Света')}}, то, независимо от исхода боя, все пришедшие разведчики атаки откладывают окончание строительства на {{=snip.time(timeMgr.fPeriod(lib.war.slowwondertime))}} каждый. Но при этом текущий срок строительства уровня {{=snip.nobr(snip.wonderIcon(true)+'Чуда Света')}} не может превысить полный срок строительства этого уровня.</div>
	<div class="paragraph">Если разведка атаки выжила, то происходит разведывательная операция. Она зависит от числа выживших разведчиков атаки и {{=snip.pop('населения')}} разведываемого города.</div>
	<table class="def_table" style="border:#A8804B 1px solid;text-align:center">
		<thead><tr><td>Население / разведчики</td><td>Тип разведки</td></tr></thead>
		<tr class="trow0"><td class="aC">Не более {{= parseInt(1 / lib.war.spyk2 + Appl.C_EPSILON1000, 10) }}</td><td class="aC">Армия и снабжение</td></tr>
		<tr class="trow1"><td class="aC">Не более {{= parseInt(1 / lib.war.spyk1 + Appl.C_EPSILON1000, 10) }}</td><td class="aC">Снабжение</td></tr>
		<tfoot><tr><td></td><td></td></tr></tfoot>
	</table>
	<div class="paragraph">Обе стороны получают отчет о результатах разведывательной операции. Если разведка атаки полностью погибла, то атаковавший не узнает численность разведки защиты.</div>
</script>

<script type="text/plain" id="help.resources">
	{{ for (var id in it.resources) { }}
		<span class="resw">{{=snip.resBig(id)}}{{= it.resources[id] }}</span> 
	{{ } }}
</script>

<script type="text/plain" id="help.move">
	{{var roads = Road.getList(true);}}
	
	<div class="paragraph help-subtitle">Путь по суше</div>
	<div class="paragraph">При необходимости напасть на другой город, послать туда подкрепление или для совершения торговой операции маршрут рассчитывается по следующим правилам:</div>
	<ul>
		<li>переходы между ячейками карты могут быть только вертикальные, горизонтальные или диагональные;</li>
		<li>при перемещении вертикально или горизонтально на одну ячейку карты, дистанция составляет 1.5;</li>
		<li>при перемещении диагонально на одну ячейку карты, дистанция составляет 1;</li>
		<li>при наступании на месторождение, дистанция в данном месте будет увеличена в полтора раза;</li>
		<li>при наступании на холм, дистанция в данном месте будет увеличена в полтора раза;</li>
		<li>при наступании на гору, дистанция в данном месте будет увеличена в два раза;</li>
		<li>ячейка карты с рекой увеличивает длину пути на 1, а уровень дороги в данном месте не будет превышать уровень моста (но мост 3 уровня совместим с маглевом);</li>
		<li>войска или торговцы ищут кратчайший путь до цели.</li>
	</ul>
	<div class="help-move-img4 {{?iMap.isSimplified()}}-type-simple{{?}}">
		<div class="help-move-img4-text -type-top">Горизонтальное перемещение</div>
		<div class="help-move-img4-text -type-left">Вертикальное перемещение</div>
		<div class="help-move-img4-text -type-diag">Диагональное перемещение</div>
	</div>
	<div class="paragraph">Обратный маршрут может быть несколько больше или меньше. Это может быть связано, например, с расположением одного из городов на холме или реке.</div>
	<div class="aC">Например путь: Из 1 в 2 — <b>6.75</b>, из 2 в 1 — <b>7.00</b></div>
	
	<div class="help-move-img -type-1 {{?iMap.isSimplified()}}-type-simple{{?}}"></div>
	
	<br>
	
	<div class="paragraph help-subtitle">Дороги и тоннели</div>
	
	<div class="paragraph">
		После изучения {{=snip.scienceLink(roads[Road.ids.dirt-1].getScience())}}
		 можно прокладывать грунтовые дороги. {{=snip.scienceLink(roads[Road.ids.highway-1].getScience())}}
		 дает возможность прокладывать шоссе. Наука {{=snip.scienceLink(roads[Road.ids.railway-1].getScience())}}
		 — железную дорогу, а {{=snip.scienceLink(roads[Road.ids.maglev-1].getScience())}}
		 — маглев. А {{=snip.scienceLink(roads[Road.ids.tunnel-1].getScience())}}
		 позволит строить тоннели сквозь горы.
	</div>
		
	<div class="paragraph">Дороги и тоннели прокладываются между двумя соседними ячейками карты. Шоссе прокладывается по грунтовой дороге, ж/д — по шоссе, а маглев по ж/д.</div>
	<div class="paragraph">Дорога не может быть проложена по воде.</div>	
	<div class="paragraph">После строительства, дорога начнет использоваться в течение суток.</div>
	
	<div class="paragraph">Дороги и тоннели строятся по одному сегменту. Все затраты указаны для одного сегмента. Но при прокладке дорог через <a class="link" href="{{=HashMgr.getHref('#/help/deposit')}}">{{=snip.deposit()}}месторождения</a> стоимость вырастает втрое. После строительства любого объекта рабочие не возвращаются.</div>
	
	<div class="tbl -pad-0">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-td help-move-col0">Дорога</div>
				<div class="tbl-td help-move-col1">Стоимость</div>
				<div class="tbl-td help-move-col2">Скорость</div>
				<div class="tbl-td help-move-col3"></div>
			</div>
		</div>
		<div class="tbl-tbody">
			{{~roads: road}}
				<div class="tbl-tr">
					<div class="tbl-td help-move-col0">{{= road.getName()}}</div>
					<div class="tbl-td help-move-col1">{{= snip.resList(road.getCost())}} {{= snip.unitCountLink(road.getUnit())}}</div>
					<div class="tbl-td help-move-col2">{{= utils.toPercent(1 / road.getSpeed())}}%</div>
					<div class="tbl-td help-move-col3">{{= snip.scienceLink(road.getScience())}}</div>
				</div>
			{{~}}
		</div>
	</div>

	<br>
	<div class="paragraph help-subtitle">Водный путь</div>
	<div class="paragraph">Водный путь включает в себя как движение по морям (водным ячейкам карты), так и по рекам. Путь по водоемам в 2 раза короче чем по суше, а по рекам в 3 раза. У прибережных городов вход и выход из города осуществляется только при наличии диагональной возможности выхода.</div>
	<div class="paragraph">Корабли делятся на мелководные и глубоководные. Мелководные передвигаются как по рекам, так и по морям, океанам, но, не отходя от берега. Глубоководные корабли свободно передвигаются по водным ячейкам, но не ходят по рекам.</div>
	<div class="paragraph">Пример пути:</div>
	<div class="aC">Путь: 3.34</div>
	<div class="help-move-img -type-2 {{?iMap.isSimplified()}}-type-simple{{?}}"></div>

	<br>
	<div class="paragraph help-subtitle">Транспортировка на кораблях</div>
	<div class="paragraph">При необходимости отправить сухопутную армию в город на острове или другом континенте, можно использовать транспортные корабли. Так же транспортные корабли можно использовать для быстрой доставки сухопутных войск по воде.</div>
	<div class="paragraph">
		{{var unit = new Unit(13);}}
		Некоторые корабли имеют особенность «транспорт». Каждый такой корабль может перевозить по {{=snip.pop(lib.war.transportpopcount)}} на каждого матроса. Например, {{=snip.unitNameLink(lib.war.transportunit)}} имеет экипаж — {{=snip.pop(lib.units.list[lib.war.transportunit].popcost)}}. Значит, она может перевозить {{=snip.unitCountLink(unit, lib.war.transportpopcount * lib.units.list[lib.war.transportunit].popcost / unit.getPopCost())}}, так как каждый {{=snip.unitIconLink(unit)}} — это {{=snip.pop(unit.getPopCost())}}
	</div>
	<div class="paragraph">Для транспортировки войск на кораблях нужно включить опцию «Посадить армию на корабли» при создании военной операции. Далее нужно выбрать город погрузки на корабли. Это может быть свой город или город своей страны, основанный более чем {{=timeMgr.fPeriod(lib.war.prepareforunload, {showDimension:true, only:lib.war.prepareforunload<timeMgr.DtS?Timer.dimension.h:false})}} назад. Если цель похода находится не на берегу, куда могут добраться корабли, то войска выгрузятся в подходящем городе своей страны и продолжат свой путь. Если такого города нет, то войска выгрузятся на удобном побережье, что увеличит время пути на {{=timeMgr.fPeriod(lib.war.landingtime, {showDimension:true})}} Обратный путь равен пути до цели, рассчитанному в момент отправки войск назад.</div>
	<div class="paragraph">Если в городе погрузки недостаточно транспортных кораблей, то об этом будет соответствующее сообщение. Транспортные корабли резервируются в момент выхода армии к городу погрузки, а освобождаются по возвращении армии в родной город.</div>
	<div class="paragraph">Если армия отправлена в качестве подкрепления (с использованием транспортных кораблей), то город, предоставивший корабли, может отозвать эти войска. Войска на транспортных кораблях можно отзывать только полностью.</div>
	<div class="paragraph">Город, предоставляющий корабли, видит военные операции с использованием своих кораблей на странице военных дел.</div>
	<div class="paragraph">Транспортирующие корабли в бою не участвуют и не могут быть уничтожены до конца транспортной операции.</div>
	<div class="paragraph">Шпионы не могут проводить разведывательные операции, передвигаясь на транспортных кораблях.</div>
	<div class="paragraph">Пример транспортировки:</div>
	<div class="help-move-img -type-3 {{?iMap.isSimplified()}}-type-simple{{?}}"></div>
</script>

<script type="text/plain" id="help.deposit">
	{{?wofh.account}}
		<div class="help-control">
			<div class="help-filterBlock">
				<div class="help-page-filterWrp help-dep-filterWrp">
					<label class="clr2">{{=snip.checkbox1({attrs: {'data-filter': 1<<6}, cls: 'help-dep-filter'})}} изученные</label> 
					<label class="clr0">{{=snip.checkbox1({attrs: {'data-filter': 1<<7}, cls: 'help-dep-filter'})}} недоступные</label>
					<br>
					<label>{{=snip.checkbox1({attrs: {'data-filter': 1<<1}, cls: 'help-dep-filter'})}} {{=Tile.climate[1].title}}</label> 
					<label>{{=snip.checkbox1({attrs: {'data-filter': 1<<2}, cls: 'help-dep-filter'})}} {{=Tile.climate[2].title}}</label> 
					<label>{{=snip.checkbox1({attrs: {'data-filter': 1<<3}, cls: 'help-dep-filter'})}} {{=Tile.climate[3].title}}</label> 
					<label>{{=snip.checkbox1({attrs: {'data-filter': 1<<4}, cls: 'help-dep-filter'})}} {{=Tile.climate[4].title}}</label> 
					<label>{{=snip.checkbox1({attrs: {'data-filter': 1<<5}, cls: 'help-dep-filter'})}} {{=Tile.climate[5].title}}</label>
				</div>
			</div>
			<div class="help-filterBlock -type-resFilter">
				<div class="help-dep-resFilterWrp">
					{{@it.resFilter: filter: field}}
						<span class="help-filter help-dep-resFilter {{?filter.on}}-on{{??}}-off{{?}}" data-field="{{=field}}">{{=filter.icon}}</span>
					{{@}}
				</div>
			</div>
		</div>
	{{?}}
	<div class="help-dep-list" style="max-height: {{=utils.getWindowHeight(-70, 675)-165}}px;">
		<div class="tbl help-dep-table">
			{{~lib.map.deposit:deposit:id }}
				{{? deposit.res }}
					<div class="tbl-tr help-dep-item" data-id="{{=id}}">
						<div class="tbl-td help-dep-col0">
							<span class="map-layers {{?iMap.isSimplified()}}-type-simple{{?}}">
								<span class="map-climate -id-{{=deposit.climate}}"></span>
								<span class="map-deposit -id-{{= id}} -type-hover"></span>
							</span>
						</div>
						<div class="tbl-td help-dep-col1">
							<div class="help-dep-name">
								{{=snip.deposit(id, true)}} {{=snip.nobr(' — ' + Tile.climate[deposit.climate].title, 'span')}}
							</div>
							{{=snip.depositRes(id)}}
						</div>
						<div class="tbl-td help-dep-col2">
							{{science = Science.get(deposit.science);}}
							{{?!science.isEmpty()}}
								{{=snip.scienceLink(science, {highlight: true})}}
							{{?}}
						</div>
					</div>
				{{?}}
			{{~}}
		</div>
	</div>
</script>



<script type="text/plain" id="help.getDeposit">
	<div class="paragraph">В начале игры открыты только месторождения некоторых видов ресурсов. Другие, ещё неоткрытые, месторождения на суше выглядят и помечены как «неизвестные месторождения», а на воде скрыты.
	<br>Некоторые науки открывают месторождения, т.е. некоторые из месторождений, ранее отображавшихся как «неизвестные», становятся известными. Новые месторождения не появляются. Часть «неизвестных» месторождений никогда не станут известными.</div>

	<div class="paragraph">Чтобы колонизировать месторождение ресурса нужны {{=snip.unitLink(Unit.ids.worker, 'Рабочие')}}.
	<br>Рабочие подготавливаются в землянке или на складе.
	<br>Рабочие могут колонизировать месторождение только для города, где были обучены.
	<br>Морские месторождения можно колонизировать только из города, расположенного у воды (имеющего два или более места для строительства водных зданий).
	<br>Для возможности обучения рабочих требуется изучить {{=snip.scienceLink(2)}} и {{=snip.scienceLink(5)}}.
	<br>Чем больше у тебя городов, тем больше рабочих требуется для колонизации месторождения. Для колонизации месторождения урана требуется не менее {{= lib.resource.uranworkers }} рабочих.</div>

	<div class="paragraph">Для города можно колонизировать только одно месторождение единовременно, в зоне квадратом 5×5 ячеек вокруг. Зона колонизации не изменяется в течение игры.</div>

	<div class="paragraph">Колонизированное месторождение увеличивает производство добываемого с него ресурса в городе хозяине. При этом рост населения города падает на {{= utils.toPercent(1 - lib.town.population.depositgrown) }}%.</div>
	<div class="help-move-img -type-dep {{?iMap.isSimplified()}}-type-simple{{?}}"></div>
	<div class="paragraph">На рисунке показана область колонизации месторождения.</div>
</script>

<script type="text/plain" id="help.res">
	<div class="paragraph">
		Ресурсы делятся на основные, стратегические и социальные.
		<br>
		Основные ресурсы нужны для совершенно разных сфер деятельности и производить их может каждый город.
	</div>

	{{=tmplMgr.help.resTable({list: [0, 1, 3, 2, 4], wide: false, type: 'basic'})}}

	<div class="paragraph">Стратегические ресурсы необходимы для особых видов войск и некоторых строений. Их производство зависит от выполнения различных условий. Таких, как колонизация <a href="{{=HashMgr.getHref('#/help/deposit')}}">месторождения</a>, изучение определённой <a href="{{=HashMgr.getHref('#/help/science')}}">науки</a> т.п.</div>

	{{=tmplMgr.help.resTable({list: [5, 6, 7, 8, 10], wide: false, type: 'strategic'})}}

	<div class="paragraph">
		Социальные ресурсы могут потребляться населением, чем приносят пользу городу. К ним относятся {{=snip.cult()}}культурные, {{=snip.grow()}}демографические и особые ресурсы.<br/>
		Начать потребление социальных ресурсов можно в «Городском управлении и контроле» и подразделе «Экономика» соответствующего города.
	</div>
	<div class="paragraph">
		Ресурсы культуры при потреблении увеличивают максимальный предел {{=snip.cultEffect()}}культуры города.<br/>
		Количество расходуемого ресурса в час зависит только от размера, на который увеличивается культурный предел города после начала его потребления. Следует учитывать влияние на культурный предел, оказываемое дополнительными факторами, такими как наличие Великих граждан, улучшений местности, Бонусов Удачи
	</div>

	{{=tmplMgr.help.resTable({list: [17, 18, 19, 21], wide: true, type: 'culture'})}}

	<div class="paragraph">Количество расходуемого ресурса в час зависит только от размера, на который увеличивается {{=snip.growEffect()}}прирост города после начала его потребления. Тут также следует учитывать влияние на прирост города, оказываемое дополнительными факторами, такими как наличие Великих граждан, улучшений местности, Бонусов Удачи.</div>

	{{=tmplMgr.help.resTable({list: [11, 12, 13, 14, 15, 16], wide: true, type: 'grown'})}}

	<div class="paragraph">Особо существует ресурс, влияющий на одно из важнейших производств города. {{=snip.resBig(22)}}книги увеличивают количество производимых {{=snip.resBig(Resource.ids.science)}}знаний.</div>

	{{=tmplMgr.help.resTable({list: [22], wide: true, type: 'special'})}}

	<div class="paragraph">Каждый город одновременно может потреблять ограниченное число социальных ресурсов. Чем больше население города, тем больше видов ресурсов он может потреблять.</div>
	<div class="paragraph">При окончании потребления социального ресурса, его эффект пропадает немедленно. Если культуры стало меньше населения, то население начнет спадать постепенно.</div>
	<div class="paragraph">Индейцы добывают {{= utils.toPercent(lib.town.production.raceres[0][1]) }}% {{=snip.resBig(12)}}кукурузы, европейцы — {{= utils.toPercent(lib.town.production.raceres[1][1]) }}% {{=snip.resBig(13)}}пшеницы, азиаты — {{= utils.toPercent(lib.town.production.raceres[2][1]) }}% {{=snip.resBig(14)}}риса, а африканцы — {{= utils.toPercent(lib.town.production.raceres[3][1]) }}% {{=snip.resBig(11)}}фруктов.</div>
	<div class="paragraph">
		{{=snip.resBig(10)}} Уран имеет эффект «полураспада». За {{= lib.resource.halflifetime }} ч. запасы {{=snip.resBig(10)}} урана уменьшаются вдвое. «Полураспад» происходит непрерывно. «Полураспад» не влияет на добычу. Из залога для снабжения {{=snip.resBig(10)}} уран не возвращается.
	</div>
</script>

<script type="text/plain" id="help.resTable">
	<table class="def_table">
		<colgroup>
			{{?it.wide}}
				<col width="30%">
				<col width="25%">
				<col width="25%">
				<col width="20%">
			{{??}}
				<col width="50%">
				<col width="50%">
			{{?}}
		</colgroup>
		<thead>
			<tr>
				<td colspan="{{=it.wide? 4: 2}}">
					{{?it.type=='basic'}}Основные ресурсы
					{{??it.type=='strategic'}}Стратегические ресурсы
					{{??it.type=='culture'}}Культурные ресурсы
					{{??it.type=='grown'}}Демографические ресурсы
					{{??it.type=='special'}}Особые ресурсы
					{{?}}
				</td>
			</tr>
			{{?it.wide}}
				<tr>
					<td>Ресурс</td>
					<td>
						Расход
						{{?it.type=='culture'}} {{=snip.hint('Из расчета за '+snip.cultEffect()+'100')}}</li>
						{{??it.type=='grown'}} {{=snip.hint('Из расчета за '+snip.pop()+'1')}}</li>
						{{??it.type=='special'}} {{=snip.hint('Из расчета за '+snip.resBig(Resource.ids.science)+'1')}}</li>
						{{?}}

					</td>
					<td>Эффект</td>
					<td>Производят</td>
				</tr>
			{{?}}
		</thead>
		<tfoot><tr><td colspan="5"></td></tr></tfoot>
		<tbody>
			{{ 
				for (var i in it.list){ 
					var res = new Resource(it.list[i]);
			}}
				<tr class="trow{{=i%2}}">
					{{? res.getId() == Resource.ids.food}}
						<td colspan="2">{{=snip.resBig(res.getId())}}{{= res.getName() }}</td>
					{{??}}
						<td>{{=snip.resBig(res.getId())}}{{= res.getName() }}</td>
						{{?it.wide}}
							<td class="aC">
								{{? res.lib.consumption > 0 }}
									{{?it.type=='grown'}}
										{{= (utils.toPercent(res.lib.consumption)/100) }}
									{{??it.type=='special'}}
										{{= (utils.toPercent(res.lib.consumption)/100) }}
									{{??}}
										{{= utils.toPercent(res.lib.consumption) }}
									{{?}}
								{{?}}
							</td>
							<td>
								{{? res.getType() == Resource.types.culture }}
									{{=snip.icon(snip.c.anyIcon, 'cult', false, '+' + utils.toPercent(res.lib.effect) + '%')}}
								{{?? res.getType() == Resource.types.grown }}
									{{=snip.icon(snip.c.anyIcon, 'grow', false, '+' + utils.toPercent(res.lib.effect) + '%')}}
								{{?? res.getType() == Resource.types.science }}
									<nobr><img class="wget1" src="https://test.waysofhistory.com/img/_.gif" data-title="Производство знаний в городе" /> +{{= utils.toPercent(res.lib.effect) }}%</nobr>
								{{?}}
							</td>
							
							<td class="aC">{{=snip.resProdtypeIcon(res.getProdtype())}}</td>
						{{??}}
							<td>{{=snip.resProdtypeIcon(res.getProdtype(), true)}}</td>
						{{?}}
					{{?}}
				</tr>
			{{
				}
			}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="help.trade">
	<div class="paragraph">Для того чтобы начать торговать нужно построить <a class="link" href="{{=HashMgr.getHref('#/buildinfo/87')}}">Площадь</a>.</div>
	<div class="paragraph">{{=snip.trader()}}Торговцы ходят со скоростью {{= parseInt(lib.trade.speed, 10) }} полей в час (<a class="link" href="{{=HashMgr.getHref('#/help/race')}}">{{=snip.accIcon(new Account([-1,'',1,Race.ids.asia]))}} азиаты</a> со скоростью {{= parseInt(lib.trade.asiaspeed, 10) }}). Каждый из них может переносить до {{= lib.trade.capacity }} единиц ресурсов. Изначальная максимальная дистанция торговли — {{= lib.trade.distance }} полей.</div>
	<div class="paragraph">Расчет пути {{=snip.trader()}}торговцев происходит как и у войск. У прибрежного города {{=snip.trader()}}торговцы могут быть как сухопутные, так и водные (в зависимости от расположения города и пути к цели).</div>
	<div class="paragraph">Торговать можно всеми ресурсами, кроме {{=snip.resBig(Resource.ids.science)}}знаний и {{=snip.resBig(Resource.ids.money)}}денег.</div>
	<div class="paragraph">На раннем этапе торговля осуществляется как обмен ресурсами. Для совершения торговой операции нужно выставить торговое предложение и ждать, пока его кто-то купит. Можно также купить ресурсы по уже имеющемуся чужому торговому предложению.</div>

	<div class="paragraph help-subtitle">Продвинутая торговля</div>
	<div class="paragraph">После изучения науки {{=snip.scienceLink(19)}}, города начинают производить новый ресурс — <span class="nobr">{{=snip.resBig(Resource.ids.money)}}деньги</span>. Становится доступна торговля за {{=snip.resBig(Resource.ids.money)}}деньги. <span class="qinf-mmenuBtn -type-money"></span> Средства для осуществления сделок используются из единой казны игрока. При этом прежний способ торговли определенное время остается доступен.</div>
	<div class="paragraph">На странице торговли появляются новые интерфейсы для управления продвинутой торговлей.</div>
	<div class="paragraph">В каждом городе можно выставлять предложения на покупку и продажу товаров. Торговля ведется за {{=snip.resBig(Resource.ids.money)}}деньги по указанным ценам.</div>
	<div class="paragraph">Если покупка не удалась (например, из-за отсутствия торговцев у продавца), то предложение временно убирается с рынка.</div>
	<div class="paragraph">Доставка товара всегда осуществляется торговцами продающего города.</div>

	<div class="paragraph help-subtitle">Снабжение. Торговые потоки</div>
	<div class="paragraph">После изучения науки {{=snip.scienceLink(19)}}, появляется возможность создавать торговые потоки для осуществления постоянного снабжения.</div>
	<div class="paragraph">Торговый поток представляет собой равномерное перетекание ресурсов из одного города в другой. Для потока используются торговцы, и действуют стандартные правила денежной торговли.</div>
	<div class="paragraph">Поставляемые ресурсы могут быть оплачиваемы. Цену товара устанавливает поставщик при создании исходящего снабжения. Если цена отсутствует, то создание потока начнется немедленно. Если же цена указана, то покупателю придет предложение о его создании.</div>
	<div class="paragraph">При создании потока, оба участвующих города должны внести залоговые ресурсы, которые будут возвращены по окончанию действия потока. Исключением является снабжение {{=snip.resBig(10)}}ураном.</div>

	<div class="paragraph help-subtitle">Ускорение снабжения и доставки грузов</div>
	<div class="paragraph">Для ускорения снабжения и доставки грузов можно использовать определенные ресурсы.</div>
	{{var landCons = new ResList(lib.trade.fuellcons);}}
	{{var waterCons = new ResList(lib.trade.fuelwcons);}}
	{{var airCons = new ResList(lib.trade.fuelacons);}}
	{{var landSpeed = new ResList(lib.trade.fuellspeed);}}
	{{var waterSpeed = new ResList(lib.trade.fuelwspeed);}}
	{{var airSpeed = new ResList(lib.trade.fuelaspeed);}}

	{{var fuelScience = new ResList(lib.trade.fuelscience);}}
	{{var scienceFuel = new ScienceList();}}


	{{@ fuelScience.getList(): fs}}
		{{
			var science = new Science(fs.getCount());
			science.fuel = fs;
			scienceFuel.addElem(science);
		}}
	{{@}}
	<table class="def_table">
		<thead>
			<tr>
				<td>По суше</td>
				<td>По воде</td>
				<td>По воздуху</td>
				<td>Требуется</td>
			</tr>
		</thead>
		<tfoot><tr><td colspan="4"></td></tr></tfoot>
		<tbody>
			{{@ scienceFuel.getSortList('cost', true).getList(): sf: i}}
				<tr class="trow{{=i%2}}">
					{{var lRes = landCons.getElem(sf.fuel.getId());}}
					{{var wRes = waterCons.getElem(sf.fuel.getId());}}
					{{var aRes = airCons.getElem(sf.fuel.getId());}}
					{{?(lRes && lRes.getCount()) || (wRes && wRes.getCount()) || (aRes && aRes.getCount())}}
						<td class="aC">
							{{?lRes && lRes.getCount()}}
								{{=snip.resBig(sf.fuel)}}{{=lRes.getCount()}} даёт ускорение {{=landSpeed.getCount(lRes)}}x
							{{??}}
								&mdash;
							{{?}}
						</td>
						<td class="aC">
							{{?wRes && wRes.getCount()}}
								{{=snip.resBig(sf.fuel)}}{{=wRes.getCount()}} даёт ускорение {{=waterSpeed.getCount(wRes)}}x
							{{??}}
								&mdash;
							{{?}}
						</td>
						<td class="aC">
							{{?aRes && aRes.getCount()}}
								<br>
								<span class="cl-blue">
									{{=snip.resBig(sf.fuel)}}{{=aRes.getCount()}} даёт ускорение {{=airSpeed.getCount(aRes)}}x
								</span>
							{{??}}
								&mdash;
							{{?}}
						</td>
						<td>
							{{=snip.scienceLink(sf.getId(), {highlight: true})}}
							{{?aRes && aRes.getCount()}}
								<br>
								{{=snip.nobr(snip.wonderIcon(true) + ' Грузовые аэропорты', false, 'cl-blue pl03')}}
							{{?}}
						</td>
					{{?}}
				</tr>
			{{@}}
		</tbody>
	<table>

	<i style="font-size:13px">Потребление ресурсов указано из расчета на 100 единиц груза за 1 клетку пути.</i>
	<div class="paragraph"><span class="iconTab -id-14"></span> Настройка использования ресурсов для этого происходит в «Торговле» для каждого города игрока индивидуально.</div>

	<div class="paragraph help-subtitle">Торговые союзы</div>
	<div class="paragraph">Вступая в страну игрок автоматически попадает в {{=snip.tradeUnion('торговый союз')}} этой страны. Выйти из него можно только покинув страну.</div>
	<div class="paragraph">Можно так же создавать личные {{=snip.tradeUnion('торговые союзы')}}. Игрок, создавший такой {{=snip.tradeUnion('союз')}}, является его главой и может добавлять в этот {{=snip.tradeUnion('союз')}} как игроков, так и целые страны.</div>
	<div class="paragraph">
		Все торговые предложения, выставленные для {{=snip.tradeUnion('торгового союза')}}, будут доступны только участникам этого {{=snip.tradeUnion('союза')}}. Если покинуть {{=snip.tradeUnion('торговый союз')}}, то все предложения игрока для данного {{=snip.tradeUnion('торгового союза')}} будут сняты с рынка.
		 Размер торгового союза ограничен. Если в нем находится более {{=lib.tradeally.maxmembers}} участников, то он перестает функционировать.
	</div>
	
</script>

<script type="text/plain" id="help.race">
	<div class="paragraph">
		При регистрации можно выбирать свою расу. Это могут быть Индейцы, Европейцы, Азиаты или Африканцы. У каждой расы есть свои сильные стороны и уникальные виды войск.
	</div>
	
	<div class="tbl help-race-table">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-td">Индейцы</div>
				<div class="tbl-td">Европейцы</div>
				<div class="tbl-td">Азиаты</div>
				<div class="tbl-td">Африканцы</div>
			</div>
		</div>
		<div class="tbl-tbody">
			<div class="tbl-tr">
				<div class="tbl-td">
					<div>Потребляют на {{= utils.toPercent(1 - lib.resource.indianconsumptionk) }}% меньше всех социальных ресурсов.</div><br>
					<div>Наносят больший урон ловушками перед боем на {{= lib.war.indiatrapdamage[0] }} + {{= utils.toPercent(lib.war.indiatrapdamage[1]-1) }}%.</div>
				</div>
				<div class="tbl-td">
					<div>Культура на {{= utils.toPercent(lib.town.population.europeculture - 1) }}% выше.</div><br>
					<div>Обзор карты больше на {{= (lib.map.view.europerange[0]) }} + {{= utils.toPercent(lib.map.view.europerange[1]-1) }}%.</div><br>
					<div>Частоколы и стены имеют повышенную на {{= utils.toPercent(1 / lib.war.europedefarmor - 1) }}% стойкость к осадным орудиям.</div>
				</div>
				<div class="tbl-td">
					<div>Рост населения на {{= utils.toPercent(lib.town.population.asiagrown - 1) }}% выше.</div><br>
					<div>Скорость движения торговцев {{= parseInt(lib.trade.asiaspeed, 10) }} полей в час (вместо {{= parseInt(lib.trade.speed, 10) }}).</div>
				</div>
				<div class="tbl-td">
					<div>+{{= Math.round(lib.war.afrikaattack * 100) }}% бонус войны.</div><br>
					<div>Содержание строений на {{= utils.toPercent(1 - lib.town.production.afrikaeconomy) }}% дешевле.</div>
				</div>
			</div>
			<div class="tbl-tr">
				<div class="tbl-td">
					<div>Производят на {{= utils.toPercent(lib.town.production.raceres[0][1] - 1) }}% больше {{=snip.resBig(12)}}Кукурузы.</div>
				</div>
				<div class="tbl-td">
					<div>Производят на {{= utils.toPercent(lib.town.production.raceres[1][1] - 1) }}% больше {{=snip.resBig(13)}}Пшеницы.</div>
				</div>
				<div class="tbl-td">
					<div>Производят на {{= utils.toPercent(lib.town.production.raceres[2][1] - 1) }}% больше {{=snip.resBig(14)}}Риса.</div>
				</div>
				<div class="tbl-td">
					<div>Производят на {{= utils.toPercent(lib.town.production.raceres[3][1] - 1) }}% больше {{=snip.resBig(11)}}Фруктов.</div>
				</div>
			</div>
			<div class="tbl-tr">
				{{ for (var race in Race.bin) { }}
					{{ if (race == 'all') continue; }}
					<div class="tbl-td">
						{{@Army.getAll().sortByDefault().getList(): unit }}
							{{? unit.hasRace(Race.ids[race]) && unit.isRaceUnique() }}
								{{=snip.unitNameLink(unit)}}<br>
							{{?}}
						{{@}}
					</div>
				{{ } }}
			</div>
			<div class="tbl-tr">
				{{var slotList = SlotList.getSorted().getList();}}
				
				{{@Race.bin: race}}
					{{?race == Race.bin.all}}{{continue;}}{{?}}
					
					<div class="tbl-td">
						{{@slotList: slot}}
							{{? slot.getRaces().racebin == race && slot.getSlotType() != Build.slotType.no }}
								<div>
									<a href="{{=hashMgr.getWndHref('buildinfo', slot.getId())}}">
										<div class="build_icon_s {{?slot.isWonder()}}build_icon_sw{{?}}"><img src="https://test.waysofhistory.com/img/buildings2/{{=slot.getId()}}_{{=slot.getPic()}}.png"></div>
										<br>
										{{=slot.getName()}}
									</a>
								</div>
							{{?}}
						{{@}}
					</div>
				{{@}}
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="help.map">
	<div class="paragraph help-subtitle">Особенности климатических зон</div>

	<div class="tbl -pad-0 help-map-table">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-td help-map-col01">Климат</div>
				<div class="tbl-td help-map-col2">Наука</div>
				<div class="tbl-td help-map-col3">Сельское хозяйство</div>
				<div class="tbl-td help-map-col4">Промышленность</div>
				<div class="tbl-td help-map-col5">Финансы</div>
			</div>
		</div>
		<div class="tbl-tbody">
			{{@ Tile.climate: climate: id }}
				{{? id != Tile.climateIds.undefined && id != Tile.climateIds.deepwater}}
					<div class="tbl-tr">
						<div class="tbl-td help-map-col0">
							<div class="map-layers -type-mini {{?iMap.isSimplified()}}-type-simple{{?}}">
								<div class="map-climate -id-{{=id}}"></div>
							</div>
						</div>
						<div class="tbl-td help-map-col1">{{= climate.title }}</div>
						<div class="tbl-td help-map-col2">{{= utils.toPercent(lib.town.production.climatebonus.knowledge[id]) }}%</div>
						<div class="tbl-td help-map-col3">{{= utils.toPercent(lib.town.production.climatebonus.food[id]) }}%</div>
						<div class="tbl-td help-map-col4">{{= utils.toPercent(lib.town.production.climatebonus.production[id]) }}%</div>
						<div class="tbl-td help-map-col5">{{= utils.toPercent(lib.town.production.climatebonus.money[id]) }}%</div>
					</div>
				{{?}}
			{{@}}
		</div>
	</div>

	<div class="paragraph">До выполнения определенного начального задания все климатические зоны на карте выглядят одинаково, а месторождения других климатических зон как неизвестные. За исключением водного климата.</div>
	<div class="paragraph help-subtitle">Разведка карты</div>
	<div class="paragraph">Сначала ты видишь только небольшой участок карты вокруг своего города, но по мере развития сможешь открывать новые территории. Открытая территория уже никогда не закроется.</div>
	<div class="paragraph">Зона обзора расширяется при следующих условиях:</div>
	<ol>
		<li>При нападении на игрока, нападающая сторона получает обзор атакуемого города в случае победы и если размер выжившей армии не менее {{=snip.pop(lib.map.attackopenpop)}}, а защищающаяся сторона получает обзор атакующего города в любом случае.{{=snip.hint('Условие действует, если расстояние между городами не превышает '+lib.map.view.openmaxdistance+' полей.')}}</li>
		<li>При транспортировке ресурсов, город, принимающий ресурсы, получает зону обзора поставщика при условии, что объем транспортировки не менее {{= lib.map.view.opentradevalue }} единиц.{{=snip.hint('Условие действует, если расстояние между городами не превышает '+lib.map.view.openmaxdistance+' полей.')}}</li>
		<li>После изучения некоторых наук вся видимая область расширяется.</li>
		<li>При вступлении в страну (после окончания объединения), игрок получает видимость всех городов страны, а страна — городов игрока.</li>
		<li>На расстояние более {{= lib.map.view.openmaxdistance }} полей можно отправлять разведчиков для исследования местности. Отправлять разведчиков можно только в место на карте без города. Число разведчиков зависит от расстояния. После успешной операции разведчики не возвращаются.</li>
		<li>Все игроки страны получают обзор каждого нового города страны.</li>
	</ol>
</script>

<script type="text/plain" id="help.env">
	<div class="paragraph">
		Каждый город может использовать улучшения местности, расположенные непосредственно рядом с ним. Увидеть их можно на карте.
		<br>Улучшения дают различные бонусы городам.
		<br>Если улучшением пользуется не один город, то бонусы каждому будут уменьшены тем сильнее, чем больше городов используют данное улучшение.
		<br>В случае, если на месте улучшения строится город, то оно уничтожается безвозвратно. При постройке улучшения на месте другого, оно его замещает. Но мосты и гидротехнические сооружения существуют вместе с любыми улучшениями или городом и продолжают давать свой эффект.
		<br>Почти все улучшения можно построить только непосредственно возле города. Но дороги и мосты можно построить не далее {{=lib.map.makeroaddistance}} полей от строящего города или прямо в нем. Подробнее о дорогах и их строительстве, отличном от строительства улучшений местности ты можешь прочитать в разделе <a class="link" href="{{=HashMgr.getHref('#/help/move')}}">«Дороги и передвижение войск, торговцев»</a>.
		<br>После строительства улучшения {{=snip.unitIcon(Unit.ids.worker)}}рабочие в город не возвращаются.
	</div>

	<center>
		<table class="s-tbl tbl-env">
			<thead><tr><td colspan="{{?it.cellAlignCenter}}5{{??}}6{{?}}">Улучшения местности</td></tr></thead>
			<tbody>
				{{@MapImp.getAll().getSortList('getHelpPos', true).getList(): imp}}
					{{=tmplMgr.help.envItem({imp: imp, cellAlignCenter: it.cellAlignCenter})}}
				{{@}}
			</tbody>
			<tfoot><tr><td colspan="{{?it.cellAlignCenter}}5{{??}}6{{?}}"></td></tr></tfoot>
		</table>
	</center>
</script>


<script type="text/plain" id="help.envItem">
	{{
		var impLevels = it.imp.getMaxLevel();
		var cellSpan = it.cellAlignCenter ? 5 : 4 + (impLevels - 1);
		
		it.imp = it.imp.getMaxKnown() || it.imp;
	}}
	
	{{?it.cellAlignCenter}}
		{{=tmplMgr.help.envItem.title(it)}}
	{{?}}
	
	<tr>
		<td class="help-env-img-wrp js-pedia-imp-img" {{?it.cellAlignCenter}}col{{??}}row{{?}}span="{{=cellSpan}}" data-id="{{=it.imp.getId()}}">
			<div class="help-env-itemNew-block -effects -large-text">
				{{=tmplMgr.help.envItemEffect(it)}}
			</div>
			
			<div class="map-layers {{?iMap.isSimplified()}}-type-simple{{?}}">
				<div class="map-climate -id-{{=it.imp.getDefClimate()}}"></div>
				{{?it.imp.getId()==0}}
					{{?iMap.isSimplified()}}
						<div class="map-river -dir-0"></div>
						<div class="map-river -dir-4"></div>
					{{??}}
						<div class="map-river -id-1"></div>
					{{?}}
				{{??it.imp.getId()==5}}
					{{?iMap.isSimplified()}}
						<div class="map-river -dir-2"></div>
						<div class="map-river -dir-6"></div>
					{{??}}
						<div class="map-river -id-2"></div>
					{{?}}
				{{??it.imp.getId()==2}}
					<div class="map-hill -climate-{{=it.imp.getDefClimate()}}"></div>
				{{??it.imp.getId()==MapImp.ids.skiResort}}
					<div class="map-mountain -climate-{{=it.imp.getDefClimate()}}"></div>
				{{?}}
				
				{{= tmplMgr.pedia.imp.img(it.imp)}}
			</div>
		</td>
	</tr>
	
	{{?!it.cellAlignCenter}}
		{{=tmplMgr.help.envItem.title(it)}}
	{{?}}
	
	<tr class="trow1">
		<td colspan="5" class="-large-text">{{= it.imp.getHint()}}</td>
	</tr>
	
	{{?impLevels > 1}}

		{{
			for (var level = 1; level < impLevels + 1; level++){
				it.imp.level = level;
				var impEffect = it.imp.getEffect();
		}}

			<tr class="trow0 js-pedia-imp-level" data-level="{{=level}}" data-imp="{{=it.imp.getId()}}">
				<td class="tbl-env-col1"><span class="{{?it.imp.isAvail()}}-warn -type-green{{??}}-bgWarn -type-red{{?}}">{{=level}} ур.</span></td>
				<td class="tbl-env-col2">
					{{?impEffect}}
						+{{=snip.mapImpEffectValue(it.imp, {effect:impEffect})}}
					{{?}}
				</td>
				<td class="tbl-env-col3">{{=snip.resBigList(it.imp.getCost())}}</td>
				<td class="tbl-env-col4">{{=snip.unitCountLink(it.imp.getWorkers())}}</td>
				<td class="tbl-env-col5 -large-text">
					{{=snip.scienceLink(it.imp.getScience(), {highlight: true})}}
				</td>
			</tr>

		{{ } }}

	{{??}}
		<tr class="trow0">
			<td colspan="3" style="min-width: 120px;">{{=snip.resBigList(it.imp.getCost())}}</td>
			<td style="text-align: left;">{{=snip.unitCountLink(it.imp.getWorkers())}}</td>
			<td style="text-align: left;"><span class="-lenLim -large-text dIB" style="max-width: 100px;">{{=snip.scienceLink(it.imp.getScience())}}</span></td>
		</tr>
	{{?}}
</script>

<script type="text/plain" id="help.envItem.title">
	<tr class="help-env-name {{?it.imp.getId() != 0}}-type-bordered{{?}}">
		<td class="-large-text aC" colspan="5"><strong>{{=it.imp.getName()}}</strong></td>
	</tr>
</script>

<script type="text/plain" id="pedia.imp.img">
	<div class="map-improvement -id-{{=it.getId()}} -level-{{=it.getLevel()}} {{?iMap.isSimplified()}}-type-simple{{?}}"></div>
</script>


<script type="text/plain" id="help.envItemEffect">
	{{?it.imp.getId()==0}}
		Переправа через реки
	{{??}}
		{{it.imp.level = 1;}}
		
		{{
			var preFix = '';
			var postFix = '';
		}}
		
		{{?it.imp.hasAddEffect()}}
			{{preFix = snip.mapImpEffectIcon(it.imp, {useResIcon:true});}}
		{{??}}
			{{=snip.mapImpEffectIcon(it.imp)}}
		{{?}}
		
		+
		
		{{=snip.list(it.imp.getLevels(), function(level, i){
			it.imp.level = (+i)+1;
			
			var effect = it.imp.getEffect(),
				text = '';
			
			if( it.imp.getEffectUngrown() )
				postFix = ' ' + snip.mapImpEffectUngrown(it.imp, {effect:effect});
			else if( it.imp.getEffectProd() )
				postFix = ' ' + snip.mapImpEffectProd(it.imp, {effect:effect});
			
			return snip.nobr(snip.mapImpEffectValue(it.imp, {effect:effect, preFix:preFix, postFix:postFix, noPostFix:true}), false, 'pb02 imp-effect-level -impId-'+it.imp.getLevel());
		})}}
		
		{{?it.imp.isEffectGetTypePercent()}}%{{?}}
	{{?}}
</script>


<script type="text/plain" id="help.country">
	<div class="paragraph">Игрокам необходимо объединяться в страны для координации действий и взаимопомощи. Все игроки страны вместе развивают свою науку быстрее, чем, если бы они были по отдельности.</div>
	<div class="paragraph help-subtitle">Создание страны</div>
	<div class="paragraph">Создать новую страну можно в <span class="nobr"><a class="link" href="{{=HashMgr.getHref('#/buildinfo/13')}}">посольстве</a></span>. Игрок, создавший страну, становится главой этой страны. Глава страны может приглашать игроков в страну и раздавать им должности.
	<br>В страну может вступить любой игрок, видящий хотя бы один город страны, находящийся на расстоянии не более {{=+utils.formatNum(lib.country.joindistance, {fixed:1})}} полей от любого города игрока.</div>
	<div class="paragraph">Вступать в страну можно не раньше чем через {{=timeMgr.fPeriod(lib.country.jointime)}} после предыдущего вступления в любую страну.</div>

	<div class="paragraph help-subtitle">Очки дипломатии</div>
	<div class="paragraph">После того, как страна создана, можно приглашать игроков присоединиться к ней.</div>
	<div class="paragraph">Для вступления каждого нового игрока требуются очки дипломатии. Их дают посольства. Каждый игрок может построить только одно посольство. Очки дипломатии страны — это сумма очков дипломатии всех игроков этой страны. Если случилось так, что очков дипломатии слишком мало для страны с таким числом игроков, то все знания, переданные в науку, будут пропадать.</div>


	<div class="paragraph help-subtitle">Наука страны</div>
	<div class="paragraph">Научное состояние страны, это среднее состояние наук всех игроков страны. При изучении науки в стране, она изучается только для тех членов страны, которые её не изучили ранее. При вступлении в страну игроки не могут потерять частично или полностью изученные науки, а страна может. Научное состояние страны и членов страны может отличаться (в результате вступления в страну).</div>

	<div class="paragraph help-subtitle">Налоги и бюджет</div>
	<div class="paragraph">После изучения {{=snip.scienceLink(19, {text: 'Денег'})}}, в стране появляется возможность собирать налоги. {{=snip.nobr(snip.postIcon(Country.postIds.economics)+'Казначей')}} страны устанавливает единые налоги для всех игроков страны, и у них начинает происходить отчисление в казну страны или накопление налоговой задолженности. {{=snip.nobr(snip.postIcon(Country.postIds.economics)+'Казначей')}} так же может устанавливать правила бюджетных выплат из казны игрокам страны.</div>

	<div class="paragraph help-subtitle">Должности</div>
	
	<div class="paragraph"><b>Глава</b> — управляет страной, назначает других игроков на соответствующие должности, обозначает врагов и союзников страны.</div>
	<div class="paragraph"><b>Советник</b> — имеет доступ к специальной исторической и статистической информации по стране.</div>
	<div class="paragraph"><b>Казначей</b> — устанавливает налоги, ведет казну страны, собирает налоговые задолженности и направляет субсидии.</div>
	<div class="paragraph"><b>Мудрец</b> — устанавливает последовательность изучения наук, видит научный потенциал каждого игрока.</div>
	<div class="paragraph"><b>Воевода и его помощники</b>  — видят войска и военные события всех членов страны, координируют военные операции.</div>
	<div class="paragraph"><b>Учётчик и его помощники</b>  — организуют и контролируют перераспределение ресурсов страны.</div>
	
	<div class="paragraph help-comment">* Только должностные лица страны могут посылать сообщения всей стране</div>
</script>

<script type="text/plain" id="help.barbarian">
	<div class="paragraph">Города игроков, заблокированных за нарушения правил или не посещавших игру в течение длительного времени, а так же разрушенные другими игроками становятся варварскими. Так же варварские города могут появляться случайным образом рядом с городами игрока во время прохождения стартовых заданий.</div>
	<div class="paragraph"><b>Культура в таких городах опускается до {{= lib.town.population.barbarianculture }} и начинается спад населения. Варвары с населением {{= lib.town.population.barbarianculture }} исчезают.</b></div>
	<div class="paragraph">Становясь варварским, город отзывает свои подкрепления, выдворяет чужие и разрушает все свои фортификационные сооружения.</div>
	<div class="paragraph">На карте города варваров соответственно подписаны и отображаются особым образом.</div>
	<div class="paragraph">Варварский город можно атаковать и грабить, как обычный, пока население в нем не уменьшится до {{= lib.town.population.barbarianculture }}.</div>
</script>

<script type="text/plain" id="help.win">
	<div class="js-searchMark">Для победы в игре необходимо построить, запустить и вывести на нужный курс космический корабль (КК).</div>
	<div class="js-searchMark">КК собирается из специальных компонентов. Компоненты КК строятся на {{=snip.link(HashMgr.getHref('#/buildinfo/59'), 'космическом заводе')}}.</div>
	<div class="js-searchMark">Сборка космического корабля происходит на {{=snip.link(HashMgr.getHref('#/buildinfo/77'), 'космодроме')}}. Сборка КК возможна только на космодроме 20 уровня. Для сборки КК необходимо доставить на космодром нужное количество всех компонентов. Компоненты КК передвигаются как обычные сухопутные войска, но их можно отправить только в качестве подкрепления в город с космодромом 20 уровня. При этом их уже нельзя отозвать, пока космодром присутствует в городе. Компоненты могут использоваться только от игроков страны. Компоненты чужих стран будут разрушаться. Строительство космодрома нельзя ускорить за Монеты Удачи.</div>
	<br>
	<center>
		Для сборки КК необходимо:<br><br>
		<table class="def_table"><thead><tr><td>Ресурсы</td><td>Количество</td></tr></thead>
		{{~ lib.spaceship.components: component:i}}
			<tr class="trow{{= i % 2 }}" bgcolor="#f2cc9a">
				<td>&nbsp;&nbsp;{{=snip.unitNameLink(component.id)}}</td>
				<td>{{= component.count }}&nbsp;</td>
			</tr>
		{{~}}
		<tfoot><tr><td></td><td></td></tr></tfoot></table>
	</center>
	<br>
	<div class="paragraph aC"><b>Запуск и вывод на курс КК</b></div>
	<div class="js-searchMark">Когда все необходимое доставлено на <a class="link" href="{{=HashMgr.getHref('#/buildinfo/77')}}">космодром</a>, можно запустить сборку корабля. КК будет собираться {{= lib.spaceship.assembletime / 86400 }} дней. Если во время сборки КК необходимые детали и войска будут не в полном объеме (например, умрут от «голода»), то сборка КК прервется. При сборке КК и при наличии собранного КК, владелец КК не может покинуть страну, и никто не может вступить в эту страну. Нельзя начать сборку КК, пока не все игроки страны имеют одинаковое научное состояние. При отсутствии дальнейшей возможности финансирования <a class="link" href="{{=HashMgr.getHref('#/buildinfo/77')}}">космодрома</a>, он пропадает вместе со всеми компонентами.</div>
	<div class="paragraph aC"><b>Запуск КК</b></div>
	<div class="js-searchMark">Для запуска собранного КК требуется иметь в стране {{= lib.spaceship.controlcenterssum}} или более активированных <a class="link" href="{{=HashMgr.getHref('#/buildinfo/29')}}">Центров управления полетами (ЦУП)</a>. Запуск и выведение на нужный курс КК длится {{=timeMgr.fPeriod(lib.spaceship.launchtime)}} В это время владельцы активированных <a class="link" href="{{=HashMgr.getHref('#/buildinfo/29')}}">ЦУП</a> не могут покинуть страну. При отсутствии дальнейшей возможности финансирования <a class="link" href="{{=HashMgr.getHref('#/buildinfo/29')}}">ЦУП</a>, он пропадает. После окончания периода запуска и выведения на курс главе страны остается только написать прощальное слово и заявить победу в мире. Вывод на курс Корабля увеличивает очки рейтингов всех граждан этой страны на {{=utils.formatNum(lib.spaceship.ratemultiplier - 1, {toPercent:true, servRound:true})}}%.</div>
	
	/* 
	<div class="paragraph help-subtitle">Победа</div>

	<br>По истечении полного срока сборки, КК будет готов к запуску.
	<br>Запуск корабля является победой всей страны, в которой он запущен.
	<br>При запуске корабля необходимо оставить сообщение. Это сообщение, как и данные о мире и стране-победителе попадут в Зал славы.
	<br>Победителем в мире признается только одна страна, запустившая Космический Корабль в космос. Все остальные страны, в том числе и союзники победителей, являются проигравшими.
	<br>В прощальном слове в любом контексте запрещено упоминание конкретных игроков и стран, неотносящихся к победителям. Запрещено упоминание любых объединений стран.
	*/
</script>

<script type="text/plain" id="help.changelog">
	<div>Версия 1.4.43</div>
	<ul>
		<li>Здания можно переставлять местами за Монеты Удачи;</li>
		<li>Новый боевой юнит - мотоциклист (пока только в симуляторе);</li>
		<li>Добавлено новое Чудо Света &quot;Грузовой аэропорт&quot;;</li>
		<li>Можно устанавливать уровень остатка казны, защищённый от операций по вкладам и кредитам;</li>
		<li>В выборах главы не участвуют игроки, отсутствующие в игре длительный срок;</li>
		<li>Добавлен график истории финансовых затрат на обучение войск;</li>
		<li>Отчёты о состоянии аккаунта и городов можно делать раз в 10 часов (было 20 часов).</li>
	</ul>
	
	<div>Версия 1.4.42</div>  
	<ul>
		<li>В горах можно строить тоннели;</li>
		<li>Бартерную систему торговли можно включить в любой момент;</li>
		<li>Путь по водоемам в 2 раза короче чем по суше, а по рекам в 3 раза (было 1.5 / 2);</li>
		<li>Эффективность кампусов уменьшена до 1%/2%/3% (было 2%/4%/7%);</li>
		<li>Кампусы дополнительно увеличивают число рабочих мест во всех научных строениях на 2%/4%/6%;</li>
		<li>Залог в потоках уменьшен до 3-х часов (было 5 часов);</li>
		<li>Изменилась цена шоссе в населении и граните: 50 человек (было 100), 700 гранита (было 500);</li>
		<li>Введён новый боевой тег юнитов - тяжелобронированный.</li>
	</ul>
	
	<div>Версия 1.4.41</div>  
	<ul>
		<li>Введены дотации на производство ресурсов;</li>
		<li>В условиях тактик можно указывать численность сторон;</li>
		<li>Полностью введены войска: робопёс и моргенштерн;</li>
		<li>Уменьшено число требуемых ЦУП до 4-х (было 5);</li>
		<li>Улучшен горнолыжный курорт - доход 250/600/1400 (было 150/400/1000), спад населения 6,8/16,2/37,8 (было 6/16/40), так же добавлен эффект бонуса производства за Монеты Удачи.</li>
	</ul>
	
	<div>Версия 1.4.40</div>  
	<ul>
		<li>Добавлены новые должности: учетчик и два помощника;</li>
		<li>Введен новый инструмент страны - заказы ресурсов;</li>
		<li>Предложения потоков можно сопровождать текстами.</li>
	</ul>
	
	<div>Версия 1.4.39</div>  
	<ul>
		<li>Новый режим симулятора боя - симуляция естественного боя при городе (с волнами и тактиками);</li>
		<li>Убраны учебные бои;</li>
		<li>В правилах тактики можно учитывать количество существующих линий сооружений каждой стороны;</li>
		<li>Нельзя объединять войска разных стран в одной военной операции;</li>
		<li>Войска, изученные менее чем у половины игроков страны, имеют штраф 15% военного бонуса;</li>
		<li>Миротворцы и робкие юниты не учитываются в размере армии в очереди на бой;</li>
		<li>Военную операцию защиты может отменить владелец города-цели;</li>
		<li>Город может быть использован для выгрузки войск транспортными кораблями только после 12 часов существования;</li>
		<li>Время высадки/посадки войск вне берега уменьшено до 24 ч. (было 48 ч.);</li>
		<li>Начавшуюся военную операцию нельзя отменить, пока в городе-цели идет бой.</li>
	</ul>
	
	<div>Версия 1.4.38</div>  
	<ul>
		<li>В симулятор боя добавлены юниты: моргенштерн, робопёс;</li>
		<li>Правилам тактики можно задавать несколько условий</li>
		<li>Торговые союзы не работают при численности участников более 250 игроков (125 в мирах с сокращенными странами);</li>
		<li>После боя войска возвращаются домой с разделением по скоростям (кроме транспортируемых);</li>
		<li>Введено улучшение местности - горнолыжный курорт;</li>
		<li>Технология &quot;биологическое оружие&quot; заменена на &quot;слабый искусственный интеллект&quot;;</li>
		<li>Уменьшен бонус производства &quot;нанотехнологии&quot; до 20% (было 30%);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>
	
	<div>Версия 1.4.37</div>  
	<ul>
		<li>Великие Граждане выпадают более равновероятно;</li>
		<li>Изменены коэффициенты научного распределения;</li>
		<li>Корабли выходят и заходят по водоему в город в любом направлении, но только при наличии диагональной возможности (были только диагональные направления);</li>
		<li>Введена возможность показывать оптимальные пути между любыми сухопутными местами карты (только для пользователей Царь-Аккаунта);</li>
		<li>Очки рейтинга защиты за водные и авиабои выдаются владельцам армий защиты и систем ПВО, пропорционально нанесенному ими урону (выдавались городу защиты);</li>
		<li>Каждый город может иметь 2 монетных двора (был 1);</li>
		<li>Уменьшена стоимость монетного двора на 20%;</li>
		<li>Колизей дает 8% бонус войны (было 9%);</li>
		<li>Бонус войны за Монеты Удачи дает по 8% за уровень (было 9%);</li>
		<li>Немного уменьшен бонус войны от Великих Полководцев;</li>
		<li>Реализован ряд мер защиты от непредусмотренных влияний на проведение боя.</li>
	</ul>
	
	<div>Версия 1.4.36</div>  
	<ul>
		<li>Можно формировать специальные отчеты, содержащие некоторые сведения о своем аккаунте или городах, и предоставлять к ним доступ;</li>
		<li>Можно устанавливать бюджетные выплаты за тренировку войск;</li>
		<li>При отправке войск на кораблях можно оптимизировать по скорости или размеру армии;</li>
		<li>Колизей дает 9% бонус войны (было 10%);</li>
		<li>Бонус войны за Монеты Удачи дает по 9% за уровень (было 10%);</li>
		<li>Немного уменьшен бонус войны от Великих Полководцев.</li>
	</ul>
	
	<div>Версия 1.4.35</div>  
	<ul>
		<li>Изменена формула расчета суммарного военного бонуса;</li>
		<li>Орден Тамплиеров теперь увеличивает скорость обучения рыцарей и латников в 4 раза;</li>
		<li>Транспортный корабль можно произвести только в сухом доке;</li>
		<li>Войска, находящиеся на поле боя, наносят урон кораблям и авиации.</li>
	</ul>
	
	<div>Версия 1.4.34</div>  
	<ul>
		<li>Введено улучшение местности &quot;курорт&quot;;</li>
		<li>Введены оставшиеся боевые корабли второй половины игры;</li>
		<li>Введено строение &quot;сухой док&quot;;</li>
		<li>Эффективность Великих Граждан увеличена в 2 раза;</li>
		<li>Убийцы населения убивают до 25% возможного (было 20%);</li>
		<li>Галера: цена увеличена на 50 древесины;</li>
		<li>Джонка: цена уменьшена на 25 пищи;</li>
		<li>Ладья: цена уменьшена на 50 пищи;</li>
		<li>Каравелла: цена уменьшена на 50 пищи;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>
	
	<div>Версия 1.4.33</div>  
	<ul>
		<li>Введен морской бой и боевые корабли;</li>
		<li>Добавлена возможность вводить налоги на месторождения;</li>
		<li>Время высадки/посадки войск вне берега уменьшено до 2 дн. (было 3 дн.);</li>
		<li>Увеличено время возведения частокола, стены, укрепрайона;</li>
		<li>Урон от ловушек частокола уменьшен на 1, стены - на 3, укрепрайона - на 7;</li>
		<li>Цена в ресурсах и населении, время создания и цена содержания триремы, ладьи, каравеллы, парохода, транспортного корабля увеличены вдвое;</li>
		<li>Максимальное число ловушек для рыбы теперь 3 (было 4);</li>
		<li>Для &quot;фундаментализма&quot; больше не требуется &quot;богословие&quot;, для &quot;демократии&quot; не требуется &quot;философия&quot;.</li>
	</ul>
	
	<div>Версия 1.4.32</div>  
	<ul>
		<li>Можно проводить военные учения;</li>
		<li>Введены &quot;очки рейтингов&quot;;</li>
		<li>Скорость движения по рекам увеличена в 2 раза, а по водоемам в 1.5 раза;</li>
		<li>Один игрок может иметь на карте одновременно только один комментарий на месторождениях и 10 комментариев всего;</li>
		<li>Головорезы убивают на 50% населения больше;</li>
		<li>Конкурирующее расстояние Центра управления полетами увеличено до 42 (было 35).</li>
	</ul>
	
	<div>Версия 1.4.31</div>  
	<ul>
		<li>Введена система получения и применения Великих граждан;</li>
		<li>При транспортировке войск кораблями город высадки более не требуется. Разгрузка кораблей может происходить в любом месте побережья;</li>
		<li>Очередь изучения наук увеличена до 4 (было 2);</li>
		<li>Город с активированным Мачу-Пикчу не может основывать новые города на улучшениях местности;</li>
		<li>Цена мушкетера уменьшена на 15 серы;</li>
		<li>Время тренировки мушкетера уменьшено на 30 минут;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>  
	
	<div>Версия 1.4.30</div>  
	<ul>
		<li>Введены ежедневные подарки Монет Удачи;</li>
		<li>В действующем снабжении можно изменить ускоряющий ресурс, но — только на повышение скорости;</li>
		<li>Пошлинами и налогами не облагаются операции продажи Монет Удачи на рынке;</li>
		<li>Игроки, покинувшие страну во время сборки космического корабля, могут быть возвращены обратно;</li>
		<li>Эффект Лас-Вегаса увеличен вдвое;</li>
		<li>Конкурирующее расстояние Центра управления полетами увеличено до 35 (было 30);</li>
		<li>Для запуска и вывода на курс КК требуется 5 Центров управления (было 3);</li>
		<li>Увеличен объем тайника.</li>
	</ul>   
	
	<div>Версия 1.4.29</div>  
	<ul>
		<li>Добавлены более тонкие настройки бюджетных выплат на войска;</li>
		<li>Воевода и его помощники имеют доступ к истории численности войск страны;</li>
		<li>По любой стране можно посмотреть графики числа игроков, числа городов и суммарного населения;</li>
		<li>Если волна тактики не может быть собрана, то сборка переходит к следующей волне или правилу;</li>
		<li>В случае поражения сторона атаки теряет по крайней мере 10% осадных орудий (было 5%);</li>
		<li>Дивизионная пушка наносит 7500 урона городу (было 5000), реактивный миномет - 13000 (было 10000), реактивная артиллерия - 30000 (было 25000);</li>
		<li>Конкурирующее расстояние Центра управления полетами увеличено до 30 (было 25);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>   
	
	
	<div>Версия 1.4.28</div>  
	<ul>
		<li>Начавшимся военным операциям тактику нельзя менять во время боя;</li>
		<li>В случае наличия боя при городе для вновь приходящих войск тактику можно изменить за 4 часа до прихода;</li>
		<li>Волны, указанные в тактике, работают с момента вступления военной операции в бой;</li>
		<li>Бонус войны дает 10-20-30% (было 7-14-21%);</li>
		<li>Поход войск с целью защиты можно отменить в течение 5 минут (была 1 минута);</li>
		<li>В случае поражения сторона атаки теряет по крайней мере 5% осадных орудий;</li>
		<li>Военные операции без войск можно удалять в любое время;</li>
		<li>При отсутствии боя военную операцию защиты можно отменить без отзыва войск;</li>
		<li>При торговле на рынке используется оптимальный торговый союз;</li>
		<li>Убрана автокоррекция цен на рынке;</li>
		<li>Жертвенник дополнительно увеличивает скорость тренировки войск в казарме на 5%;</li>
		<li>Время сборки космического корабля уменьшено до 15 дней (было 20 дней);</li>
		<li>&quot;Музыка&quot; дает 25 культуры (было 50);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>


	<div>Версия 1.4.27</div>  
	<ul>
		<li>Введено условие победы;</li> 
		<li>Введено Чудо Света: центр управления полетами;</li> 
		<li>Для военных операций, принадлежащих стране, отчет о бое дополнительно получает воевода и его помощники;</li> 
		<li>Уменьшено время строительства жертвенника;</li> 
		<li>Рабочих можно переобучить в поселенцев;</li> 
		<li>Поселенцев можно переобучить в рабочих;</li> 
		<li>Для тренировки разведчика требуется 5 книг (было 3);</li> 
		<li>Изменены цены некоторых наук.</li> 
	</ul> 



	<div>Версия 1.4.26</div>
	<ul>
		<li>Тактику военной операции можно изменять во время боя через 8 часов после начала боя и последнего изменения тактики;</li>
		<li>Введена возможность закрытия военной операции защиты командующим и отправки войск по домам;</li>
		<li>Введено Чудо Света: космодром;</li>
		<li>Введены войска: реактивный истребитель, реактивный бомбардировщик, ЗРПК;</li>
		<li>Тачанку ПВО можно переобучить в зенитное орудие;</li>
		<li>Изменена катапульта: цена 100 пищи, 1000 древесины, 100 металла, 8 человек (было 90/900/90/7), урон по городу 600 (было 540), содержание 8 древесины (было 7), время тренировки 17 часов (было 15 часов);</li>
		<li>Изменен онагр: цена 100 пищи, 1200 древесины, 100 металла, 8 человек (было 90/1080/90/7), урон по городу 800 (было 720), содержание 8 древесины (было 7), время тренировки 17 часов (было 15 часов);</li>
		<li>Изменен требушет: цена 200 пищи, 1400 древесины, 200 металла, 10 человек (было 180/1260/180/9), урон по городу 1000 (было 900), содержание 10 древесины (было 8), время тренировки 24 часа (был 21 час);</li>
		<li>Дивизионная пушка больше не имеет характеристики &quot;бронированный&quot;;</li>
		<li>Для изучения &quot;печатного станка&quot; более не требуется &quot;бумага&quot;;</li>
		<li>Для изучения &quot;терроризма&quot; более не требуется &quot;кодекс чести&quot;;</li>
		<li>Для изучения &quot;межпланетных полетов&quot; более не требуется &quot;солнечная энергия&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul> 

	<div>Версия 1.4.25</div>
	<ul>
		<li>Введены визуальные фильтры на стандартной карте;</li>
		<li>Дороги можно строить через месторождения;</li>
		<li>Военные операции могут принадлежать стране;</li>
		<li>Выбор отряда для выхода на поле боя может определяться составом своих войск на поле боя;</li>
		<li>Введена возможность внесения стоящих подкреплений и личной армии города в военную операцию защиты этого города;</li>
		<li>Введены войска: рутта, современный танк, реактивная артиллерия, боевая машина пехоты;</li>
		<li>Введены компоненты космического корабля;</li>
		<li>Введено строение: космический завод;</li>
		<li>Расход всех ресурсов роста на рост увеличен;</li>
		<li>Изменена катапульта: цена 90 пищи, 900 древесины, 90 металла, 7 человек (было 80/800/80/6), урон по городу 540 (было 480), содержание 7 древесины (было 6), время тренировки 15 часов (было 13 часов);</li>
		<li>Изменен онагр: цена 90 пищи, 1080 древесины, 90 металла, 7 человек (было 80/960/80/6), урон по городу 720 (было 640), содержание 7 древесины (было 6), время тренировки 15 часов (было 13 часов);</li>
		<li>Изменен требушет: цена 180 пищи, 1260 древесины, 180 металла, 9 человек (было 160/1120/160/8), урон по городу 900 (было 800), содержание 8 древесины (было 7), время тренировки 21 час (было 19 часов);</li>
		<li>Цена конного лучника уменьшена на 100 пищи;</li>
		<li>Цена двухместной колесницы уменьшена на 30 вьючных животных и 50 древесины;</li>
		<li>Цена конного арбалетчика уменьшена на 20 вьючных животных и 30 пищи;</li>
		<li>Для тренировки разведчика требуется 3 книги (было 2);</li>
		<li>Разведчик теперь имеет свойство &quot;миротворец&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul> 

	<div>Версия 1.4.24</div>
	<ul>
		<li>У советника появилась возможность видеть ретроспективные графики развития своей страны;</li>
		<li>Советник видит объемы использования ресурсов в стране для ускорения потокового снабжения;</li>
		<li>Советник видит силу ПВО городов страны;</li>
		<li>Все подкрепления из города можно отправить по домам одновременно;</li>
		<li>При отзыве подкрепления пользователи Царь-аккаунта могут выбрать возврат войск с разделением по скоростям;</li>
		<li>При использовании заместительства списывается не менее 2-х дней (было полдня);</li>
		<li>Притоки знаний уменьшены до 65% (были 70%);</li>
		<li>При наличии защитных сооружений, способных наносить урон во время боя, визуальный бой запускается всегда;</li>
		<li>В тактиках можно использовать обратные характеристики войск;</li>
		<li>Месторождения урана дают 100% урана (было 10%);</li>
		<li>Эффективность труда обогатительного завода уменьшена до 10% (было 30%);</li>
		<li>Введены строения: маяк, система ПВО;</li>
		<li>Введены войска: зенитное орудие, истребитель, бомбардировщик, штурмовик, транспортный корабль;</li>
		<li>Расход всех ресурсов роста на рост увеличен;</li>
		<li>Изменена катапульта: цена 80 пищи, 800 древесины, 80 металла (было 70/700/70), урон по городу 480 (было 420), время тренировки 13 часов (было 11 часов);</li>
		<li>Изменен онагр: цена 80 пищи, 960 древесины, 80 металла (было 70/840/70), урон по городу 640 (было 560), время тренировки 13 часов (было 11 часов);</li>
		<li>Изменен требушет: цена 160 пищи, 1120 древесины, 160 металла, 8 человек (было 140/980/140/7), урон по городу 800 (было 700), время тренировки 19 часов (было 16 часов);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>       

	<div>Версия 1.4.23</div>
	<ul>
		<li>Введена должность советника;</li>
		<li>Можно устанавливать прямые потоки денег (дотации) из казны игрокам страны;</li>
		<li>Сумма доступных кредитов в стране больше не зависит от размера казны;</li>
		<li>Все игроки имеют информацию обо всех открытых кредитах и вкладах в стране;</li>
		<li>Эффективность академии увеличена до 24% (было 22%), изменено число рабочих мест;</li>
		<li>Эффективность университета увеличена до 32% (было 25%), изменено число рабочих мест;</li>
		<li>Войска второго резерва могут выходить в бой при наличии первого резерва, если они явно заданы в волнах или правилах;</li>
		<li>Введены войска: гранатометчик, снайпер, пехотинец, огнеметчик, тачанка ПВО, легкий истребитель, легкий бомбардировщик, пикировщик;</li>
		<li>Введены строения: зенитная башня, радиолокационная станция;</li>
		<li>Увеличен расход ресурсов на ускорение торговли: вьючные животные 0.4 (было 0.35), древесина 0.4 (было 0.35), топливо 0.1/0.2 (было 0.09/0.18);</li>
		<li>Изменена катапульта: цена 70 пищи, 700 древесины, 70 металла (было 65/650/65), урон по городу 420 (было 390), содержание 6 древесины (было 5), время тренировки 11 часов (было 9 часов);</li>
		<li>Изменен онагр: цена 70 пищи, 840 древесины, 70 металла (было 65/780/65), урон по городу 560 (было 520), содержание 6 древесины (было 5), время тренировки 11 часов (было 9 часов);</li>
		<li>Изменен требушет: цена 140 пищи, 980 древесины, 140 металла, 7 человек (было 130/910/130/6), урон по городу 700 (было 650), содержание 7 древесины (было 6), время тренировки 16 часов (было 13 часов);</li>
		<li>Изменена цена копейщика: 60 пищи, 100 древесины, 10 металла (было 80/100/20);</li>
		<li>Цена автоматчика в сере уменьшена до 25 (было 50);</li>
		<li>Малый радиус обороны авиации увеличен до 5 (был 3);</li>
		<li>Средний радиус обороны авиации увеличен до 6 (был 5);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>


	<div>Версия 1.4.22</div>

	<ul>
		<li>Введены авиабои;</li>
		<li>Объявления теперь могут быть только на весь мир;</li>
		<li>Если бой был прерван из-за ошибки, то оставшиеся войска атаки отправятся домой, а в отчете будет соответствующая пометка;</li>
		<li>До выполнения задания на прочтение письма зона обзора карты равна 3х3;</li>
		<li>До выполнения задания на изучение 5 наук все климаты на карте выглядят так же, как климат города игрока;</li>
		<li>Введена возможность бюджетных выплат за содержание научных, военных и фортификационных строений;</li>
		<li>Налоги и пошлины за потоковое снабжение списываются потоково;</li>
		<li>Войска с особенностью &quot;миротворец&quot; всегда выходят на поле боя последними в своей группе;</li>
		<li>Введены войска: аэростат, дирижабль, танк-ягуар;</li>
		<li>Введено строение: ангар;</li>
		<li>Изменена катапульта: цена 65 пищи, 650 древесины, 65 металла, 6 человек (было 60/600/60/5), урон по городу 390 (было 360), содержание 5 древесины (было 4);</li>
		<li>Изменен онагр: цена 65 пищи, 780 древесины, 65 металла, 6 человек (было 60/720/60/5), урон по городу 520 (было 480), содержание 5 древесины (было 4);</li>
		<li>Изменен требушет: цена 130 пищи, 910 древесины, 130 металла, 6 человек (было 120/840/120/5), урон по городу 650 (было 600), содержание 6 древесины (было 5);</li>
		<li>Два уровня стрельбища перенесены из науки &quot;автоматическое оружие&quot; в &quot;взрывчатые вещества&quot; и еще два уровня перенесены из науки &quot;огнестрельное оружие&quot; в &quot;порох&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.21</div>
	<ul>
		<li>Максимальное число войск на поле боя с каждой стороны теперь 750 (было 500);</li>
		<li>Если в бою участвует более 5000 войск суммарно, то из резерва за раз выходит войск на 75 мест (было на 50 всегда);</li>
		<li>Войска с наибольшим военным бонусом выходят в бой первыми;</li>
		<li>В тактике можно создать второй резерв, который будет вступать в бой только после окончания войск в первом резерве;</li>
		<li>Военный бонус теперь увеличивает урон на 7-14-21% (было 5-10-15%);</li>
		<li>Разведчики ходят напрямую только на операции разведки;</li>
		<li>Пехотинец переименован в солдата;</li>
		<li>Введены войска: метатель бола, тяжелый танк, реактивный миномет, бронетранспортер;</li>
		<li>Индейцы не могут тренировать арбалетчиков и конных арбалетчиков;</li>
		<li>Топорщика можно переобучить в алебардщика (можно было в самурая);</li>
		<li>Пушку можно переобучить в дивизионную пушку;</li>
		<li>Изменена катапульта: цена 60 пищи, 600 древесины, 60 металла (было 55/550/55), урон по городу 360 (было 330);</li>
		<li>Изменен онагр: цена 60 пищи, 720 древесины, 60 металла (было 55/660/55), урон по городу 480 (было 440);</li>
		<li>Изменен требушет: цена 120 пищи, 840 древесины, 120 металла (было 110/770/110), урон по городу 600 (было 550);</li>
		<li>Расход всех ресурсов роста на рост увеличен на 12;</li>
		<li>Увеличен расход ресурсов на ускорение торговли: вьючные животные 0.35 (было 0.3), древесина 0.35 (было 0.3), топливо 0.09/0.18 (было 0.08/0.15);</li>
		<li>Цены всех наук увеличены приблизительно на 25%, выбранная наука изучается на 100% знаний (было 80%), остальные доступные науки получают +25% знаний;</li>
		<li>Дополнительно изменены цены некоторых наук.</li>
	</ul>




	<div>Версия 1.4.20</div>
	<ul>
		<li>Введена система тактик боя;</li>
		<li>Введены строения: укрепрайон, киностудия;</li>
		<li>Капище дает +5 роста в день (было +4);</li>
		<li>Уменьшена цена рынка;</li>
		<li>Введены войска: латник, минометчик, бронеавтомобиль, легкий танк, дивизионная пушка;</li>
		<li>Грузоподъемность арбалетчика и чо-ко-ну теперь равна 30;</li>
		<li>Легионер стоит на 30 металла меньше;</li>
		<li>Легионер тренируется 12 часов (было 15 часов);</li>
		<li>Легионера можно переобучить в латника;</li>
		<li>Длинный лук передвигается со скоростью 6 (было 5);</li>
		<li>Длинный лук тренируется 12 часов (было 14 часов);</li>
		<li>Цена катапульты и онагра увеличена на 10%, время тренировки на 30 минут, урон по городу на 10%;</li>
		<li>Цена требушета увеличена на 10%, время тренировки на 1 час, урон по городу на 10%;</li>
		<li>Рыцарь тренируется 16 часов (было 13:20:00);</li>
		<li>Мортиру можно переобучить в минометчика;</li>
		<li>Гренадера можно переобучить в егеря (можно было в автоматчика);</li>
		<li>Гренадер и егерь теперь являются убийцами населения;</li>
		<li>Пехотинец больше не тренируется в стрельбище;</li>
		<li>Пехотинца можно переобучить в автоматчика;</li>
		<li>Автоматчик стоит на 50 серы меньше, но на 50 древесины больше;</li>
		<li>Автоматчик более не является убийцей населения;</li>
		<li>Для автоматчика дополнительно требуется национализм;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>


	<div>Версия 1.4.19</div>
	<ul>
		<li>В некоторых случаях за раз на поле боя может выйти более 50 боевых единиц;</li>
		<li>Защитные сооружения города (кроме рва) после боя разрушаются по общим правилам разрушения строений;</li>
		<li>Введены улучшения местности: 3 уровень гидротехнического сооружения, 3 уровень промысловой зоны, 3 уровень исследовательской акватории;</li>
		<li>Действующая кредитная ставка страны является ставкой по уже взятым кредитам;</li>
		<li>Больше нельзя самостоятельно перечислять деньги в бюджет страны;</li>
		<li>При любом поступлении денег на аккаунт в первую очередь происходит автоматическое погашение налоговой задолженности;</li>
		<li>Эффективность труда академии повышена до 22% (было 20%), но изменено число рабочих;</li>
		<li>Эффективность труда университета повышена до 25% (было 20%), но изменено число рабочих;</li>
		<li>Ядерная энергия дает бонус производства 20% (было 40%);</li>
		<li>Криптография дает 10% бонус производства денег;</li>
		<li>4 уровня военного завода и военной части перенесены из бронетехники в милитаризм;</li>
		<li>2 уровня посольства перенесены из государственного аппарата в национализм;</li>
		<li>Для вычислительных машин более не нужно массовое производство;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>




	<div>Версия 1.4.18</div>
	<ul>
		<li>Все игроки страны видят персональные выплаты игрокам;</li>
		<li>У кредитов больше нет срока погашения;</li>
		<li>Выплаты по процентам кредитов и вкладов производятся потоково;</li>
		<li>Налоги за торговые сделки выплачиваются сразу;</li>
		<li>Увеличен расход ресурсов на ускорение торговли: вьючные животные 0.3 (было 0.2), древесина 0.3 (было 0.2), топливо 0.08/0.15 (было 0.05/0.10);</li>
		<li>Введены строения: обогатительный завод, очистная станция, станция Маниту;</li>
		<li>Изменена цена лаборатории;</li>
		<li>Введены войска: пароход;</li>
		<li>Цена, население, время тренировки и содержание триремы, каравеллы, ладьи увеличены в 2 раза;</li>
		<li>Изменены бонусы производства от наук: индустриализация - 20%, сталь - 10%, конвейер - 20%, массовое производство - 20%, электричество - 10%, компьютеры - 10%, робототехника - 20%, утилизация - 20%;</li>
		<li>Эффективность банка повышена до 110% (было 100%);</li>
		<li>Эффективность монетного двора повышена до 135% (было 125%);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.17</div>
	<ul>
		<li>Коэффициент эффективности производства от числа работников теперь 0.88 (был 0.87);</li>
		<li>Казна страны и бюджет объединены;</li>
		<li>Изменен принцип расчета выплат из бюджета;</li>
		<li>Выплаты из бюджета производятся потоково;</li>
		<li>Минимальная частота изменения налогов составляет 1 час (было 10 часов);</li>
		<li>Налогами не облагаются ресурсы, произведенные на бонус за Монеты Удачи;</li>
		<li>Все члены страны видят налог и налоговую задолженность каждого игрока страны;</li>
		<li>Введены строения: госпиталь, порт, лаборатория;</li>
		<li>Для гвардейца требуются науки &quot;демократия&quot; и &quot;лидерство&quot; (требовался &quot;национализм&quot;);</li>
		<li>Для &quot;электричества&quot; более не нужны &quot;научные исследования&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.16</div>
	<ul>
		<li>Сбор подушного и производственного налога происходит потоково;</li>
		<li>Строения можно сносить поуровнево;</li>
		<li>Войска можно переучивать в более современные;</li>
		<li>Введены защитные сооружения в симулятор боя;</li>
		<li>Потребление кукурузы, пшеницы, риса, рыбы увеличено на 24;</li>
		<li>Эффективность труда дома ткача увеличена до 110% (было 100%);</li>
		<li>Эффективность труда ткацкой фабрики увеличена до 140% (было 125%);</li>
		<li>Отменен возможный возврат ресурсов при перестройке строений;</li>
		<li>Грунтовая дорога дает ускорение 200%, шоссе - 300%, железная дорога - 500%, маглев - 750%;</li>
		<li>Введены улучшения местности: 3 уровень заповедника, 3 уровень пригорода;</li>
		<li>Введены Чудеса Света: Лас-Вегас, Бранденбургские ворота;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.15</div>
	<ul>
		<li>При отправлении войск можно указывать время их прибытия позже расчетного;</li>
		<li>Войска разных городов в атаке или защите можно объединять;</li>
		<li>Число одновременных атак и подкреплений города не может превышать 20 (было максимум 30 атак);</li>
		<li>Введены строения: стена, завод, университет, военная часть;</li>
		<li>Введены войска: мортира, автоматчик, пехотинец, егерь, пулеметчик, кавалерист;</li>
		<li>Введены улучшения местности: 3 уровень ирригации, 3 уровень шахт, 3 уровень кампуса, 3 уровень ярмарки;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.14</div>
	<ul>
		<li>Все доступные науки изучаются одновременно;</li>
		<li>Введена возможность устанавливать особые пошлины для торговых союзов;</li>
		<li>Водяное колесо переименовано в гидротехническое сооружение 1 уровня;</li>
		<li>Введены улучшения местности: 2 уровень гидротехнического сооружения, 2 уровень исследовательской акватории;</li>
		<li>Введены строения: собор, мануфактура, торговая база, мэрия;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.13</div>
	<ul>
		<li>Введены карты: политическая и экологическая;</li>
		<li>Если уровень научного распределения страны и игрока, состоящего в ней, различается, то для каждого города этого игрока будет выбран меньший из двух процент передачи знаний;</li>
		<li>Введены улучшения местности: 2 уровень промысловой зоны, 2 уровень заповедника, 2 уровень пригорода;</li>
		<li>Введено строение кузница;</li>
		<li>Введено Чудо Света: Царь-пушка;</li>
		<li>Увеличено содержание конюшни, стрельбища, казармы, мастерской;</li>
		<li>Уменьшено время тренировки войск: воин - 2:00:00 (было 3:30:00), дубинщик - 3:00:00 (было 5:00:00), пращник - 2:30:00 (было 5:00:00), метатель дротиков - 2:00:00 (было 3:30:00);</li>
		<li>Исследовательская акватория 1 уровня дает +4% знаний (было +3%);</li>
		<li>Водные улучшения местности можно строить на месторождениях нефти;</li>
		<li>Мост 2 уровня требует 250 рабочих (было 500);</li>
		<li>Мост 3 уровня требует 1000 рабочих (было 1500);</li>
		<li>&quot;Торговля&quot; больше не дает бонус обзора;</li>
		<li>&quot;Рыцарство&quot; и &quot;дипломатия&quot; дают бонус обзора 1;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>


	<div>Версия 1.4.12</div>
	<ul>
		<li>Введены улучшения местности: кампус 2 уровня, ярмарка 2 уровня, промысловая зона, исследовательская акватория;</li>
		<li>Для использования вьючных животных в торговле нужна наука &quot;повозки&quot;, для древесины - &quot;парус&quot;, для топлива - &quot;паровой двигатель&quot;;</li>
		<li>Потребление кукурузы, пшеницы и риса увеличено до 5 (было 4);</li>
		<li>Введены строения: академия, музей, ткацкая фабрика, военный завод;</li>
		<li>Изменена типография: увеличен спад населения, увеличено число рабочих мест, увеличено содержание;</li>
		<li>Увеличена цена водозабора;</li>
		<li>Введены войска: гренадер, гвардеец, пушка;</li>
		<li>Уменьшена цена и время тренировки мушкетера и драгуна;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.11</div>
	<ul>
		<li>Теперь можно выбирать от использования каких улучшений местности возле города отказаться;</li>
		<li>Изменена механика работы моста;</li>
		<li>Введены 2 и 3 уровни моста;</li>
		<li>Для ускорения сухопутной и водной торговли можно использовать топливо;</li>
		<li>Введены строения: больница, водопровод, водозабор, топливный завод;</li>
		<li>2 уровня фермы перемещены из «строительства» в «севооборот»;</li>
		<li>Изменена библиотека: время строительства увеличено на 1 час для каждого уровня, число рабочих мест увеличено вдвое, содержание увеличено вдвое, спад населения увеличен вдвое, эффективность труда уменьшена до 18% (было 20%);</li>
		<li>Изменен дом ткача: увеличено время строительства, число рабочих мест увеличено вдвое, содержание увеличено вдвое, спад населения увеличен вдвое;</li>
		<li>Водяное колесо дает бонус 8% (было 10%);</li>
		<li>Боевые слоны вступают в бой и числятся 1 как 3 юнита;</li>
		<li>Рыцари, кирасиры и мамлюки вступают в бой и числятся 1 как 2 юнита;</li>
		<li>Изменены грузоподъемности юнитов: конный арбалетчик - 75, арбалетчик - 40, лучник - 40, топорщик - 50, колесница - 150;</li>
		<li>При каждой операции транспортировки и создания потока можно выбрать расходуемый ресурс для ускорения;</li>
		<li>Потребление кукурузы, пшеницы и риса увеличено до 4 (было 3);</li>
		<li>Изменены бонусы роста наук: сельское хозяйство больше не дает бонус, фармакология дает 8 (было 10), монотеизм дает 2 (было 4), богословие дает 2 (было 4), канализация дает 6 (было 8), анатомия дает 6 (было 8);</li>
		<li>Изменены бонусы культуры наук: фундаментализм дает 75 (было 0), философия дает 50 (было 100), канализация дает 75 (было 100), часы дает 75 (было 100), история дает 75 (было 125), демократия дает 50 (было 125), либерализм дает 50 (было 125);</li>
		<li>Наука «рабовладельчество» переименована в «рабство»;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.10</div>
	<ul>
		<li>В бою может присутствовать одновременно не более 500 юнитов с каждой стороны;</li>
		<li>Боевые слоны вступают в бой и числятся 1 как 2 юнита;</li>
		<li>Глава имеет некоторые функции прочих должностей;</li>
		<li>Оросительные каналы переименованы в ирригацию;</li>
		<li>Ирригация 1 уровня дает бонус 2% (был 1%);</li>
		<li>Цена ирригации 1 уровня увеличена до 300 пищи и 750 древесины (было 200/500);</li>
		<li>Цена моста уменьшена до 1000 пищи, 3000 древесины и 50 рабочих;</li>
		<li>Введены улучшения местности: шахты 2 уровня, ирригация 2 уровня;</li>
		<li>Введено Чудо Света: гелиоконцентратор;</li>
		<li>Введены строения: ратуша, монастырь;</li>
		<li>Уменьшено содержание храма;</li>
		<li>Введены войска: драгун, кирасир, мамлюк;</li>
		<li>Расовые бонусы производства у европейцев, азиатов и индейцев уменьшены до 30% (было 40%), а у африканцев до 8% (было 10%);</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.9</div>
	<ul>
		<li>Введены улучшения местности: пригород, заповедник;</li>
		<li>Введены новые задания отшельника;</li>
		<li>Введены строения: обсерватория, банк, сероплавильный завод;</li>
		<li>Введены войска: мушкетер, алебардщик, бомбарда;</li>
		<li>Можно включать автоматическое размещение безработных на производство;</li>
		<li>Уменьшено время строительства площади;</li>
		<li>Уменьшено время строительства бойцовской ямы;</li>
		<li>Уменьшена цена бойцовской ямы;</li>
		<li>Уменьшена эффективность бойцовской ямы;</li>
		<li>Два уровня бойцовской ямы из науки «охота» и два из «военного ремесла» перенесены в задания отшельника;</li>
		<li>Хижина теперь дает прирост 0.3 за уровень (было 0.2);</li>
		<li>Типи теперь дает прирост 0.4 за уровень (было 0.3);</li>
		<li>Прирост дома увеличен на 2;</li>
		<li>2 уровня ловушки для рыбы перемещено из науки «рыболовство» в «плетение»;</li>
		<li>Замок перераспределен по наукам;</li>
		<li>Цена конного арбалетчика увеличена на 50 вьючных животных;</li>
		<li>Цена рыцаря увеличена на 50 вьючных животных;</li>
		<li>Изменены цены многих наук.</li>
	</ul>

	<div>Версия 1.4.8</div>
	<ul>
		<li>После выполнения некоторых заданий около города появляются варварские города с промышленностью и обороной;</li>
		<li>Введена разведка;</li>
		<li>Введено Чудо Света: Колосс;</li>
		<li>Введены войска: боевой слон, разведчик;</li>
		<li>Для всех входящих атак указана скорость движения армии;</li>
		<li>Введено улучшение местности: водяное колесо;</li>
		<li>Улучшения местности (кроме мостов) можно строить только рядом со строящим городом;</li>
		<li>Дороги и мосты можно строить на расстоянии не более 15 клеток от строящего города;</li>
		<li>Коэффициент эффективности труда теперь 0.87 (был 0.86);</li>
		<li>Уменьшено содержание суда;</li>
		<li>Уменьшено содержание скотного двора;</li>
		<li>Изменено содержание винодельни;</li>
		<li>Уменьшено время строительства петроглифа;</li>
		<li>Изменены цены многих наук.</li>
	</ul>

	<div>Версия 1.4.7</div>
	<ul>
		<li>Военный бонус наук исключен;</li>
		<li>Введены улучшения местности: кампус, ярмарка;</li>
		<li>Расход вьючных животных для ускорения поставок увеличен вдвое;</li>
		<li>Базовое производство металла составляет 30% (было 20%);</li>
		<li>Увеличено потребление всех ресурсов роста;</li>
		<li>Производство одежды с месторождений овец увеличено на 20%;</li>
		<li>Уменьшено содержание рынка;</li>
		<li>Для начальных уровней фонтана увеличено содержание;</li>
		<li>Типография теперь работает и в городе с месторождением;</li>
		<li>Виноделен теперь может быть до 4 в городе (было 3 максимум);</li>
		<li>Увеличено число рабочих мест у дома ткача;</li>
		<li>Месторождение жемчуга теперь дает 40% драгоценностей (было 50%);</li>
		<li>Введено Чудо Света: Сфинкс;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.6</div>
	<ul>
		<li>Социальные ресурсы теперь потребляются пропорционально производимому эффекту;</li>
		<li>Изменен объем потребления всех социальных ресурсов;</li>
		<li>При отключении строения из-за нехватки денег, сумма компенсации может быть меньше, чем необходимо для включения;</li>
		<li>Введены строения: пристань, замок;</li>
		<li>Введены Чудеса Света: Терракотовая армия, Великая библиотека, Орден Тамплиеров, Академия СунЦзы, Мачу-Пикчу;</li>
		<li>Эффективность лесоповала увеличена до 175% (было 150%);</li>
		<li>Уменьшена цена лесоповала;</li>
		<li>Уменьшена оплата у театра и храма;</li>
		<li>Увеличено число рабочих мест на ферме;</li>
		<li>Увеличено число рабочих мест в библиотеках;</li>
		<li>Эффективность труда библиотек уменьшена до 20% (было 40%).</li>
	</ul>

	<div>Версия 1.4.5</div>
	<ul>
		<li>Коэффициент эффективности труда теперь 0.86 (был 0.85);</li>
		<li>В сражениях между игроками, войска, вступившие в бой, дают доступ к просмотру боя и полному боевому отчету только продержавшись не менее 0:02:00;</li>
		<li>После изучения торговли нет ограничения дальности, как на транспортировку ресурсов, так и на выставление товара и его на покупку;</li>
		<li>Стоунхендж дает 15 торговцев (давал 25);</li>
		<li>Уменьшена цена содержания дома ткача;</li>
		<li>Домов ткачей может быть 4 в городе (было 3 максимум);</li>
		<li>Увеличено число рабочих мест на скотном дворе;</li>
		<li>Жемчуг дает 50% драгоценностей (было 100%);</li>
		<li>Введены строения: верфь, частокол, театр, статуя, фонтан, типография, резиденция;</li>
		<li>Введены войска: рыцарь, самурай, пикинер, длинный лук, требушет;</li>
		<li>Введены транспортные корабли: трирема, каравелла, ладья;</li>
		<li>Когда город становится варварским, в нем пропадают защитные сооружения;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.4</div>
	<ul>
		<li>Потребление ресурсов в пищу теперь управляется настройками приоритетов;</li>
		<li>Для ускорения торговли возможно использовать вьючных животных и древесину;</li>
		<li>Торговля и бартер теперь могут производиться за купленные и не переведенные ранее Монеты Удачи;</li>
		<li>Одно платное место для строительства зданий переведено в доступное сразу;</li>
		<li>Приток от наук уменьшен на 30%;</li>
		<li>Цена грунтовой дороги уменьшена до 100 пищи, 300 древесины, 5 рабочих;</li>
		<li>Теперь можно строить по 4 фермы и лесоповала в каждом городе;</li>
		<li>Увеличено число рабочих мест в ферме, лесоповале и монетном дворе;</li>
		<li>Эффективность монетного двора теперь 125% (была 100%).</li>
	</ul>
	<div>Версия 1.4.3</div>
	<ul>
		<li>Деньги больше не хранятся в городах;</li>
		<li>Бонус производства денег за Монеты Удачи включен в состав бонуса производства ресурсов;</li>
		<li>Добыча рыбы возможна только после изучения &quot;рыболовства&quot;;</li>
		<li>Производство одежды возможно только после изучения &quot;тканей&quot;;</li>
		<li>Военный рейтинг заменен на рейтинг атаки и защиты;</li>
		<li>Введены строения: монетный двор, библиотека, рынок, муляж, дом, дом ткача;</li>
		<li>Введены чудеса Света: оракул, пирамида, висячие сады, колизей;</li>
		<li>Наука &quot;монархия&quot; дополнительно требует &quot;деньги&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>
	<div>Версия 1.4.2</div>
	<ul>
		<li>Месторождения урана теперь открываются с наукой &quot;радиоактивность&quot;;</li>
		<li>Добыча рыбы на реке (без водоема) уменьшена вдвое;</li>
		<li>Время до повторного вступления в страну уменьшено до 2 дней (было 7 дней);</li>
		<li>Введены строения: философская школа, склад, хранилище такаюка, винодельня, храм, мастерская, суд, промысловый порт;</li>
		<li>Промысловый порт теперь может добывать жемчуг;</li>
		<li>Ров больше не дает военный бонус;</li>
		<li>Военный бонус от наук уменьшен вдвое;</li>
		<li>Военный бонус африканцев теперь 5% (был 10%);</li>
		<li>Военный бонус за Монеты Удачи уменьшен вдвое;</li>
		<li>Бойцовская яма может быть теперь только одна в каждом городе (было 2);</li>
		<li>Бойцовскую яму можно перестроить в казарму и с казармой она более не работает;</li>
		<li>Введены войска: легионер, мечник, топорщик, конный арбалетчик, арбалетчик, чо-ко-ну, воин-ягуар, катапульта, онагр;</li>
		<li>Урон пращника уменьшен до 4 (был 5);</li>
		<li>Урон метателя дротиков уменьшен до 3 (был 4);</li>
		<li>Наука &quot;политеизм&quot; теперь дает доступ к науке &quot;философия&quot;;</li>
		<li>Наука &quot;литература&quot; требует &quot;драматургию&quot; и &quot;письменность&quot; (раньше требовала &quot;религию&quot; и &quot;бумагу&quot;);</li>
		<li>Бонус культуры науки &quot;календарь&quot; уменьшен до 50 (был 75);</li>
		<li>Изменены цены некоторых наук;</li>
		<li>Задание отшельника на строительство хижин 15 уровня заменено на строительство хижин 14 уровня;</li>
		<li>Задание отшельника на строительство колодца 3 уровня заменено на строительство колодца 6 уровня;</li>
		<li>Задание отшельника на строительство колодца 1 уровня заменено на строительство колодца 3 уровня.</li>
	</ul>
	<div>Версия 1.4.1</div>
	<ul>
		<li>Введена новая система научного объединения;</li>
		<li>Нельзя строить дороги на месторождениях;</li>
		<li>Эффект от потребления ресурсов роста или культуры теперь складывается (раньше перемножался);</li>
		<li>Изменены цены дорог и улучшений как в рабочих, так и в ресурса;</li>
		<li>Рабочие больше не возвращаются после строительства дорог и улучшений;</li>
		<li>Введены чудеса Света: капище, жертвенник (изменено назначение), земляная плотина, геоглиф, мать-земля, стоунхендж;</li>
		<li>Введены строения: казарма, стрельбище, конюшня, посольство, мохоро вождей, шахта, гранитный карьер, обелиск;</li>
		<li>Изменены цена и время строительства площади;</li>
		<li>Два уровня алтаря перемещены из науки &quot;алфавит&quot; в &quot;военное ремесло&quot; и два уровня из &quot;обработки древесины&quot; в &quot;приручение животных&quot;;</li>
		<li>Два уровня дома охотника перемещены из науки &quot;охота&quot; в &quot;стрельбу из лука&quot;;</li>
		<li>Изменены цены некоторых наук.</li>
	</ul>

	<div>Версия 1.4.0</div>
	<ul>
		<li>Курс Монеты Удачи уменьшен в 20 раз;</li>
		<li>Карта теперь соединена боковыми краями;</li>
		<li>Убраны месторождения алюминия;</li>
		<li>Изменен бонус добычи ресурсов многих месторождений;</li>
		<li>Введена новая боевая система для сухопутных боев;</li>
		<li>Отключены водные и авиационные бои;</li>
		<li>Армии больше не ограничены 20 видами войск;</li>
		<li>Атакующему открывается карта только в случае выживания армии размером в 10 населения или более;</li>
		<li>Убран фильтр видов войск подкреплений;</li>
		<li>Убран бонус грабежа за Монеты Удачи;</li>
		<li>Симулятор боя временно отключен;</li>
		<li>Дерево наук расширено и переработано;</li>
		<li>Знания больше не хранятся в городе. Производство знаний идет сразу в науку;</li>
		<li>Наценки на стоимость наук больше нет;</li>
		<li>Изменены цены всех наук;</li>
		<li>Изменены цены и параметры многих строений;</li>
		<li>Изменены параметры всех сухопутных юнитов;</li>
		<li>Изменен принцип производства ресурсов;</li>
		<li>Большинство строений и юнитов временно исключено из игры;</li>
		<li>Переименованы расовые строения;</li>
		<li>Строение &quot;пещера&quot; заменено на &quot;бойцовскую яму&quot;;</li>
		<li>Введено строение &quot;дом охотника&quot;;</li>
		<li>Строение &quot;яма&quot; переименована в &quot;ров&quot;;</li>
		<li>Изменен эффект рва;</li>
		<li>Вместо &quot;хижины&quot; индейцы будут строить &quot;типи&quot;;</li>
		<li>Строения &quot;фруктовая плантация&quot;, &quot;кукурузная плантация&quot;, &quot;пшеничное поле&quot;, &quot;рисовая плантация&quot;, &quot;ферма&quot; теперь объединены в строение &quot;ферма&quot;;</li>
		<li>Убраны строения: алюминиевый завод, филармония, студия звукозаписи;</li>
		<li>Убраны торговые пути;</li>
		<li>Бартерные предложения больше не резервируют товар;</li>
		<li>Для торговли больше не нужны вьючные животные;</li>
		<li>Вместимость торговца теперь 100 единиц (было 250);</li>
		<li>Изменены размеры бонусов потребления ресурсов роста;</li>
		<li>Потребление рыбы больше не дает бонус производства знаний;</li>
		<li>Убраны ресурсы: алюминий, музыка;</li>
		<li>Ресурс &quot;пища&quot; больше не является самостоятельным ресурсом. При использовании пищи тратятся ресурсы роста;</li>
		<li>Бонус культуры европейцев теперь 5% (был 10%);</li>
		<li>Изменены расовые бонусы производства ресурсов;</li>
		<li>Изменены климатические бонусы;</li>
		<li>Изменены многие задания отшельника;</li>
		<li>Таблички с пищей заменены на таблички с фруктами;</li>
		<li>Таблички со знаниями заменены на таблички с мясом.</li>
	</ul>
</script>



<script type="text/plain" id="help.rules">
	<div>1. Общие положения</div>
	<div class="paragraph">Аккаунтом называется учетная запись игрока.<br>В настоящих правилах владельцем аккаунта называется владелец электронной почты, которая указана и подтверждена в настройках этого аккаунта, либо владелец учетной записи той платформы, которая используется для входа на этот аккаунт.<br>Используя аккаунт, вы принимаете настоящие правила и обязуетесь их выполнять.</div>
	<ol type="a">
		<li>Запрещено использовать аккаунт с именем, полностью схожим с уже имеющимся зарегистрированным аккаунтом.</li>
		<li>В случае нанесения вреда аккаунту лицом, обладающим паролем, компенсация или восстановление ущерба невозможно.</li>
		<li>У аккаунта может быть только один владелец. Наличие доступа к аккаунту не означает владение им.</li>
		<li>Все вопросы, связанные с аккаунтом, могут решаться только с его владельцем.</li>
	</ol>
	<div>2. Мультиводство</div>
	<div class="paragraph">Мультиводством называется использование нескольких аккаунтов одним человеком в одном игровом мире.</div>
	<ol type="a">
		<li>Мультиводство запрещено.</li>
		<li>Брошенный аккаунт может считаться мультиаккаунтом.</li>
		<li>Запрещено использовать аккаунт в целях наживы третьих лиц. Такой аккаунт может быть признан мультиаккаунтом.</li>
		<li>Аккаунты разных игроков с общим Интернет-соединением считаются мультиаккаунтами.</li>
		<li>Запрещено использовать средства для подмены сетевого адреса Интернет-соединения.</li>
		<li>Присмотр за аккаунтом другого игрока допустим исключительно через систему заместительства. Прямой вход по паролю является мультиводством.</li>
		<li>При постановке на удаление, аккаунт продолжает считаться действующим в течение всего срока удаления.</li>
	</ol>
	<div>3. Общение</div>
	<ol type="a">
		<li>Запрещено оскорблять других игроков и администрацию любым способом.</li>
		<li>Шантажировать и угрожать можно только в рамках игры.</li>
		<li>Запрещено использовать нецензурные слова и выражения в любом виде.</li>
		<li>Запрещено обманывать администрацию любым способом.</li>
		<li>Запрещено выдавать себя за администрацию игры.</li>
		<li>Спам запрещен.</li>
		<li>Запрещено призывать к нарушениям правил.</li>
		<li>Запрещено публиковать объявления, не относящиеся к игровому процессу.</li>
		<li>Запрещается публикация и использование в любом виде информации (в том числе и ссылок на информацию) неигрового содержания, содержащей дискриминацию по любым признакам или пропагандирующей экстремизм, терроризм, нацизм, ненависть или неуважительное отношение к культуре, расе, народу, языку, религиозным взглядам, политике и политическому строю, идеологии, общественному движению.</li>
		<li>Запрещено общение и распространение информации на политические темы, не относящиеся к игре.</li>
		<li>Запрещено распространять ложную информацию о действиях администрации и об игровом проекте.</li>
		{{?debug.getLang() != 'ru'}}
			<li>Официальными языками игры являются английский и немецкий. Использование иных языков в описании аккаунта, объявлениях, комментариях, названиях и описаниях стран, сообщениях (без согласия на то прочих участников общения) запрещено. Использование транслитерации в сообщениях, объявлениях, комментариях и описаниях запрещено. Это правило не распространяется на имена аккаунтов и городов.</li>
		{{?}}
	</ol>
	<div>4. Игра</div>
	<ol type="a">
		<li>Торговые операции с Монетами Удачи допустимы исключительно через интерфейс торговли. Любая реклама сделок за Монеты Удачи запрещена.</li>
		{{?debug.showRule4b()}}
			<li>Запрещено обозначать союзы игроков и стран не предусмотренным для этого способом (в том числе использование для обозначения частично схожих имен городов и стран).</li>
		{{?}}
	</ol>
	<div>5. Реклама</div>
	<ol type="a">
		<li>Реклама проектов, товаров и услуг, не относящихся к данной игре, запрещена.</li>
		<li>Прочая реклама, несогласованная с администрацией, или не предусмотренная игровым процессом, имеющая своей целью экономическую и иную выгоду, запрещена.</li>
		<li>Любые игровые сторонние услуги, заказанные и оплаченные деньгами или материальными ценностями, несогласованные с администрацией, запрещены.</li>
	</ol>
	<div>6. Ошибки</div>
	<ol type="a">
		<li>Запрещено использовать найденные ошибки. О найденных ошибках следует сообщать в поддержку игры, через электронную почту или администратору на форуме.</li>
		<li>Игровые уязвимости или недоработки могут считаться ошибками.</li>
	</ol>
	<div>7. Ботоводство</div>
	<ol type="a">
		<li>Запрещены любые (несогласованные с администрацией) сторонние программы (скрипты), осуществляющие управление аккаунтом, сбор игровых данных или изменение игровых страниц.</li>
	</ol>
	<div>8. Наказания</div>
	<ol type="a">
		<li>Администрация сама определяет меру наказания.</li>
		<li>Администрация не дает подробных разъяснений по выданным наказаниям.</li>
		<li>Информация о наказаниях не предоставляется третьим лицам.</li>
	</ol>
	<div>9. Правила</div>
	<ol type="a">
		<li>Администрация вправе дополнять данные правила при наличии необходимости.</li>
	</ol>
</script>

<script type="text/plain" id="help.legal">
	<div class="paragraph"><b>Пользовательское соглашение игры «Пути Истории»</b></div>
	<div class="paragraph"><i>Редакция 1 от 1.09.2010</i></div>

	<div class="paragraph">1.1. Настоящее пользовательское соглашение (далее «Соглашение»), регулирует отношения между администрацией (далее «Администрация») браузерной коллективной стратегии «Пути Истории» (далее «Проект») и пользователем игры (далее «Пользователь»).</div>
	<div class="paragraph">1.2. Проект составляют любые материалы, размещенные на доменном имени <a class="link">{{=appl.cnst.protocol}}//{{=lib.main.maindomain}}</a>, а также относящиеся к указанной игре сопутствующие игровые ресурсы.</div>
	<div class="paragraph">1.3. Все авторские, смежные и иные права на игру, включая игровые профили, игровые расчетные средства, и Проект в целом, принадлежат Администрации, если иное в явном виде не указано. Все права собственности и права на интеллектуальную собственность в отношении Проекта, включая, но, не ограничиваясь, любыми графическими изображениями, фотографиями, анимацией, видеозаписями, звукозаписями, музыкой, текстом, сопровождающие Проект материалы и любые ее части или копии принадлежат Администрации. Несанкционированное в явном виде Администрацией использование Проекта или элементов Проекта полностью или частично запрещается.</div>
	<br>
	<br>
	<div class="paragraph">2.1. В случае, если Вам в соответствии с законами вашего государства запрещено получать игровые услуги онлайн или существуют иные законодательные ограничения, включая ограничения по возрасту допуска к таким услугам, вы не вправе использовать Проект или отдельные услуги в Проекте, и обязуетесь немедленно прекратить использование услуг в рамках Проекта.</div>
	<div class="paragraph">2.2. Все сервисы или услуги в рамках Проекта предоставляются исключительно Администрацией. Получение услуг или сервисов от иных третьих лиц может повлечь отказ в предоставлении услуг Проекта для Пользователя полностью или в части на усмотрение Администрации.</div>
	<div class="lgtb">2.3. При использовании сервисов Проекта Пользователь обязуется следовать всем инструкциям, прилагаемым к Проекту, включая следующие: <a class="link" href="{{=HashMgr.getHref('#/help/rules')}}">{{=appl.cnst.protocol}}//{{= lib.main.domain }}/#/help/rules</a> (далее «Правила Проекта»). Правила Проекта формируются Администрацией и обязательны для выполнения Пользователем.</div>
	<div class="lgtb">2.4. Настоящее Соглашение и Правила Проекта могут быть изменены Администрацией в любое время без предварительного уведомления Пользователя. Действующая версия Соглашения расположена по адресу: <a class="link lgtb" href="{{=HashMgr.getHref('#/help/legal')}}">{{=appl.cnst.protocol}}//{{= lib.main.domain }}/#/help/legal</a>. Пользователь, принимая условия настоящего Соглашения, подтверждает, что он достиг 18-летнего возраста, правоспособен и дееспособен и вправе заключать настоящее Соглашение, лица, не достигшие 18-летнего возраста, обязаны согласовать использование Проекта со своими законными представителями (родителями, опекунами и т.д.). Пользователь обязуется проверять Соглашение на предмет изменений не менее чем один раз в семь дней. В случае, если такой проверки не будет в указанные сроки или после ознакомления с Соглашением (новой редакцией Соглашения) Пользователь продолжает пользоваться Проектом, считается, что Пользователь ознакомлен и согласен с Соглашением (новой редакцией Соглашения).
	<div class="paragraph">2.5. Пользователь настоящим уведомлен, что регулярное длительное (непрерывное) нахождение у персонального компьютера может вызывать различные осложнения физического состояния, в том числе ослабление зрения, сколиоз, различные формы неврозов и прочие негативные воздействия на организм. Пользователь гарантирует, что он будет использовать Проект исключительно на протяжении разумного времени, с перерывами на отдых или иные мероприятия по профилактике физического состояния, если таковые Пользователю рекомендованы или предписаны. Настоящим Пользователь уведомлен, что Проект может предусматривать различные звуковые и/или видео эффекты, которые, при определенных обстоятельствах, могут вызывать обострение состояний у лиц, склонных к эпилептическим или иным расстройствам нервного характера. Пользователь гарантирует, что указанными расстройствами он не страдает, или же обязуется не использовать Проект.</div>
	<div class="paragraph">2.6. Пользователь гарантирует, что используемое им оборудование и средства связи, в том числе используемые Пользователем услуги оператора связи, являются достаточными и исправными для участия в Проекте.</div>
	<div class="paragraph">2.7. Администрация предоставляет бесплатный доступ Пользователя к Проекту. Администрация не обеспечивает Пользователю доступ во всемирную сеть Интернет.</div>
	<div class="paragraph">2.8. Исключается использование игры в целях получения прибыли или других коммерческих целях.</div>
	<br>
	<br>
	<div class="paragraph">3.1. Получение дополнительных (Платных) Услуг в Проекте — исключительно инициатива и пожелание Пользователя.</div>
	<div class="paragraph">3.2. Администрация не несет ответственности за правильность выполнения Пользователем положений Правил Проекта. Получение Пользователем дополнительных сервисов Проекта возможно при условии принятия условий настоящего Соглашения, при этом Администрация вправе такие сервисы не предоставлять, предоставлять в ограниченном объеме или ограничивать Пользователю получение как дополнительных (Платных), так и основных сервисов в рамках Проекта. При этом обязанности Администрации по предоставлению Пользователю дополнительных (Платных) услуг в Проекте, предусмотренных настоящим Соглашением, считаются исполненными с момента правомерного получения таким Пользователем возможности реализовать оплаченный объем дополнительных (Платных) услуг.</div>
	<div class="paragraph">3.3. Администрация вправе в одностороннем порядке и в любое время изменить количество и качество предоставляемых услуг, без предварительного уведомления Пользователя.</div>
	<div class="paragraph">3.4. Обязанность Пользователя по правомерному получению доступа к дополнительным (Платным) услугам в Проекте, и наделение Пользователя правами в отношении получения таких услуг по настоящему Соглашению, считается Сторонами исполненными с момента получения Администрацией вознаграждения от Пользователя за такие дополнительные (Платные) услуги.</div>
	<div class="paragraph">3.5. В случае намерения Пользователя использовать дополнительные сервисы Проекта, Пользователь обязуется следовать всем инструкциям, прилагаемым к Проекту по порядку и способам оплаты, в том числе по правилам ввода номера коротких текстовых сообщений (SMS), если таковые предоставляются, включая, но не ограничиваясь, порядком ввода строчных или заглавных букв, пробелов, языка ввода. Администрация игры не несет ответственности за правильность выполнения Пользователем условий проведения оплаты дополнительных сервисов Проекта, как за находящиеся вне контроля Администрации.</div>
	<div class="paragraph">3.6. Администрация вправе закрывать и/или ограничивать функциональность Проекта в любое время без какого-либо предварительного уведомления Пользователей.</div>
	<div class="paragraph">3.7. Администрация не дает никаких явных или подразумеваемых гарантий того, что в процессе разработки Проекта были учтены все недочеты и выявлены все программные ошибки, и, основываясь в том числе на вышеизложенном, Администрация прилагает все разумные усилия для того, чтобы указанные ошибки были выявлены и в разумные сроки исправлены. При этом Пользователь, нашедший такой недочет или ошибку, но не сообщивший о ее наличии Администрации, и использовавший ее для получения не предусмотренных условиями соглашения возможностей игры или публично обнародовавший факт ее существования или характер проявления, лишается прав, предусмотренных Соглашением, непосредственно в момент такого неправомерного использования или обнародования.</div>
	<div class="paragraph">3.8. Исключаются требования возмещения недостатков, касающиеся ошибок, которые возникают в результате внешних независящих от Администрации факторов (форс-мажоры), или ошибок, возникших в результате ошибок управления Пользователем.</div>
	<div class="paragraph">3.9. Администрация не несет ответственности за выход из строя сервера, за возможные ошибки программирования и за ущерб, нанесенный другим образом. Полностью исключены претензии на восстановление состояния игрового аккаунта, которое было до наступления одного из подобных нарушений.</div>
	<div class="paragraph">3.10. Игра и игровые миры в процессе разработки постоянно обновляются и изменяются. Пользователь не может требовать сохранения игры в той версии, которая была при заключении договора.</div>
	<div class="paragraph">3.11. За нарушения Соглашения или Правил Проекта Пользователю может быть незамедлительно, без какого-либо предварительного уведомления, отказано в услугах по предоставлению сервиса Проекта или такие услуги или доступ к Проекту могут быть ограничены полностью или частично.</div>
	<div class="paragraph">3.12. Получение дополнительных (платных) сервисов Проекта не освобождает Пользователей или посетителей Проекта от соблюдения и применения в отношении них Администрацией игры настоящего Соглашения или Правил Проекта, включая, но не ограничиваясь, возможность отказа Администрацией игры в услугах по предоставлению сервиса Проекта или такие услуги или доступ к Проекту могут быть ограничены полностью или частично.</div>
	<br>
	<br>
	<div class="paragraph">4.1. В отдельных случаях Администрация вправе передать данные о Пользователе, нарушающем Соглашение или действующее законодательство, в правоохранительные органы.</div>
	<div class="paragraph">4.2. По требованию Администрации Пользователь обязан сообщить достоверную, полную и актуальную информацию о себе. Если после регистрации эта информация изменится, Пользователь обязан её актуализировать. Любая информация Пользователя персонального характера может быть запрошена Администрацией исключительно для целей исполнения Соглашения, и ни при каких обстоятельствах не передается третьим лицам не иначе как для целей исполнения Соглашения или в соответствии с требованиями законодательства.</div>
	<div class="paragraph">4.3. Администрация предлагает посредством веб-страниц только площадку для сообщения между игроками. За содержание данной коммуникации несет ответственность сам пользователь.</div>
	<div class="paragraph">4.4. Использование сервисов Проекта производится Пользователем исключительно самостоятельно и по принципу «как есть», то есть Администрация не отвечает перед Пользователем ни при каких обстоятельствах за любой прямой и/или косвенный ущерб, которые может быть (возникнуть) у Пользователя в связи с получением сервиса игры или невозможностью такой сервис получить.</div>
	<div class="paragraph">4.5. Администрация управляет Проектом исключительно по своему усмотрению. Для сбора статистических данных и идентификации посетителей Проекта Администрация игры может отслеживать и сохранять информацию об IP-адресах доступа Пользователя к Проекту, использовать файлы технической информации (cookies), размещаемые на локальном терминале Пользователя или посетителя Проекта. Администрация вправе собирать статистические данные о способах, продолжительности, особенностях использования Проекта, Пользователями для их использования в анонимном (обезличенном) виде для улучшения функционирования Проекта в целом, разработки и предоставления дополнительных услуг, иных маркетинговых потребностей Администрации.</div>
	<div class="paragraph">4.6. Регистрируясь, Пользователь выражает свое согласие на просмотр Администрацией его внутриигровой переписки в целях контроля за соблюдением правил игры и законов РФ.</div>
	<div class="paragraph">4.7. Администрация вправе использовать контактную информацию, предоставленную Пользователем добровольно, для отправки информационных рассылок, документов, приглашений на мероприятия и т.п.</div>
	<br>
	<br>
	<div class="paragraph">5.1. Недействительность одного или нескольких положений Соглашения, признанная в установленном порядке вступившим в силу решением суда, не влечет для сторон недействительность Соглашения в целом. В случае признания одного или нескольких положений договора в установленном порядке недействительными, Стороны обязуются исполнять взятые на себя по соглашению обязательства максимально близким к подразумеваемым Сторонами при заключении и/или согласованном изменении соглашения способом.</div>
	<div class="paragraph">5.2. При изменении законодательства, регулирующего установленные соглашением отношения между Сторонами, Стороны обязуются исполнять взятые на себя по соглашению обязательства максимально близким к подразумеваемым Сторонами при заключении и/или согласованном изменении соглашения способом, включая, но не ограничиваясь объемом переданных прав, порядком и способами получения дополнительных сервисов Проекта, условиями поддержки Проекта или прекращения действия соглашения.</div>
	<div class="paragraph">5.3. Все споры сторон по настоящему соглашению подлежат разрешению путем переписки и переговоров, в случае невозможности достичь согласия между сторонами путем переговоров, рассмотрение спора может быть передано любой заинтересованной стороной в соответствующий суд общей юрисдикции г. Красноярск, Россия.</div>
	<div class="paragraph">5.4. Администрация вправе рассылать Пользователям электронные сообщения информационного или технического характера, связанные с Проектом.</div>
	<div class="paragraph">5.5. Всё взаимодействие в рамках соглашения ведется на русском языке.</div>
	<br>
	<br>
	<div class="paragraph">6.1. Настоящее Соглашение вступает в силу при акцептации его Пользователем путем выбора и нажатия опции «согласен» (или иной аналогичной опции). Пользователь соглашается, что выбор им вышеуказанной опции означает, что он предварительно и в полном объеме ознакомился с условиями настоящего Соглашения, и принимает их без каких-либо исключений. Соглашение заключается на неопределенный срок. Пользователь может прекратить действие Соглашения в любое время, прекратив использование Проекта. Администрация может в любое время прекратить действие Соглашения по любой причине или без причины. При прекращении настоящего Соглашения по любой причине или без причины, все права, предоставленные Пользователю по настоящему Соглашению, прекращаются. Администрация вправе в одностороннем порядке отказаться от настоящего Соглашения и прекратить предоставление услуг по пользованию Проектом без возмещения убытков. Все изменения, дополнения, приложения к настоящему Соглашению или иная информация являются неотъемлемой его частью и являются обязательными для исполнения с момента опубликования их на сайте игры.</div>
	<div class="paragraph">6.2. Начало использования проекта означает безусловное согласие и принятие условий пользователем, в отношении положений настоящего соглашения.</div>
	<div class="paragraph">6.3. По вопросам, связанным с исполнением Соглашения, просьба обращаться по адресу: <a class="link" href="mailto:{{= lib.main.supportemail }}">{{= lib.main.supportemail }}</a></div>
</script>

<script type="text/plain" id="help.search">
	<div class="help-page-topic">Результат поиска</div>
	<div class="help-page">
		<div class="aC">
			{{var searchTitle = utils.sizeOf(it.searchResults) ? ['Результат поиска по запросу ', ''] : ['Поиск по запросу ', ' не дал результатов :('];}}
			
			{{=searchTitle[0]}}
			«{{=snip.wrp('help-search-highlight fwB', it.searchText)}}»
			{{=searchTitle[1]}}
		</div>
		<div class="help-search">
			{{?utils.sizeOf(it.searchResults)}}
				{{@it.searchResults: results: pageName}}
					<div class="help-search-page">
						{{@results: result}}
							<div class="help-search-result">
								<div class="aC fwB">{{=snip.link(hashMgr.getWndHref('help', pageName), wHelp.pages[pageName].name, 'fwB js-searchPage', {data: 'data-page="'+pageName+'" data-pos="'+result.pos+'"'})}}</div>
								<div class="help-search-html">{{=result.html}}</div>
							</div>
						{{@}}
					</div>
				{{@}}
			{{??}}
				<div class="aC">
					Несколько советов при поиске:
					<br><br>
					Убедись, что нет ошибок в строке поиска;
					<br>
					Старайся использовать более общие понятия.
				</div>
			{{?}}
		</div>
	</div>
</script>
					
<script type="text/plain" id="tpl-town-link">
	<div style="position: fixed;z-index: 99999;left: 50%;bottom: 100px;margin-left: -480px;">
		<div style="display:block;position:absolute;width: 151px;top: -59px;bottom: -30px;left: -2px;background: linear-gradient(to bottom, green, transparent);"></div>
		<a class="townbut link -chgLoc" href="/{{=HashMgr.getLinkadd()}}"><span class="townbut-scroll">В город</span></a>
	</div>
</script><script type="text/plain" id="buildinfo.header">
    {{=it.slot.getName()}}
</script>

<script type="text/plain" id="buildinfo">
    <div class="page-pedia">
		<div class="tabs tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="buildinfo.desc">
	{{=tmplMgr.buildinfo.img(it)}}
	
	<div class="pedia-text js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-80, 300)}}px;">
		<div class="pedia-info -type-buildInfo">{{=it.slot.getDesc()}}</div>
		
		{{=tmplMgr.buildinfo.features(it)}}
		
		{{=it.slot.getSpeciale()}}
		
		{{=tmplMgr.buildinfo.info(it)}}
	</div>
</script>

<script type="text/plain" id="buildinfo.img">
	<div class="pedia-img-wrp">
		<div class="pedia-img -type-build">
			{{var slotImg = new Slot(it.slot.id, (wofh.account.research && wofh.account.research.build[it.slot.id])||1);}}
			<div class="slotbld-imgBack -type-{{= slotImg.getImgBack() }}">
				<div class="slotbld-imgSlot">
					{{var offset = slotImg.getDisp(true);}}
					<div class="slotbld-img" style="top: {{=offset.y}}px; left: {{=offset.x}}px;position:relative;">
						{{=snip.buildImgBig(slotImg, false, {noTitle: true})}}
					</div>
				</div>
			</div>
		</div>
		
		{{=snip.pediaLinkBtn(it.slot.isWonder()?'wonder':'build', 'pedia-upBtn')}}
	</div>
</script>

<script type="text/plain" id="buildinfo.features">
	<table style="width: 100%">
		{{=snip.buildParams(it.slot, false)}}
	</table>
</script>

<script type="text/plain" id="buildinfo.info">
	<div class="pedia-buildInfo">
		<dl>
			<dt>Требуемые науки: </dt>
			<dd>
				{{
					var avail = it.slot.getAvailQuestLevel();
					var taken = it.slot.getQuestLevel();
				}}
				{{?avail}}
					<span class="clr{{?taken == 0}}0{{??taken < avail}}1{{??}}2{{?}}" style="padding-left: 20px;">Выполнение начальных заданий </span>
					(+{{= avail }}  ур.)<br>
				{{?}}

				{{@it.slot.getSciences().getList(): science}}
					{{var known = Account.isLogin() ? science.getKnown() : Science.known.done;}}
					<a class="link clr{{?known == Science.known.unavail}}0{{??known == Science.known.avail}}1{{??}}2{{?}}" href="{{=HashMgr.getHref('#/scienceinfo/'+science.getId())}}">{{=snip.scienceIcon()}}{{= science.getName()}}</a> (+{{= science.getBuildLevel(it.slot.getId()) }}  ур.)<br>
				{{@}}
			</dd>
		</dl>

		{{var train = it.slot.getTrainUnits();}}
		{{? !train.isEmpty()}}
			<dl>
				<dt>Обучает: </dt>
				<dd>
					{{@train.getList() : unit}}
						{{=snip.unitNameLink(unit, false, {highlight:true})}}<br>
					{{@}}
				</dd>
			</dl>
		{{?}}

		{{var group = it.slot.getConflicts();}}
		{{?!group.isEmpty()}}
			<br><br>Не работает с: 
			{{@ group.getList(): slot }}
				{{=snip.buildLink(slot)}}&nbsp;
			{{@}}
		{{?}}

		{{var nextBuild = it.slot.getRebuild();}}
		{{?nextBuild && !nextBuild.isEmpty()}}
			<br><br>Можно перестроить в:  {{=snip.buildLink(nextBuild, false, {level:false})}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="buildinfo.levels">
	<div>
		{{
			var hasBuildPay = it.slot.hasBuildPay();
			var hasBuildUngrown = it.slot.hasBuildUngrown();
			var tblType = 'wide';
			var colsCount = 3 + (hasBuildPay ? 1 : 0) + (hasBuildUngrown ? 1 : 0);
			if( colsCount > 4 )
				tblType = 'narrow';
			else if( colsCount > 3 )
				tblType = 'medium';
		}}
		<table class="s-tbl tbl-buildLevels -type-{{=tblType}}">
			<colgroup>
				<col class="buildLevels-col1">
				<col class="buildLevels-col2">
			</colgroup>
			
			<thead>
				<tr>
					<th>Уровень</th>
					<th>Цена</th>
					{{?hasBuildPay}}
						<th>Содержание</th>
					{{?}}
					<th>{{?it.slot.getType() == Build.type.production}}Работники{{??}}Эффективность{{?}}</th>
					{{?hasBuildUngrown}}
						<th>Спад населения</th>
					{{?}}
				</tr>
			</thead>
			<tbody>
				{{ for (var l = 1; l <= lib.build.maxlevel; l++) { }}
					{{var slot = new Slot(it.slot.getId(), l);}}
					
					<tr class="trow{{= l % 2 }}">
						<td>
							{{=snip.time(false, timeMgr.fPeriod(slot.getTime()))}} <span class="{{?wofh.account.research && wofh.account.research.build[it.slot.getId()] < l}}-warnBg -bgColor-brown{{?}}">{{=l}}</span>
						</td>
						<td class="tl">{{=snip.resList(slot.getCost())}}</td>
						{{?hasBuildPay}}
							<td>
								{{var pay = slot.getPay({withoutRace: true});}}

								{{?pay > 0}}
									{{= snip.resCount(Resource.ids.money, pay.toFixed(pay < 100 ? 1 : 0)) }}
								{{?}}
							</td>
						{{?}}
						<td>
							{{=snip.slotEffect(slot)}}
						</td>
						{{?hasBuildUngrown}}
							<td>
								{{var ungrown = slot.getUngrown();}}
								
								{{?ungrown}}
									{{=snip.pop(snip.fixedHint(ungrown * timeMgr.DtH))}}
								{{?}}
							</td>
						{{?}}
					</tr>
				{{ } }}
			</tbody>
		</table>
	</div>
</script><script type="text/plain" id="scienceinfo.header">
    {{=it.science.getName()}}
</script>

<script type="text/plain" id="scienceinfo">
    <div class="page-pedia view-scienceinfo">
		{{=tmplMgr.scienceinfo.img(it)}}
		
		<div class="pedia-text js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-50), 300)}}px;">
            <div>
                <div class="pedia-info -type-scienceInfo">{{=it.science.getDesc()}}</div>
            
                {{=tmplMgr.scienceinfo.info(it)}}
            </div>
		</div>
		
		<div class="cB"></div>
	</div>
</script>

<script type="text/plain" id="scienceinfo.img">
	<div class="pedia-img-wrp">
		<div class="pedia-img -type-science">
			{{=snip.scienceImgBig(it.science)}}
		</div>
		
		{{=snip.pediaLinkBtn('science', 'pedia-upBtn')}}
	</div>
</script>

<script type="text/plain" id="scienceinfo.info">
	<div class="pedia-scienceInfo">
		<dl>
			<dt>Требуется:</dt>
			<dd>
				{{= snip.res(Resource.ids.science)}}{{=utils.stages(~~it.science.getCost())}}
				<br>
				{{~it.science.need: science}}
					{{science = Science.get(science);}}
					{{?!science.isEmpty()}}
						{{=snip.scienceLink(science, {highlight: true})}}<br/>
					{{?}}
				{{~}}
			</dd>
		</dl>


		<!-- науки -->
		{{? !it.science.next.isEmpty() }}
			<dl>
				<dt>Открывает к изучению:</dt>
				<dd>
					{{~ it.science.next.clone().getSortList('cost', true).getList(): science }}
						{{=snip.scienceLink(science, {highlight: true})}}<br/>
					{{~}}
				</dd>
			</dl>
		{{?}}



		<!-- юниты -->

		{{? !it.science.units.isEmpty() }}
			<dl>
				<dt>Открывает войска:</dt>
				<dd>
					{{@ it.science.units.getList(): unit }}
						<span class="build-w">
							{{=snip.unitLink(unit, snip.unitIcon(unit, {half: unit.isHalf})+'<br/>'+unit.getName())}}
						</span>
					{{@}}
				</dd>
			</dl>
		{{?}}

		<!-- строения -->
		{{ var builds = it.science.builds.filterWonders(false);}}

		{{? !builds.isEmpty() }}
			<dl>
				<dt>Открывает строения:</dt>
				<dd>
					{{@ builds.getList() : build}}
						<span class="build-w">
							{{=snip.slotFrame(build, '<span class="build-level">+'+build.getCount()+'</span>')}}
							<span class="dB">{{=snip.buildLink(build)}}</span>
						</span>
					{{@}}
				</dd>
			</dl>
		{{?}}

		<!-- чудеса -->
		{{ var builds = it.science.builds.filterWonders(true);}}
		{{? !builds.isEmpty() }}
			<dl>
				<dt>Открывает Чудеса Света:</dt>
				<dd>
					{{@ builds.getList() : build }}

						<span class="build-w">
							{{=snip.slotFrame(build, '<span class="build-level">+'+build.getCount()+'</span>')}}
							<span class="dB">{{=snip.buildLink(build)}}</span>
						</span>
					{{@}}
				</dd>
			</dl>
		{{?}}

		<!-- бонусы -->
		{{? utils.sizeOf(it.science.bonuses) || utils.sizeOf(it.science.abilities) || it.science.envs.length }}
			<dl>
				<dt>Дает бонусы:</dt>
				<dd>
					{{@ it.science.bonuses: bonusVal : bonusId }}
						<div>
							<span class="bt bt{{= bonusId }}"></span>

							{{=snip.scienceBonus(bonusId, bonusVal)}}

							{{?bonusId == Science.bonus.knowledge && !it.science.isKnown(true) && wofh.account && wofh.account.isScientist()}} 
								<span class="scienceinfo-prognosis">(<a class="link scienceinfo-prognosisLink">прогноз</a>)</span>
							{{?}}
						</div>
					{{@}}
					{{@ it.science.abilities: abilityVal : abilityId }}
						<div class="scienceinfo-ability">
							{{?abilityId == Science.ability.fish}}
								{{=snip.resEffect(Resource.ids.fish)}}
							{{??abilityId == Science.ability.cloth}}
								{{=snip.resEffect(Resource.ids.cloth)}}
							{{??abilityId == Science.ability.roadDirt || abilityId == Science.ability.roadHighway || abilityId == Science.ability.roadRailway || abilityId == Science.ability.roadMaglev || abilityId == Science.ability.roadTunnel}}
								{{=snip.icon(snip.c.anyIcon, 'mapImp')}}
							{{??}}
								{{=snip.icon(snip.c.anyIcon, 'cap')}}
							{{?}}

							{{=snip.scienceAbility(abilityId)}}
						</div>
					{{@}}
					{{~ it.science.envs: imp }}
						<div><span class="btAnyIconWrp">{{= snip.mapImpLevel(imp, {icon: 'effect'}) }}</div>
					{{~}}
					{{?it.science.fuel}}
						<div><span class="btAnyIconWrp">{{=snip.icon(snip.c.anyIcon, 'fuel')}}</span> Ускорение доставки грузов за {{=snip.resBig(it.science.fuel)}}</div>
					{{?}}
				</dd>
			</dl>
		{{?}}

		<!-- Великие граждани -->
		{{=tmplMgr.snipet.specialistList({science:it.science})}}

		<!-- местороды -->
		{{? it.science.deposits.length }}
			<dl>
				<dt>Открывает месторождения:</dt>
				<dd>
					{{var lastName = '';}}
					{{~ it.science.deposits: deposit }}

						{{?lastName!= deposit.getName()}}
							<span class="mti deposit"></span><a href="{{=HashMgr.getHref('#/help/deposit')}}">{{= deposit.getName() }}</a><br>
							{{lastName = deposit.getName();}}
						{{?}}
					{{~}}
				</dd>
			</dl>
		{{?}}
	</div>
</script><script type="text/plain" id="unitinfo.header">
	{{=it.unit.getName()}}
</script>


<script type="text/plain" id="unitinfo">
	<div class="page-pedia">
		{{=tmplMgr.unitinfo.img(it)}}
		
		<div class="pedia-text">
			<div class="pedia-info -type-unitInfo">{{=it.unit.getDesc()}}</div>
			
			{{=tmplMgr.unitinfo.features(it)}}
		</div>
		
		<div class="clearleft" style="clear: both"></div>
	</div>
</script>

<script type="text/plain" id="unitinfo.img">
	<div class="pedia-img-wrp">
		<div class="pedia-img -type-unit">
			<img src="https://test.waysofhistory.com/img/help/units/{{=it.unit.getImgId()}}.png">
		</div>
		
		{{=snip.pediaLinkBtn('unit', 'pedia-upBtn')}}
	</div>
</script>

<script type="text/plain" id="unitinfo.features">
	{{var unit = it.unit;}}
	
	<table class="pedia-features">
		<colgroup>
			<col class="pedia-features-col1">
			<col class="pedia-features-col2">
			<col class="pedia-features-col3">
		</colgroup>

		<tbody>
			{{?unit.hasTag(Unit.tags.aircraft | Unit.tags.ship)}}
				<tr>
					<td class='pedia-label'>Здоровье</td>
					<td><img class="icnu ic14" src="https://test.waysofhistory.com/img/_.gif" title="Здоровье"></td>
					<td>{{= utils.formatNum(unit.getHealth(), {stages:true})}}</td>
				</tr>
			{{?}}

			{{? unit.getGroundDamage()}}
				<tr>
					<td class="pedia-label">Урон по сухопутной армии и флоту</td>
					<td><img class='icnu ic16' src='https://test.waysofhistory.com/img/_.gif' title='Урон по сухопутной армии и флоту'></td>
					<td>{{= snip.pop(unit.getGroundDamage()) }}</td>
				</tr>
			{{?}}

			{{? unit.hasAbility(Unit.ability.destroy) }}
				<tr>
					<td class="pedia-label">Урон городу</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'townDmg')}}</td>
					<td>{{=utils.formatNum(unit.getBuildDamage(), {round:true, stages:true})}}</td>
				</tr>
			{{?}}

			{{? unit.data.evasion > 0 }}
				<tr>
					<td class="pedia-label">Уклонение</td>
					<td><img class='icnu ic12' src='https://test.waysofhistory.com/img/_.gif' title='Уклонение'></td>
					<td>{{= utils.toPercent(unit.data.evasion) }}%</td>
				</tr>
			{{?}}


			{{? unit.data.popkill > 0 }}
				<tr>
					<td class='pedia-label'>Убивает население</td>
					<td><img class='icnb ic10' src='https://test.waysofhistory.com/img/_.gif' title='Убивает население'></td>
					<td>{{=snip.pop()}}{{=utils.formatNum(unit.data.popkill, {uFixed:1, stages:true})}}</td>
				</tr>
			{{?}}
			{{?unit.getAirDamage()}}
				<tr>
					<td class='pedia-label'>Урон авиации</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'airDamage')}}</td>
					<td>{{=utils.formatNum(unit.getAirDamage(), {stages:true})}}</td>
				</tr>
			{{?}}
			{{?unit.getWaterDamage()}}
				<tr>
					<td class='pedia-label'>Урон кораблям</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'waterDamage')}}</td>
					<td>{{=utils.formatNum(unit.getWaterDamage(), {stages:true})}}</td>
				</tr>
			{{?}}
			{{?unit.getCapacity()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.unitCapacity.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'unitCapacity')}}</td>
					<td>{{=utils.formatNum(unit.getCapacity(), {stages:true})}} <span class="pedia-label">единиц</span></td>
				</tr>
			{{?}}

			<tr>
				<td class="pedia-label">{{=snip.c.anyIcon.speed.title}}</td>
				<td>{{=snip.icon(snip.c.anyIcon, 'speed')}}</td>
				<td>{{=utils.formatNum(unit.getSpeed() * 3600, {servRound:true, fixed:1})}} <span class="pedia-label">полей в час</span></td>
			</tr>
			<tr>
				<td class="pedia-label">{{=snip.c.anyIcon.race.title}}</td>
				<td>{{=snip.icon(snip.c.anyIcon, 'race')}}</td>
				<td>
					{{? unit.getRaces().hasAll() }}
						Любая
					{{??}}
						{{= snip.list(unit.getRaces().getList(), function(race){return snip.raceName(race, {colored:(wofh.account||{}).race});})}}
					{{?}}
				</td>
			</tr>

			{{?unit.getTags()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.features.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'features')}}</td>
					<td>{{=snip.unitTags(unit)}}</td>
				</tr>
			{{?}}

			{{?unit.hasAbilities()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.abilities.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'abilities')}}</td>
					<td>
						{{=snip.list(unit.getAbilitiesArr(), function(item, i){
							return '<a class="link " href="'+HashMgr.getHref('#/help/unit&anchor=abil')+'">'+Unit.getAbilityName(+i+1)+'</a>'
						})}}
					</td>
				</tr>
			{{?}}
			<tr>
				<td colspan="3">&nbsp;</td>
			</tr>
			{{var slots = unit.getTrainingSlots();}}
			{{?!slots.isEmpty()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.place.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'place')}}</td>
					<td>
						{{= snip.list(slots.getList(), function(slot){
							return snip.buildLink(slot, false, {level: false});
						})}}
					</td>
				</tr>
			{{?}}
			<tr>
				<td class="pedia-label">{{=snip.c.anyIcon.cost.title}}</td>
				<td>{{=snip.icon(snip.c.anyIcon, 'cost')}}</td>
				<td>
					{{= timeMgr.fPeriod(unit.getTrainTime())}} 
					{{?unit.getPopCost()}}
						{{=snip.pop(unit.getPopCost())}} 
					{{?}}
					{{=snip.resList(unit.getCost())}}
				</td>
			</tr>
			{{?!unit.getPay().isEmpty()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.rent.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'rent')}}</td>
					<td>
						{{=snip.resList(unit.getPay())}}
						<span class="pedia-label">  в час</span>
					</td>
				</tr>
			{{?}}
			{{var sciences = unit.getSciences();}}
			{{?!sciences.isEmpty()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.science.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'science')}}</td>
					<td>
						{{~sciences.getSortList('cost', true).getList() : science}}
							{{ var known = science.getKnown(); }}
							<a class="clr{{?known == Science.known.unavail}}0{{??known == Science.known.avail}}1{{??}}2{{?}} link" href="{{=HashMgr.getHref('#/scienceinfo/'+science.getId())}}">{{= science.getName() }}</a><br>
						{{~}}
					</td>
				</tr>
			{{?}}


			{{var nextUnit = unit.getNext();}}
			{{?!nextUnit.isEmpty()}}
				<tr>
					<td class="pedia-label">{{=snip.c.anyIcon.retrain.title}}</td>
					<td>{{=snip.icon(snip.c.anyIcon, 'retrain')}}</td>
					<td>
						{{=snip.unitNameLink(nextUnit)}}
					</td>
				</tr>
			{{?}}
		</tbody>
	</table>
</script><script type="text/plain" id="mapFilterWnd.header">
	Фильтры
</script>


<script type="text/plain" id="mapFilterWnd">
	<div class="view-mapFilter">
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.town;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Tile.relation.none}}" data-title="Нейтральные города">
				<span class="iconTown -rel-none"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Tile.relation.self}}" data-title="Мои города">
				<span class="iconTown -rel-self"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Tile.relation.country}}" data-title="Города страны">
				<span class="iconTown -rel-country"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Tile.relation.ally}}" data-title="Города союзников">
				<span class="iconTown -rel-ally"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Tile.relation.enemy}}" data-title="Города врагов">
				<span class="iconTown -rel-enemy"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.town.barb}}" data-title="Города варваров">
				<span class="iconTown -type-barb"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.town.build}}" data-title="Основываемые города">
				<span class="iconTown -type-build"></span>
			</a>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.hill;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.hill.show}}" data-title="Холмы">
				<span class="iconHill"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.hill.spec}}" data-title="Xолмы под и вокруг своих городов">
				<span class="iconHill -type-blue"></span>
			</a>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.mount;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.mount.show}}" data-title="Горы">
				<span class="iconMount"></span>
			</a>
			
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.mount.spec}}" data-title="Горы вокруг твоих городов">
				<span class="iconMount -type-blue"></span>
			</a>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.wonder;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.wonder.inactive}}" data-title="Неактивированные Чудеса Света">
				<span class="iconWonder"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.wonder.concurent}}" data-title="Чудеса Света конкурирующие с текущим городом">
				<span class="iconWonder -type-blue"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.wonder.active}}" data-title="Активированные Чудеса Света">
				<span class="iconWonder -active"></span>
			</a>
			<select class="mapFilter-select select1" data-id="{{=LS.mapFilter2.wonderId}}">
				<option value="-1">Все города</option>
				<option value="-2">Города с Чудесами Света</option>
				{{@BuildList.getAll().filterWonders(true).getList(): slot}}
					<option value="{{=slot.id}}">{{=slot.getName()}}</option>
				{{@}}
				<option value="-3">Города без Чудес Света</option>
			</select>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.deposit;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.deposit.show}}" data-title="Все месторождения">
				<span class="iconDeposit"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.deposit.spec}}" data-title="Видны подходящие для колонизации">
				<span class="iconDeposit -type-blue"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.deposit.build}}" data-title="Колонизируемые месторождения">
				<span class="iconDeposit -type-build"></span>
			</a>
			<select class="mapFilter-select select1" data-id="{{=LS.mapFilter2.depositId}}">
				<option value="-1">Все месторождения</option>
				{{@Deposit.groupIds: groupName: groupId}}
					<option value="{{=groupId}}">{{=groupName}}</option>
				{{@}}
				
				{{@DepositList.getAll(true).getList(): deposit}}
					<option value="{{=deposit.id}}">{{=deposit.getName()}} - {{=Tile.climate[deposit.getClimate()].title}}</option>
				{{@}}
			</select>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.mapimp;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.mapImp.show}}" data-title="Все улучшения местности">
				<span class="iconMapImp"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.mapImp.spec}}" data-title="Улучшения у моих городов">
				<span class="iconMapImp -type-blue"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.mapImp.build}}" data-title="Строящиеся улучшения">
				<span class="iconMapImp -type-build"></span>
			</a>
			<select class="mapFilter-select select1" data-id="{{=LS.mapFilter2.mapimpId}}">
				<option value="-1">Все улучшения местности</option>
				{{@MapImp.getAll().getList(): mapImp}}
					<option value="{{=mapImp.id}}">{{=mapImp.getName()}}</option>
				{{@}}
			</select>
		</div>
		<div class="mapFilter-row">
			{{var id = LS.mapFilter2.road;}}
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.road.spec}}" data-title="Дороги, доступные для улучшения текущим городом">
				<span class="iconRoad -type-blue"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Road.ids.dirt}}" data-title="Грунтовая дорога">
				<span class="iconRoad -type-{{=Road.ids.dirt}}"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Road.ids.highway}}" data-title="Шоссе">
				<span class="iconRoad -type-{{=Road.ids.highway}}"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Road.ids.railway}}" data-title="Железная дорога">
				<span class="iconRoad -type-{{=Road.ids.railway}}"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Road.ids.maglev}}" data-title="Маглев">
				<span class="iconRoad -type-{{=Road.ids.maglev}}"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=Road.ids.tunnel}}" data-title="Тоннель">
				<span class="iconRoad -type-{{=Road.ids.tunnel}}"></span>
			</a>
			<a class="button4 mapFilter-button" data-id="{{=id}}" data-val="{{=wMapFilter.filter.road.build}}" data-title="Строящиеся дороги">
				<span class="iconRoad -type-build"></span>
			</a>
		</div>
		<div class="mapFilter-row aC">
			<br>
			<a class="link mapFilter-reset">Сбросить фильтры</a>
		</div>
	</div>
</script><script type="text/plain" id="market.panel">
	<div class="market-panel">
		<div class="market-traders-wrp">
			<div class="market-traders-block js-market-traders-block">
				<div class="market-traders js-market-traders">
					{{=tmplMgr.market.traders()}}
				</div>
				<div class="market-capacity">
					<span class="js-market-capacity">
						{{=tmplMgr.market.capacity()}}
					</span>
					{{?wofh.account.isPremium() || wofh.account.isAdmin()}}
						<div class="market-showTradersInfo js-market-showTradersInfo" data-title="Показать полную информацию о торговцах"></div>
					{{?}}
				</div>
				<div class="market-reserve">
					{{=snip.title('Резерв торговцев', 'Количество зарезервированных торговцев.<br>Они не используются для обеспечения внешних торговых операций, кроме черного рынка.', 'fakelink')}}
					&nbsp;
					{{=snip.input1({cls: 'market-reserve-inp', name: 'count', value: wofh.town.traders.reserve, autocomplete: 'off'})}}
					<button type="button" class="button2 market-reserve-set -type-accept -hidden"></button>	
				</div>
			</div>
			{{?it.showAutoStart}}
				<span class="tradersMove-autoShow-block">
					<label class="crP">{{=snip.checkbox1({cls:'js-tradersMove-autoStart', checked: ls.getTradersMoveAutoStart(true)})}} Авто-появление</label>
				</span>
			{{?}}
			
			<div class="market-info-wrp">
				{{?Resource.fuelScience.getLength()}}
					<div class="market-button {{?it.showTradersMove}}-type-sep{{?}}">
						<a href="{{=hashMgr.getWndHref('tradeCons')}}">
							<span class="speedUpIcon">
								{{=snip.icon(snip.c.anyIcon, 'fuel')}}
							</span>
						</a>
					</div>
				{{?}}

				{{?it.showTradersMove}}
					{{=tmplMgr.market.button.tradersMove()}}
				{{?}}
			</div>

			{{?it.showLuck}}
				<div class="market-luck-wrp">
					{{=snip.title(snip.luck(utils.toInt(wofh.account.getCoinsBought())), 'Количество доступных для торговли Монет Удачи. <br>Для совершения торговых операций можно использовать только купленные, ранее не переводимые и не использованные в торговых операциях Монеты Удачи.', 'fakelink crH js-market-luck')}}
				</div>
			{{?}}
		</div>
		
		<div class="market-tradersInfo-wrp js-market-tradersInfo-wrp">
			{{=tmplMgr.market.tradersInfo(it)}}
		</div>
	</div>
</script>

<script type="text/plain" id="market.button.tradersMove">
	<div class="market-button">
		<a href="{{=hashMgr.getWndHref('tradersMove')}}">
			<span class="tradersMoveIcon">
				{{=snip.icon(snip.c.anyIcon, 'traders', 'Передвижение торговцев')}}
			</span>
		</a>
	</div>
</script>

<script type="text/plain" id="market.traders">
	Торговцы: &nbsp;
	<span data-title="Свободно ">{{=wofh.town.getFreeTraders()}}</span>
	&nbsp;/&nbsp;
	<span data-title="Всего ">{{=wofh.town.traders.count}}</span>

	{{var bonus = wofh.town.getLuckBonus(LuckBonus.ids.traders);}}
	{{?wBonusTakeNow.canShow(bonus)}}
		&nbsp;
		<a class="link market-traders-addBonus">
			(ещё {{=bonus.getTypedEffectUp()}})
		</a>
	{{?}}
</script>

<script type="text/plain" id="market.capacity">
	Вместимость: &nbsp;
	<span data-title="Доступно">{{=(wofh.town.traders.count - wofh.town.traders.busy) * lib.trade.capacity}}</span>
	&nbsp;/&nbsp;
	<span data-title="Всего">{{=wofh.town.traders.count * lib.trade.capacity}}</span>
</script>


<script type="text/plain" id="market.tradersInfo">
	<div class='market-tradersInfo'>
		<div class='market-tradersInfo-traders'>
			{{?it.showBusyTrders}}
				На рынке: <span class="js-marketBusyTraders">0</span> торг.
				<br>
			{{?}}
			{{
				var streamTraders = Trade.getStreamTradersCount();
				var moveTraders = wofh.town.traders.busy - streamTraders;
			}}
			В пути: {{=moveTraders}} торг.
			<br>
			На снабжении: {{=streamTraders}} торг.
			<br>
			<div>
				<a class="link js-marketTrans">История операций</a>
			</div>
		</div>
		<div class='market-tradersInfo-capacity'>
			Вместимость одного торговца: {{=lib.trade.capacity}} ед.
			<br>
			Общая вместимость: {{=wofh.town.traders.count * lib.trade.capacity}} ед.
			<br>
			Доступная вместимость: {{=(wofh.town.traders.count - wofh.town.traders.busy) * lib.trade.capacity}} ед.
		</div>
	</div>
</script>


<script type="text/plain" id="market.tabs">
	<div class="tabs -type-market">
		{{?Trade.isBarterAllowed()}}
			<a class="tabs-btn {{?it.activeTab == 'barter'}}-active{{?}}" href="{{=HashMgr.getHref('#/barter')}}">
				<span class="tabs-icon">
					<span class="iconTab -id-0"></span>
				</span>
				<span class="tabs-title">Бартерный обмен</span>
			</a>
			
			{{=tmplMgr.market.subTabs({subTab: 'barter', activeTab: it.activeTab})}}
		{{?}}
		{{?Account.hasAbility(Science.ability.money)}}
			<a class="tabs-btn {{?it.activeTab == 'trade'}}-active{{?}}" href="{{=HashMgr.getHref('#/trade')}}">
				<span class="tabs-icon">
					<span class="iconTab -id-2"></span>
				</span>
				<span class="tabs-title">Торговля</span>
			</a>
			
			{{=tmplMgr.market.subTabs({subTab: 'trade', activeTab: it.activeTab})}}
			
			<a class="tabs-btn {{?it.activeTab == 'stream'}}-active{{?}}" href="{{=HashMgr.getHref('#/stream')}}">
				<span class="tabs-icon">
					<span class="iconTab -id-5"></span>
				</span>
				<span class="tabs-title">Снабжение</span>
			</a>
			
			{{=tmplMgr.market.subTabs({subTab: 'stream', activeTab: it.activeTab})}}
			
			<div class="market-opt-wrp">
				{{?debug.isTest('later')}}
					<a class="button4 market-optWnd" href="{{=hashMgr.getWndHref('marketOpt')}}">{{=snip.optIcon()}}</a>
				{{?}}
				
				<a href="{{=HashMgr.getHref('#/ally')}}">
					<span class="iconTab -id-13"></span>
				</a>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="market.subTabs">
	{{?it.subTab != it.activeTab}}{{return out;}}{{?}}
	
	<ul class="market-subTabs -type-{{=it.activeTab}}">
		{{?it.activeTab == 'barter'}}
			<li class="js-tabLink -active" data-tab="sell">
				<a class="market-subTab">
					<span class="tab-icon -sell"></span>
					<span class="tab-title">Мои предложения (<span class="js-activeBarterOffersCount"></span>)</span>
				</a>
			</li>
			{{?Ability.isBarterAvailable()}}
				<li class="js-tabLink" data-tab="buy">
					<a class="market-subTab">
						<span class="tab-icon -buy"></span>
						<span class="tab-title">Все предложения</span>
					</a>
				</li>
			{{?}}
		{{??it.activeTab == 'trade'}}
			<li class="js-tabLink -active" data-tab="{{=Trade.type.sell}}">
				<a class="market-subTab">
					<span class="tab-icon -sell"></span>
					<span class="tab-title">Мои предложения (<span class="js-activeTradeOffersCount"></span>)</span>
				</a>
			</li>
			
			<li class="js-tabLink" data-tab="{{=Trade.type.buy}}">
				<a class="market-subTab">
					<span class="tab-icon -buy"></span>
					<span class="tab-title">Все предложения</span>
				</a>
			</li>
		{{??it.activeTab == 'stream'}}
			<li class="js-tabLink" data-tab="info">
				<a class="market-subTab">
					<span class="tab-icon -info"></span>
					<span class="tab-title">Создание и управление (<span class="js-streamsCount"></span>)</span>
				</a>
			</li>
			<li class="js-tabLink" data-tab="sell">
				<a class="market-subTab">
					<span class="tab-icon -sell"></span>
					<span class="tab-title">Мои предложения (<span class="js-streamOffersCount"></span>)</span>
				</a>
			</li>
			<li class="js-tabLink" data-tab="buy">
				<a class="market-subTab">
					<span class="tab-icon -buy"></span>
					<span class="tab-title">Все предложения</span>
				</a>
			</li>
		{{?}}
	</ul>
</script>





<script type="text/plain" id="marketOpt.header">
	Настройки торговли
</script>

<script type="text/plain" id="marketOpt">
	<div class="view-marketOpt">
		<div class="marketOpt-barter-wrp"></div>
	</div>
</script>

<script type="text/plain" id="marketOpt.barter">
	<div>
		
	</div>
</script><script type="text/plain" id="message.header">
	{{?it.thread}}
		Переписка с {{=it.thread.author.name}}
	{{??}}
		Переписка
	{{?}}
</script>

<script type="text/plain" id="message">
	<div class="view-message">
		<div class="message-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="message.view">
	<form>
		<div class="message-topic {{?it.thread.access}}-type-short{{?}}">
			{{=TextParser.prepare(it.thread.topic)}}
			{{?it.thread.access}}
				<div class="noDiscuss">
					{{=snip.nobr(snip.crown() + ' ' + snip.tooltip('без обсуждения', 'В этой теме могут писать только должностные лица страны и их помощники'))}}
				</div>
			{{?}}
		</div>
		
		<div class="message-list-wrp">
			<div class="js-scroll-wrp message-list" style="max-height: {{=Math.max(Math.min(utils.getWindowHeight(-400, 0), 1150), 350)}}px;">
				<ul class="message-list-ul"></ul>
			</div>
			
			<div class="message-list-toNewBtn panel2"><span class="link bgLight">Новых: <span class="message-list-unreadMsgsCount"></span></span></div>
		</div>

		<div class="message-input-wrp">
			{{
				var showTextArea = wofh.account.canMessage() && it.thread.author.id > 0 && it.thread.author.id != Account.hermit.id && it.thread.author.id != Account.admin.id && it.thread.author.id != Account.bot.id;
				
				if( showTextArea && it.thread.access )
					showTextArea = !!wofh.account.getPost();
			}}
			
			{{?showTextArea}}
				<textarea class="message-input-msg textarea1" name="text">{{=it.backupText||''}}</textarea>
			{{?}}
			
			{{?showTextArea}}
				<div class="message-write-sub">
					<button type="submit" class="button1 message-write-btn -disabled">Отправить</button>
					<div class="mes-chrleft">Осталось  <span></span>  символов.</div>
					{{?it.thread.block}}
						<div class="-warn">Собеседник не может ответить, так как у него ограничены функции переписки.</div>
					{{?}}	
				</div>
			{{??!wofh.account.canMessage()}}
				<div class="-warn">
					{{=snip.alertTmpl.blocked.message()}}
				</div>
			{{?}}
		</div>
	</form>
</script>

<script type="text/plain" id="message.view.list">
	{{~it.list: mess: index}}
		<li class="message-message {{?wofh.account.id == mess.account.id}}self{{??}}stranger{{?}} {{?!mess.noMark}}-type-marked{{?}} {{?mess.isFirstUnread}}-type-firstUnread{{?}}" data-time="{{=mess.time}}" {{?mess.loadNext}}style="position: relative;"{{?}}>
			<div class="info">
				<div class="name">
					{{=snip.accLink(mess.account)}}
				</div>
				<div class="time">{{=timeMgr.fMoment(mess.time)}}</div>
			</div>
			<div class="text">{{=TextParser.prepare(mess.text, {showSmiles: true})}}</div>
		</li>
	{{~}}
</script><script type="text/plain" id="messages.header">
    {{=snip.wrp('js-messages-header', 'Переписка')}}
</script>

<script type="text/plain" id="messages.main">
    <div class="view-messages">
		<div class="tabs tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="messages.write">
	{{?wofh.account.canMessage()}}
		<form class="messages-write-form">
			<div class="messages-write-info">
				<div class="messages-write-block">
					<span class="messages-write-field">Кому:</span>
					{{?it.account}}
						{{=snip.accIcon(it.account)}}
					{{?}}
					<input class="messages-write-to js-add-icon" name="to" value="{{?it.account}}{{=it.account.getName()}}{{??}}{{=ls.getNewMessageBackup(LS.newMessageBackup).to}}{{?}}">
					{{?wofh.contacts.getLength()}}<a class="icon-contacts-popup"></a>{{?}}
					<span class="messages-write-mass-wrp"></span>
				</div>

				<div class="messages-write-block">
					<span class="messages-write-field">Тема:</span>
					<input name="topic" maxlength="{{=lib.message.topicmaxlen}}" value="{{=ls.getNewMessageBackup(LS.newMessageBackup).topic}}">
				</div>
			</div>
			
			<textarea class="messages-write-text" name="text">{{=it.text}}</textarea>
			
			<div class="messages-write-block messages-write-footer">
				<button class="button1 messages-write-btn" type="submit">Отправить</button>
				<div class="messages-write-chrCount">Осталось  <span></span>  символов.</div>
			</div>
		</form>
	{{??}}
		<div class="messages-write-form aC">{{=snip.alertTmpl.blocked.message()}}</div>
	{{?}}
</script>

<script type="text/plain" id="messages.write.mass">
	{{?wofh.account.getPost()}}
		<label>
			{{=snip.checkbox1({cls: 'messages-write-mass', name: 'mass'})}} всей стране
		</label>
		
		<label class="messages-write-noDiscuss-wrp"></label>
	{{?}}
</script>

<script type="text/plain" id="messages.write.mass.noDiscuss">
	{{?it.show}}
		{{=snip.checkbox1({cls: 'messages-write-noDiscuss', name: 'access', value: Country.getPostsBinFilter()})}}
		
		{{=snip.nobr(snip.crown() + ' ' + snip.tooltip('без обсуждения', 'В этой теме могут писать только должностные лица страны и их помощники'))}}
	{{?}}
</script>

<script type="text/plain" id="messages.list">
	<div class="js-messages-list-block {{?!it.messages}}-hidden{{?}}">
		<div class="list-page-nav-wrp">
			<a class="page-nav-prev"></a>
			<a class="page-nav-next"></a>
			<form class="js-messages-list-form">
				<table class="s-tbl s-tbl-messages -type-list">
					{{=tmplMgr.messages.list.data(it)}}
				</table>
			</form>
		</div>
		
		<div class="wnd-footer">
			<div class="messages-selectAll">
				<label>{{=snip.checkbox1({cls: 'js-messages-selectAll'})}} Отметить все</label>
			</div>
			
			<button class="button1 js-messages-delSelected">Удалить выбранные</button>
			<button class="button1 js-messages-readAll">Пометить все как «прочитанные»</button>
			<button class="button1 -type-red js-messages-delAll" data-title="Удалить все сообщения">Удалить все</button>
		</div>
	</div>
	<div class="js-messages-empty-block {{?it.messages}}-hidden{{?}}">
		<div class="pt20">И нет печальней дня для благородного правителя,<br>чем тот когда друзья и враги,<br>вассалы и слуги, забыли о нем.<br>И пусто, и одиноко.<br>И нет писем.</div>
	</div>
</script>

<script type="text/plain" id="messages.list.data">
	<thead>
		<tr>
			<td class="messages-list-checker"></td>
			<td class="messages-list-reply"></td>
			<td>Тема</td>
			<td></td>
			<td>Собеседник</td>
			<td class="-col-date">Дата</td>
		</tr>
	</thead>
	<tbody>
		{{@it.messages: thread}}
			<tr>
				<td class="messages-list-checker">
					{{=snip.checkbox1({name: thread.id})}}
				</td>
				<td class="messages-list-reply">
					{{?thread.reply}}
						<div class="messages-reply"></div>
					{{?}}
				</td>
				<td class="messages-list-topic" {{?!thread.deleted}}colspan="2"{{?}}>
					<a href="{{=hashMgr.getWndHref('message', thread.id)}}" class="messages-topic {{?!thread.isread}}messages-notRead{{?}} -lenHint">
						{{=TextParser.noLinks(TextParser.prepare(thread.topicLink))}}
					</a>
				</td>
				{{?thread.deleted}}
					<td>
						<a href="{{=hashMgr.getWndHref('message', thread.id)}}"> (удалено)</a>
					</td>
				{{?}}
				<td>
					{{?thread.player instanceof Country}}
						{{=snip.countryLink(thread.player, {text: false, flag: 'normal'})}}
						{{?thread.access}}
							 
							{{=snip.crown()}}
						{{?}}
					{{??}}
						{{=snip.accLink(thread.player)}}
					{{?}}
				</td>
				<td class="-col-date">
					<a href="{{=hashMgr.getWndHref('message', thread.id)}}">
						{{=timeMgr.fMoment(thread.time)}}
					</a>
				</td>
			</tr>
		{{@}}
	</tbody>
</script>




<script type="text/plain" id="messages.note">
	<form class="messages-note-form">
		<textarea class="messages-note-text" name="text">{{=it.text}}</textarea>
		
		<div class="messages-write-block messages-write-footer">
			<button class="button1 messages-note-btn" type="submit">Отправить</button>
			<div class="messages-note-chrCount">Осталось  <span></span>  символов.</div>
		</div>
	</form>
</script>





<script type="text/plain" id="messages.contacts">
	<div class="messages-contacts-block"></div>
</script><script type="text/plain" id="money.header">
	Баланс
</script>

<script type="text/plain" id="money">
    <div class="view-money">
		<div class="money-balance-wrp"></div>
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-80, 0), 100)}}px;">
			<div class="money-towns-wrp"></div>
			
			{{=tmplMgr.money.bank(it)}}

			<div class="money-moves-wrp">
				{{?wofh.account.isAdmin() || wofh.account.isPremium()}}
					<br>
					<a class="money_moves_link crP tdUL link bgLight">История операций</a>
				{{?}}
			</div>
		</div>
	</div>
</script>



<script type="text/plain" id="money.balance">
    <div>
		<table class="tbl-money-balance">
			<tr>
				<td>Казна</td>
				<td></td>
				<td class="td-balance-reserve">Резерв</td>
				<td></td>
				<td>Доступно</td>
				<td></td>
			</tr>
			<tr>
				<td><span class="balance-treasury-wrp"></span></td>
				<td class="td-balance-sep">-</td>
				<td class="td-balance-reserve"><div class="balance-reserve-wrp"></div></td>
				<td class="td-balance-sep">=</td>
				<td>
					<span class="balance-sum-wrp"></span>
					&nbsp;
					{{=snip.nobr('('+snip.coloredNum(it.money.inc, {sign:true, int: true, stages:true})+')')}}
					{{?it.money.inc < 0 && !(it.townTotals.debt && it.money.sum < wMoney.debtLimit)}}
						{{var timer = snip.timer(timeMgr.getNow() + it.timeLeft, 'dec');}}
						 хватит на 
						<span class="{{?it.timeLeft < timeMgr.DtS}}cl-red{{?}}">{{=timer}}</span>
						
					{{?}}
				</td>
			</tr>
			<tr>
				<td colspan="5">
					<span class="balance-duty-wrp"></span>
				</td>
			</tr>
		</table>
	</div>
</script>

<script type="text/plain" id="money.balance.reserve">
	<form class="js-moneyReserve">
		{{=snip.res(Resource.ids.money)}}
		{{=snip.input1({cls: 'balance-reserve-input spinbox', name: 'savemoney', value: wofh.account.money.reserve||0})}}
		<button class="button2 -type-accept balance-reserve-changeReserve -hidden" type="submit"></button>
	</form>
</script>

<script type="text/plain" id="money.balance.treasury">
    <span>
		{{=snip.res(Resource.ids.money)}}<b>{{=utils.formatNum(wofh.account.money.sum, {int:true, stages:true})}}</b>
	</span>
</script>

<script type="text/plain" id="money.balance.sum">
    <span>
		{{=snip.res(Resource.ids.money)}}<b>{{=snip.coloredNum(wofh.account.money.sum - (wofh.account.money.reserve||0), {int:true, stages:true})}}</b>
	</span>
</script>

<script type="text/plain" id="money.balance.duty">
    <span>
		Долг перед {{=snip.countryLink(wofh.country)}}:  {{=snip.res(Resource.ids.money)}} {{=utils.formatNum(wofh.account.money.duty, {int:true, stages:true})}}
	</span>
</script>



<script type="text/plain" id="money.towns">
	<table class="s-tbl s-tbl-money-towns">
		<colgroup>
			<col class="money-towns-col1">
		</colgroup>
		
		<thead>
			<tr>
				<td class="aL"></td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'inc')}}</td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'cons')}}</td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'stream')}}</td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'tax')}}</td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'budget')}}</td>
				<td>{{=snip.icon(snip.c.moneyIcon, 'sum')}}</td>
			</tr>
		</thead>
		<tbody>
			{{@it.towns: town}}
				<tr>
					<td class="aL">{{=snip.townLink(town)}}</td>
					<td>
						<span data-title="{{=tmplMgr.money.townIncInfo({town:town})}}">
							{{=snip.coloredNum(town.inc, {int:true, stages:true})}}
						</span>
					</td>
					<td>
						<span data-title="{{=tmplMgr.money.townDecInfo({town:town})}}">
							{{=snip.coloredNum(town.dec, {int:true, stages:true})}}
						</span>
					</td>
					<td>
						<span class="money-towns-short-info">{{=snip.coloredNum(town.stream, {int:true, stages:true})}}</span>
						<span class="money-towns-full-info">{{=tmplMgr.money.townStreamInfo(town)}}</span>
					</td>
					<td>
						<span {{?town.taxes.sum}}data-title='{{=tmplMgr.money.townTaxInfo(town)}}'{{?}}>
							{{=snip.coloredNum(town.taxes.sum, {int:true, stages:true})}}
						</span>
					</td>
					<td>
						<span {{?town.budget}}data-title='{{=tmplMgr.money.townBudgetInfo(town)}}'{{?}}>
							{{=snip.coloredNum(town.budgetSum, {int:true, stages:true})}}
						</span>
					</td>
					<td>
						<span data-title="{{=utils.formatNum(town.profit, {mixed:true, uFixed:2})}}">
							{{=snip.coloredNum(town.profit, {int:true, stages:true})}}
						</span>
					</td>
				</tr>
			{{@}}
			{{?wofh.country}}
				{{?it.money.credites.inc}}
					<tr>
						<td class="aL"><a href="{{=hashMgr.getWndHref('country')}}" class="link">Выплаты по кредитам</a></td>
						<td colspan="5"></td>
						<td class="cl-red">
							<span data-title="{{=utils.formatNum(-it.money.credites.inc, {mixed:true, uFixed:2})}}">
								{{=utils.formatNum(-it.money.credites.inc, {stages:true, int:true})}}
							</span>
						</td>
					</tr>
				{{?}}
				{{?it.money.deposites.inc}}
					<tr>
						<td class="aL"><a href="{{=hashMgr.getWndHref('country')}}" class="link">Выплаты по вкладам</a></td>
						<td colspan="5"></td>
						<td class="cl-green">
							<span data-title="{{=utils.formatNum(it.money.deposites.inc, {mixed:true, uFixed:2})}}">
								{{=utils.formatNum(it.money.deposites.inc, {stages:true, int:true})}}
							</span>
						</td>
					</tr>
				{{?}}
				{{?it.money.budget.subsidy}}
					<tr>
						<td class="aL"><a href="{{=hashMgr.getWndHref('country')}}" class="link">Дотации</a></td>
						<td colspan="5"></td>
						<td class="cl-green">{{=utils.formatNum(it.money.budget.subsidy, {stages:true})}}</td>
					</tr>
				{{?}}
			{{?}}
			{{?it.townTotals.debt && it.money.sum < wMoney.debtLimit }}
				<tr>
					<td class="aL"><a href="{{=hashMgr.getWndHref('country')}}" class="link">Налоговая задолженность</a></td>
					<td colspan="5"></td>
					<td class="cl-dark-yellow">
						<span data-title="{{=utils.formatNum(it.townTotals.debt, {mixed:true, uFixed:2})}}">{{=utils.formatNum(it.townTotals.debt, {stages:true})}}</span>
					</td>
				</tr>
			{{?}}
			<tr class="money-towns-totals">
				<td class="aL">Итого</td>
				<td>
					<span data-title="{{=utils.formatNum(it.townTotals.inc, {mixed:true, uFixed:2})}}">
						{{=snip.coloredNum(it.townTotals.inc, {int:true, stages:true})}}
					</span>
				</td>
				<td>
					<span data-title="{{=utils.formatNum(it.townTotals.dec, {mixed:true, uFixed:2})}}">
						{{=snip.coloredNum(it.townTotals.dec, {int:true, stages:true})}}
					</span>
				</td>
				<td>
					<span class="money-towns-short-info">{{=snip.coloredNum(it.townTotals.stream, {int:true, stages:true})}}</span>
					<span class="money-towns-full-info">{{=tmplMgr.money.townStreamInfo(it.townTotals)}}</span>
				</td>
				<td>
					<span {{?it.townTotals.taxes.sum}}data-title='{{=tmplMgr.money.townTaxInfo(it.townTotals)}}'{{?}}>
						{{=snip.coloredNum(it.townTotals.taxes.sum, {int:true, stages:true})}}
					</span>
				</td>
				<td>
					<span {{?it.townTotals.budget}}data-title='{{=tmplMgr.money.townBudgetInfo(it.townTotals)}}'{{?}}>
						{{=snip.coloredNum(it.townTotals.budgetSum, {int:true, stages:true})}}
					</span>
				</td>
				<td>
					<span data-title="{{=utils.formatNum(it.money.inc, {mixed:true, uFixed:2})}}">
						{{=snip.coloredNum(it.money.inc, {int:true, stages:true})}}
					</span>
				</td>
			</tr>
		</tbody>
		<tfoot><tr><td colspan="7"></td></tr></tfoot>
	</table>
</script>

<script type="text/plain" id="money.townTaxInfo">
	Подушный налог {{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.taxes.pop, {mixed: true, fixed: 2})}}
	<br>
	Производственный налог {{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.taxes.prod, {mixed: true, fixed: 2})}}
	<br>
	Налог со снабжения {{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.taxes.streamSum, {mixed: true, fixed: 2})}}
	<br>
	Налог на месторождения {{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.taxes.deposit, {mixed: true, fixed: 2})}}
</script>

<script type="text/plain" id="money.townStreamInfo">
	<span data-title="{{=utils.formatNum(it.streamdec, {mixed:true, uFixed:2})}}">
		{{=snip.coloredNum(it.streamdec, {int:true, stages:true, sign:true, negative:true, noZeroColor:true})}}
	</span>
	<span data-title="{{=utils.formatNum(it.streaminc, {mixed:true, uFixed:2})}}">
		{{=snip.coloredNum(it.streaminc, {int:true, stages:true, sign:true, positive:true, noZeroColor:true})}}
	</span>
</script>

<script type="text/plain" id="money.townBudgetInfo">
	{{
		it.budget.army = it.budget.army||{};
		
		it.budget.buildings = it.budget.buildings||{};
	}}
	
	{{?it.budget.production}}
		Производственные дотации: {{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.budget.production, {mixed: true, fixed: 2})}}<br>
	{{?}}
	{{?it.budget.knowledgetakes}}
		<span class="nobr">За вложенные {{=snip.resBig(Resource.ids.science)}}знания:{{=snip.resCount(Resource.ids.money, it.budget.knowledgetakes, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.army.death}}
		<span class="nobr">За мертвые войска:{{=snip.resCount(Resource.ids.money, it.budget.army.death, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.army.live}}
		<span class="nobr">За живые войска:{{=snip.resCount(Resource.ids.money, it.budget.army.live, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.buildings.diplomacy}}
		<span class="nobr">За {{=snip.icon(snip.c.anyIcon, 'diplomacyPoints')}}очки дипломатии:{{=snip.resCount(Resource.ids.money, it.budget.buildings.diplomacy, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.buildings.strategy}}
		<span class="nobr">За денежное содержание стратегических строений:{{=snip.resCount(Resource.ids.money, it.budget.buildings.strategy, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.buildings.war}}
		<span class="nobr">За денежное содержание военных строений:{{=snip.resCount(Resource.ids.money, it.budget.buildings.war, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.buildings.science}}
		<span class="nobr">За денежное содержание научных строений:{{=snip.resCount(Resource.ids.money, it.budget.buildings.science, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
	{{?it.budget.buildings.defence}}
		<span class="nobr">За денежное содержание фортификационных строений:{{=snip.resCount(Resource.ids.money, it.budget.buildings.defence, {filter: 'formatNum', mixed: true, fixed: 2})}}</span><br>
	{{?}}
</script>

<script type="text/plain" id="money.townIncInfo">
	Строения:  {{=utils.formatNum(it.town.inc - it.town.lasvegasinc, {mixed:true, fixed:2})}}
	{{?it.town.lasvegasinc}}
		<br>
		Лас-Вегас:  {{=utils.formatNum(it.town.lasvegasinc, {mixed:true, fixed:2})}}
	{{?}}
</script>

<script type="text/plain" id="money.townDecInfo">
	Строения:  {{=utils.formatNum(it.town.dec - it.town.lasvegasdec, {mixed:true, fixed:2})}}
	{{?it.town.lasvegasdec}}
		<br>
		Лас-Вегас:  {{=utils.formatNum(it.town.lasvegasdec, {mixed:true, fixed:2})}}
	{{?}}
</script>



<script type="text/plain" id="money.bank">
	<table class="s-tbl s-tbl-money-bank -type-test" cellpadding="0" cellspacing="0">
		<tbody>
			<tr class="s-tr">
				<td class="s-td">
					<div class="money-credites-wrp"></div>
				</td>
				<td class="s-td">
					<div class="money-deposites-wrp"></div>
				</td>
			</tr>
		</tbody>
	</table>
</script>

<script type="text/plain" id="money.deposites">
	<table class="s-tbl s-tbl-money-deposit">
		<thead>
			<tr>
				<td colspan="4">Вклад</td>
			</tr>
			<tr class="-s-tbl-tr-bgLight">
				<td>Доступно</td>
				<td>Вклад</td>
				<td>Выплата в день</td>
				<td>Снять</td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td class="cl-grey">
					{{=snip.resCount(Resource.ids.money, it.deposit.maxSum)}}
				</td>
				<td>
					{{=snip.resCount(Resource.ids.money, utils.toInt(it.deposit.sum))}}
					<br>
					под <b>{{=utils.toFixed(it.deposit.rate * 0.1, 1)}}</b>%
				</td>
				<td class="fwB">
					{{=snip.resCount(Resource.ids.money, utils.formatNum(it.money.deposites.inc * timeMgr.DtH, {fixed:1}))}}
				</td>
				<td>
					{{?it.deposit.sum}}
						<div class="money-deposit-get">
							{{=snip.res(Resource.ids.money)}}{{=snip.input1({value: utils.toInt(it.deposit.sum), cls: 'js-moneyInput js-inpGetDeposit'})}}
							<div class="money-deposit-getBtns">
								<button class="button2-small -type-accept js-getDeposit"></button>&nbsp;
								<button class="button2-small -type-cancel js-resetGetDeposit"></button>
							</div>
						</div>
					{{?}}
				</td>
			</tr>
			<tr>
				<td colspan="4">
					<button class="button1 {{?it.deposit.maxSum}}js-putDeposit{{??}}-disabled{{?}}">Вложить</button>
				</td>
			</tr>
		</tbody>
	</table>
</script>

<script type="text/plain" id="money.putDeposit">
	<form>
		<div><b>Сделать вклад:</b></div>
		<br>
		{{=snip.res(Resource.ids.money)}}{{=snip.input1({name: 'sum', cls: 'js-depositSum', value: it.deposit.maxSum})}}
		<br><br>
		 под <b><span>{{=utils.toFixed(it.deposit.rate * 0.1, 1)}}</span>%</b>
		<br><br>
		ежедневная выплата <span class="money_depositPut_pay"></span>
		<br><br>
	</form>
</script>
	
<script type="text/plain" id="money.putDeposit.pay">
	<b data-title="{{=utils.escapeHtml(snip.resCount(Resource.ids.money, utils.toFixed(it.pay/24, 1)))}}  в час">
		{{=snip.resCount(Resource.ids.money, utils.toFixed(it.pay, 1))}}
	</b>
</script>
	
<script type="text/plain" id="money.credites">
	<table class="s-tbl s-tbl-money-credit">
		<thead>
			<tr>
				<td colspan="4">Открытые кредиты</td>
			</tr>
			<tr class="-s-tbl-tr-bgLight">
				<td>Доступно</td>
				<td>Кредит</td>
				<td>Выплата в день</td>
				<td>Погасить</td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td class="cl-grey">
					{{=snip.resCount(Resource.ids.money, it.credit.maxSum)}}
				</td>
				<td>
					{{=snip.resCount(Resource.ids.money, utils.toInt(it.credit.sum))}}
					<br>
					под <b>{{=utils.toFixed(it.credit.rate * 0.1, 1)}}</b>%
				</td>
				<td class="fwB">
					{{=snip.resCount(Resource.ids.money, utils.formatNum(it.money.credites.inc * timeMgr.DtH, {fixed:1}))}}
				</td>
				<td>
					<div class="money-credit-pay">
						{{?it.credit.sum}}
							{{=snip.res(Resource.ids.money)}}{{=snip.input1({name: 'sum', value: Math.max(0, utils.toInt(Math.min(it.credit.sum, it.money.sum  - wofh.account.money.reserve))), cls: 'js-moneyInput js-inpPayCredit'})}}
							<div class="money-credit-payBtns">
								<button class="button2-small -type-accept js-payCredit"></button>&nbsp;
								<button class="button2-small -type-cancel js-resetPayCredit"></button>
							</div>
						{{?}}
					</div>
				</td>
			</tr>
			<tr>
				<td colspan="4">
					<button class="button1 {{?it.credit.maxSum}}js-getCredit{{??}}-disabled{{?}}">Взять кредит</button>
				</td>
			</tr>
		</tbody>
	</table>
	
</script>

<script type="text/plain" id="money.getCredit">
	<form>
		<div><b>Страна предоставляет кредит:</b></div>
		<br>
		{{=snip.res(Resource.ids.money)}}{{=snip.input1({name: 'sum', cls: 'js-creditSum', value: it.credit.maxSum})}}
		<br><br>
		 под <b><span>{{=utils.toFixed(it.credit.rate * 0.1, 1)}}</span>%</b>
		<br><br>
		ежедневная переплата <span class="money_creditGet_overpay"></span>
		<br><br>
	</form>
</script>

<script type="text/plain" id="money.getCredit.overpay">
	<b data-title="{{=utils.escapeHtml(snip.resCount(Resource.ids.money, utils.toFixed(it.overpay/24, 1)))}}  в час">
		{{=snip.resCount(Resource.ids.money, utils.toFixed(it.overpay, 1))}}
	</b>
</script>

<script type="text/plain" id="money.trans">
	<div class="view-moneyMoves js-moneyMoves js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100)}}px;">
		<table class="def_table" style="width: 100%">
			<thead>
				<tr>
					<td>Время</td>
					<td>Город</td>
					<td>{{=snip.res(Resource.ids.money)}}Сумма</td>
					<td>Тип операции</td>
				</tr>
			</thead>
			<tbody></tbody>
			<tfoot>
				<tr>
					<td colspan="4"><a class="money_moves_add crP" style="color: white">Загрузить ещё!</a></td>
				</tr>
			</tfoot>
		</table>
	</div>
</script>

<script type="text/plain" id="money.transData">
	{{~it: item: pos}}
		<tr class="row{{=pos%2}}">
			<td>{{=timeMgr.fMoment(item.time)}}</td>
			<td class="aL">
                {{?item.town}}
                    {{=snip.townLink(item.town)}}
                {{?}}
                {{?item.account}}
                    {{=snip.accLink(item.account)}}
                {{?}}
                    
            </td>
			<td class="aR">
				<span class="cl-{{?item.sum > 0}}green{{??}}red{{?}}">
					{{?item.sum > 0 && item.type != 11}}+{{?}}{{=utils.stages(utils.toFixed(item.sum, 1))}}
				</span>
			</td>
			<td>
				{{=wMoney.moneyMoveText[item.type]||'Не известно'}}
			</td>
		</tr>
	{{~}}
</script><script type="text/plain" id="options.header">
	{{=snip.acc(wofh.account)}}. Настройки 
</script>

<script type="text/plain" id="options">
	<div class="view-options">
		<div class="tabs tabs-wrp"></div>
		<div class="tabs-cont"></div>	
	</div>
</script>

<script type="text/plain" id="options.general">
	<div class="options-cell-wrp">
		<div class="options-cell">Язык:</div>
		<div class="options-cell">
			<select class="select1 options-input options-lang">
				<option value="en" {{?wofh.account.language == 'en'}}selected{{?}}>English</option>
				<option value="ru" {{?wofh.account.language == 'ru'}}selected{{?}}>Русский</option>
				<option value="de" {{?wofh.account.language == 'de'}}selected{{?}}>Deutsch</option>
			</select>
			<span class="dIB options-lang-loader" style="width: 10px; height: 18px;"><span>
		</div>
	</div>

	{{var gameIf = ls.getGameIf(Appl.interface.standart);}}
	{{?wofh.platform.hasmobileinterfaces || !wofh.platform.nooldinterfaces || debug.isTest('system')}}
		<div class="options-cell-wrp">
			<div class="options-cell">Интерфейс:</div>
			<div class="options-cell">
				<select class="select1 options-input options-iface">
					{{?debug.isTest('later')}}
						<option value="{{=Appl.interface.standart}}">
							Автоматический
						</option>
					{{?}}
					<option value="{{=Appl.interface.standart}}" {{?gameIf == Appl.interface.standart}}selected{{?}}>
						Полный
					</option>
					{{?!wofh.platform.nooldinterfaces}}
						<option value="{{=Appl.interface.simplified}}" {{?gameIf == Appl.interface.simplified}}selected{{?}}>
							Упрощенный
						</option>
					{{?}}
					{{?wofh.platform.hasmobileinterfaces && utils.isTouchDevice()}}
						<option value="{{=Appl.interface.mobile}}" {{?gameIf == Appl.interface.mobile}}selected{{?}}>
							Мобильный Beta 2.0
						</option>
					{{?}}
				</select>
			</div>
		</div>
	{{?}}

	{{?gameIf != Appl.interface.simplified}}
		<div class="options-cell-wrp">
			<div class="options-cell">Масштаб города:</div>
			<div class="options-cell">
				{{var zoomLock = ls.getTownZoomLock(0);}}
				{{var zoom = ls.getTownZoom(1);}}
				<select class="select1 options-input options-zoomLock">
					<option value="auto" {{?!zoomLock}}selected{{?}}>Автоматический</option>
					<option value="1" {{?zoomLock && zoom == 1}}selected{{?}}>100%</option>
					<option value="0.9" {{?zoomLock && zoom == 0.9}}selected{{?}}>90%</option>
					<option value="0.8" {{?zoomLock && zoom == 0.8}}selected{{?}}>80%</option>
					<option value="0.7" {{?zoomLock && zoom == 0.7}}selected{{?}}>70%</option>
					<option value="0.6" {{?zoomLock && zoom == 0.6}}selected{{?}}>60%</option>
				</select>
			</div>
		</div>
	{{?}}
	
	{{?gameIf != Appl.interface.mobile}}
		<label class="options-cell-wrp -type-switcher">
			<div class="options-cell">Запоминать положение окон:</div>
			<div class="options-cell">
				{{=snip.checkbox1({cls: 'options-useWndPos', checked: ls.getWndPos()})}}
			</div>
		</label>
	{{?}}
	
	{{?gameIf == Appl.interface.standart || gameIf == Appl.interface.mobile}}
		<label class="options-cell-wrp -type-switcher">
			<div class="options-cell">Жители:</div>
			<div class="options-cell">
				{{=snip.checkbox1({cls: 'options-moversAnim', checked: ls.getMoversAnim(true)})}}
			</div>
		</label>
	{{?}}

	<label class="options-cell-wrp -type-switcher">
		<div class="options-cell">{{=snip.title('Сохранять данные о дорогах на карте:', 'Для ускорения прорисовки', '-type-underline')}}</div>
		<div class="options-cell">
			{{=snip.checkbox1({cls: 'options-roadsCache', checked: ls.getRoadsCache(true)})}}
		</div>
	</label>

	<label class="options-cell-wrp -type-switcher">
		<div class="options-cell">Сглаживание:</div>
		<div class="options-cell">
			{{=snip.checkbox1({cls: 'options-antialiasing', checked: ls.getAntialiasing(LS.def.Antialiasing)})}}
		</div>
	</label>

	{{=tmplMgr.options.general.mobile(it)}}
</script>

<script type="text/plain" id="options.general.mobile"></script>

<script type="text/plain" id="options.proxy">
	<div class="options-cell-wrp">
		<div class="options-cell">Твой заместитель: </div>
		<div class="options-cell">
			{{? it.assistant.account }}
				<span>
					{{=snip.accLink(it.assistant.account)}}
					&nbsp;
					<button id="clearassist" class="button2 -type-delete" style="vertical-align: -8px;" title="Убрать"></button>
				</span>
			{{??}}
				<input class="input options-input" type='text' name='assistant' value="" maxlenght="{{= lib.account.namelimit[1] }}">
			{{?}}
			{{=snip.hint('Заместительство включается минимум на ' + timeMgr.fPeriod(lib.account.assistmin) + ', но если доступно меньше, то можно использовать остаток.')}}&nbsp;
			<span class="button2-small -type-accept -hidden js-setAssist"></span>
		</div>
	</div>
	
	<div class="options-cell-wrp">
		<div class="options-cell">Время замещения:</div>
		<div class="options-cell">
			{{var days = it.assistant.days||0;}}

			{{?days}}
				{{=timeMgr.fPeriod(days * timeMgr.DtS, {format: Timer.format.full, noZero: true, noSeconds: true})}}
			{{??}}
				{{=days}}  дн.
			{{?}}

			{{?it.assistant.minDaysLeft}}
				 + {{=timeMgr.fPeriod(it.assistant.minDaysLeft * timeMgr.DtS, {format: Timer.format.full, noZero: true, noSeconds: true})}} {{=snip.hint('Время, которое будет безвозвратно потеряно в случае отключения заместительства')}}
			{{?}}

			&nbsp;

			{{? it.period > 0 }}
				Получить заместительство можно будет через {{= timeMgr.fPeriod(it.period) }}
			{{??}}
				{{? !it.assistprice }}
					<a class="link" id="option-replAcc">Получить еще {{= it.assistadddays }} дн.</a>
				{{?? it.assistprice <= it.coins }}
					<a class="link" id="option-replAcc">Получить еще {{= it.assistadddays }} дн.</a>
					 за 
					<span class="nobr">{{=snip.luck()}}{{= it.assistprice }}</span> {{=snip.hint('Только за купленные Монеты Удачи')}}
				{{??}}
					<a href="{{=HashMgr.getHref('#/bonus')}}" class="link">Чтобы получить {{= it.assistadddays }} дн. требуется</a>
					 
					<span class="nobr">{{=snip.luck()}}{{= it.assistprice }}</span> {{=snip.hint('Только за купленные Монеты Удачи')}}
				{{?}}
			{{?}}
		</div>
	</div>
	
	<div class="options-cell-wrp">
		{{?!wofh.account.isAssistant()}}
			/*кого замещаешь*/
			{{? utils.sizeOf(it.assistfor) }}
				<div class="options-cell">Ты замещаешь: </div>
				<div class="options-cell">
					{{@it.assistfor: account }}
						{{=snip.accLink(account)}}
						{{? !it.isassist }}
							 (<a class="link js-enterAsPlayer" data-id="{{=account.id}}">войти</a>)
						{{?}}
						<br>
					{{@}}
				</td>
			{{??}}
				<div class="options-cell">Сейчас ты никого не замещаешь</div>
			{{?}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="options.rep">
	<div class="options-rep">
		<h3 class="mTN">Не создавать отчеты</h3>
		<div>
			<div><label>{{=snip.checkbox1({name: 'r0', checked: it.deleteReports.r0})}} Изучение науки</label></div>
			<div><label>{{=snip.checkbox1({name: 'r2', checked: it.deleteReports.r2})}} Смерть подкрепления</label></div>
			<div><label>{{=snip.checkbox1({name: 'r3', checked: it.deleteReports.r3})}} Операции с подкреплениями</label></div>
			<div><label>{{=snip.checkbox1({name: 'r8', checked: it.deleteReports.r8})}} Голод и небоевые утраты</label></div>
			<div><label>{{=snip.checkbox1({name: 'r4', checked: it.deleteReports.r4})}} Доставка ресурсов</label></div>
			<div><label>{{=snip.checkbox1({name: 'r5', checked: it.deleteReports.r5})}} Обмен ресурсами</label></div>
			<div><label>{{=snip.checkbox1({name: 'r9', checked: it.deleteReports.r9})}} Торговые отчеты</label></div>
			<div><label>{{=snip.checkbox1({name: 'r1', checked: it.deleteReports.r1})}} Военные отчеты со спамом</label></div>
			<div><label>{{=snip.checkbox1({name: 'r6', checked: it.deleteReports.r6})}} Потребление ресурсов</label></div>
		</div>
	</div>
</script>

<script type="text/plain" id="options.acc">
	<div>
		{{?!wofh.platform.noemail}}
			<div>
				<div class="options-cell">Электронная почта:</div>
				<div class="options-cell">
					{{? wofh.account.isAssistant() }}
						Скрыта
					{{??}}
						<input class="input options-input" type='text' name='email' value="{{= wofh.account.email }}">
					{{?}}
					{{=snip.hint('Адрес электронной почты необходимо указать для возможности восстановления забытого пароля')}} <div class="button2-small -type-accept -hidden js-chooseEmail"></div>
				</div>
			</div>
		{{?}}
		{{?!wofh.platform.nopassword}}
			<h3>Старый пароль:</h3>
			<div class="opt-changePass">
				<div>
					<div class="options-cell">Старый пароль:</div>
					<div class="options-cell"><input class="input options-input" type='password' name='oldpass'></div>
				</div>
				<div>
					<div class="options-cell">Новый пароль:</div>
					<div class="options-cell"><input class="input options-input" type='password' name='newpass'></div>
				</div>
				<div>
					<div class="options-cell">Еще раз новый пароль:</div>
					<div class="options-cell"><input class="input options-input" type='password' name='newpass2'></div>
				</div>
			</div>
			<div class="aL">
				<button type="button" class="button1 -type-green -disabled js-newPassword">Сохранить</button>
			</div>
		{{?}}
		{{?!wofh.account.isAssistant()}}
			<h3>Удаление аккаунта</h3>
			{{?!wofh.platform.nopassword}}
				<div>
					<div class="options-cell">Пароль:</div>
					<div class="options-cell"><input type="password" id="pass-del-acc" class="input options-input"></div>
				</div>
			{{?}}
			<div>
				<button id="btn-del-acc" class="button1 -type-red">Удалить</button>
			</div>
		{{?}}

		<div class="aL tB p1000">
			<b>Описание:</b>
			<br>
			<span class="input-blinkWrp -type-stretched">
				{{?Quest.isActive(Quest.ids.introduce)}}
					<span class="input-blink -anim-blink"></span>
				{{?}}
				<textarea {{?!wofh.account.canMessage()}}disabled="disabled"{{?}} name="text" class="input options-acc-text">
					{{= wofh.account.text }}
				</textarea>
			</span>
			<div>
				Осталось <span class="options-chrLeft"></span> символов.
				{{?!wofh.account.canMessage()}} {{=snip.alert(snip.alertTmpl.blocked.message())}}{{?}}
			</div>
			<div class="aR">
				<button type="button" class="button1 -type-green -hidden js-setAccText">Сохранить</button>
			</div>
		</div>
	</div>
</script>


<script type="text/plain" id="options.audio">
	<div class="options-audio">
		{{?debug.isTest('later')}}
			<div class="options-cell-wrp">
				<div class="options-cell">Общая громкость</div>
				<div class="options-cell">
					<div class="slider options-audio-slider js-options-audio-global-slider"></div>
				</div>
			</div>
		{{?}}
		{{?debug.isTest('later')}}
			<div class="options-cell-wrp">
				<div class="options-cell">Музыка</div>
				<div class="options-cell">
					<div class="slider options-audio-slider js-options-audio-music-slider"></div>
				</div>
			</div>
		{{?}}
		<div class="options-cell-wrp">
			<div class="options-cell">Эффекты</div>	
			<div class="options-cell">
				<div class="slider options-audio-slider js-options-audio-event-slider"></div>
			</div>
		</div>
		{{?debug.isTest('later')}}
			<div class="options-cell-wrp">
				<div class="options-cell">Окружение</div>
				<div class="options-cell">
					<div class="slider options-audio-slider js-options-audio-ambient-slider"></div>
				</div>
			</div>
		{{?}}
		{{?debug.isTest('later')}}
			<div class="options-cell-wrp">
				<div class="options-cell">Белый шум</div>
				<div class="options-cell">
					<div class="slider options-audio-slider js-options-audio-noise-slider"></div>
				</div>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="options.chat">
	<div class="options-chat">
		<table class="tbl-options-chat" cellpadding="0" cellspacing="0">
			<tbody>
				{{?wofh.account.isPremium()}}
					<tr>
						<td class="aR">
							{{=snip.checkbox1({id: 'options-chat-display', name: 'display', cls: 'js-options-chat-display', checked: ls.getChatDisplay(true)})}}
						</td>
						<td>
							<label for="options-chat-display">Отображать чат</lable>
						</td>
						<td></td>
					</tr>
				{{?}}
				<tr>
					<td class="aR">
						{{=snip.input1({name: 'fontSize', cls: 'options-chat-input spinbox js-options-chat-fontSize', value: it.styles.fontSize, autocomplete: 'off'})}}
					</td>
					<td>
						<div class="slider options-chat-slider js-options-chat-fontSize-slider"></div>
					</td>
					<td>
						Размер шрифта
					</td>
				</tr>
				<tr>
					<td></td>
					<td>
						<div class="options-chat-bgColor">
							{{@tabOptChat.bgColors: bgcolor}}
								<button class="options-chat-bgButton"  style="background-color: rgb({{=bgcolor}});" data-bgcolor="{{=bgcolor}}"></button>
							{{@}}
						</div>
					</td>
					<td>
						Цвет фона
					</td>
				</tr>
				<tr>
					<td class="aR">
						{{=snip.input1({name: 'opacity', cls: 'options-chat-input spinbox js-options-chat-opacity', value: it.styles.alpha, autocomplete: 'off'})}}
					</td>
					<td>
						<div class="slider options-chat-slider js-options-chat-opacity-slider"></div>
					</td>
					<td>
						Прозрачность
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</script><script type="text/plain" id="questinfo.header">
	{{=it.quest.getName()}}
</script>

<script type="text/plain" id="questinfo">
	<div class="view-questinfo" data-id="{{=it.quest.getId()}}">
		{{=tmplMgr.questinfo.giver(it)}}
		
		<div class="qinf-text-wrp js-scroll-wrp">
			<div class="qinf-text">{{=it.quest.getText()}}</div>
		</div>

		<div class="qinf-prize">
			<div class="qinf-prize-title wnd-panelLR -type-infoTtl">Награда</div>
			<div class="qinf-prize-data PANEL-panel -type-panel">
				{{=snip.wndPanel()}}

				<div class="qinf-prize-bld">
					{{?it.quest.hasBonusMapPost()}}
						<div class="quest-buildImgWrp">
							<div class="quest-clearFog" data-title="Развеять туман войны вокруг места с сообщением"></div> 
						</div> 
					{{?}}
					{{?it.quest.hasBonusMapBattle()}}
						<div class="quest-buildImgWrp">
							<div class="quest-clearFog" data-title="Развеять туман войны вокруг атакованного города (только, конечно, если этот город все еще существует в неспокойном и переменчивом мире)"></div> 
						</div> 
					{{?}}
					{{?it.quest.hasBonusMapClimates()}}
						<div class="quest-buildImgWrp">
							<div class="quest-clearFog" data-title="Возможность различать климатические зоны"></div> 
						</div> 
					{{?}}
					{{?it.quest.hasBonusMapRange()}}
						<div class="quest-buildImgWrp">
							<div class="quest-clearFog" data-title="Увеличение радиуса обзора"></div> 
						</div> 
					{{?}}

					{{?it.quest.getBonusBuild()}}
						{{var bld = it.quest.getBonusBuild().getAlternate();}}
						<div class="quest-buildImgWrp">
							{{=snip.buildLinkOpen(bld)}}
								<div class="quest-buildImg" {{=snip.buildImgPath(bld)}} data-title="{{=bld.getName()}}"></div>
							{{=snip.linkClose()}}
						</div> 
						<div class="quest-buildText">
							{{=bld.getName()}} <br/>
							<b>+{{=bld.getLevel()}}</b>
						</div>
					{{?}}
				</div>
				<div class="qinf-prize-res">
					{{?it.quest.getBonusPop()}}
						<div>{{=snip.pop(it.quest.getBonusPop())}}</div>
					{{?}}
					<div>
						/* Отображаем все ресы роста, как пищу до квеста на постройку дома собирателя */
						{{=snip.resList(it.quest.getBonusRes(!Quest.isAvail(Quest.ids.bldCollector1)))}}
					</div>
					<div>
						{{@it.quest.getBonusArmy().getList(): unit}}
							{{=snip.unitIcon(unit)}} {{=unit.getName()}} +{{=unit.getCount()}}&nbsp;
						{{@}}
					</div>
					{{?it.quest.getBonusLuck()}}
						<div>{{=snip.luck(it.quest.getBonusLuck())}}</div>
					{{?}}
				</div>
				<div class="qinf-prize-btnWrp">
					{{?it.quest.isReferal() && !it.quest.isStatusBonus()}}
						<div>
							<a class="button1 js-toggleDelay" style="width: 130px;" data-title="Скрой, если не хочешь его видеть в списке заданий">
								Скрыть
							</a>
						</div>
						<div>
							{{?it.quest.isStatusBonus()}}
								<a class="button1 -type-gold qinf-getPrize" style="width: 130px;">Забрать награду</a>
							{{??}}
								<a class="button1 -type-grey js-wnd-close -noHover" style="width: 130px; color: #ffde9c!important;" data-title="Выполни это задание и приходи за наградой">Выполняется</a>
							{{?}}
						</div>
					{{??}}
						{{?it.quest.isStatusBonus()}}
							<a class="button5 -blink qinf-getPrize">Забрать награду</a>
						{{??}}
							<a class="button5 -type-disabled js-wnd-close" data-title="Выполни это задание и приходи за наградой">Выполняется</a>
						{{?}}
					{{?}}
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/plain" id="questinfo.giver">
	<div class="qinf-giver-wrp">
		<div class="qinf-giver -type-{{=utils.cnstName(Quest.givers, it.quest.getGiver())}}"></div>
	</div>
</script>

<script type="text/plain" id="questinfo.confirm">
	<div>
		{{?it.res}}
			<div>Внимание. Текущей <span class="iconCapacity"></span>вместимости хранилища города не хватит, чтобы вместить всю награду за задание. Часть будет утеряна.</div>
		{{?}}
		{{?it.pop}}
			<div>Твой текущий уровень {{=snip.cult('культуры')}} города, а значит и предел для населения ниже того, который позволит вместить всех новых {{=snip.pop('жителей')}}.</div>
			<div>Ты можешь построить или улучшить культурные здания. А можешь смириться и наблюдать, как постепенно «лишние» {{=snip.pop('люди')}} будут покидать твой город.</div>
		{{?}}
		<div>Все равно забрать награду?</div>
	</div>
</script>
<script type="text/plain" id="rate.header">
	{{=snip.wrp('js-rate-title', 'Рейтинги')}}
</script>

<script type="text/plain" id="rate">
    <div class="view-rate">
		<div class="tabs tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>





<script type="text/plain" id="rate.town">
	<div class="rate-filterBar -type-town">
		{{?wndMgr.interfaces.town.friends}}
			<a class="rate-btn -type-friends" data-title="Рейтинг только среди твоих друзей"><span class="rate-btn-icon iconSocial -small -type-{{=wofh.platform.name}}"></span></a>
		{{?}}
		{{?wofh.account.isPremium() && wofh.country}}
			<a data-filter="conly" class="rate-btn -type-country -hidden" data-title="Рейтинг только среди членов твоей страны"><span class="rate-btn-icon"></span></a>
		{{?}}
	</div>
	
	<div class="town-list-wrp list-page-nav-wrp"></div>
	
	<div class="wnd-footer">
		<form class="js-rate-town-search">
			<div>
				<span class="rate-searchField">
					Место {{=snip.input1({cls: 'spinbox', name: 'pos', autocomplete: 'off'})}}
				</span>
			</div>
			
			<button class="button1" type="submit">Искать</button>
		</form>
	</div>
</script>

<script type="text/plain" id="rate.town.list">
	<a class="page-nav-prev"></a>
	<a class="page-nav-next"></a>
	<table class="s-tbl s-tbl-rate -type-towns">
		<colgroup>
			<col class="tbl-rate-col1">
			<col class="tbl-rate-col2">
			<col class="tbl-rate-col3">
			<col class="tbl-rate-col4">
			<col class="tbl-rate-col5">
		</colgroup>
		
		<thead>
			<tr class="-s-tbl-tr-bgLight">
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Место города в рейтинге', '№')}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Город', snip.townIcon())}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Игрок-хозяин города', snip.accIcon())}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Страна игрока', 'Страна')}}</div></th>
				<th>{{=snip.hintWrp('Население города', snip.pop())}}</th>
			</tr>
		</thead>
		<tbody>
			{{@it.towns: town}}
				<tr class="
					{{?town.twn && town.twn.id == wofh.town.id}}
						-type-own
					{{??!it.noColor}}
						{{?town.pos == it.search.pos}}
							-type-pos
						{{?}}
					{{?}}
				">
					<td class="aC"><div class="s-tbl-rate-colSep">{{=utils.formatNum(town.pos, {stages:true})}}</div></td>
					<td><div class="s-tbl-rate-colSep">{{=snip.townLink(town.twn)}}</div></td>
					<td><div class="s-tbl-rate-colSep">{{=snip.accLink(town.twn.account)}}</div></td>
					<td>
						<div class="s-tbl-rate-colSep">
						{{?town.twn.account.country && town.twn.account.country.id}}
							{{=snip.countryLink(town.twn.account.country)}}
						{{?}}
						</div>
					</td>
					<td>{{=utils.formatNum(town.pop, {stages:true})}}</td>
				</tr>
			{{@}}
		</tbody>
		<tfoot><tr><td colspan="5"></td></tr></tfoot>
	</table>
</script>





<script type="text/plain" id="rate.player">
	<div class="rate-alert-wrp -hidden"></div>
	
	<div class="rate-filterBar -type-player">
		<a data-type="0" class="rate-btn js-rate-type" data-title="Общий рейтинг"><span class="rate-btn-icon"></span><span class="rate-btn-text">Общий</span></a>
		<a data-type="4" class="rate-btn js-rate-type" data-title="Военный рейтинг - атака"><span class="rate-btn-icon"></span><span class="rate-btn-text">Атака</span></a>
		<a data-type="5" class="rate-btn js-rate-type" data-title="Военный рейтинг - защита"><span class="rate-btn-icon"></span><span class="rate-btn-text">Защита</span></a>
		<a data-type="2" class="rate-btn js-rate-type" data-title="Научный рейтинг"><span class="rate-btn-icon"></span><span class="rate-btn-text">Наука</span></a>
		<a data-type="3" class="rate-btn js-rate-type" data-title="Рейтинг производства"><span class="rate-btn-icon"></span><span class="rate-btn-text">Производство</span></a>
		{{?wofh.account.isPremium()}}
			<a class="rate-btn -type-hide -hidden" data-title="Скрыть меня в рейтинге"><span class="rate-btn-icon"></span></a>
		{{?}}
		{{?wndMgr.interfaces.town.friends}}
			<a class="rate-btn -type-friends -hidden" data-title="Рейтинг только среди твоих друзей"><span class="rate-btn-icon iconSocial -small -type-{{=wofh.platform.name}}"></span></a>
		{{?}}
		{{?wofh.account.isPremium() && wofh.country}}
			<a data-filter="conly" class="rate-btn -type-country -hidden" data-title="Рейтинг только среди членов твоей страны"><span class="rate-btn-icon"></span></a>
		{{?}}
		<a data-filter="cont" class="rate-btn -type-continent" data-title="Рейтинг только моего континента"><span class="rate-btn-icon"></span></a>
		
		<span class="rate-pointsEarnTimeout-wrp"></span>
	</div>
	
	<div class="player-list-wrp list-page-nav-wrp"></div>
	
	<div class="wnd-footer">
		<form class="js-rate-player-search">
			<div>
				<span class="rate-searchField">Имя {{=snip.input1({name: 'player', autocomplete: 'off'})}}</span>
				<span class="rate-searchField">Место {{=snip.input1({cls: 'spinbox', name: 'pos', autocomplete: 'off'})}}</span>
				{{?wofh.account.isAdmin()}}
					<span class="rate-searchField">IP / E-mail {{=snip.input1({name: 'addr', autocomplete: 'off'})}}</span>
				{{?}}
			</div>
			
			<button class="button1" type="submit">Искать</button>
		</form>
	</div>
</script>

<script type="text/plain" id="rate.player.list">
	<a class="page-nav-prev"></a>
	<a class="page-nav-next"></a>
	<table class="s-tbl s-tbl-rate -type-players">
		{{?it.player}}
			<colgroup>
				<col width="100%">
			</colgroup>
			<thead>
				<tr class="-s-tbl-tr-bgLight">
					<th>{{=snip.hintWrp('Игрок', snip.accIcon())}}</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>{{=snip.accLink(it.player.account, {isBarbarian: true})}}</td>
				</tr>
			</tbody>
			<tfoot><tr><td></td></tr></tfoot>
		{{??}}
			<colgroup {{?it.type == 0}}class="-type-commCols"{{?}}>
				<col class="tbl-rate-col1">
				<col class="tbl-rate-col2">
				<col class="tbl-rate-col3">
				<col class="tbl-rate-col4">
				<col class="tbl-rate-col5">
				<col class="tbl-rate-col6">
			</colgroup>
			
			<thead>
				<tr class="-s-tbl-tr-bgLight">
					<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Место игрока в рейтинге', '№')}}</div></th>
					<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Игрок', snip.accIcon())}}</div></th>
					<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Страна игрока', 'Страна')}}</div></th>
					<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Количество городов у игрока', snip.townIcon())}}</div></th>
					{{?it.type==0}}
						<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Общее население всех городов игрока', snip.pop())}}</div></th>
						<th>{{=snip.hintWrp('Среднее население на город игрока', snip.pop()+'/'+snip.townIcon())}}</th>
					{{??}}
						<th>
							<div class="s-tbl-rate-colSep">
								<a data-type="{{=it.type}}" class="js-rate-type">
									{{?it.type==2}}
										{{=snip.hintWrp('Знания', 'Знания')}}
									{{??it.type==3}}
										{{=snip.hintWrp('Произведено', 'Произведено')}}
									{{??it.type==4}}
										{{=snip.hintWrp('Очки, заработанные игроком за убийство вражеских войск', 'Очки атаки')}}
									{{??it.type==5}}
										{{=snip.hintWrp('Очки, заработанные игроком при защите от вражеских войск', 'Очки защиты')}}
									{{?}}
									{{=snip.sort('empty', 0, '-black')}}
								</a>
							</div>
						</th>
						<th>
							<a data-type="{{=it.type+tabRatePlayer.subtypeDec}}" class="js-rate-type" data-title="Сортировать">
								{{=snip.hintWrp('Очки рейтинга', snip.ratePointIcon(it.type))}}{{=snip.sort('empty', 0, '-black')}}
							</a>
						</th>
					{{?}}
				</tr>
			</thead>
			
			{{var isEarnTimeout = RatePoints.isEarnTimeout();}}
			
			<tbody>
				{{@it.players: player}}
					<tr class="
						{{?player.account && wofh.account.id == player.account.id}}
							-type-own
						{{??!it.noColor}}
							{{?it.search.name !== undefined && player.account && player.account.name.toLowerCase() == utils.escapeHtml(it.search.name.toLowerCase())}}
								-type-found
							{{?}}
							{{?it.search.name === undefined && player.pos == it.search.pos}}
								-type-pos
							{{?}}
						{{?}}
					">
						<td class="aC"><div class="s-tbl-rate-colSep">{{=utils.formatNum(player.pos, {stages:true})}}</div></td>
						<td>
							<div class="s-tbl-rate-colSep">
								{{?!player.account || (it.hideme == 2 && player.account.id == wofh.account.id && it.type != 0)}}
									{{=snip.wrp('-nobr -snip-acc', 'Скрытый игрок')}}
								{{??}}
									{{=snip.accLink(player.account, {isBarbarian: !player.towns})}}
								{{?}}
							</div>
						</td>
						<td>
							<div class="s-tbl-rate-colSep">
							{{?player.account && player.account.country && !(it.hideme == 2 && player.account.id == wofh.account.id && it.type != 0)}}
								{{=snip.countryLink(player.account.country)}}
							{{?}}
							</div>
						</td>
						<td><div class="s-tbl-rate-colSep">{{?player.towns && !(it.hideme == 2 && player.account.id == wofh.account.id && it.type != 0)}}{{=utils.formatNum(player.towns, {stages:true})}}{{?}}</div></td>
						{{?it.type == 0}}
							<td><div class="s-tbl-rate-colSep">{{=utils.formatNum(player.rate, {stages:true})}}</div></td>
							<td>{{?player.towns}}{{=utils.formatNum(player.rate/player.towns, {int:true, stages:true})}}{{?}}</td>
						{{??}}
							<td>
								<div class="s-tbl-rate-colSep">
									{{=utils.formatNum(player.rate, {int:true, stages:true})}}
								</div>
							</td>
						{{?}}
						{{?it.type != 0}}
							<td>
								<span class="-nobr">
									<span>
										{{=utils.formatNum(player.points, {int:true, stages:true})}}
									</span>
									{{?!(wofh.global.win || isEarnTimeout || it.filterC || it.isSubtype)}}
										{{
											var pointsPerDayOrigin = tabRatePlayer.pointsPlace - player.pos;
											var pointsPerDay = pointsPerDayOrigin * player.mult;
										}}
										{{?pointsPerDay > 0}}
											<span class="cl-grey -type-underline" data-title="Ежедневный бонус на данном месте {{=utils.formatNum(pointsPerDay, {mixed:true, fixed:3})}} = {{=utils.formatNum(pointsPerDayOrigin, {int:true, stages:true})}} * {{=utils.formatNum(player.mult, {toPercent:true, int:true})}}%">
												{{=utils.formatNum(pointsPerDay, {int:true, stages:true, sign:true})}}
											</span>
										{{?}}
									{{?}}
								</span>
							</td>
						{{?}}
					</tr>
				{{@}}
			</tbody>
			<tfoot><tr><td colspan="6"></td></tr></tfoot>
		{{?}}
	</table>
</script>

<script type="text/plain" id="rate.player.alert">
    {{?it.alrt==0}}
        <div class="rate-alert">Игрок {{=it.search.name}} не найден.</div>
    {{??}}
        <div class="rate-alert">Нет никого с IP/Email  {{=it.search.addr}} </div>
    {{?}}
</script>





<script type="text/plain" id="rate.country">
	<div class="rate-filterBar"></div>
	
	<div class="country-list-wrp list-page-nav-wrp"></div>
	
	<div class="wnd-footer">
		<form class="js-rate-country-search">
			<div>
				<span class="rate-searchField">Место {{=snip.input1({cls: 'spinbox', name: 'pos', autocomplete: 'off'})}}</span>
			</div>
			
			<button class="button1" type="submit">Искать</button>
		</form>
	</div>
</script>

<script type="text/plain" id="rate.country.list">
	<a class="page-nav-prev"></a>
	<a class="page-nav-next"></a>
	
	<table class="s-tbl s-tbl-rate -type-countries">
		<colgroup>
			<col class="tbl-rate-col1">
			<col class="tbl-rate-col2">
			<col class="tbl-rate-col3">
			<col class="tbl-rate-col4">
			<col class="tbl-rate-col5">
			<col class="tbl-rate-col6">
			<col class="tbl-rate-col7">
		</colgroup>
		
		<thead>
			<tr class="-s-tbl-tr-bgLight">
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Место страны в рейтинге', '№')}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Страна', 'Страна')}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Количество игроков в стране', snip.accIcon())}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Количество городов в стране', snip.townIcon())}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Количество жителей страны', snip.pop())}}</div></th>
				<th><div class="s-tbl-rate-colSep">{{=snip.hintWrp('Среднее количество жителей на игрока страны', snip.pop()+'/'+snip.accIcon())}}</div></th>
				<th>{{=snip.hintWrp('Среднее количество жителей на город страны', snip.pop()+'/'+snip.townIcon())}}</th>
			</tr>
		</thead>
		<tbody>
			{{@it.countries: country}}
				<tr class="
					{{?wofh.country && wofh.country.id == country.country.id}}
						-type-own
					{{??!it.noColor}}
						{{?country.pos == it.search.pos}}
							-type-pos
						{{?}}
					{{?}}
				">
					<td class="aC"><div class="s-tbl-rate-colSep">{{=utils.formatNum(country.pos, {stages:true})}}</div></td>
					<td>
						<div class="s-tbl-rate-colSep">
							{{=snip.countryLink(country.country)}}
						</div>
					</td>
					<td><div class="s-tbl-rate-colSep">{{=country.accounts}}</div></td>
					<td><div class="s-tbl-rate-colSep">{{=country.towns}}</div></td>
					<td><div class="s-tbl-rate-colSep">{{=utils.formatNum(country.pop, {stages:true})}}</div></td>
					<td><div class="s-tbl-rate-colSep">{{=utils.formatNum(country.pop/country.accounts, {int:true, stages:true})}}</div></td>
					<td>{{=utils.formatNum(country.pop/country.towns, {int:true, stages:true})}}</td>
				</tr>
			{{@}}
		</tbody>
		<tfoot><tr><td colspan="7"></td></tr></tfoot>
	</table>
</script><script type="text/plain" id="refNotif.header">
    Ты не одинок!
</script>

<script type="text/plain" id="refNotif">
    <div class="view-refNotif">
        <div class="qinf-giver-wrp">
            <div class="qinf-giver -type-{{=utils.cnstName(Quest.givers, ~~(Math.random() *utils.sizeOf(Quest.givers)))}}"></div>
        </div>
        <div>Не забывай делить радость открытия нового мира вместе со своими друзьями!</div>
        <div><b>Пригласи их, поделившись этой ссылкой</b> и они присоединятся к тебе в долгом и интересном пути!</div>
        <input class="refNotif-link" value="{{=snip.referalLink()}}" readonly="readonly">
        <div>И помни, что за каждого приглашенного друга у тебя появится возможность получить награду в {{=snip.luck(lib.luckbonus.referalsbonus)}}</div>
    </div>
</script><script type="text/plain" id="report.header">
	{{?it.type === undefined}}
		Отчет
		
		{{return out;}}
	{{?}}
	
	{{ switch (it.type) { }}
		{{ case Report.type.science: }}
			Научный отчет
			{{ break; }}
		{{ case Report.type.tax: }}
			Отчет казначейства
			{{ break; }}
		{{ case Report.type.battleFull: }}
			Военный отчет — {{=!it.isTown1Hid() ? snip.townAccCountryLink(it.town1, {lenLim:200}, {lenLim:200}, {lenLim:200}) : snip.townHid()}}
			{{ break; }}
		{{ case Report.type.attackAir: }}
		{{ case Report.type.attackWater: }}
			Военный отчет — {{=!it.isTown2Hid() ? snip.townAccCountryLink(it.town2, {lenLim:200}, {lenLim:200}, {lenLim:200}) : snip.townHid()}}
			{{ break; }}
		{{ case Report.type.battleShort: }}
			Военный отчет — {{=snip.townAccCountryLink(it.town1, {lenLim:200}, {lenLim:200}, {lenLim:200})}}
			{{ break; }}
		{{ case Report.type.reinfDeath: }}
			Военный отчет
			{{ break; }}
		{{ case Report.type.spy: }}
			{{=!it.isTown1Hid() ? snip.townLink(it.town1) : snip.townHid()}}
			 разведал {{=!it.isTown2Hid() ? snip.townLink(it.town2) : snip.townHid()}}
			{{ break; }}
		{{ case Report.type.hunger: }}
			{{?it.isHungerSpecReason()}}
				Небоевые утраты
			{{??}}
				Голод
			{{?}}
			{{ break; }}
		{{ case Report.type.reinf: }}
			Отчет о подкреплении
			{{ break; }}
		{{ case Report.type.sendRes: }}
			Отчет о транспортировке
			{{ break; }}
		{{ case Report.type.tradeBarter: }}
		{{ case Report.type.tradeMoney: }}
		{{ case Report.type.stream: }}
		{{ case Report.type.streamChangeCost: }}
		{{ case Report.type.noFuel: }}
			Торговый отчет
			{{ break; }}
		{{ case Report.type.streamOffer: }}
			Торговое предложение
			{{ break; }}
		{{ case Report.type.congrat: }}
			Поздравление
			{{ break; }}
		{{ case Report.type.revolution: }}
			Дипломатия
			{{ break; }}
		{{ case Report.type.createTown: }}
			Основание нового города
			{{ break; }}
		{{ case Report.type.subsidy: }}
		{{ case Report.type.switchOff: }}
		{{ case Report.type.getDeposit: }}
		{{ case Report.type.sendMoney: }}
		{{ case Report.type.credit: }}
		{{ case Report.type.depositMove: }}
			Финансы
			{{ break; }}
		{{ case Report.type.consumption: }}
			Управление городом
			{{ break; }}
		{{ case Report.type.worldStop: }}
			Остановка мира
			{{ break; }}
		{{ case Report.type.payment: }}
			{{?it.data.cancel}}
				Платеж за Монеты Удачи отменен
			{{??}}
				Платеж
			{{?}}
			{{ break; }}
		{{ case Report.type.luckMove: }}
			Перечисление Монет Удачи
			{{ break; }}
		{{ case Report.type.settle: }}
			Заселение
			{{ break; }}
		{{ case Report.type.bonusCode: }}
			Бонус-код
			{{ break; }}
		{{ case Report.type.countryJoin: }}
			Вступление в {{=snip.country(it.data.country)}}
			{{ break; }}
		{{ case Report.type.countryLeave: }}
			{{?it.data.reason}}
				Тебя выгнали из 
			{{??}}
				Ты покинул страну 
			{{?}}
			{{=snip.country(it.data.country)}}
			{{ break; }}
		{{ case Report.type.bonusEnded: }}
			Окончилось действие бонуса Удачи!
			{{ break; }}
		{{ case Report.type.infoReport: }}
			Инфо отчет. 
			{{?it.isAccReport}}
				Науки {{=snip.accCountry(it.owner)}}
			{{??}}
				{{=snip.townAccCountry(it.town)}}
			{{?}}
			{{ break; }}
	{{ } }}
</script>

<script type="text/plain" id="report">																																															
	<div class="view-report">
		<div class="report-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="report.view">
	<div class="report-info">
		<div class="ri-content">
			{{=tmplMgr.report.info(it)}}
		</div>
	</div>
	<div class="report-content {{?it.hasExtInfo()}}rp-wide{{?}} -sel">
		{{=tmplMgr.report[utils.cnstName(Report.type, it.type)](it)}}
	</div>
	<div class="report-bottom">
		<div class="report-nav-prev-wrp"></div>

		<div class="report-bottom-content">
			{{=tmplMgr.report.bottom(it)}}
		</div>

		<div class="report-nav-next-wrp"></div>
	</div>
</script>

<script type="text/plain" id="report.info">
	<table class="report-topic-left">
		<colgroup>
			<col width="8%">
			<col width="69%">
		</colgroup>

		{{?debug.isAdmin()}}
			<tr>
				<td>Чей:</td>
				<td colspan="3">
					{{=snip.accCountry(it.owner)}}
				</td>
			</tr>
		{{?}}
		<tr>
			<td>Тема:</td>
			<td>
				<span>{{=tmplMgr.report.topic(it)}}</span>
			</td>
		</tr>
	</table>

	<table class="report-topic-right">
		<colgroup>
			<col width="8%">
			<col width="15%">
		</colgroup>

		{{=tmplMgr.report.view.right({report:it})}}
	</table>
</script>

<script type="text/plain" id="report.view.right">
	{{ switch (it.report.type) { }}
		{{ case Report.type.battleFull: }}
			<tr>
				<td>Начало боя:</td>
				<td>
					{{=timeMgr.fMoment(it.report.time - it.report.data.period)}}
				</td>
			</tr>
			<tr>
				<td>Продолжительность:</td>
				<td>
					{{=timeMgr.fPeriod(Math.abs(it.report.data.period))}}
				</td>
			</tr>
			{{ break; }}
		{{ case Report.type.infoReport: }}
			<tr>
				<td>Создан:</td>
				<td>
					{{=timeMgr.fMoment(it.report.time)}}
				</td>
			</tr>
			<tr>
				<td>Прошло:</td>
				<td>
					{{=timeMgr.fPeriod(timeMgr.getNow()-it.report.time) }}
				</td>
			</tr>
			{{ break; }}
		{{ default: }}
			<tr>
				<td>Время::</td>
				<td>
					{{=timeMgr.fMoment(it.report.time) }}
				</td>
			</tr>
			{{ break; }}
	{{ } }}
</script>

<script type="text/plain" id="report.bottom">
	<div class="report-bottom-button -type-left">
		{{=tmplMgr.report.bottom.left(it)}}
	</div>

	<div class="report-bottom-button -type-center">
		{{=tmplMgr.report.bottom.center(it)}}
	</div>

	<div class="report-bottom-button -type-right">
		{{=tmplMgr.report.bottom.right(it)}}
	</div>
</script>

<script type="text/plain" id="report.bottom.left">
	{{?wofh.platform && wofh.platform.postToWall && (it.type == Report.type.battleFull || it.type == Report.type.science)}}
		<div class="report-postToWall-wrp">
			<button class="button1 -type-green report-postToWall">
				<div class="report-postToWall-blink button1 -type-green -active"></div>
				<div class="report-postToWall-cont">
					<span class="iconSocial -type-{{=wofh.platform.name}}"></span> 
					На стену
				</div>
			</button>
			<div class="report-postToWall-arrow-wrp">
				<div class="report-postToWall-arrow"></div>
			</div>
		</div>
	{{?}}
	{{?it.type == Report.type.battleFull}}
		{{?it.data.replay }}
			<a class="button1 -type-green js-battleLink" href="{{=snip.getBattleLink({replay: it.data.replay})}}" target="_blank">Пересмотреть бой</a>
		{{?}}
		{{?!wofh.account.noAcc && Ability.simulator()}}
			<a class="button1 -type-blue js-toSimbattle">Симулятор</a>
		{{?}}
	{{?}}
	{{?it.type == Report.type.stream}}
		{{? it.town1.account.id == wofh.account.id && (it.data.type == 3 || it.data.type == 5 || it.data.type == 6 || it.data.type == 10) }}
			<a class="button1 -type-green" href="{{?!wofh.town || wofh.town.id != it.town1.id}}/#town/{{=it.town1.id}}{{??}}{{=HashMgr.getHref('#')}}{{?}}/stream/{{=it.town2.id}}&res={{=it.data.res}}&count={{=it.data.count}}&cost={{=it.data.cost}}">Повторить</a>
		{{?}}
	{{?}}
	{{?it.type == Report.type.payment && it.data.cancel}}
		<a class="button1 -type-gold" href="{{=HashMgr.getHref('#/shop')}}">В магазин удачи</a>
	{{?}}
</script>

<script type="text/plain" id="report.bottom.center">
	{{?wofh.account.id == it.owner.id || debug.isAdmin()}}
		{{?it.archived}}
			<a class="button1 js-report-archive"><img class="event e95" src="https://test.waysofhistory.com/img/_.gif">Убрать из архива</a>
		{{??}}
			<a class="button1 js-report-archive" data-title="Архивный отчет не удаляется автоматически по истечению срока хранения"><img class="event e95" src="https://test.waysofhistory.com/img/_.gif">В архив</a>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="report.bottom.right">
	{{?wofh.account.id == it.owner.id || debug.isAdmin()}}
		{{? it.deleted }}
			<a class="js-report-restore button1 -type-red">Восстановить</a>
		{{??}}
			<a class="js-report-delete button1 -type-red">Удалить</a>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="report.science">
	{{ var studyScience = Science.get(it.data.science); }}
	
	<div class="enc_infoc -report">
		<div class="studyScience">
			Изучено: <a class="link" href="{{=HashMgr.getHref('#/scienceinfo/'+studyScience.getId())}}">{{=snip.scienceIcon()}}{{= studyScience.getName() }}</a>
		</div>

		<div>Приток знаний составил <img class='res r0' src='https://test.waysofhistory.com/img/_.gif' title='Знания'>{{= parseInt(it.data.added) }}</div>
		<div>Эту науку знали до тебя {{=snip.accIcon()}} {{=it.data.known||0}}</div>

		<dl>
			<!-- науки -->
			{{? studyScience.takes[0] != Science.no }}
				<dt>Доступно к изучению:</dt>
				<dd>
					{{~ studyScience.takes:science }}
						{{science = new Science(science);}}
						{{?!science.isEmpty()}}
							{{=snip.scienceLink(science, {highlight: true})}}<br/>
						{{?}}
					{{~}}
				</dd>
			{{?}}

			<!-- юниты -->
			{{? !studyScience.units.isEmpty() }}
				<dt>Новые войска:</dt>
				<dd>
					{{@ studyScience.units.getList(): unit }}
						<span class="build-w">
							{{=snip.unitLink(unit, snip.unitIcon(unit, {half: unit.isHalf})+'<br/>'+unit.getName())}}
						</span>
					{{@}}
				</dd>
			{{?}}

			<!-- строения -->
			{{ var hasWonders = false; }}
			{{ var builds = studyScience.builds;}}

			{{? !builds.isEmpty() }}
				<dt>Новые строения:</dt>
				<dd>
					{{@ builds.getList() : slot}}
						{{
							if (Build.isWonder(slot.build.getId())) {
								hasWonders = true;
								continue;
							}
						}}
						{{? slot.build.enabled() }}
							<span class="build-w">
								<a href="{{=HashMgr.getHref('#/buildinfo/'+slot.getId())}}" class="build_icon_s" style="background-image:url(https://test.waysofhistory.com/img/buildings2/{{=slot.getId()}}_{{=slot.getPic()}}.png)" title="{{= slot.getName() }} +{{= slot.getCount() }} ур." data-tip="{{= slot.getName() }} +{{= slot.getCount() }} ур.">
									<span class="build-level">+{{= slot.getCount() }}</span>
								</a>
								<span class="dB">{{=snip.buildLink(slot)}}</span>
							</span>
						{{?}}
					{{@}}
				</dd>
			{{?}}

			<!-- чудеса -->
			{{? hasWonders }}
				<dt>Были открыты Чудеса Света:</dt>
				<dd>
					{{@ builds.getList() : slot }}
						{{ if (!Build.isWonder(slot.getId())) continue; }}
						{{? slot.build.enabled() }}
							<span class="build-w">
								<a href="{{=HashMgr.getHref('#/buildinfo/'+slot.getId())}}" class="build_icon_s build_icon_sw" style="background-image:url(https://test.waysofhistory.com/img/buildings2/{{=slot.getId()}}_{{=slot.getPic()}}.png)" title="{{= slot.getName() }} +{{= slot.getCount() }} ур." data-tip="{{= slot.getName() }} +{{= slot.getCount() }} ур.">
									<span class="build-level">+{{= slot.getCount() }}</span>
								</a>
								<span class="dB">{{=snip.buildLink(slot)}}</span>
							</span>
						{{?}}
					{{@}}
				</dd>
			{{?}}

			<!-- бонусы -->
			{{? utils.sizeOf(studyScience.bonuses) || utils.sizeOf(studyScience.abilities) || studyScience.envs.length }}
				<dt>Новые бонусы:</dt>
				<dd>
					{{@studyScience.bonuses: bonusVal : bonusId }}
						<p class="row">
							{{? bonusId != Science.bonus.ability1 && bonusId != Science.bonus.ability2 }}
								<span class="bt bt{{= bonusId }}"></span>
							{{??}}
								{{=snip.icon(snip.c.anyIcon, 'cap')}} 
							{{?}}

							{{=snip.scienceBonus(bonusId, bonusVal)}}
						</p>
					{{@}}
					{{?studyScience.fuel}}
						<p class="row"><span class="btAnyIconWrp">{{=snip.icon(snip.c.anyIcon, 'fuel')}}</span> Ускорение доставки грузов за {{=snip.resBig(studyScience.fuel)}}</p>
					{{?}}
					{{~ studyScience.envs: imp }}
						<p class="row">Улучшение местности: {{= snip.mapImpLevel(imp, {icon: 'effect'}) }}</p>
					{{~}}
					{{@studyScience.abilities: abilityVal : abilityId }}
						<p class="row scienceinfo-ability">
							{{?abilityId == Science.ability.fish}}
								{{=snip.resEffect(Resource.ids.fish)}}
							{{??abilityId == Science.ability.cloth}}
								{{=snip.resEffect(Resource.ids.cloth)}}
							{{??abilityId == Science.ability.roadDirt || abilityId == Science.ability.roadHighway || abilityId == Science.ability.roadRailway || abilityId == Science.ability.roadMaglev || abilityId == Science.ability.roadTunnel}}
								{{=snip.icon(snip.c.anyIcon, 'mapImp')}}
							{{??}}
								{{=snip.icon(snip.c.anyIcon, 'cap')}}
							{{?}}

							{{=snip.scienceAbility(abilityId)}}
						</p>
					{{@}}
				</dd>
			{{?}}
			
			<!-- Великие граждани -->
			{{=tmplMgr.snipet.specialistList({science:studyScience})}}

			<!-- местороды -->
			{{? studyScience.deposits.length }}
				<dt>Были открыты месторождения:</dt>
				<dd>
					{{var lastName = '';}}
					{{~ studyScience.deposits: deposit }}

						{{?lastName!= deposit.getName()}}
							{{=snip.depositLink(deposit)}}
							<br>
							{{lastName = deposit.getName();}}
						{{?}}
					{{~}}
				</dd>
			{{?}}
		</dl>
	</div>
</script>

<script type="text/plain" id="report.createTown">
	<p>
		{{?it.data.town.id}}
			{{=snip.townLink(it.town1)}} основал {{=snip.townLink(it.data.town)}}
		{{??}}
			{{=snip.townLink(it.town1)}} не смог основать новый город
		{{?}}
	</p>
</script>

<script type="text/plain" id="report.getDeposit">
	<p>
		{{?it.data.result}}
			{{=snip.townAccCountryLink(it.town1)}}
			 колонизировал месторождение <a class="link" href="{{=HashMgr.getHref('#map/o='+it.town1.id+'&x='+it.data.dx+'&y='+it.data.dy)}}">
				{{=(new Deposit(it.data.deposit)).getName() }}
			</a>
		{{??}}
			{{=snip.townAccCountryLink(it.town1)}}
			 не смог колонизировать месторождение <a class="link" href="{{=HashMgr.getHref('#map/o='+it.town1.id+'&x='+it.data.dx+'&y='+it.data.dy)}}">
				{{=(new Deposit(it.data.deposit)).getName() }}
			</a>
		{{?}}
	</p>
</script>

<script type="text/plain" id="report.battleShort">
	<div class="report-battle rb-short cf">
		<div class="{{? it.data.isattacker }}rb-attacker{{??}}rb-defender{{?}}">
			<div class="rb-header">
				<div class="{{?it.data.isattacker}}imgAttack{{??}}imgDefence{{?}}"></div>
			</div>
			<div class="rb-title">
				{{? it.data.isattacker }}Армия атаки{{??}}Армия защиты{{?}}
				{{? !it.data.survived}}
					<span class="rb-lose"> погибла</span>
				{{?}}
			</div>
			
			{{? it.data.army }}
				{{ 
					var army = new Army(it.data.army);
					var survived = new Army(it.data.survived||"");
					var dead = army.clone().diffList(survived).onlyPositive();
				}}
				<div class="rb-army rb-pan -type-battleLoose">
					{{= snip.army(army) }}
				</div>
				
				{{?it.data.survived}}
					/* атака. погибшие */
					{{? !dead.isEmpty() }}
						<div class="rb-title">Погибшие</div>
						<div class="rb-army rb-pan -type-battleLoose">
							{{= snip.army(dead) }}
						</div>
					{{?}}

					/* атака. выжившие */
					{{? !survived.isEmpty() }}
						<div class="rb-title">Выжившие</div>
						<div class="rb-army rb-pan -type-battleLoose">
							{{= snip.army(survived) }}
						</div>
					{{?}}
				{{?}}
				
				<div class="rb-title">{{?it.data.isattacker}}Нападающие{{??}}Защитники{{?}} <span class="report-armyPop">{{=snip.pop(army.calcPop())}}</span></div>
			{{?}}
			
		</div>
	</div>
</script>

<script type="text/plain" id="report.revolution">
	<p>
		Революция в стране 
		{{=snip.countryLink(it.data.country)}}
		.
	</p>
	<p>
		Старый глава 
		{{=snip.accLink(wofh.world.getAccount(it.data.lastleader))}}
		 был свергнут.
	</p>
	<p>
		Да здравствует новый правитель 
		{{=snip.accLink(wofh.world.getAccount(it.data.newleader))}}
		!
	</p>
</script>

<script type="text/plain" id="report.worldStop">
	Мир был приостановлен на {{= Timer.numToTime(it.data.time) }}
</script>


<script type="text/plain" id="report.depositMove">
	{{? it.data.sum > 0 }}
		На вклад в страну {{=snip.countryLink(it.data.country)}} зачислено {{=snip.res(1)}}{{= ~~it.data.sum }}.
	{{??}}
		C вклада в стране {{=snip.countryLink(it.data.country)}} снято {{=snip.res(1)}}{{= -(~~it.data.sum) }}.
	{{?}}
</script>

<script type="text/plain" id="report.subsidy">
	Из казны страны тебе перечислено  {{=snip.res(Resource.ids.money)}}{{= it.data.sum }}<br>
	 с комментарием «{{= TextParser.prepare(it.data.text) }}».
</script>

<script type="text/plain" id="report.streamChangeCost">
	<div class="streamChangeCost">
		<div>Изменены условия снабжения.</div>
		<br>
		<div class="accInfo">

			<div class="accProvider">
				Поставщик:
				<br>
				<div class="aL lenLim">
					{{=snip.townLink(it.town1)}}
					<br>
					{{=snip.accLink(it.town1.account)}}
					{{?it.town1.account.country}}
						<br>
						{{=snip.countryLink(it.town1.account.country)}}
					{{?}}
				</div>
			</div>
			<div class="accConsumer">
				Потребитель:
				<br>
				<div class="aL lenLim">
					{{=snip.townLink(it.town2)}}
					<br>
					{{=snip.accLink(it.town2.account)}}
					{{?it.town2.account.country}}
						<br>
						{{=snip.countryLink(it.town2.account.country)}}
					{{?}}
				</div>
			</div>
		</div>
		<br>
		<br>
		<div>
			Старые условия:
			<br>
			<span>
				{{var oldCost = ~~((it.data.lastcost * it.data.count + it.data.lasttcost * (~~it.data.traders)) * 0.001);}}
				({{=snip.res(Resource.ids.money)}}{{=utils.toFixed(it.data.lastcost * 0.001, 3)}} x {{=snip.resCount(it.data.res, ~~it.data.count)}}) + ({{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.lasttcost * 0.001, {fixed:1})}} x {{=snip.trader(it.data.traders)}}) = {{=snip.res(Resource.ids.money)}}<span class="fwB">{{=utils.stages(oldCost)}}</span>
			</span>
		</div>
		<br>
		<div>
			Новые условия:
			<br>
			<span class="newConditions">
				{{var newCost = ~~((it.data.newcost * it.data.count + it.data.newtcost * (~~it.data.traders)) * 0.001);}}
				({{=snip.res(Resource.ids.money)}}<span class="{{?it.data.lastcost != it.data.newcost}}deffColor fwB{{?}}">{{=utils.toFixed(it.data.newcost * 0.001, 3)}}</span> x {{=snip.resCount(it.data.res, ~~it.data.count)}}) + ({{=snip.res(Resource.ids.money)}}<span class="{{?it.data.lasttcost != it.data.newtcost}}deffColor fwB{{?}}">{{=utils.formatNum(it.data.newtcost * 0.001, {fixed:1})}}</span> x {{=snip.trader(it.data.traders)}}) = {{=snip.res(Resource.ids.money)}}<span class="deffColor fwB">{{=utils.stages(newCost)}}</span>
			</spn>
		</div>
		<br>
		<div>
			Итог: <span class="fwB cl-{{?newCost > oldCost}}red{{??}}green{{?}}">{{=snip.res(Resource.ids.money)}}{{=snip.sign(newCost - oldCost, utils.stages(newCost - oldCost))}}</span>
		</div>
	</div>
</script>


<script type="text/plain" id="report.payment">
	{{?it.data.luck}}
		{{?it.data.cancel}}
			Тобой было куплено {{=snip.resCount(Resource.ids.luck, it.data.luck)}}.
			{{?it.data.bonus > 0}}
				<br>
				В подарок ты получил {{=snip.resCount(Resource.ids.luck, it.data.bonus)}}.
			{{?}}
			<br>
			<strong>Но твой платеж был отклонен платежной системой.</strong>
			<br>
			Поэтому эта покупка аннулирована, а полученные {{=snip.resCount(Resource.ids.luck, it.data.luck + it.data.bonus)}} были изъяты.
		{{??}}
			Успешно приобретено {{=snip.luck(Math.round(it.data.luck))}} Монет Удачи!
			{{?it.data.bonus > 0}}
				<br>В подарок получаешь еще {{=snip.luck(it.data.bonus)}} Монет Удачи!
			{{?}}
			
			{{?it.data.bonusspecialist !== undefined}}
				<br>
				А еще, ты получил Великого Гражданина — 
				{{var specialist = new Specialist(it.data.bonusspecialist);}}
				{{=snip.specialistTooltip(specialist, specialist.getName())}}
				.
				<br>
				Теперь он доступен в окне 
				<a class="link" href="{{=HashMgr.getHref('#/bonus')}}">Удачи</a>
				, где ты можешь его определить в любой свой город.
			{{?}}
		{{?}}
	{{??}}
		Сообщение скрыто
	{{?}}
</script>

<script type="text/plain" id="report.luckMove">
	Получено {{=snip.luck(it.data.luck)}} Монет Удачи от игрока {{=snip.accLink(wofh.world.getAccount(it.data.from))}}. <br>Будьте осторожны, данный игрок может отменить свой платеж и тогда эти Монеты Удачи с вас счислятся. <br>В этом случае вам придется незамедлительно погасить задолженность. <br>Не спешите тратить Монеты Удачи, полученные от незнакомых или малознакомых лиц.
</script>

<script type="text/plain" id="report.streamOffer">
	<p>
		{{=snip.townLink(it.town1)}}
		 предложил начать снабжение с {{=snip.townLink(it.town2)}}
		
	</p>
	<table>
		<tr>
			<td>Поставки:</td>
			<td>
				{{=snip.resCount(it.data.res, it.data.count)}} в час
				 (для {{=snip.townLink(it.town2)}})
			</td>
		</tr>
		<tr>
			<td>Оплата:</td>
			<td>
				{{=snip.res(Resource.ids.money)}}{{=utils.toFixed((it.data.count * it.data.cost + (it.data.traders||0) * it.data.tcost) * 0.001, 1)}} в час (цена 
				{{=snip.res(Resource.ids.money)}}{{=utils.toFixed(it.data.cost * 0.001, 3)}})
			</td>
		</tr>
		<tr>
			<td>Залог:</td>
			<td>{{=snip.resCount(Resource.ids.money, Math.ceil(it.data.count * it.data.cost / 1000 * lib.trade.pledgehours))}}</td>
		</tr>
	</table>
	<p><a class="trade_stream_offerAccept" data-id="{{= it.id }}" href="#">Принять</a></p>

</script>

<script type="text/plain" id="report.settle">
	Вы успешно заселились неподалеку от игрока {{=snip.accLink(wofh.world.getAccount(it.data.settler))}}. Если вы не начнете выполнять начальные Задания отшельника сразу, то ваш аккаунт скоро будет удален.
</script>

<script type="text/plain" id="report.congrat">
	<p>
		{{=snip.townLink(it.town1)}}  от всей души поздравляет 
		{{=snip.townLink(it.town2)}} c Новым Годом!
	</p>
	<p>Ненадолго задержавшись на отдохнуть, отметить и поиграть в шахматы, дорогие гости отправились восвояси.<br>И почти не оставили после себя мусора, хаоса и разрушений, что приятно.</p>
</script>


<script type="text/plain" id="report.bonusCode">
	Твой бонус-код дал {{=snip.luck(it.data.coins)}} Монет Удачи. Это существенное преимущество перед остальными. Зайди в меню «Удача», чтобы использовать Монеты.
</script>

<script type="text/plain" id="report.noFuel">
	<p>В {{=snip.townAccCountryLink(it.town1)}} прекращено использование {{=snip.resName(it.data.fuel)}} для ускорения торговли.</p>
</script>

<script type="text/plain" id="report.switchOff">
	{{
		var build = new Slot(it.data.build);
		var town = wofh.towns[it.town1.id];
		var slot = town ? town.getSlots().clone(town).setSorted(true).getElem(it.data.build, false) : false;
		if( !slot || slot.isActive() ) slot = false;
	}}
	В  {{=snip.townLink(it.town1)}}  отключено строение «
	{{?town}}
		{{var href;}}
		{{?slot}}
			{{href=HashMgr.getHref('#town/'+town.id+'/slot/'+slot.getPos());}}
		{{??}}
			{{href=HashMgr.getHref('#/buildinfo/'+build.id);}}
		{{?}}
		
		<a class="link" href="{{=href}}">{{=build.getName()}}</a>
	{{??}}
		{{=build.getName()}}
	{{?}}
	». Не хватило денег на его содержание.
	{{?it.data.sum}}
		<br>
		И ты получаешь {{=snip.resCount(Resource.ids.money, it.data.sum)}}.
	{{?}}
	
	{{?town && slot}}
		<br>
		<br>
		<a class="link" href="{{=href}}">Включить это строение снова за</a> {{=snip.resCount(Resource.ids.money, utils.toInt(slot.getSwitchCost()))}}
	{{?}}
	
	{{?it.data.sum}}
		<br>
		<p>
			<b>Внимание!</b><br/>
			Если это строение не включить сейчас, то есть риск отсутствия денежной компенсации при подобном отключении<br/>
			в дальнейшем, что может привести к одновременному отключению большого числа строений в городе.
		</p>
	{{?}}
</script>

<script type="text/plain" id="report.sendMoney">
	Игрок 
	{{=snip.accLink(wofh.world.getAccount(it.data.from))}}
	 перечислил тебе 
	{{=snip.res(Resource.ids.money)}}{{= it.data.sum }}
</script>

<script type="text/plain" id="report.battleFull">
{{
	var id,
		attackerAll = new Army(),
		attackerDead = new Army(),
		attackerSurvived = new Army(),
		attackerLoot = new ResList(),
		defenderAll = new Army(),
		defenderDead = new Army(),
		defenderSurvived = new Army(),
		attackerCountries = {},
		defenderCountries = {};

	for (id in it.data.attackers) {
		var attacker = it.data.attackers[id];
		if (attacker.robbed) {
			attackerLoot.addList(new ResList(attacker.robbed));
		}
		attackerAll.addList(new Army(attacker.army));
		attackerSurvived.addList(new Army(attacker.survived));

		if (attacker.country) {
			attackerCountries[attacker.country.id] = attacker.country;
		} else {
			attackerCountries[0] = Country.blankCountry;
		} 

	}
	attackerDead = attackerAll.clone().diffList(attackerSurvived).onlyPositive();

	for (id in it.data.defenders) {
		var defender = it.data.defenders[id];
		defenderAll.addList(new Army(defender.army));
		defenderSurvived.addList(new Army(defender.survived));

		if (defender.country) {
			defenderCountries[defender.country.id] = defender.country;
		} else {
			defenderCountries[0] = Country.blankCountry;
		} 

	}
	defenderDead = defenderAll.clone().diffList(defenderSurvived).onlyPositive();
}}
	<div class="report-battle -type-battleFull {{?!ls.getAttDefViewReport(true)}}-type-viewDefLeft{{?}}">
		<label class="report-battleView-wrp">
			{{=snip.checkbox1({cls: 'report-battleView', checked: !ls.getAttDefViewReport(true)})}}
			Отображать стороны как в бою
		</label>
		{{
			var htmlAtt = tmplMgr.report.battleFull.att({
				it: it, 
				attackerAll: attackerAll,
				attackerDead: attackerDead,
				attackerSurvived: attackerSurvived,
				attackerLoot: attackerLoot,
				defenderAll: defenderAll,
				defenderDead: defenderDead,
				defenderSurvived: defenderSurvived,
				attackerCountries: attackerCountries,
				defenderCountries: defenderCountries
			}),
			htmlDef = tmplMgr.report.battleFull.def({
				it: it, 
				attackerAll: attackerAll,
				attackerDead: attackerDead,
				attackerSurvived: attackerSurvived,
				attackerLoot: attackerLoot,
				defenderAll: defenderAll,
				defenderDead: defenderDead,
				defenderSurvived: defenderSurvived,
				attackerCountries: attackerCountries,
				defenderCountries: defenderCountries
			});
		}}
		{{?ls.getAttDefViewReport(true)}}
			{{=htmlAtt}}
		{{??}}
			{{=htmlDef}}
		{{?}}
		
		{{?!ls.getAttDefViewReport(true)}}
			{{=htmlAtt}}
		{{??}}
			{{=htmlDef}}
		{{?}}
	</div>
	
	{{=tmplMgr.report.access(it)}}
</script>

<script type="text/plain" id="report.battleFull.def">
	{{
		var	attackerAll = it.attackerAll,
			attackerDead = it.attackerDead,
			attackerSurvived = it.attackerSurvived,
			attackerLoot = it.attackerLoot,
			defenderAll = it.defenderAll,
			defenderDead = it.defenderDead,
			defenderSurvived = it.defenderSurvived,
			attackerCountries = it.attackerCountries,
			defenderCountries = it.defenderCountries;
		
		it = it.it;
	}}
	
	<div class="rb-defender">
		<div class="rb-header">
			{{?!ls.getAttDefViewReport(true)}}
				<div class="imgDefence"></div>
			{{?}}
			
			<div class="rb-header-info">
				{{?it.isShare(Report.accessIds.hd)}}
					Скрыто
				{{??}}
					{{?!it.isTown1Hid() && it.town1.account}}
						<div>
							{{? it.town1.id != -5 }}
								{{=snip.townLink(it.town1, {townCls:(it.town1.townowner?' -decorationThrough':'')})}}
							{{??}}
								<span>{{= it.town1.name }}</span>
							{{?}}
						</div>
						<div>
							{{=snip.accCountry(it.town1.townowner||it.town1.account, false, {accCls:(it.town1.townowner && it.town1.townowner.isBarbarian()?' -decorationThrough':'')})}}
						</div>
					{{??}}
						{{=snip.townHid()}}
					{{?}}
				{{?}}
			</div>
			
			{{?ls.getAttDefViewReport(true)}}
				<div class="imgDefence"></div>
			{{?}}
		</div>
		{{?it.isShare(Report.accessIds.hda)}}
			Скрыто
		{{??}}
			<div class="rb-title">
				Вся армия защиты —&nbsp;

				{{? it.data.result == Report.battleResult.win }}
					<span class="rb-win">Победа</span>
				{{?? it.data.result == Report.battleResult.abort }}
					<span class="rb-abort">Бой прерван</span>
				{{??}}
					<span class="rb-lose">Поражение</span>
				{{?}}
			</div>
			{{? it.data.defstruct && it.data.deflevel > 0 }}
				<div class="rb-pan">
					{{var defStruct = new Slot(it.data.defstruct, it.data.deflevel);}}
					{{=snip.slotName(defStruct, {level: true})}}
				</div>
			{{?}}
			/* защита. вся армия */
			<div class="rb-armyall rb-army rb-pan">
				{{? !defenderAll.isEmpty() }}
					{{= snip.army(defenderAll) }}
				{{??}}
					<span class="rb-title">Нет</span>
				{{?}}
			</div>

			/* защита. погибшие */
			{{? !defenderDead.isEmpty() }}
				<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(defenderDead.calcPop())}}</span></div>
				<div class="rb-army rb-pan">
					{{= snip.army(defenderDead) }}
				</div>
			{{?}}
			/* защита. выжившие */
			{{? !defenderSurvived.isEmpty() }}
				<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(defenderSurvived.calcPop())}}</span></div>
				<div class="rb-army rb-pan">
					{{= snip.army(defenderSurvived) }}
				</div>
			{{?}}

			{{? !defenderDead.isEmpty() }}
				<div class="rb-title">Потерянные войска в ресурсах</div>
				<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(defenderDead.calcCost()) }}</div>
			{{?}}
		{{?}}
		{{? it.data.defenders }}
			<div class="report-block">
				<div class="rb-title">Защитники <span class="report-armyPop">{{=snip.pop(defenderAll.calcPop())}}</span></div>
				{{?utils.sizeOf(defenderCountries)>1}}
					<div class="report-armies-filterWrp">
						{{@defenderCountries: country: countryId}}
							<a class="report-armies-filter -active" data-id="{{=countryId}}">
								{{=snip.countryFlag(country, {flag: 'normal'})}}
							</a>&nbsp;
						{{@}}
					</div>
				{{?}}
				<div class="rb-pan">
					{{?it.isShare(Report.accessIds.hd) }}
						Скрыто
					{{??}}
						{{~ it.data.defenders : fighter }}
							{{var tooltip = tmplMgr.report.battleFull.details({fighter: fighter, defender: true});}}

							<div class="rb-account panel2 js-rb-defender report-fighter {{?tooltip}}js-tooltip{{?}}" data-country="{{=fighter.country? fighter.country.id: fighter.country}}" data-tooltip-wnd="text" data-tooltip-text="{{=utils.escapeHtml(tooltip)}}">
								<div>
									{{?it.towns && fighter.town}}
										{{=snip.townAccCountryLink(fighter.town, {lenLim: 85}, false, {text:false})}}
									{{??}}
										{{=snip.townHid()}}
									{{?}}
								</div>
								<div>
									{{?fighter.army}}
										{{= snip.pop(new Army(fighter.army).calcPop()) }}
									{{?}}

									{{ var accountDeadQty = new Army(fighter.army).diffList(new Army(fighter.survived)).onlyPositive().calcPop(); }}
									{{? accountDeadQty > 0 }}
										<img class="event ae0" src="https://test.waysofhistory.com/img/_.gif">{{= accountDeadQty }}
									{{?}}
								</div>
							</div>
						{{~}}
					{{?}}
				</div>
			</div>
		{{?}}
		{{? it.data.destroy }}
			<div class="rb-title">Разрушения</div>
			<div class="rb-pan dIB">
				{{=tmplMgr.report.attack.buildDestroy(it)}}
			</div>
		{{?}}
		{{? it.data.killed > 0 }}
			<div class="rb-title rb-pan">Убито <span class="report-armyPop">{{= snip.death(it.data.killed) }}</span></div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="report.battleFull.att">
	{{
		var attackerAll = it.attackerAll,
			attackerDead = it.attackerDead,
			attackerSurvived = it.attackerSurvived,
			attackerLoot = it.attackerLoot,
			defenderAll = it.defenderAll,
			defenderDead = it.defenderDead,
			defenderSurvived = it.defenderSurvived,
			attackerCountries = it.attackerCountries,
			defenderCountries = it.defenderCountries;
		
		it = it.it;
	}}
	
	<div class="rb-attacker">
		<div class="rb-header">
			<div class="imgAttack"></div>
		</div>

		{{?it.isShare(Report.accessIds.haa)}}
			Скрыто
		{{??}}
			<div class="rb-title">
				{{? attackerAll.getLength() > 0 }}
					Вся армия нападения 
				{{?}}—&nbsp;

				{{? it.data.result == Report.battleResult.win }}
					<span class="rb-lose">Поражение</span>
				{{?? it.data.result == Report.battleResult.abort }}
					<span class="rb-abort">Бой прерван</span>
				{{??}}
					<span class="rb-win">Победа</span>
				{{?}}
			</div>
			{{? it.data.defstruct && it.data.deflevel > 0 }}
				/* Для выравнивания верстки */
				<div class="rb-pan -invis">
					{{var defStruct = new Slot(it.data.defstruct, it.data.deflevel);}}
					{{=snip.slotName(defStruct, {level: true})}}
				</div>
			{{?}}
			/* атака. вся армия */
			{{? attackerAll.getLength() > 0 }}
				<div class="rb-armyall rb-army rb-pan">
					{{= snip.army(attackerAll) }}
				</div>
			{{?}}
			/* атака. погибшие */
			{{? attackerDead.getLength() > 0}}
				<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(attackerDead.calcPop())}}</span></div>
				<div class="rb-army rb-pan">
					{{= snip.army(attackerDead) }}
				</div>
			{{?}}
			/* атака. выжившие */
			{{? attackerSurvived.getLength() > 0 }}
				<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(attackerSurvived.calcPop())}}</span></div>
				<div class="rb-army rb-pan">
					{{= snip.army(attackerSurvived) }}
				</div>
			{{?}}

			{{? !attackerDead.isEmpty() }}
				<div class="rb-title">Потерянные войска в ресурсах</div>
				<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(attackerDead.calcCost()) }}</div>
			{{?}}
		{{?}}
		<div class="report-block">
			<div class="rb-title">Нападающие <span class="report-armyPop">{{=snip.pop(attackerAll.calcPop())}}</span></div>
			{{?utils.sizeOf(attackerCountries)>1}}
				<div class="report-armies-filterWrp">
					{{@attackerCountries: country: countryId}}
						<a class="report-armies-filter -active" data-id="{{=countryId}}">
							{{=snip.countryFlag(country, {flag: 'normal'})}}
						</a>&nbsp;
					{{@}}
				</div>
			{{?}}
			<div class="rb-pan">
				{{?it.isShare(Report.accessIds.ha)}}
					Скрыто
				{{??}}
					{{~it.data.attackers : fighter}}
						{{var tooltip = tmplMgr.report.battleFull.details({fighter: fighter, attacker: true});}}

						<div class="rb-account panel2 report-fighter {{?tooltip}}js-tooltip{{?}}" data-country="{{=fighter.country ? fighter.country.id : fighter.country}}" data-tooltip-wnd="text" data-tooltip-text="{{=utils.escapeHtml(tooltip)}}">
							<div>
								{{?it.towns && fighter.town}}
									{{=snip.townAccCountryLink(fighter.town, {lenLim: 85}, false, {text:false})}}
								{{??}}
									{{=snip.townHid()}}
								{{?}}
							</div>
							<div>
								{{?fighter.army}}
									<img class="res rp" src="https://test.waysofhistory.com/img/_.gif">{{= new Army(fighter.army).calcPop() }}
								{{?}}

								{{ var accountDeadQty = new Army(fighter.army).diffList(new Army(fighter.survived)).onlyPositive().calcPop(); }}
								{{? accountDeadQty > 0 }}
									<img class="event ae0" src="https://test.waysofhistory.com/img/_.gif">{{= accountDeadQty }}
								{{?}}

								{{? fighter.robbed }}
									<img class="event e90" src="https://test.waysofhistory.com/img/_.gif">{{= Resource.countFromStr(fighter.robbed) }}
								{{?}}
							</div>
						</div>
					{{~}}
				{{?}}
			</div>
		</div>
		{{? attackerLoot.getLength() > 0 }}
			<div class="rb-title">Награблено</div>
			<div class="rb-pan">
				{{= snip.resBigList(attackerLoot) }}
			</div>
		{{?}}

		{{?(it.data.defwonder == 91) || (it.data.defstruct !== undefined && it.data.defstruct != Build.no && it.data.deflevel)}}
			<div class="rb-title">Урон от защитных сооружений</div>
			<div class="rb-pan">
				{{?it.data.defwonder == 91}}
					{{
						var slot = new Slot(it.data.defwonder, lib.build.maxlevel);
						var effect = WonderEffect.getEffect(slot.getId(), WonderEffect.ids.damageDefenceWood).getEffect();
					}}
					<div class="report-attack-slotWrp">
						<div>
							<a class="report-attack-slot link" data-head="{{=snip.slotTitle(slot)}}" href="{{=HashMgr.getHref('#/buildinfo/'+slot.getId())}}">{{=snip.slotFrame(slot, snip.slotLevel(slot), {noTitle:true})}}</a>
							&nbsp;—&nbsp;
							<span class="report-attack-slotEffect" data-title="{{=utils.escapeHtml(snip.pop(effect)+' урона после боя при городе войскам вражеской армии, состоящим преимущественно из древесины')}}">{{=snip.pop(effect)}}</span>
						</div>
						{{=slot.getName()}}
					</div>
				{{?}}
				{{?it.data.defstruct !== undefined && it.data.defstruct != Build.no && it.data.deflevel}}
					{{var slot = new Slot(it.data.defstruct, it.data.deflevel);}}
					<div class="report-attack-slotWrp">
						<div>
							<a class="report-attack-slot link" data-head="{{=snip.slotTitle(slot)}}" href="{{=HashMgr.getHref('#/buildinfo/'+slot.getId())}}">{{=snip.slotFrame(slot, snip.slotLevel(slot), {noTitle:true})}}</a>
							&nbsp;—&nbsp;{{=snip.pop(utils.toInt(slot.getEffect({account:it.data.townowner})))}}
						</div>
						{{=slot.getName()}}
					</div>
				{{?}}
			</div>
		{{?}}
	</div>
</script>
	
<script type="text/plain" id="report.battleFull.details">
	{{?it.fighter && it.fighter.bonus}}
		<div class="rb-account-details">
			{{?it.attacker}}
				<div class="rb-account-bonus">Военный бонус: {{=it.fighter.bonus - 100}}%</div>
				
				{{=snip.army(new Army(it.fighter.army))}}
				
				{{?it.fighter.robbed}}
					<div class="rb-account-robbed">
						<img class="event e90" src="https://test.waysofhistory.com/img/_.gif">: {{=snip.resBigList(new ResList(it.fighter.robbed))}}
					</div>
				{{?}}
			{{??}}
				<div class="rb-account-bonus">Военный бонус: {{=it.fighter.bonus - 100}}%</div>

				{{=snip.army(new Army(it.fighter.army))}}
			{{?}}
		</div>
	{{?}}
</script>


<script type="text/plain" id="report.attack.buildDestroy">
	{{? it.data.destroy }}
		<div class="mb05">Снесено уровней</div>
	
		{{var slots = SlotList.getReportSortList(it.data.destroy);}}
		
		<table class="mb05" align="right">
			<tbody>
				{{@slots:buildData}}
					{{? buildData.getId() == lib.build.nobuild }}
						{{continue;}}
					{{?}}
					<tr>
						{{? buildData.getId() == 601 }}
							<td colspan="2">Ресурсная колония разрушена ({{=snip.depositLink(buildData.getLevel())}})</td>
						{{?? buildData.getId() == 602 }}
							<td colspan="2" class="p0500">{{=snip.nobr(snip.townIcon(true)+'Город разрушен')}}</td>
						{{??}}
							<td class="pr20">{{=snip.buildLink(buildData, false, {level:false})}}</td>
							<td>{{=buildData.getLevel()}}</td>
						{{?}}
					</tr>
				{{@}}
			</tbody>
		</table>
	{{?}}
</script>

<script type="text/plain" id="report.attackAir">
{{
	var attackerWas = new Army(it.data.army1);
	var attackerSurv = new Army(it.data.survived1);
	var attackerDead = attackerWas.clone().diffList(attackerSurv).onlyPositive();
	var attackerEvas = new Army(it.data.evasion);
	
	var defenderWas = new Army(it.data.army2);
	var defenderLandWas = new Army(it.data.armyland);
	var defenderLandSurv = new Army(it.data.surviveland);
	var defenderLandDead = defenderLandWas.clone().diffList(defenderLandSurv).onlyPositive();
}}
	<div class="report-battle cf">
		<div class="rb-attacker">
			<div class="rb-header">
				<div class="imgAttack"></div>
				<div class="rb-header-info">
					{{?it.isShare(Report.accessIds.ha)}}
						Скрыто
					{{??}}
						{{?!it.isTown1Hid() && it.town1.account}}
							<div>
								{{? it.town1.id != -5 }}
									{{=snip.townLink(it.town1)}}
								{{??}}
									<span>{{= it.town1.name }}</span>
								{{?}}
							</div>
							<div>
								{{=snip.accCountry(it.town1.account)}}
							</div>
						{{??}}
							{{=snip.townHid()}}
						{{?}}
					{{?}}
				</div>
			</div>

			{{?it.isShare(Report.accessIds.haa) }}
				Скрыто
			{{??}}
				<div class="rb-title">
					
					{{? !attackerWas.isEmpty() }}
						Вся армия нападения 
					{{?}}—&nbsp;

					{{? it.data.result == Report.battleResult.win }}
							<span class="rb-lose">Поражение</span>
					{{??}}
							<span class="rb-win">Победа</span>
					{{?}}
				</div>
		
				<div><b>Военный бонус: {{=it.data.bonus1||0}}%</b></div>
		
				/* атака. вся армия */
				{{? !attackerWas.isEmpty() }}
					<div class="rb-armyall rb-army rb-pan">Авиация: {{= snip.army(attackerWas) }}</div>
				{{?}}


				{{
					var damageAAD = it.data.aaddamage;
					var damageLand = defenderLandWas.calcAirDamage();
					var damageAir = defenderWas.calcAirDamage();
					var damageTotal = damageAAD + damageLand + damageAir;
				}}
				{{?damageTotal}}
					<div class="rb-title">Полученный урон <img class="icnu ic16" src="https://test.waysofhistory.com/img/_.gif"><span class="report-armyPop">{{=utils.stages(damageTotal)}}</span></span></div>
					<div class="rb-armyall rb-army rb-pan">
						{{?damageAAD}}<div>ПВО нанесло: {{=utils.stages(damageAAD)}}</div>{{?}}
						{{?damageLand}}<div>Сухопутные войска нанесли: {{=utils.stages(damageLand)}}</div>{{?}}
						{{?damageAir}}<div>Авиация нанесла: {{=utils.stages(damageAir)}}</div>{{?}}
					</div>
				{{?}}
			
				/* атака. погибшие */
				{{? attackerDead.getLength() > 0}}
					<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(attackerDead.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(attackerDead) }}</div>
				{{?}}

				/* атака. уклонившиеся */
				{{? !attackerEvas.isEmpty() }}
					<div class="rb-title">Уклонившиеся <span class="report-armyPop">{{=snip.pop(attackerEvas.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(attackerEvas) }}</div>
				{{?}}
				
				/* атака. выжившие */
				{{? !attackerSurv.isEmpty() }}
					<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(attackerSurv.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(attackerSurv) }}</div>
				{{?}}
				
				{{? !attackerDead.isEmpty() }}
					<div class="rb-title">Потерянные войска в ресурсах</div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(attackerDead.calcCost()) }}</div>
				{{?}}
				
			{{?}}

		</div>

		/* защита */
		<div class="rb-defender">
			<div class="rb-header">
				<div class="rb-header-info">
					{{?it.isShare(Report.accessIds.hd)}}
						Скрыто
					{{??}}
						{{?!it.isTown2Hid() && it.town2.account}}
							<div>
								{{? it.town2.id != -5 }}
									{{=snip.townLink(it.town2)}}
								{{??}}
									<span>{{= it.town2.name }}</span>
								{{?}}
							</div>
							<div>
								{{=snip.accCountry(it.town2.account)}}
							</div>
						{{??}}
							{{=snip.townHid()}}
						{{?}}
					{{?}}
				</div>
				<div class="imgDefence"></div>
			</div>

			{{?it.isShare(Report.accessIds.hda)}}
				Скрыто
			{{??}}
				<div class="rb-title">
					Вся армия защиты —&nbsp;

					{{? it.data.result == Report.battleResult.win }}
							<span class="rb-win">Победа</span>
					{{??}}
							<span class="rb-lose">Поражение</span>
					{{?}}
				</div>
		
				<div><b>Военный бонус: {{=it.data.bonus2||0}}%</b></div>

				{{? it.data.defstruct && it.data.deflevel > 0 }}
					<div class="rb-pan">
						{{var defStruct = new Slot(it.data.defstruct, it.data.deflevel);}}
						{{=snip.slotName(defStruct, {level: true})}}
					</div>
				{{?}}

				/* защита. вся армия */
				<div class="rb-armyall rb-army rb-pan">
					{{? !defenderWas.isEmpty() }}
						<div>Авиация: {{= snip.army(defenderWas) }}</div>
					{{?}}
					{{? !defenderLandWas.isEmpty() }}
						<div>Сухопутные: {{= snip.army(defenderLandWas) }}</div>
					{{?}}
					{{?defenderWas.isEmpty() && defenderLandWas.isEmpty()}}
						{{?it.data.army2 !== undefined && it.data.armyland !== undefined}}
							<span class="rb-title">Нет</span>
						{{??}}
							<span class="rb-title">Неизвестно</span>
						{{?}}
					{{?}}
				</div>
				
				/* защита. погибшие */
				{{? !defenderLandDead.isEmpty()}}
					<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(defenderLandDead.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(defenderLandDead) }}</div>
				{{?}}
				
				/* защита. выжившие */
				{{? !defenderLandSurv.isEmpty() || !defenderWas.isEmpty() }}
					<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(defenderLandSurv.calcPop() + defenderWas.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">
						{{?!defenderWas.isEmpty()}}
							Авиация: {{= snip.army(defenderWas) }}
							<br>
						{{?}}
						{{?!defenderLandSurv.isEmpty()}}
							Сухопутные: {{= snip.army(defenderLandSurv) }}
						{{?}}
					</div>
				{{?}}
				{{? !defenderLandDead.isEmpty() }}
					<div class="rb-title">Потерянные войска в ресурсах</div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(defenderLandDead.calcCost()) }}</div>
				{{?}}
			{{?}}
			
			{{? it.data.destroy }}
				<div class="rb-title">Разрушения</div>
				<div class="rb-pan">
					{{=tmplMgr.report.attack.buildDestroy(it)}}
				</div>
			{{?}}
			
			{{? it.data.killed > 0 }}
				<div class="rb-title rb-pan">Убито <span class="report-armyPop">{{= snip.death(it.data.killed) }}</span></div>
			{{?}}
		</div>
	</div>
	
	{{=tmplMgr.report.access(it)}}
</script>

<script type="text/plain" id="report.attackWater">
{{
	var attackerWas = new Army(it.data.army1);
	var attackerSurv = new Army(it.data.survived1);
	var attackerDead = attackerWas.clone().diffList(attackerSurv).onlyPositive();
	
	var defenderWaterWas = new Army(it.data.water2);
	var defenderWaterSurv = new Army(it.data.watersurvive2);
	var defenderWaterDead = defenderWaterWas.clone().diffList(defenderWaterSurv).onlyPositive();
	var defenderGroundWas = new Army(it.data.ground2);
	
	var wonder1 = new Slot(it.data.wonder1, lib.build.maxlevel);
	var wonder2 = new Slot(it.data.wonder2, lib.build.maxlevel);
}}
	
	<div class="report-battle cf">
		<div class="rb-attacker">
			<div class="rb-header">
				<div class="imgAttack"></div>
				<div class="rb-header-info">
					{{?it.isShare(Report.accessIds.ha)}}
						Скрыто
					{{??}}
						{{?!it.isTown1Hid() && it.town1.account}}
							<div>
								{{? it.town1.id != -5 }}
									{{=snip.townLink(it.town1)}}
								{{??}}
									<span>{{= it.town1.name }}</span>
								{{?}}
							</div>
							<div>
								{{=snip.accCountry(it.town1.account)}}
							</div>
						{{??}}
							{{=snip.townHid()}}
						{{?}}
					{{?}}
				</div>
			</div>

			{{?it.isShare(Report.accessIds.haa) }}
				Скрыто
			{{??}}
				<div class="rb-title">
					
					{{? !attackerWas.isEmpty() }}
						Вся армия нападения 
					{{?}}—&nbsp;

					{{? it.data.result == Report.battleResult.win }}
						<span class="rb-lose">Поражение</span>
					{{??}}
						<span class="rb-win">Победа</span>
					{{?}}
				</div>
				
				<div><b>Военный бонус: {{=it.data.bonus1||0}}%</b></div>
				
				/* атака. вся армия */
				{{? !attackerWas.isEmpty() }}
					<div class="rb-armyall rb-army rb-pan">Флот: {{= snip.army(attackerWas) }}</div>
				{{?}}
				
				{{
					var damageGround = defenderGroundWas.calcWaterDamage(it.data.bonus2 * 0.01);
					var damageWater = defenderWaterWas.calcWaterDamage(it.data.bonus2 * 0.01);
					var damageTotal = damageGround + damageWater;
				}}
				{{?damageTotal}}
					<div class="rb-title">Полученный урон <img class="icnu ic16" src="https://test.waysofhistory.com/img/_.gif"><span class="report-armyPop">{{=utils.formatNum(damageTotal, {int:true, stages:true, servRound:true})}}</span></span></div>
					<div class="rb-armyall rb-army rb-pan">
						{{?damageGround}}<div>Сухопутные войска нанесли: {{=utils.formatNum(damageGround, {int:true, stages:true, servRound:true})}}</div>{{?}}
						{{?damageWater}}<div>Флот нанес: {{=utils.formatNum(damageWater, {int:true, stages:true, servRound:true})}}</div>{{?}}
					</div>
				{{?}}
			
				/* атака. погибшие */
				{{? attackerDead.getLength() > 0}}
					<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(attackerDead.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(attackerDead) }}</div>
				{{?}}
				
				/* атака. выжившие */
				{{? !attackerSurv.isEmpty() }}
					<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(attackerSurv.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(attackerSurv) }}</div>
				{{?}}
				
				{{? !attackerDead.isEmpty() }}
					<div class="rb-title">Потерянные войска в ресурсах</div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(attackerDead.calcCost()) }}</div>
				{{?}}
				
			{{?}}
			
			{{?it.data.grabbed}}
				<div class="rb-title">Награблено</div>
				<div class="rb-pan">
					{{=snip.resBigList(new ResList(it.data.grabbed))}}
				</div>
			{{?}}
			
			{{?wonder2.isHeConcentrator()}}
				<div class="rb-title">Урон от защитных сооружений</div>
				<div class="rb-pan">
					<div class="report-attack-slotWrp">
						<div>
							<a class="report-attack-slot link" data-head="{{=snip.slotTitle(wonder2)}}" href="{{=HashMgr.getHref('#/buildinfo/'+wonder2.getId())}}">{{=snip.slotFrame(wonder2, snip.slotLevel(wonder2), {noTitle:true})}}</a>
							&nbsp;—&nbsp;{{=snip.pop(WonderEffect.getEffect(wonder2.getId(), WonderEffect.ids.damageDefenceWood).getEffect())}}
						</div>
						{{=wonder2.getName()}}
					</div>
				</div>
			{{?}}
		</div>
		
		/* защита */
		<div class="rb-defender">
			<div class="rb-header">
				<div class="rb-header-info">
					{{?it.isShare(Report.accessIds.hd) }}
						Скрыто
					{{??}}
						{{?!it.isTown2Hid() && it.town2.account}}
							<div>
								{{? it.town2.id != -5 }}
									{{=snip.townLink(it.town2)}}
								{{??}}
									<span>{{= it.town2.name }}</span>
								{{?}}
							</div>
							<div>
								{{=snip.accCountry(it.town2.account)}}
							</div>
						{{??}}
							{{=snip.townHid()}}
						{{?}}
					{{?}}
				</div>
				<div class="imgDefence"></div>
			</div>

			{{?it.isShare(Report.accessIds.hda)}}
				Скрыто
			{{??}}
				<div class="rb-title">
					Вся армия защиты —&nbsp;

					{{?it.data.result == Report.battleResult.win}}
						<span class="rb-win">Победа</span>
					{{??}}
						<span class="rb-lose">Поражение</span>
					{{?}}
				</div>
				
				<div><b>Военный бонус: {{=it.data.bonus2||0}}%</b></div>
				
				{{? it.data.defstruct && it.data.deflevel > 0 }}
					<div class="rb-pan">
						{{var defStruct = new Slot(it.data.defstruct, it.data.deflevel);}}
						{{=snip.slotName(defStruct, {level: true})}}
					</div>
				{{?}}

				/* защита. вся армия */
				<div class="rb-armyall rb-army rb-pan">
					{{? !defenderWaterWas.isEmpty() }}
						<div>Флот: {{= snip.army(defenderWaterWas) }}</div>
					{{?}}
					{{? !defenderGroundWas.isEmpty() }}
						<div>Сухопутные: {{= snip.army(defenderGroundWas) }}</div>
					{{?}}
					{{?defenderWaterWas.isEmpty() && defenderGroundWas.isEmpty()}}
						{{?it.data.water2 !== undefined && it.data.ground2 !== undefined}}
							<span class="rb-title">Нет</span>
						{{??}}
							<span class="rb-title">Неизвестно</span>
						{{?}}
					{{?}}
				</div>
				
				{{?!defenderWaterWas.isEmpty()}}
					{{
						var damageWater = attackerWas.calcWaterDamage(it.data.bonus1 * 0.01);
					}}
					{{?damageWater}}
						<div class="rb-title">Полученный урон <img class="icnu ic16" src="https://test.waysofhistory.com/img/_.gif"><span class="report-armyPop">{{=utils.formatNum(damageWater, {int:true, stages:true, servRound:true})}}</span></span></div>
					{{?}}
				{{?}}
				
				/* защита. погибшие */
				{{? !defenderWaterDead.isEmpty()}}
					<div class="rb-title">Погибшие <span class="report-armyPop">{{=snip.death(defenderWaterDead.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.army(defenderWaterDead) }}</div>
				{{?}}
				
				/* защита. выжившие */
				{{? !defenderWaterSurv.isEmpty() || !defenderWaterWas.isEmpty() }}
					<div class="rb-title">Выжившие <span class="report-armyPop">{{=snip.pop(defenderWaterSurv.calcPop() + defenderGroundWas.calcPop())}}</span></div>
					<div class="rb-armyall rb-army rb-pan">
						{{?!defenderWaterSurv.isEmpty()}}
							Флот: {{= snip.army(defenderWaterSurv) }}
							<br>
						{{?}}
						{{?!defenderGroundWas.isEmpty()}}
							Сухопутные: {{= snip.army(defenderGroundWas) }}
						{{?}}
					</div>
				{{?}}
				{{? !defenderWaterDead.isEmpty() }}
					<div class="rb-title">Потерянные войска в ресурсах</div>
					<div class="rb-armyall rb-army rb-pan">{{= snip.resBigList(defenderWaterDead.calcCost()) }}</div>
				{{?}}
			{{?}}
			
			{{? it.data.destroy }}
				<div class="rb-title">Разрушения</div>
				<div class="rb-pan">
					{{=tmplMgr.report.attack.buildDestroy(it)}}
				</div>
			{{?}}
			
			{{? it.data.killed > 0 }}
				<div class="rb-title rb-pan">Убито <span class="report-armyPop">{{= snip.death(it.data.killed) }}</span></div>
			{{?}}
		</div>
	</div>
	
	{{=tmplMgr.report.access(it)}}
</script>																																																

<script type="text/plain" id="report.reinfDeath">
	{{console.log("report.reinfDeath",it);}}
	<p>При обороне  {{=snip.townAccLink(it.town1)}} </p>
	<p>Пострадало твое подкрепление из  {{=snip.townLink(it.town2)}} </p>
	<p>Подкрепление: {{= snip.army(new Army(it.data.army)) }}</p>
	<p>Потери:
		{{? it.data.survive }}
			{{= snip.army(new Army(it.data.army).clone().diffList(new Army(it.data.survive)), {notAllowZero:true}) }}
		{{??}}
			{{= snip.army(new Army(it.data.army)) }}
		{{?}}
	</p>
</script>

<script type="text/plain" id="report.reinf">
	<p>
		{{=snip.townLink(it.town1)}}
		{{? it.data.operation == Report.reinfOperation.gone }}
			 подкрепляет 
		{{?? it.data.operation == Report.reinfOperation.back }}
			 отозвал подкрепление из 
		{{?? it.data.operation == Report.reinfOperation.withdraw }}
			 выслал подкрепление 
		{{?}} 
		{{=snip.townLink(it.town2)}}
	</p>
	<p>
		Войска: 
		{{= snip.army(new Army(it.data.army)) }}
	</p>
</script>

<script type="text/plain" id="report.tax">
	{{var moneyIcon = snip.res(Resource.ids.money);}}

	<div class="report-taxNew-column-wrp">	
		{{
			it.data.new.budget = it.data.new.budget||{};
			it.data.last.budget = it.data.last.budget||{};
			
			it.data.new.budget.army = it.data.new.budget.army||{};
			it.data.last.budget.army = it.data.last.budget.army||{};

			it.data.new.budget.buildings = it.data.new.budget.buildings||{};
			it.data.last.budget.buildings = it.data.last.budget.buildings||{};
			
			it.data.new.budget.knowledgetakes = utils.toFixed(it.data.new.budget.knowledgetakes||0, 2, true);
			
			it.data.new.budget.army.death = utils.toFixed(it.data.new.budget.army.death||0, 2, true);
			it.data.new.budget.army.live = utils.toFixed(it.data.new.budget.army.live||0, 3, true);
			
			it.data.new.budget.buildings.diplomacy = utils.toFixed(it.data.new.budget.buildings.diplomacy||0, 2, true);
			it.data.new.budget.buildings.strategy = utils.toFixed(it.data.new.budget.buildings.strategy||0, 2, true);

			it.data.new.budget.buildings.war = utils.toFixed(it.data.new.budget.buildings.war||0, 2, true);
			it.data.new.budget.buildings.science = utils.toFixed(it.data.new.budget.buildings.science||0, 2, true);
			it.data.new.budget.buildings.defence = utils.toFixed(it.data.new.budget.buildings.defence||0, 2, true);
			
			it.data.last.budget.knowledgetakes = utils.toFixed(it.data.last.budget.knowledgetakes||0, 2, true);
			
			it.data.last.budget.army.death = utils.toFixed(it.data.last.budget.army.death||0, 2, true);
			it.data.last.budget.army.live = utils.toFixed(it.data.last.budget.army.live||0, 3, true);
			
			it.data.last.budget.buildings.diplomacy = utils.toFixed(it.data.last.budget.buildings.diplomacy||0, 2, true);
			it.data.last.budget.buildings.strategy = utils.toFixed(it.data.last.budget.buildings.strategy||0, 2, true);
			it.data.last.budget.buildings.war = utils.toFixed(it.data.last.budget.buildings.war||0, 2, true);
			it.data.last.budget.buildings.science = utils.toFixed(it.data.last.budget.buildings.science||0, 2, true);
			it.data.last.budget.buildings.defence = utils.toFixed(it.data.last.budget.buildings.defence||0, 2, true);

			it.data.new.budget.subsidy = it.data.new.budget.subsidy||[];
			it.data.last.budget.subsidy = it.data.last.budget.subsidy||[];
			
			var baseRatesChanged = 
				(it.data.new.budget.knowledgetakes != it.data.last.budget.knowledgetakes) || 
				(it.data.new.budget.army.death != it.data.last.budget.army.death) || 
				(it.data.new.budget.army.live != it.data.last.budget.army.live) || 
				(it.data.new.budget.buildings.diplomacy != it.data.last.budget.buildings.diplomacy) || 
				(it.data.new.budget.buildings.strategy != it.data.last.budget.buildings.strategy) || 
				(it.data.new.budget.buildings.war != it.data.last.budget.buildings.war) || 
				(it.data.new.budget.buildings.science != it.data.last.budget.buildings.science) || 
				(it.data.new.budget.buildings.defence != it.data.last.budget.buildings.defence);
			
			var unitRatesChanged = !utils.isEqual(it.data.new.budget.army.liveu, it.data.last.budget.army.liveu);
			var depRatesChanged = !utils.isEqual(it.data.new.tax.deposit, it.data.last.tax.deposit);
			var trainUnitRatesChanged = !utils.isEqual(it.data.new.budget.army.train, it.data.last.budget.army.train);
		}}
		
		{{?baseRatesChanged || unitRatesChanged || trainUnitRatesChanged}}
			<div class="report-taxNew-column-left">
				{{?baseRatesChanged}}
					<span class="fwB">Изменения ставок по бюджетным выплатам:</span>

					<table class="tbl-baseRatesChanged report-taxNew-budget-info" cellpadding="0" cellspacing="0">
						<thead>
							<tr>
								<td class="-taxNew-title"></td>
								<td></td>
								<td class="-taxNew-title"></td>
								<td class="-taxNew-title -taxNew-gray">Было</td>
							</tr>
						</thead>
						<tbody>
							{{?it.data.new.budget.knowledgetakes != it.data.last.budget.knowledgetakes}}
								<tr>
									<td class="-taxNew-desc">На вложенное  {{=snip.resBigCount(0, 1)}}</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.knowledgetakes}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.knowledgetakes}})</td>
								</tr>
							{{?}}
							{{?it.data.new.budget.army.death != it.data.last.budget.army.death}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.pop(1)}} мертвых войск</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.army.death}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.army.death}})</td>
								</tr>
							{{?}}
							{{?it.data.new.budget.army.live != it.data.last.budget.army.live}}
								<tr>
									<td class="-taxNew-desc">На живые войска</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.army.live}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.army.live}})</td>
								</tr>
							{{?}}	
							{{?it.data.new.budget.buildings.diplomacy != it.data.last.budget.buildings.diplomacy}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.icon(snip.c.anyIcon, 'diplomacyPoints', false, 1)}} очко дипломатии</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.buildings.diplomacy}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.buildings.diplomacy}})</td>
								</tr>
							{{?}}
							{{?it.data.new.budget.buildings.strategy != it.data.last.budget.buildings.strategy}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.resCount(1, 1)}} содержания стратегических строений</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.buildings.strategy}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.buildings.strategy}})</td>
								</tr>
							{{?}}

							{{?it.data.new.budget.buildings.war != it.data.last.budget.buildings.war}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.resBig(Resource.ids.money)}}1 содержания военных строений</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.buildings.war}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.buildings.war}})</td>
								</tr>
							{{?}}

							{{?it.data.new.budget.buildings.science != it.data.last.budget.buildings.science}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.resBig(Resource.ids.money)}}1 содержания научных строений</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.buildings.science}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.buildings.science}})</td>
								</tr>
							{{?}}

							{{?it.data.new.budget.buildings.defence != it.data.last.budget.buildings.defence}}
								<tr>
									<td class="-taxNew-desc">На {{=snip.resBig(Resource.ids.money)}}1 содержания фортификационных строений</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">{{=it.data.new.budget.buildings.defence}}</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">({{=it.data.last.budget.buildings.defence}})</td>
								</tr>
							{{?}}
						</tbody>
					</table>
				{{?}}
				
				{{?unitRatesChanged}}
					{{
						var newLiveu = new Army(it.data.new.budget.army.liveu);
						var lastLiveu = new Army(it.data.last.budget.army.liveu);

						var liveu = new Army();
						for(var unit in lastLiveu.getList()){
							unit = lastLiveu.getElem(unit);
							unit.rateOld = unit.count;
							liveu.addElem(unit);
						}
						for(var unit in newLiveu.getList()){
							unit = newLiveu.getElem(unit);
							liveuUnit = liveu.getElem(unit.id);
							liveuUnit.rate = unit.count;
							liveu.addElem(liveuUnit);
						}
					}}
				
					<span class="fwB">Особые ставки на войска:</span>

					<table class="tbl-unitRatesChanged report-taxNew-budget-info" cellpadding="0" cellspacing="0">
						<thead>
							<tr>
								<td class="-taxNew-title"></td>
								<td></td>
								<td class="-taxNew-title"></td>
								<td class="-taxNew-title -taxNew-gray">Было</td>
							</tr>
						</thead>
						<tbody>
							{{@liveu.getList(): unit}}
								{{?unit.rate != unit.rateOld}}
									<tr>
										<td class="-taxNew-desc">{{=snip.unitIconLink(unit)}}</td>
										<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
										<td class="-taxNew-value nobr">
											{{?unit.rate==null}}
												Базовая ставка
											{{??}}
												{{=unit.rate.toFixed(2)}}
											{{?}}
										</td>
										<td class="-taxNew-unitsRateold -taxNew-lastValue -taxNew-gray nobr">
											(
												{{?unit.rateOld==null}}Базовая ставка
												{{??}}{{=unit.rateOld.toFixed(2)}}
												{{?}}
											)
										</td>
									</tr>
								{{?}}
							{{@}}
						</tbody>
					</table>
				{{?}}
				
				{{?trainUnitRatesChanged}}
					{{
						var newTrain = new Army(it.data.new.budget.army.train);
						var lastTrain = new Army(it.data.last.budget.army.train);

						var train = new Army();
						for(var unit in lastTrain.getList()){
							unit = lastTrain.getElem(unit);
							unit.rateOld = unit.count;
							train.addElem(unit);
						}
						for(var unit in newTrain.getList()){
							unit = newTrain.getElem(unit);
							trainUnit = train.getElem(unit.id);
							trainUnit.rate = unit.count;
							train.addElem(trainUnit);
						}
					}}
					
					<br>
					
					<span class="fwB">Разовые выплаты на обучение войск</span>

					<table class="tbl-trainUnitRatesChanged report-taxNew-budget-info" cellpadding="0" cellspacing="0">
						<thead>
							<tr>
								<td class="-taxNew-title"></td>
								<td></td>
								<td class="-taxNew-title"></td>
								<td class="-taxNew-title -taxNew-gray">Было</td>
							</tr>
						</thead>
						<tbody>
							{{@train.getList(): unit}}
								{{?unit.rate != unit.rateOld}}
									<tr>
										<td class="-taxNew-desc">{{=snip.unitIconLink(unit)}}</td>
										<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
										<td class="-taxNew-value nobr">
											{{=(unit.rate||0).toFixed(2)}}
										</td>
										<td class="-taxNew-unitsRateold -taxNew-lastValue -taxNew-gray nobr">
											({{=(unit.rateOld||0).toFixed(2)}})
										</td>
									</tr>
								{{?}}
							{{@}}
						</tbody>
					</table>
				{{?}}
			</div>
		{{?}}
		
		<div class="report-taxNew-column-right">
			{{?(it.data.new.tax.pop != it.data.last.tax.pop) || (it.data.new.tax.trade != it.data.last.tax.trade)}}
				<span class="fwB">Изменения налогов:</span>

				<table class="report-taxNew-budget-info" cellpadding="0" cellspacing="0">
					<thead>
						<tr>
							<td colspan="3"></td>
							<td class="-taxNew-gray">Было</td>
						</tr>
					</thead>
					<tbody>
						{{?it.data.new.tax.pop != it.data.last.tax.pop}}
							<tr>
								<td>Подушный</td>
								<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
								<td class="-taxNew-taxValue nobr">{{?it.data.new.tax.pop}}{{=utils.toFixed(it.data.new.tax.pop, 2)}}{{??}}0.00{{?}}</td>
								<td class="-taxNew-gray nobr">({{?it.data.last.tax.pop}}{{=utils.toFixed(it.data.last.tax.pop, 2)}}{{??}}0.00{{?}})</td>
							</tr>
						{{?}}
						{{?it.data.new.tax.trade != it.data.last.tax.trade}}
							<tr>
								<td>С продаж</td>
								<td class="-taxNew-moneyIcon"></td>
								<td class="-taxNew-taxValue nobr">{{?it.data.new.tax.trade}}{{=utils.toFixed(it.data.new.tax.trade, 2)}}{{??}}0.00{{?}}%</td>
								<td class="-taxNew-gray nobr">({{?it.data.last.tax.trade}}{{=utils.toFixed(it.data.last.tax.trade, 2)}}{{??}}0.00{{?}}%)</td>
							</tr>
						{{?}}
					</tbody>
				</table>
			{{?}}
			
			{{?depRatesChanged}}
				<span class="fwB">Налог на месторождения:</span>
				
				{{
					var depNew = it.data.new.tax.deposit;
					var depLast = it.data.last.tax.deposit;
				}}
				
				<table class="report-taxNew-budget-info" cellpadding="0" cellspacing="0">
					<thead>
						<tr>
							<td class="-taxNew-title"></td>
							<td></td>
							<td></td>
							<td class="-taxNew-title"></td>
							<td class="-taxNew-title -taxNew-gray">Было</td>
						</tr>
					</thead>
					<tbody>
						{{@depNew: rateNew: deposit}}
							{{?rateNew != depLast[deposit]}}
								{{
									deposit = new Deposit(+deposit+1);
									deposit.rateNew = rateNew;
									deposit.rateLast = depLast[deposit.getOffsetId()];
								}}
								<tr>
									<td class="-taxNew-desc -type-dep">{{=snip.depositLink(deposit)}}</td>
									<td>
										{{=snip.depositClimateIcon(deposit)}}
									</td>
									<td class="-taxNew-moneyIcon">{{=moneyIcon}}</td>
									<td class="-taxNew-value nobr">
										{{=utils.formatNum(deposit.rateNew, {stages:true})}}
									</td>
									<td class="-taxNew-lastValue -taxNew-gray nobr">
										(
											{{=utils.formatNum(deposit.rateLast, {stages:true})}}
										)
									</td>
								</tr>
							{{?}}
						{{@}}
					</tbody>
				</table>
			{{?}}
		</div>
	</div>

	{{var productTax = {};}}

	{{~it.data.new.tax.prodx: prodx: index}}
		{{?prodx}}
			{{?!productTax[index+1]}}{{productTax[index+1] = {};}}{{?}}
			{{productTax[index+1].prodxNew = prodx;}}
		{{?}}
	{{~}}
	{{~it.data.last.tax.prodx: prodx: index}}
		{{?prodx}}
			{{?!productTax[index+1]}}{{productTax[index+1] = {};}}{{?}}
			{{productTax[index+1].prodxLast = prodx;}}
		{{?}}
	{{~}}
	
	{{~it.data.new.budget.prod: budgetProd: index}}
		{{?budgetProd}}
			{{?!productTax[index]}}{{productTax[index] = {};}}{{?}}
			{{productTax[index].budgetProdNew = budgetProd;}}
		{{?}}
	{{~}}
	{{~it.data.last.budget.prod: budgetProd: index}}
		{{?budgetProd}}
			{{?!productTax[index]}}{{productTax[index] = {};}}{{?}}
			{{productTax[index].budgetProdLast = budgetProd;}}
		{{?}}
	{{~}}
	
	{{~it.data.new.customs_[0]: custom: index}}
		{{?custom}}
			{{?!productTax[index+1]}}{{productTax[index+1] = {};}}{{?}}
			{{productTax[index+1].customNew = custom;}}
		{{?}}
	{{~}}
	{{~it.data.last.customs_[0]: custom: index}}
		{{?custom}}
			{{?!productTax[index+1]}}{{productTax[index+1] = {};}}{{?}}
			{{productTax[index+1].customLast = custom;}}
		{{?}}
	{{~}}

	{{@productTax: product: key}}
		{{?product.prodxNew == product.prodxLast && product.budgetProdNew == product.budgetProdLast && product.customNew == product.customLast}}
			{{delete productTax[key];}}
		{{?}}
	{{@}}

	{{?!$.isEmptyObject(productTax)}}
		<p class="fwB">Изменения налогов на производство и таможенных пошлин:</p>
		
		<table class="tbl-productTax s-tbl report-taxNew-info">
			<thead>
				<tr>
					<th class="productTax-res"></th>
					<th colspan="2">Налоги на производство</th>
					<th colspan="2">Дотации на производство</th>
					<th colspan="2">Общие таможенные пошлины</th>
				</tr>
				<tr>
					<th class="productTax-res">Ресурс</th>
					<th>Было</th>
					<th>Стало</th>
					<th>Было</th>
					<th>Стало</th>
					<th>Было</th>
					<th>Стало</th>
				</tr>
			</thead>
			<tbody>
				{{var index = 0;}}
				{{@productTax: product: resId }}
					<tr class="trow{{=(index++)%2}}">
						<td class="productTax-res">{{=snip.resName(resId)}}</td>
						<td>{{?product.prodxNew != product.prodxLast}}{{=snip.resCount(Resource.ids.money, utils.formatNum((product.prodxLast||0) * 0.001, {fixed: 3}))}}{{?}}</td>
						<td>{{?product.prodxNew != product.prodxLast}}{{=snip.resCount(Resource.ids.money, utils.formatNum((product.prodxNew||0) * 0.001, {fixed: 3}))}}{{?}}</td>
						<td>{{?product.budgetProdNew != product.budgetProdLast}}{{=snip.resCount(Resource.ids.money, utils.formatNum((product.budgetProdLast||0) * 0.001, {fixed: 3}))}}{{?}}</td>
						<td>{{?product.budgetProdNew != product.budgetProdLast}}{{=snip.resCount(Resource.ids.money, utils.formatNum((product.budgetProdNew||0) * 0.001, {fixed: 3}))}}{{?}}</td>
						<td>{{?product.customLast !== product.customNew}}{{=utils.toFixed(product.customLast, 1)}}%{{?}}</td>
						<td>{{?product.customLast !== product.customNew}}{{=utils.toFixed(product.customNew, 1)}}%{{?}}</td>
					</tr>
				{{@}}
			</tbody>
		</table>
	{{?}}

	{{var allianceTax = {};}}
	
	/* Если союз был удален или добавлен под налогообложение */
	{{?utils.sizeOf(it.data.new.customs_) != utils.sizeOf(it.data.last.customs_)}}
		{{?utils.sizeOf(it.data.new.customs_) > utils.sizeOf(it.data.last.customs_)}}
			{{
				var customs_long = it.data.new.customs_;
				var customs_short = it.data.last.customs_;
			}}
		{{??}}
			{{
				var customs_long = it.data.last.customs_;
				var customs_short = it.data.new.customs_;
			}}
		{{?}}
		
		{{@customs_long: customs_: key}}
			{{?!customs_short[key]}}
				{{customs_short[key] = [];}}
				{{@customs_:tax}}
					{{customs_short[key].push(0);}} /* 0 в виде числа прописывается для несуществующего ресурса */
				{{@}}
			{{?}}
		{{@}}
	{{?}}
	
	/* Обработка данных по пошлинам торговых союзов */
	{{@it.data.new.customs_: newAllyTax: key}}

		/* Исключаем общие таможенные пошлины (индекс 0) */
		{{?~~key}}
			/* Предидущие данные по пошлинам */
			{{var lastAllyTax = it.data.last.customs_[key];}}
			
			{{?lastAllyTax === undefined}}{{continue;}}{{?}}
			
			{{@newAllyTax: tax: index}}
				{{?tax || lastAllyTax[index]}}

					{{
						tax = utils.toFixed(tax||0, 2);
						lastAllyTax[index] = utils.toFixed(lastAllyTax[index]||0, 2);
					}}

					/* Показываем только тогда, когда предидущие и текущие не равны */
					{{?tax != lastAllyTax[index]}}
						{{?!allianceTax[key]}}{{allianceTax[key] = {};}}{{?}}
						{{allianceTax[key][+index+1] = {};}}
						{{allianceTax[key][+index+1].newTax = tax;}}
						{{allianceTax[key][+index+1].lastTax = lastAllyTax[index];}}
					{{?}}

				{{?}}
			{{@}}
		{{?}}

	{{@}}
	
	{{?!$.isEmptyObject(allianceTax)}}
		<p><b>Изменение пошлин для торговых союзов</b></p>
		
		{{@allianceTax: ally: allyId}}
			<table class="s-tbl report-taxNew-info">
				<thead>
					<tr>
						<th colspan="3">{{=snip.tradeUnion()}}{{=it.tradeallies[allyId]}}</th>
					</tr>
					<tr>
						<th>Ресурс</th>
						<th>Было</th>
						<th>Стало</th>
					</tr>
				</thead>
				<tbody>
					{{var index = 0;}}
					{{@ally: allyTax: resId}}
						<tr class="trow{{=(index++)%2}}">
							<td>{{=snip.resName(resId)}}</td>
							<td>{{=allyTax.lastTax}}%</td>
							<td>{{=allyTax.newTax}}%</td>
						</tr>
					{{@}}
				</tbody>
			</table>
			<br>
		{{@}}
	{{?}}

	{{?
		it.data.last.credit.maxp != it.data.new.credit.maxp ||
		it.data.last.credit.maxc != it.data.new.credit.maxc ||
		it.data.last.credit.rate != it.data.new.credit.rate ||
		it.data.last.credit.reserve != it.data.new.credit.reserve
	}}

		<p><b>Кредиты:</b></p>

		<table class="s-tbl report-taxNew-info">
			<thead>
				<tr>
					<th class="report-credit-col0"></th>
					{{?it.data.last.credit.rate != it.data.new.credit.rate}}
						<th class="aRi">Cтавка в день</th>
					{{?}}
					{{?it.data.last.credit.maxp != it.data.new.credit.maxp}}
						<th class="aRi">Максимальная сумма на игрока</th>
					{{?}}
					{{?it.data.last.credit.maxc != it.data.new.credit.maxc}}	
						<th class="aRi">Максимальная сумма на страну</th>
					{{?}}
					{{?it.data.last.credit.reserve != it.data.new.credit.reserve}}	
						<th class="aRi">Неприкасаемый остаток казны</th>
					{{?}}
				</tr>
			</thead>
			<tbody class="aR">
				<tr class="trow0">
					<td class="report-credit-col0 aL">Было</td>
					{{?it.data.last.credit.rate != it.data.new.credit.rate}}
						<td class="aRi">{{=utils.toFixed((utils.toInt(it.data.last.credit.rate) * 0.1), 1) }}%</td>
					{{?}}
					{{?it.data.last.credit.maxp != it.data.new.credit.maxp}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.credit.maxp, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.credit.maxc != it.data.new.credit.maxc}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.credit.maxc, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.credit.reserve != it.data.new.credit.reserve}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.credit.reserve, {int: true, stages: true})}}</td>
					{{?}}
				</tr>
				<tr class="trow1">
					<td class="report-credit-col0 aL">Стало</td>
					{{?it.data.last.credit.rate != it.data.new.credit.rate}}
						<td class="aRi">{{=utils.toFixed((utils.toInt(it.data.new.credit.rate) * 0.1), 1)}}%</td>
					{{?}}
					{{?it.data.last.credit.maxp != it.data.new.credit.maxp}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.credit.maxp, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.credit.maxc != it.data.new.credit.maxc}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.credit.maxc, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.credit.reserve != it.data.new.credit.reserve}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.credit.reserve, {int: true, stages: true})}}</td>
					{{?}}
				</tr>
			</tbody>
		</table>
	{{?}}

	{{?
		it.data.last.deposit.maxp != it.data.new.deposit.maxp ||
		it.data.last.deposit.maxc != it.data.new.deposit.maxc ||
		it.data.last.deposit.rate != it.data.new.deposit.rate ||
		it.data.last.deposit.reserve != it.data.new.deposit.reserve
	}}

		<p><b>Вклады:</b></p>

		<table class="s-tbl report-taxNew-info">
			<thead>
				<tr>
					<th class="report-deposit-col0"></th>
					{{?it.data.last.deposit.rate != it.data.new.deposit.rate}}
						<th class="aRi">Процентная ставка</th>
					{{?}}
					{{?it.data.last.deposit.maxp != it.data.new.deposit.maxp}}
						<th class="aRi">Максимальная сумма на игрока</th>
					{{?}}
					{{?it.data.last.deposit.maxc != it.data.new.deposit.maxc}}	
						<th class="aRi">Максимальная сумма на страну</th>
					{{?}}
					{{?it.data.last.deposit.reserve != it.data.new.deposit.reserve}}	
						<th class="aRi">Неприкасаемый остаток казны</th>
					{{?}}
				</tr>
			</thead>
			<tbody class="aR">
				<tr class="trow0">
					<td class="report-deposit-col0 aL">Было</td>
					{{?it.data.last.deposit.rate != it.data.new.deposit.rate}}
						<td class="aRi">{{=utils.toFixed((utils.toInt(it.data.last.deposit.rate) * 0.1), 1) }}%</td>
					{{?}}
					{{?it.data.last.deposit.maxp != it.data.new.deposit.maxp}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.deposit.maxp, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.deposit.maxc != it.data.new.deposit.maxc}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.deposit.maxc, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.deposit.reserve != it.data.new.deposit.reserve}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.last.deposit.reserve, {int: true, stages: true})}}</td>
					{{?}}
				</tr>
				<tr class="trow1">
					<td class="report-deposit-col0 aL">Стало</td>
					{{?it.data.last.deposit.rate != it.data.new.deposit.rate}}
						<td class="aRi">{{=utils.toFixed((utils.toInt(it.data.new.deposit.rate) * 0.1), 1)}}%</td>
					{{?}}
					{{?it.data.last.deposit.maxp != it.data.new.deposit.maxp}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.deposit.maxp, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.deposit.maxc != it.data.new.deposit.maxc}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.deposit.maxc, {int: true, stages: true})}}</td>
					{{?}}
					{{?it.data.last.deposit.reserve != it.data.new.deposit.reserve}}
						<td class="aRi">{{=snip.res(Resource.ids.money)}}{{=utils.formatNum(it.data.new.deposit.reserve, {int: true, stages: true})}}</td>
					{{?}}
				</tr>
			</tbody>
		</table>
	{{?}}

	{{?it.data.new.budget.subsidy.length || it.data.last.budget.subsidy.length}}

		{{
			var newSubsidy = it.data.new.budget.subsidy;
			var lastSubsidy = it.data.last.budget.subsidy;

			var newSubsidyObj = {};
			for( var subsidy in newSubsidy ){
				subsidy = newSubsidy[subsidy];
				newSubsidyObj[subsidy.acc] = subsidy;
			}

			var lastSubsidyObj = {};
			for( var subsidy in lastSubsidy ){
				subsidy = lastSubsidy[subsidy];
				lastSubsidyObj[subsidy.acc] = subsidy;
			}

			var subStatus = {start:0, stop:1, change:2};

			var subsidyArr = [];

			for( var newSub in newSubsidyObj ){
				var sub = {};
				sub.acc = wofh.world.getAccount(newSub);
				
				if( lastSubsidyObj[newSub] ){
					sub.status = subStatus.change;
					sub.newSum = newSubsidyObj[newSub].sum;
					sub.lastSum = lastSubsidyObj[newSub].sum;

					delete lastSubsidyObj[newSub];

					if( sub.newSum == sub.lastSum )
						continue;
				}
				else{
					sub.status = subStatus.start;
					sub.sum = newSubsidyObj[newSub].sum;
				}

				subsidyArr.push(sub);
			}

			for( var lastSub in lastSubsidyObj ){
				var sub = {};
				sub.status = subStatus.stop;
				sub.acc = wofh.world.getAccount(lastSub);
				sub.sum = lastSubsidyObj[lastSub].sum;

				subsidyArr.push(sub);
			}
		}}

		{{?subsidyArr.length}}
			<p><b>Дотации</b></p>
			
			<table class="s-tbl report-taxNew-info -subventions">
				<thead>
					<tr>
						<th class="aLi">Игрок</th>
						<th class="aRi">Статус</th>
						<th class="aRi">Дотация</th>
					</tr>
				</thead>
				<tbody class="aR">
					{{~subsidyArr: subsidy: index}}
						<tr class="trow{{=index%2}}">
							<td class="aL">
								{{=snip.accLink(subsidy.acc)}}
							</td>
							<td class="aR">
								{{?subsidy.status == subStatus.start }}
									Начато
								{{??subsidy.status == subStatus.stop}}
									Остановлено
								{{??}}
									Изменено
								{{?}}
							</td>
							<td class="aR">
								{{?subsidy.status == subStatus.start || subsidy.status == subStatus.stop}}
									{{=snip.res(Resource.ids.money)}}{{=utils.stages(~~subsidy.sum)}}
								{{??}}
									C  {{=snip.res(Resource.ids.money)}}{{=utils.stages(~~subsidy.lastSum)}}  на  {{=snip.res(Resource.ids.money)}}{{=utils.stages(~~subsidy.newSum)}}
								{{?}}
							</td>
						</tr>
					{{~}}
				</tbody>
			</table>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="report.sendRes">
	<div>
		{{=snip.townAccCountryLink(it.town2)}}<br>
		 доставил {{= snip.resBigList(new ResList(it.data.res)) }}<br>
		 в {{=snip.townAccCountryLink(it.town1)}}
	</div>
</script>

<script type="text/plain" id="report.tradeBarter">
	<p>
		{{=snip.townAccCountryLink(it.town2)}}
		 совершил сделку с 
		{{=snip.townAccCountryLink(it.town1)}}
	</p>
	<table>
		<tr>
			{{ var sell = new ResList(it.data.res2, true).getFirst(); }}
			{{ var buy = new ResList(it.data.res1, true).getFirst(); }}
			<td>Продал: </td>
			<td>{{=snip.resBigCount(sell)}}</td>
		</tr>
		<tr>
			<td>Купил: </td>
			<td>{{=snip.resBigCount(buy)}}</td>
		</tr>
	</table>
</script>

<script type="text/plain" id="report.tradeMoney">
	{{? it.data === null }}
		/*nohorse*/
		<p>
			В 
			{{=snip.townAccCountryLink(it.town1)}}
			 отсутствуют вьючные животные. Продажа товара невозможна.
		</p>
	{{??}}
		<p>
			{{?it.data.sell != 0}}
				{{
					var town1 = it.town1,
						town2 = it.town2;
				}}
			{{??}}
				{{
					var town1 = it.town2,
						town2 = it.town1;
				}}
			{{?}}
			{{=snip.townAccCountryLink(town1)}}
			 совершил сделку с 
			
			{{=snip.townAccCountryLink(town2)}}
		</p>
		<table>
			<tr>
				<td>{{? it.data.sell }}Продал: {{??}}Купил: {{?}}</td>
				<td><img class="res r{{= it.data.res == Resource.ids.science? Resource.ids.luck: it.data.res}}" src="https://test.waysofhistory.com/img/_.gif">{{= ~~it.data.count }}</td>
			</tr>
			<tr>
				<td>Цена: </td>
				<td>{{=snip.res(Resource.ids.money)}}{{= (it.data.cost / 1000).toFixed(3) }}</td>
			</tr>
			<tr>
				<td>Сумма: </td>
				<td>{{=snip.res(Resource.ids.money)}}{{= utils.toFixed(it.data.count * it.data.cost / 1000, 1) }}</td>
			</tr>
			{{? it.data.tax }}
				<tr>
					<td>Налог</td>
					<td>{{=snip.res(Resource.ids.money)}}{{= utils.toFixed(it.data.tax, 1) }}</td>
				</tr>
			{{?}}
		</table>
	{{?}}
</script>

<script type="text/plain" id="report.hunger">
	{{?it.isHungerSpecReason()}}
		{{=tmplMgr.report.hunger.specReason(it)}}
	{{??}}
		<p>Голод в {{=snip.townLink(it.town1)}}</p>
		<p>
			Погибли: 
			{{= snip.army(new Army(it.data.army)) }}
			
		</p>

		{{var resources = new ResList(it.data.resources);}}

		{{?resources.getLength()}}
			<p>
				Ресурсы добавлены: 
				{{=snip.resBigList(resources)}}
				
			</p>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="report.hunger.specReason">
	<p>Из-за несоблюдения техники безопасности при обращении с компонентами космического корабля в {{=snip.townLink(it.town1)}} были уничтожены:</p>
	<p>
		{{=snip.army(new Army(it.data.army))}}
	</p>
	<div class="m1000">
		Подробнее о сборке космического корабля написано в {{=snip.pediaLink('win', 'энциклопедии', {showIcon:true})}}.
	</div>
</script>

<script type="text/plain" id="report.spy">
	{{
		var armyAtt = new Army(it.data.army1);
		var armyDef = new Army(it.data.army2);
		var armyAttSurv = new Army(it.data.survived1);
		var armyAttDead = armyAtt.clone().diffList(armyAttSurv);
	}}
	
	<style>
		.report-spy-table td{
			padding: 5px 10px;
			text-align: left;
		}
	</style>
	<div style="padding: 0 10px;">
		<div class="report-battle -type-spy">
			<span class="report-battle-spy rb-title -nobr">
				 разведал 
			</span>
			<div class="rb-attacker">
				<div class="rb-header">
					<div class="imgSpy"></div>
					<div class="rb-header-info">
						{{?it.isShare(Report.accessIds.ha) }}
							Скрыто
						{{??}}
							<div>
								{{=snip.townLink(it.town1)}}
							</div>
							<div>
								{{=snip.accCountry(it.town1.account)}}
							</div>
						{{?}}
					</div>
				</div>
				<table class="report-spy-table" style="margin-left: 10px;">
					<tr>
						<td>Разведка:</td>
						<td>
							{{?it.isShare(Report.accessIds.haa)}}
								Скрыто
							{{??}}
								{{= snip.army(armyAtt) }}
							{{?}}
						</td>
					</tr>

					{{?!armyAttDead.isEmpty()}}
						<tr>
							<td>Выжившие:</td>
							<td>
								{{?it.isShare(Report.accessIds.haa) }}
									Скрыто
								{{??}}
									{{?armyAttSurv.getLength() == 0}}нет
									{{??}}{{= snip.army(armyAttSurv) }}
									{{?}}
								{{?}}
							</td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>Потери:</td>
							<td>
								{{?it.isShare(Report.accessIds.haa) }}
									Скрыто
								{{??}}
									{{?armyAttDead.getLength() == 0}}нет
									{{??}}{{= snip.army(armyAttDead) }}
									{{?}}
								{{?}}
							</td>
							<td></td>
							<td></td>
						</tr>
					{{?}}
				</table>
			</div>
			<div class="rb-defender">
				<div class="rb-header">
					<div class="rb-header-info">
						{{?it.isShare(Report.accessIds.hd)}}
							Скрыто
						{{??}}
							<div>
								{{=snip.townLink(it.town2, {townCls:it.town2.townowner?' -decorationThrough':''})}}
							</div>
							<div>
								{{=snip.accCountry(it.town2.townowner||it.town2.account, false, {accCls:it.town2.townowner && it.town2.townowner.isBarbarian()?' -decorationThrough':''})}}
							</div>
						{{?}}
					</div>
					<div class="imgDefence"></div>
				</div>
				{{?!armyDef.isEmpty()}}
					<table class="report-spy-table">
						<tr>
							<td>Контрразведка:</td>
							<td>
								{{?it.isShare(Report.accessIds.hda)}}
									Скрыто
								{{??}}
									{{= snip.army(armyDef) }}
								{{?}}
							</td>
						</tr>
					</table>
				{{?}}

				{{?it.data.wonderstop}}
					<p style="text-align: left; padding-left: 10px;">Строительство Чуда Света отложено на:  {{= Timer.numToTime(it.data.wonderstop) }}</p>
				{{?}}

				<p style="text-align: left; padding-left: 10px;">
					<b>Данные разведки:</b>
				</p>

				{{? it.data.data.level == 0 }}
					<p>Не удалось собрать данные</p>
				{{?? it.data.data.level == 2 }}
					<table class="report-spy-table">
						<tr>
							<td style="min-width: 110px;">Ресурсы города:</td>
							<td>
								{{= snip.resList(new ResList(it.data.data.res), undefined, true) }}
							</td>
						</tr>
						<tr>
							<td>Сейчас войска в городе:</td>
							<td>
								{{= snip.army(new Army(it.data.data.armythere)) }}
							</td>
						</tr>
						<tr>
							<td>Личная армия города:</td>
							<td>
								{{= snip.army(new Army(it.data.data.armyown)) }}
							</td>
						</tr>
						<tr>
							<td>Защитное сооружение:</td>
							<td>
								{{? it.data.data.defstruct[1] > 0 }}
									{{var slot = new Slot(it.data.data.defstruct[0], it.data.data.defstruct[1]);}}
									{{=snip.slotFrame(slot, snip.slotLevel(slot))}} {{=slot.getName()}}
								{{??}}
									Отсутствует
								{{?}}
							</td>
						</tr>
					</table>
				{{?}}
				{{? it.data.data.level >= 1 }}
					<p style="text-align: left; padding-left: 10px;">Снабжение:</p>
					<div style="text-align: left; padding-left: 10px; margin-bottom: 10px;">
						{{? it.data.data.streamlist }}
							{{~ it.data.data.streamlist : stream }}
								<div>
									<div class="panel2">
										{{? stream.in == 1 }}
											Из 
										{{??}}
											В 
										{{?}}
										{{=snip.townAccCountryLink(stream.town)}}
										{{=snip.resCount(stream.res, stream.count)}}  в час
									</div>
								</div>
							{{~}}
						{{??}}
							Отсутствуют
						{{?}}
					</div>
				{{?}}
			</div>
		</div>
	</div>
	
	{{=tmplMgr.report.access(it)}}
</script>

<script type="text/plain" id="report.stream">
	{{? it.data.type === 0 }}
		<p>
			Было принято предложение о поставке из 
			{{=snip.townLink(it.town1)}}
			 в 
			{{=snip.townLink(it.town2)}}
			
		</p>
		<div>
			<table class="mA">
				<tr>
					<td>Поставки:</td>
					<td>
						{{=snip.resCount(it.data.res, it.data.count)}}  в час
					</td>
				</tr>
				<tr>
					<td>Оплата:</td>
					<td>
						{{=snip.resCount(1, utils.toFixed((it.data.count * it.data.cost + it.data.traders * it.data.tcost) * 0.001, 1))}}
						 в час (цена
						{{=snip.resCount(1, (it.data.cost * 0.001).toFixed(3))}}
						)
					</td>
				</tr>
			</table>
		</div>
	{{?? it.data.type == 1 }}
		<p>
			{{=snip.townLink(it.town1)}}
			 начал снабжение в город {{=snip.townLink(it.town2)}}
		</p>
		<div>
			<table class="mA">
				<tr>
					<td></td>
					<td>
						{{=snip.resCount(it.data.res, it.data.count)}}  в час
					</td>
				</tr>
			</table>
		</div>
	{{??}}
		<p>
			Закончилось Снабжение из 
			{{=snip.townLink(it.town1)}}
			 в 
			{{=snip.townLink(it.town2)}}
			
		</p>
		<div>
			<table class="mA">
				<tr>
					<td class="aR p05">Поставки:</td>
					<td class="aL">
						{{=snip.resCount(it.data.res, it.data.count)}}  в час
					</td>
				</tr>
				<tr>
					<td class="aR p05">Оплата:</td>
					<td class="aL">
						{{=snip.resCount(1, utils.toFixed((it.data.count * it.data.cost + it.data.traders * it.data.tcost) * 0.001, 1))}}
						 в час (цена 
						{{=snip.resCount(1, (it.data.cost * 0.001).toFixed(3))}}
						)
					</td>
				</tr>
				<tr>
					<td class="aR p05">Причина:</td>
					<td class="aL">
						{{? it.data.type == 0 }}
							Отменено создание снабжения
						{{?? it.data.type == 1 }}
							Отменено создание снабжения
						{{?? it.data.type == 2 }}
							Отменено создание снабжения
						{{?? it.data.type == 3 }}
							Отменено
						{{?? it.data.type == 4 }}
							Город разрушен
						{{?? it.data.type == 5 }}
							Нет денег для оплаты
						{{?? it.data.type == 6 }}
							Нет ресурсов для поставок
						{{?? it.data.type == 7 }}
							Недостаточно торговцев
						{{?? it.data.type == 8 }}
							Длительное отсутствие игрока
						{{?? it.data.type == 9 }}
							Отменен торговый путь
						{{?? it.data.type == 10 }}
							Нет ресурса для ускорения
						{{?}}
					</td>
				</tr>
			</table>
		</div>
	{{?}}
</script>

<script type="text/plain" id="report.credit">
	
	{{? it.data.sum > 0 }}
		<p>
			Получен кредит на сумму: 
			<b>{{=snip.res(Resource.ids.money)}}{{= it.data.sum }}</b>
		</p>
	{{??}}
		<p>
			Cумма погашенной задолженности по кредиту: 
			<b>{{=snip.res(Resource.ids.money)}}{{= -it.data.sum }}</b>
		</p>
	{{?}}
	
</script>


<script type="text/plain" id="report.consumption">
	<p>
		В {{=snip.townLink(it.town1)}}
		 прервано потребление {{=snip.resName(it.data.res)}} 
	</p>
	<p>
		Причина: 
		{{? it.data.reason === 0 }}
			окончание ресурса на складе.
		{{?? it.data.reason == 1 }}
			уменьшение численности населения.
		{{?? it.data.reason == 2 }}
			отсутствие строения потребляющего древесину.
		{{?}}
	</p>
</script>

<script type="text/plain" id="report.topic">
	{{? it.isAnother}}
		Чужой отчет
	{{??}}
		{{ switch (it.type) { }}
			{{ case Report.type.science: }}
				Изучено: {{=snip.science(it.data.science)}}
				{{ break; }}

			{{ case Report.type.tax: }}
				Отчет казначейства
				{{ break; }}

			{{ case Report.type.battleFull: }}
				<span>
					{{=!it.isTown1Hid() ? snip.townAccCountryLink(it.town1) : snip.townHid()}} атакован
				</span>
				{{ break; }}
			{{ case Report.type.attackAir: }}
			{{ case Report.type.attackWater: }}
				<span>
					{{=!it.isTown2Hid() ? snip.townAccCountryLink(it.town2) : snip.townHid()}} атакован
				</span>
				{{ break; }}
			{{ case Report.type.battleShort: }}
				<span>
					Сражение при 
					{{=snip.townAccCountryLink(it.town1)}}
				</span>
				{{ break; }}
			{{ case Report.type.congrat: }}
				{{=snip.townLink(it.town1)}} поздравляет {{=snip.townLink(it.town2)}}
				{{ break; }}

			{{ case Report.type.sendRes: }}
				
				{{=snip.townAccCountryLink(it.town2)}}
				 доставил 
				{{ var resList = utils.parseResString(it.data.res); }}
				{{ for (var resId in resList) { }}
					<span class="resw">{{=snip.res(resId)}}{{= utils.formatNum(resList[resId], {stages:true}) }}</span>
				{{ } }}
				 в 
				{{=snip.townAccCountryLink(it.town1)}}
				{{ break; }}

			{{ case Report.type.tradeBarter: }}
				{{=snip.townAccCountryLink(it.town2)}}
				 совершил сделку с 
				{{=snip.townAccCountryLink(it.town1)}}
				{{ break; }}

			{{ case Report.type.tradeMoney: }}
				{{?it.data}}
					{{
						var acc1 = snip.townAccCountryLink(it.town1);
						var acc2 = snip.townAccCountryLink(it.town2);
						var res = snip.resBigCount(new Resource(it.data.res, it.data.count).sciToLuck());
					}}
					{{?it.data.sell != 0}}
						{{=acc1}} продал {{=res}} в {{=acc2}}
					{{??}}
						{{=acc2}} купил {{=res}} в {{=acc1}}
					{{?}}
				{{??}}
					{{=snip.townAccCountryLink(it.town1)}}
					 не имеет {{=snip.res(7)}}вьючных животных
				{{?}}
				{{ break; }}

			{{ case Report.type.streamOffer: }}
				Торговое предложение из {{=snip.townLink(it.town1)}}
				{{ break; }}

			{{ case Report.type.streamChangeCost: }}
				Изменена цена в снабжении из {{=snip.townLink(it.town1)}} в {{=snip.townLink(it.town2)}}
				{{ break; }}

			{{ case Report.type.stream: }}
				{{? it.data.type <= 1 }}
					Снабжение из {{=snip.townLink(it.town1)}}
					 в {{=snip.townLink(it.town2)}}
					 начато: {{=snip.resCount(it.data.res, it.data.count)}}
				{{??}}
					Снабжение из {{=snip.townLink(it.town1)}}
					 в {{=snip.townLink(it.town2)}}
					 закончено: {{=snip.resCount(it.data.res, it.data.count)}}
				{{?}}
				{{ break; }}
			{{ case Report.type.reinfDeath: }}
				Атаковано подкрепление в {{=snip.townLink(it.town1)}}
				{{ break; }}

			{{ case Report.type.hunger: }}
				{{?it.isHungerSpecReason()}}
					Уничтожены компоненты КК в 
				{{??}}
					Голод в 
				{{?}}
				<span>{{=snip.town(it.town1)}}</span>
				{{ break; }}

			{{ case Report.type.subsidy: }}
				Из казны страны перечислено {{=snip.resCount(Resource.ids.money, it.data.sum)}}
				{{ break; }}

			{{ case Report.type.revolution: }}
				Революция в стране
				{{ break; }}

			{{ case Report.type.createTown: }}
				{{?it.data.town.id}}
					Основан новый город
				{{??}}
					Новый город не был основан
				{{?}}
				{{ break; }}

			{{ case Report.type.getDeposit: }}
				{{? it.data.result > 0 }}
					Колонизировано месторождение
				{{??}}
					Месторождение не было колонизировано
				{{?}}
				{{ break; }}

			{{ case Report.type.credit: }}
				{{? it.data.sum >= 0 }}
					Получен кредит на сумму <img class="res r1" src="https://test.waysofhistory.com/img/_.gif">{{= it.data.sum }}
				{{??}}
					Возврат по кредиту в размере <img class="res r1" src="https://test.waysofhistory.com/img/_.gif">{{= -it.data.sum }}
				{{?}}
				{{ break; }}

			{{ case Report.type.depositMove: }}
				{{? it.data.sum > 0 }}
					На вклад внесена сумма в размере <img class="res r1" src="https://test.waysofhistory.com/img/_.gif">{{= utils.KMFloor(it.data.sum) }}
				{{??}}
					Со вклада снята сумма в размере <img class="res r1" src="https://test.waysofhistory.com/img/_.gif">{{= utils.KMFloor(-it.data.sum) }}
				{{?}}
				{{ break; }}

			{{ case Report.type.consumption: }}
				В {{=snip.townLink(it.town1)}} прервано потребление {{=snip.resName(it.data.res)}} 
				{{ break; }}

			{{ case Report.type.switchOff: }}
				Отключено строение «{{= (new Build(it.data.build)).getName() }}»
				{{ break; }}

			{{ case Report.type.sendMoney: }}
				{{=snip.acc(wofh.world.getAccount(it.data.from))}}
				 перечислил тебе <img class="res r1" src="https://test.waysofhistory.com/img/_.gif">{{= it.data.sum }}
				{{ break; }}

			{{ case Report.type.reinf: }}
				{{? it.data.operation == Report.reinfOperation.gone }}
					{{=snip.townLink(it.town1)}} прислал подкрепление в {{=snip.townLink(it.town2)}}
				{{?? it.data.operation == Report.reinfOperation.back }}
					{{=snip.townLink(it.town1)}} отозвал подкрепление из {{=snip.townLink(it.town2)}}
				{{?? it.data.operation == Report.reinfOperation.withdraw }}
					{{=snip.townLink(it.town1)}} выслал подкрепление {{=snip.townLink(it.town2)}}
				{{?}}
				{{ break; }}

			{{ case Report.type.worldStop: }}
				Остановка мира
				{{ break; }}

			{{ case Report.type.payment: }}
				{{?it.data.cancel}}
					Платеж за Монеты Удачи отменен
				{{??}}
					Платеж
				{{?}}
				{{ break; }}

			{{ case Report.type.luckMove: }}
				Перечисление Монет Удачи
				{{ break; }}

			{{ case Report.type.settle: }}
				Заселение
				{{ break; }}

			{{ case Report.type.bonusCode: }}
				Бонус-код
				{{ break; }}
				
			{{ case Report.type.noFuel: }}
				Прекращено использование ресурса для торговли
				{{ break; }}

			{{ case Report.type.spy: }}
				{{=!it.isTown1Hid() ? snip.townLink(it.town1) : snip.townHid()}}
				 разведал {{=!it.isTown2Hid() ? snip.townLink(it.town2) : snip.townHid()}}
				.
				{{ break; }}
			
			{{ case Report.type.countryJoin: }}
				Вступление в {{=snip.countryLink(it.data.country)}}
				{{ break; }}
			
			{{ case Report.type.countryLeave: }}
				{{?it.data.reason}}
					Тебя выгнали из 
				{{??}}
					Ты покинул страну 
				{{?}}
				{{=snip.countryLink(it.data.country)}}
				{{ break; }}
				
			{{ case Report.type.bonusEnded: }}
				Окончилось действие бонуса Удачи!
				{{ break; }}
			{{ case Report.type.infoReport: }}
				Инфо отчет. 
				{{?it.isAccReport}}
					Науки {{=snip.accCountry(it.owner)}}
				{{??}}
					{{=snip.townAccCountry(it.town)}}
				{{?}}
				{{ break; }}
			{{ default: }}
				Неизвестный отчет
				{{ break; }}
		{{ } }}
	{{?}}
	{{? it.deleted }} (удален){{?}}
</script>



<script type="text/plain" id="report.access">
	{{?it.owner.id == wofh.account.id || debug.isAdmin()}}
		<div class="report-info">
			<div class="ri-content">
				<form class="frm-share" method="post">
					{{=tmplMgr.report.access.cont(it)}}
				</form>
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="report.access.cont">
	<table class="ri-share">
		<colgroup>
			<col width="17%">
			<col width="17%">
			<col width="16%">
			<col width="50%">
		</colgroup>
		<tr>
			<td colspan="2">
				<label>
					{{=snip.checkbox1({name: 'open', checked: it.share && !it.isShare(Report.accessIds.open, true)})}}
					&nbsp;
					Открыть доступ к отчету
				</label>
			</td>
			<td rowspan="3" class="ri-share-submit">
				<button class="button1 -type-green">Применить</button>
			</td>
			<td rowspan="3">
				{{?it.share && !it.isShare(Report.accessIds.open, true) && !wofh.platform.noreportlink}}
					<div class="aL">
						<input class="share-url" type="text" readonly="readonly" value="{{=location.protocol}}//{{=lib.main.domain||document.location.host}}/report#{{= it.id }}{{?it.code }}-{{= it.code }}{{?}}"> {{=snip.hint('Используй этот адрес в тексте для ссылки на этот отчет')}}
					</div>
				{{?}}
				{{?it.data.logs}}
					<div class="aC">
						<a class="link js-report-battle-log">Открыть лог боя</a>
					</div>
				{{?}}
			</td>
		</tr>
		<tr>
			<td>
				<label>
					{{=snip.checkbox1({name: 'ha', checked: !it.share || !it.isShare(Report.accessIds.ha, true)})}}
					 Нападающие
				</label>
			</td>
			<td>
				<label>
					{{=snip.checkbox1({name: 'hd', checked: !it.share || !it.isShare(Report.accessIds.hd, true)})}}
					 Защищающиеся
				</label>
			</td>
		</tr>
		<tr>
			<td>
				<label>
					{{=snip.checkbox1({name: 'haa', checked: !it.share || !it.isShare(Report.accessIds.haa, true)})}}
					 Армия атаки
				</label>
			</td>
			<td>
				<label>
					{{=snip.checkbox1({name: 'hda', checked: !it.share || !it.isShare(Report.accessIds.hda, true)})}}
					 Армия защиты
				</label>
			</td>
		</tr>
	</table>
</script>

<script type="text/plain" id="report.battleLog">
	<div class="report-battle-log-wrp">
		{{@it.logs: log: index}}
			<div class="report-battle-log">{{=(+index + 1)}} <a class="link -use-visited" href="{{=appl.getOriginHost()+'/'+log}}" {{?wofh.platform.downloadInNewTab}}target="_blank"{{?}}>{{=log.replace(wReport.logsPath, '')}}</a></div>
		{{@}}
	</div>
</script>

<script type="text/plain" id="report.countryJoin">
	Вступление в {{=snip.countryLink(it.data.country)}}
	<br>
	Это знаменательное событие произошло 
	<br>
	<b>{{=timeMgr.fMomentDate(it.time)}} в {{=timeMgr.fMoment(it.time, true)}}</b>.
</script>

<script type="text/plain" id="report.countryLeave">
	{{?it.data.reason}}
		Глава {{=snip.countryLink(it.data.country)}} принял решение и выгнал тебя из страны.
		<br>
		Произошло это <b>{{=timeMgr.fMomentDate(it.time)}} в {{=timeMgr.fMoment(it.time, true)}}</b>.
		<br>
		Может стоит задуматься над причинами, приведшими к такой неоднозначной ситуации.
	{{??}}
		Ты покинул страну {{=snip.countryLink(it.data.country)}}
		<br>
		 в <b>{{=timeMgr.fMomentDate(it.time)}} {{=timeMgr.fMoment(it.time, true)}}</b>.
		<br>
		Хочется верить, что это было осознанное решение.
	{{?}}
</script>

<script type="text/plain" id="report.bonusEnded">	
	{{?it.data.isSubscription}}
		Это важно!
		<br>
		В этом мире действует особая система использования бонусов.
		<br>
		Ты не активировал свой помесячный Царь-бонус.
		<br>
		Более тебе такая возможность в этом мире никогда не будет доступна.
		
		{{?!wofh.account.isPremium()}}
			<br>
			Но ты можешь включить 
			<a class="link report-bonusEnded-repeat" data-town="{{=wofh.town.id}}" data-bonus="{{=it.data.bonus}}" href>Царь аккаунт</a>
			. Это хоть как-то подразвеет твои грусть и печаль.
		{{??}}
			{{return out;}}
		{{?}}
	{{?}}
	
	{{
		var bonuses = LuckBonus.getDefBonuses(it.data.bonus);
		var luckBonus = bonuses[it.data.bonus];
	}}
	
	{{?it.data.bonus == LuckBonus.ids.accountPremium}}
		{{
			var town = wofh.town;
			var allowRepeat = true;
		}}
	{{??}}
		{{
			var town = it.town1;
			var ownTown = wofh.towns[town.id];
			
			var allowRepeat = !!ownTown;
			
			town = ownTown||town;
			
			luckBonus.bonus.level = it.data.level;
			
			luckBonus.bonus.town = town;
			
			var text = luckBonus.bonus.isMomental() ? ['В городе ', ' у тебя появилась возможность активировать улучшение, которое даст тебе ', '% моментально'] : ['В городе ', ' у тебя закончилось улучшение, которое давало тебе ', '% на неделю'];
		}}
		
		{{?luckBonus.bonus.isMomental() && !luckBonus.bonus.canUpNow() && luckBonus.bonus.getConcurentBonus().canUpNow()}}
			{{var needUseConcurent = true;}}
		{{?}}
		
		{{=text[0]}}
		{{=snip.townLink(town)}}
		{{=text[1]}}
		{{=snip.luckBonusIcon(luckBonus.bonus.isMomental() ? luckBonus.bonus.getConcurentBonus() : luckBonus.bonus)}} {{=snip.coloredNum(luckBonus.bonus.getEffect(), {toPercent:true, servRound:true, round:true, sign:true})}}
		{{=text[2]}}
	{{?}}
	
	<div class="report-bonusEnded-repeat-block luckTambourine-rel">
		<div class="luckTambourine-circle -type-{{=utils.cnstName(LuckBonus.ids, it.data.bonus)}} {{?allowRepeat}}report-bonusEnded-repeat{{?}}" data-town="{{=town.id}}" data-bonus="{{=needUseConcurent?luckBonus.bonus.getConcurentBonus().id:it.data.bonus}}">
			<span class="luckTambourine-effect">
				{{?it.data.bonus == LuckBonus.ids.accountPremium}}
					<span class="luckTambourine-effect-main">{{=luckBonus.name0}}</span>
					{{=luckBonus.name1}}
				{{??}}
					{{=luckBonus.name}}
					<span class="luckTambourine-effect-main">
						{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
					</span>
				{{?}}
			</span>
			{{?allowRepeat}}
				<button class="button1 -type-gold report-bonusEnded-repeat-btn">{{?luckBonus.bonus.isMomental()}}Активировать{{??}}Возобновить{{?}}</button>
			{{?}}
		</div>
	</div>
	
	{{?needUseConcurent || it.data.level > 1}}
		{{=snip.nobr(snip.alert('')+'&nbsp;Это улучшение сейчас нельзя активировать для '+snip.townLink(it.town1)+'. Будет предложена схожая замена')}}
	{{?}}
	
	{{
		var usableBonuses = LuckBonus.getUsableBonuses();
		delete usableBonuses[it.data.bonus];
	}}
	
	{{?utils.sizeOf(usableBonuses) > 0 && !it.data.isSubscription}}
		<a href="{{=HashMgr.getHref('#/bonusTowns/'+it.data.bonus)}}" class="report-bonusEnded-getAll">
			<div class="report-bonusEnded-bonuses-block luckTambourine-rel">
				{{@bonuses: luckBonus: luckBonusId}}
					<div class="luckTambourine-circle -type-{{=utils.cnstName(LuckBonus.ids, luckBonusId)}}">
						<span class="luckTambourine-effect">
							{{?luckBonusId == LuckBonus.ids.accountPremium}}
								<span class="luckTambourine-effect-main">{{=luckBonus.name0}}</span>
								{{=luckBonus.name1}}
							{{??}}
								{{=luckBonus.name}}
								{{?luckBonus.bonus}}
									<span class="luckTambourine-effect-main">
										{{=utils.formatNum(luckBonus.bonus.getEffect(), {toPercent: true, servRound: true, round: true})}}%
									</span>
								{{?}}
							{{?}}
						</span>
					</div>
				{{@}}
			</div>

			<span class="shop-details-button report-bonusEnded-getAll-btn">
				{{?utils.sizeOf(wofh.towns) == 1}}
					Активируй<br>для<br>своего<br>города
				{{??}}
					Активируй<br>для<br>своих<br>городов
				{{?}}
			</span>
		</a>
	{{?}}
</script>

<script type="text/plain" id="report.infoReport">
	<div class="report-infoReport">
		{{?it.isAccReport}}
			{{=tmplMgr.report.infoReport.acc(it)}}
		{{??}}
			{{=tmplMgr.report.infoReport.town(it)}}
		{{?}}
		<br><br>
		
		<div class="report-info">
			<span class="report-infoReport-link">
				<input class="share-url aL" type="text" value="{{=location.protocol}}//{{=lib.main.domain||document.location.host}}/report#{{=it.id}}{{?it.code}}-{{=it.code}}{{?}}"> {{=snip.hint('Используй этот адрес в тексте для ссылки на этот отчет')}}
			</span>
		</div>
	</div>
</script>

<script type="text/plain" id="report.infoReport.text">
	{{?it.comment}}
		<div class="report-infoReport-block">{{=it.comment}}</div>
	{{?}}
</script>

<script type="text/plain" id="report.infoReport.acc">
	{{var account = it.account;}}
	
	{{=tmplMgr.report.infoReport.text({comment: account.comment})}}
	
	<div class="report-infoReport-block -type-sci-block">
		<div class="report-infoReport-sci-accInfo-block">
			<div class="report-infoReport-sci-accInfo -type-owner">
				{{=snip.accCountry(account)}}
			</div>
			<div class="report-infoReport-sci-accInfo -type-same -type-hidden">
				<label class="-warn -type-blue">
					{{=snip.checkbox1({cls: 'report-infoReport-sci-showSame', checked: true})}} Общие <span class="report-infoReport-sci-sameCount-wrp"></span>
				</label>
			</div>
			<div class="report-infoReport-sci-accInfo -type-self -type-hidden">
				{{?!wofh.account.noAcc}}
					{{=snip.accCountry(wofh.account)}}
				{{?}}
			</div>
		</div>
		<div class="report-infoReport-sciList-block">
			<div class="report-infoReport-sciFilter" data-type="owner" data-filter="7">
				{{=tmplMgr.report.infoReport.acc.science.filter({account: account})}}
			</div>
			<div class="report-infoReport-sciTbl-block -half">
				<table class="report-infoReport-sciTbl">
					<colgroup>
						{{=tmplMgr.report.infoReport.acc.cols(it)}}
					</colgroup>
					
					<tbody>
						{{@Science.getSortedListByCost():science:index}}
							<tr class="report-infoReport-sci-block {{?index > 20}}-notShow{{?}}">
								{{=tmplMgr.report.infoReport.acc.science({account:account, science:science, type:'owner'})}}
								
								<td class="report-infoReport-sciSep"></td>
								<td class="report-infoReport-sciSep -type-self"></td>
								
								{{?!wofh.account.noAcc}}
									{{=tmplMgr.report.infoReport.acc.science({account:wofh.account, science:science, type:'self'})}}
								{{?}}
							</tr>
						{{@}}
						{{?!wofh.account.noAcc}}
							<tr class="report-infoReport-sci-compFlasks-wrp fwB -hidden">
								<td class="report-infoReport-sci sci-compFlasks-acc aL"></td>
								<td class="report-infoReport-sci"></td>
								<td class="report-infoReport-sciSep"></td>
								<td class="report-infoReport-sciSep"></td>
								<td class="report-infoReport-sci"></td>
								<td class="report-infoReport-sci sci-compFlasks-my aL"></td>
							</tr>
						{{?}}
					</tbody>
				</table>
				{{?!wofh.account.noAcc}}
					<div class="report-infoReport-sci-compare-block">
						Ты можешь сравнить эти науки со своими и понять какие из них совпадают.
						<br><br>
						<button class="button1 report-infoReport-sci-compare">Сравнить</button>
					</div>
				{{?}}
			</div>
			{{?!wofh.account.noAcc}}
				<div class="report-infoReport-sciFilter -type-hidden" data-type="self" data-filter="7">
					{{=tmplMgr.report.infoReport.acc.science.filter({account: wofh.account})}}
				</div>
			{{?}}
		</div>
		
		<a class="link report-infoReport-sci-showAll">Показать все науки</a>
	</div>
</script>

<script type="text/plain" id="report.infoReport.acc.science">
	{{
		var known = it.account.science.state[it.science.getId()];
		var percent;
		var color = 'clr';
		
		if( known == Science.known.unavail ){
			color += '0';
		}
		else if( known == Science.known.avail ){
			color += '1';
		}
		else{
			color += '2';
		}
	}}
	
	{{?it.type == 'owner'}}
		<td class="report-infoReport-sci -type-{{=it.type}} {{=color}} aL" data-id="{{=it.science.getId()}}">
			<span class="report-infoReport-sci-highlight">
				{{=snip.scienceLink(it.science)}}
			</span>
		</td>
		<td class="report-infoReport-sci -type-{{=it.type}} {{=color}} aR" data-id="{{=it.science.getId()}}">
			{{?known == Science.known.unavail || known == Science.known.avail}}
				{{percent = (it.account.science.progress[it.science.getId()]||0) / it.science.getCost() * 100;}}
			{{??}}
				{{percent = 100;}}
			{{?}}
			<span>
				{{=utils.formatNum(percent, {int: true})}}%
			</span>
		</td>
	{{??}}
		<td class="report-infoReport-sci -type-{{=it.type}} {{=color}} aL" data-id="{{=it.science.getId()}}">
			{{?known == Science.known.unavail || known == Science.known.avail}}
				{{percent = (it.account.science.progress[it.science.getId()]||0) / it.science.getCost() * 100;}}
			{{??}}
				{{percent = 100;}}
			{{?}}
			<span>
				{{=utils.formatNum(percent, {int:true})}}%
			</span>
		</td>
		<td class="report-infoReport-sci -type-{{=it.type}} {{=color}} aL" data-id="{{=it.science.getId()}}">
			<span>
				{{=snip.scienceLink(it.science)}}
			</span>
		</td>
	{{?}}
</script>

<script type="text/plain" id="report.infoReport.acc.cols">
	<col width="30%">
	<col width="10%">
	
	<col width="10%">
	<col width="10%">
	
	<col width="10%">
	<col width="30%">
</script>

<script type="text/plain" id="report.infoReport.acc.science.filter">
	{{var count = {unavail:0,avail:0,done:0};}}
	{{@it.account.science.state.split(''): known}}
		{{?known == Science.known.unavail}}
			{{count.unavail++;}}
		{{??known == Science.known.avail}}
			{{count.avail++;}}
		{{??}}
			{{count.done++;}}
		{{?}}
	{{@}}
	
	<label class="clr2">		
		{{=snip.checkbox1({cls: 'report-infoReport-sci-filter', attrs: {'data-filter': 4}, checked: true})}} изученные {{=snip.nobr('('+count.done+')')}}
	</label>
	<br><br>
	<label class="clr1">
		{{=snip.checkbox1({cls: 'report-infoReport-sci-filter', attrs: {'data-filter': 2}, checked: true})}} к изучению {{=snip.nobr('('+count.avail+')')}}
	</label>
	<br><br>
	<label class="clr0">
		{{=snip.checkbox1({cls: 'report-infoReport-sci-filter', attrs: {'data-filter': 1}, checked: true})}} недоступные {{=snip.nobr('('+count.unavail+')')}}
	</label>
</script>

<script type="text/plain" id="report.infoReport.town">
	{{var town = it.town;}}
    
	{{=tmplMgr.report.infoReport.text({comment: town.comment})}}
	
	<div class="report-infoReport-block -type-town-block">
		<div class="report-infoReport-town -type-townImg">
			{{=snip.townImg({town:town, showDeposit:true})}}
            
            {{?!wofh.account.noAcc}}
                <div class="-town-hoverOptions">
                    {{?(wofh.account.isAdmin() && !town.account.getSpecial()) || (town.account.id == wofh.account.id)}}
                        <a class="-town-hoverOption mapButton -type-enter" href="{{=hashMgr.getTownHref(town, town.account)}}" data-title="Войти в город"></a>
                    {{?}}
                    <a class="-town-hoverOption mapButton -type-map js-onMap" 
                            href="{{=HashMgr.getHref('#map/o='+town.id+'&x=0&y=0')}}" 
                            data-title="Показать этот город на карте"></a>
                </div>
            {{?}}
		</div>

		<div class="report-infoReport-town">
			<div class="report-infoReport-town -type-townGrownCult">
				{{=snip.townLink(town, {lenLim:200})}}
				<br>
				{{?town.production}}
					{{var res = town.calcFeatureRes(town.production.list, true);}}

					{{?res}}
						{{=snip.resBig(res)}}
					{{??}}
						<span class="pop-indEmpty"></span>
					{{?}}
				{{?}}
				
				{{?town.pop.has}}
					&nbsp;
					{{=snip.pop(utils.toInt(town.pop.has))}}/{{=utils.stages(utils.toInt(town.pop.culture))}}
					&nbsp;
					{{=snip.title(snip.coloredNum(town.pop.incReal, {sign:true, fixed:1}), utils.escapeHtml(snip.nobr(snip.icon(snip.c.anyIcon, 'grow') + ' ' + snip.coloredNum(town.pop.inc * timeMgr.DtH, {sign:true, fixed:1}))))}}
				{{?}}
			</div>

			<div class="report-infoReport-town -type-townLocation">
				{{var climate = Tile.climate[town.climate];}}
				{{=climate.title}} — {{?town.hasRiver()}}Река{{??}}{{=Tile.terrain[town.getType().hill==3?1:0].title}}{{?}}
				<br>
				{{=snip.townSlots(town)}}
			</div>

			<div class="report-infoReport-town -type-townLocation">
				{{?town.wonder}}
					{{=snip.buildLink(town.wonder)}}
				{{?}}
				
				{{?town.deposit && !town.deposit.isEmpty()}}
					<br>
					{{=snip.depositLink(town.deposit)}}
				{{?}}
			</div>

			{{?town.consumption && town.consumption.getLength()}}
				<div class="report-infoReport-town -type-townCons" data-title="{{=utils.escapeHtml(tmplMgr.report.infoReport.consumption({consumption:town.consumption}))}}">
					<span class="economics-stats-hint">
						Текущее потребление: 
					</span>
					{{=snip.resList(town.consumption, {tmpl:snip.resBig})}}
				</div>
			{{?}}
		</div>
	</div>

	{{?town.getSlots()}}
		<div class="report-infoReport-block -type-builds-block">
			<ul class="report-infoReport-buildList">
				{{@town.getSlots().getList(): slot}}
					{{?slot.isWonder()}}
						{{continue;}}
					{{?}}
					
					{{slot = slot.dispPrepare();}}
					
					<li class="report-infoReport-buildItem {{?slot.id != Build.no}}js-tooltip{{?}}" data-tooltip-wnd="buildinfo" data-id="{{=slot.id}}">
						<a class="link" {{?!slot.isEmpty()}}href="{{=HashMgr.getHref('#/buildinfo/'+slot.id)}}{{?}}">
							{{=snip.slotFrame(slot, snip.slotLevel(slot, {ignoreBuildErr:true}), {noTitle:true, grey: slot.isOff(), disabled: slot.isOff(), showEmpty: true})}}
							<br>
							{{=snip.lenlim(slot.getName(), {lenLim:90})}}
						</a>
					</li>
				{{@}}
			</ul>
		</div>
	{{?}}

	{{?town.production}}
		<div class="report-infoReport-block -type-production-block">
			<span class="report-infoReport-title">
				Производство ресурсов и количество занятого этим населения
			</span>
			<div>
				<span class="report-infoReport-prod">
					<span class="economics-stats-hint" data-title="Эффективность труда зависит только от численности работающего населения">Эффективность:</span>
					 
					<span class="economics-stats-hint" data-title="{{=utils.formatNum(town.getWorkEfficiency(town.production.popwork), {toPercent:true, fixed:2})}}%">
						{{=utils.formatNum(town.getWorkEfficiency(town.production.popwork), {toPercent:true, int:true})}}%
					</span>
				</span>
				<span class="report-infoReport-prod">
					<span class="economics-stats-hint" data-title="Зависит от числа городов и суда">Коррупция:</span>
					 
					{{
						var corruption = utils.servRound(1 - town.production.corruption);
						var color = '-type-';
						
						if(corruption > 0.8){
							color += 'red';
						}
						else if(corruption > 0.5){
							color += 'brown';
						}
						else if(corruption > 0.01){
							color += 'green';
						}
						else{
							color += 'blue';
						}
					}}
				
					<span class="economics-stats-hint -warn {{=color}}" data-title="{{=utils.escapeHtml(snip.wrp('-warn '+color, utils.formatNum(corruption, {toPercent:true, fixed:2})+'%'))}}">
						{{=utils.formatNum(corruption, {toPercent:true, int:true})}}%
					</span>
				</span>
				<span class="report-infoReport-prod"> Работает: {{=utils.formatNum(town.production.popwork, {int:true})}}</span>
				{{?town.pop.has}}
					<span class="report-infoReport-prod">Безработных: {{=utils.formatNum(town.pop.has - town.production.popwork, {int:true})}}</span>
				{{?}}
				
				{{?town.mapbonus.getLength()}}
					<span class="report-infoReport-prod">
						{{=snip.title('УМ:', 'Улучшения местности', 'economics-stats-hint')}}
						 
						{{@town.mapbonus.getList(): mapImp}}
							{{var format ={fixed:1, toPercent:mapImp.isEffectGetTypePercent()};}}
							
							{{=snip.nobr(snip.mapImpEffectIcon(mapImp) + utils.formatNum(mapImp.level, format) + (format.toPercent?'%':'') + '&nbsp;')}}
						{{@}}
					</span>
				{{?}}
				
			</div>
			{{?town.production.list.getLength()}}
				<table class="s-tbl s-tbl-report-infoReport-prod">
					<tbody>
						<tr>
							{{@town.production.list.getList(): res}}
								<td>{{=snip.resCount(res, utils.formatNum(res.getCount(), {int: true, stages: true}), {filter:''})}}</td>
							{{@}}
						</tr>
					</tbody>
				</table>
			{{??}}
				<div class="report-infoReport-noProd">В городе ничего не производится</div>
			{{?}}
		</div>
	{{?}}

	{{?town.garrison}}
		<div class="report-infoReport-block -type-garrison-block">
			<span class="report-infoReport-title">
				Гарнизон
			</span>
			<div class="report-infoReport-army">
				{{=snip.army(new Army(town.garrison))}}
			</div>
		</div>
	{{?}}

	{{?town.armyAll}}
		<div class="report-infoReport-block -type-army-block">
			<span class="report-infoReport-title">
				Армия города
			</span>
			<div class="report-infoReport-army">
				{{=snip.army(new Army(town.armyAll))}}
			</div>
		</div>
	{{?}}

	{{?town.attacks}}
		<div class="report-infoReport-block -type-attacks-block">
			<span class="report-infoReport-title">
				Атаки на город
			</span>

			<div class="report-infoReport-attacks">
				{{@town.attacks:attack}}
					<div class="report-infoReport-attack-block">
						<div class="report-infoReport-attack -type-town">
							<img class='atkin{{=attack.type}}' src='https://test.waysofhistory.com/img/_.gif' data-title="Нападение врага">
							<span class="trow_ar_s -lenLim">
								{{=snip.townAccUnder(wofh.world.getTown(attack.town), wofh.world.getAccountByTown(attack.town), wofh.world.getCountryByTown(attack.town))}}
							</span>
						</div>
						<div class="report-infoReport-attack t_cw_sep_l">
							{{=snip.timer(attack.time, 'dec')}}
						</div>
						<div class="report-infoReport-attack t_cw_sep_l">
							{{=timeMgr.fMoment(attack.time)}}
						</div>
						<div class="report-infoReport-attack t_cw_sep_l">
							{{=snip.icon(snip.c.anyIcon, 'speed', false, utils.formatNum(attack.speed, {servRound:true, int:true}))}}
						</div>
					</div>
				{{@}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="report.infoReport.consumption">
	{{@it.consumption.getList():res}}
		<div>
			{{=snip.resBigCount(res, utils.formatNum(res.getCount(), {servRound:true, int:true}))}}
		</div>
	{{@}}
</script><script type="text/plain" id="reports.header">
    Отчеты
</script>

<script type="text/plain" id="reports">
    <div class="view-reports">
		<div class="reports-view-wrp"></div>
		
		<div class="wnd-footer -hidden">
			<div class="reports-options">
				<label class="reports-select-all-wrp">
					{{=snip.checkbox1({cls: 'reports-select-all'})}}Отметить все
				</label>
			
				<a class="reports-read-all link">Пометить все как «прочитанные»</a>
			</div>
			
			<div class="cB"></div>
			
			<button class="button1 reports-del-selected">Удалить выбранные</button>
			  
			<a class="reports-del-all button1 -type-red link">Удалить все</a>
		</div>
    </div>
</script>

<script type="text/plain" id="reports.view">
	<div class="reports-filter-wrp">
		{{=tmplMgr.reports.filter(it)}}
	</div>
	
	{{?it.reportsList}}
		<div class="list-page-nav-wrp">
			<a class="page-nav-prev js-show-prev {{?it.prev !== undefined}}-active{{?}}" data-prev="{{=it.prev}}" data-title="Назад"></a>
			<a class="page-nav-next js-show-next {{?it.next !== undefined}}-active{{?}}" data-next="{{=it.next}}" data-title="Вперед"></a>
			
			<form class="reports-form">
				<table class="s-tbl tbl-reports">
					<colgroup>
						<col class="tbl-col-0">
						<col class="tbl-col-1">
						<col class="tbl-col-2">
						<col class="tbl-col-3">
					</colgroup>
					
					<tbody>
						{{~it.reportsList:report:id}}
							<tr class="row{{? id % 2 == 1 }}1{{??}}0{{?}}" data-id="{{= report.id }}">
								<td>
									{{=snip.checkbox1({name: report.id, attrs: {'data-arch': utils.toInt(report.archived)} })}}
								</td>
								<td class='aL report-link'>
									<a class="reports-report-topic {{?report.read === 0}}-type-unread{{?}} dB" href="{{=hashMgr.getWndHref('report', report.getIdCode())}}" data-id="{{=report.getId()}}">
										{{=tmplMgr.reports.topic(report) }}
									</a>
								</td>
								<td>
									<a href="{{=hashMgr.getWndHref('report', report.getIdCode())}}">
										{{~wReports.getIcons(report):icon}}
											{{?icon instanceof Object}}
												{{=icon.icon}}
											{{??}}
												<img class="event e{{= icon }}" src="https://test.waysofhistory.com/img/_.gif">
											{{?}}
										{{~}}
									</a>
								</td>
								<td>
									<a href="{{=hashMgr.getWndHref('report', report.getIdCode())}}">
										{{=timeMgr.fMoment(report.time)}}
									</a>
								</td>
							</tr>
						{{~}}
					</tbody>
				</table>
			</form>
		</div>
	{{??}}
		<div class='tB noreport' style='height:308px;text-align:center;'>
			Грусть и тоска терзают сердце.<br>Сверкают глаза, полные слез одиночества.<br>Нет отчетов.
		</div>
	{{?}}
</script>

<script type="text/plain" id="reports.filter">
	{{?it.filtersHide}}
		{{return out;}}
	{{?}}
	
    <form class="reports-filters" id="reports-filter" name="name" method="post">
    	<div class="reports-filterCell">
        	<a class="filterButton -type-all" id="types-select-all" data-title='Показать все/Спрятать все'></a>
			{{=snip.checkbox1({name: 'all', checked: false, disabled: true})}}
        </div>
		<div class="reports-filterCell">
			<a class="filterButton -type-arch reports-filter-arch" data-title='Архивированные отчеты'></a>
			{{=snip.checkbox1({name: 'arch', checked: it.filterArch})}}
		</div>
        {{?utils.sizeOf(wofh.towns) > 1}}
	    	<div class="reports-filterCell">
	            <div class="filterButton -type-town" data-title='Исключить отчеты других городов'>
	                <label for="lab1"><span class="dlink"></span></label>
	            </div>
				{{=snip.checkbox1({id: 'lab1', name: 'f8', checked: utils.toInt(it.filters[8])})}}
	        </div>
        {{?}}

        
    	<div class="reports-filterCell">
	        <a class="filterButton -type-scienc js-show-type" data-type="0" data-title='Научные отчеты'></a>
			{{=snip.checkbox1({name: 'f0', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[0])})}}
        </div>
		
    	<div class="reports-filterCell">
	        <a class="filterButton -type-war js-show-type" data-type="1" data-title='Военные отчеты'></a>
			{{=snip.checkbox1({name: 'f1', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[1])})}}
        </div>

    	<div class="reports-filterCell">
	        <a class="filterButton -type-rein js-show-type" data-type="2" data-title='Отчеты о подкреплениях'></a>
			{{=snip.checkbox1({name: 'f2', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[2])})}}
        </div>

    	<div class="reports-filterCell">
	        <a class="filterButton -type-trade js-show-type" data-type="3" data-title='Торговые отчеты'></a>
	        {{=snip.checkbox1({name: 'f3', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[3])})}}
        </div>

    	<div class="reports-filterCell">
	        <a class="filterButton -type-prov js-show-type" data-type="4" data-title='Отчеты о снабжении'></a>
	        {{=snip.checkbox1({name: 'f4', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[4])})}}
        </div>

    	<div class="reports-filterCell">
	        <a class="filterButton -type-eco js-show-type" data-type="5" data-title='Экономические отчеты'></a>
	        {{=snip.checkbox1({name: 'f5', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[5])})}}
        </div>

		<div class="reports-filterCell">
	        <a class="filterButton -type-hungry js-show-type" data-type="7" data-title='Отчеты о голоде и небоевых утратах'></a>
	        {{=snip.checkbox1({name: 'f7', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[7])})}}
        </div>

    	<div class="reports-filterCell">
	        <a class="filterButton -type-dip js-show-type" data-type="6" data-title='Общего характера'></a>
			{{=snip.checkbox1({name: 'f6', cls: 'reports-filter-cb', checked: utils.toInt(it.filters[6])})}}
        </div>
		
        <input class="reports-filterBtn" type="submit" value="Фильтр" name="button">
    </form>
</script>


<script type="text/plain" id="reports.topic">
	{{? it.isAnother}}
		Чужой отчет
	{{??}}
		{{ switch (it.type) { }}
			{{ case Report.type.science: }}
				Изучено: {{=snip.science(it.data.science)}}
				{{ break; }}

			{{ case Report.type.tax: }}
				Отчет казначейства
				{{ break; }}

			{{ case Report.type.battleFull: }}
				<span>
					{{=snip.townAcc(it.town1)}} атакован
				</span>
				{{ break; }}
			{{ case Report.type.attackAir: }}
			{{ case Report.type.attackWater: }}
				<span>
					{{=snip.townAcc(it.town2)}} атакован
				</span>
				{{ break; }}

			{{ case Report.type.battleShort: }}
				<span>
					Сражение при {{=snip.townAcc(it.town1)}}
				</span>
				{{ break; }}

			{{ case Report.type.congrat: }}
				<span>
					{{=snip.town(it.town1)}}
				</span>
				 поздравляет 
				<span>
					{{=snip.town(it.town2)}}
				</span>
				{{ break; }}

			{{ case Report.type.sendRes: }}
				{{=snip.town(it.town2)}}
				 доставил 
				{{ var resList = utils.parseResString(it.data.res); }}
				{{ for (var resId in resList) { }}
					<span class="resw">{{=snip.res(resId)}}{{= utils.formatNum(resList[resId], {stages:true}) }}</span>
				{{ } }}
				 в 
				{{=snip.town(it.town1)}}
				{{ break; }}

			{{ case Report.type.tradeBarter: }}
				{{=snip.town(it.town2)}}
				 совершил сделку с 
				{{=snip.town(it.town1)}}
				{{ break; }}

			{{ case Report.type.tradeMoney: }}
				{{?it.data}}
					{{
						var acc1 = snip.town(it.town1);
						var acc2 = snip.town(it.town2);
						var res = snip.resCount(new Resource(it.data.res, it.data.count).sciToLuck());
					}}
					{{?it.data.sell != 0}}
						{{=acc1}} продал {{=res}} в {{=acc2}}
					{{??}}
						{{=acc2}} купил {{=res}} в {{=acc1}}
					{{?}}
				{{??}}
					{{=snip.town(it.town1)}}
					 не имеет {{=snip.res(7)}}вьючных животных
				{{?}}
				{{ break; }}

			{{ case Report.type.streamOffer: }}
				Торговое предложение из 
				<span>
					{{=snip.townAcc(it.town1)}}
				</span>
				{{ break; }}

			{{ case Report.type.streamChangeCost: }}
				Изменена цена в снабжении из 
				<span>
					{{=snip.town(it.town1)}}
				</span>
				 в 
				<span>
					{{=snip.town(it.town2)}}
				</span>
				
				{{ break; }}

			{{ case Report.type.stream: }}
				{{? it.data.type <= 1 }}
					Снабжение из <span>{{=snip.town(it.town1)}}</span>
					 в <span>{{=snip.town(it.town2)}}</span>
					 начато: {{=snip.resCount(it.data.res, it.data.count)}}
				{{??}}
					Снабжение из <span>{{=snip.town(it.town1)}}</span>
					 в <span>{{=snip.town(it.town2)}}</span>
					 закончено: {{=snip.resCount(it.data.res, it.data.count)}}
				{{?}}
				{{ break; }}

			{{ case Report.type.reinfDeath: }}
				Атаковано подкрепление в {{=snip.town(it.town1)}}
				{{ break; }}
				
			{{ case Report.type.hunger: }}
				{{?it.isHungerSpecReason()}}
					Уничтожены компоненты КК в 
				{{??}}
					Голод в 
				{{?}}
				<span>{{=snip.town(it.town1)}}</span>
				{{ break; }}
				
			{{ case Report.type.subsidy: }}
				Из казны страны перечислено {{=snip.resCount(Resource.ids.money, it.data.sum)}}
				{{ break; }}

			{{ case Report.type.revolution: }}
				Революция в стране
				{{ break; }}

			{{ case Report.type.createTown: }}
				{{?it.data.town.id}}
					Основан новый город
				{{??}}
					Новый город не был основан
				{{?}}
				{{ break; }}

			{{ case Report.type.getDeposit: }}
				{{? it.data.result > 0 }}
					Колонизировано месторождение
				{{??}}
					Месторождение не было колонизировано
				{{?}}
				{{ break; }}

			{{ case Report.type.credit: }}
				{{? it.data.sum >= 0 }}
					Получен кредит на сумму {{=snip.resCount(Resource.ids.money, it.data.sum)}}
				{{??}}
					Возврат по кредиту в размере {{=snip.resCount(Resource.ids.money, -it.data.sum)}}
				{{?}}
				{{ break; }}
				
			{{ case Report.type.depositMove: }}
				{{? it.data.sum > 0 }}
					На вклад внесена сумма в размере {{=snip.nobr(snip.res(Resource.ids.money) + utils.KMFloor(it.data.sum))}}
				{{??}}
					Со вклада снята сумма в размере {{=snip.nobr(snip.res(Resource.ids.money) + utils.KMFloor(-it.data.sum))}}
				{{?}}
				{{ break; }}

			{{ case Report.type.consumption: }}
				В {{=snip.town(it.town1)}} прервано потребление {{=snip.resName(it.data.res)}} 
				{{ break; }}

			{{ case Report.type.switchOff: }}
				Отключено строение «{{= (new Build(it.data.build)).getName() }}»
				{{ break; }}

			{{ case Report.type.sendMoney: }}
				{{=snip.acc(wofh.world.getAccount(it.data.from))}}
				 перечислил тебе {{=snip.resCount(Resource.ids.money, it.data.sum)}}
				{{ break; }}

			{{ case Report.type.reinf: }}
				<span>{{=snip.town(it.town1)}}</span>
				{{? it.data.operation == Report.reinfOperation.gone }}
					 прислал подкрепление в 
				{{?? it.data.operation == Report.reinfOperation.back }}
					 отозвал подкрепление из 
				{{?? it.data.operation == Report.reinfOperation.withdraw }}
					 выслал подкрепление 
				{{?}}
				<span>{{=snip.town(it.town2)}}</span>
				{{ break; }}

			{{ case Report.type.worldStop: }}
				Остановка мира
				{{ break; }}

			{{ case Report.type.payment: }}
				{{?it.data.cancel}}
					Платеж за Монеты Удачи отменен
				{{??}}
					Платеж
				{{?}}
				{{ break; }}

			{{ case Report.type.luckMove: }}
				Перечисление Монет Удачи
				{{ break; }}

			{{ case Report.type.settle: }}
				Заселение
				{{ break; }}

			{{ case Report.type.bonusCode: }}
				Бонус-код
				{{ break; }}
				
			{{ case Report.type.noFuel: }}
				Прекращено использование ресурса для торговли
				{{ break; }}

			{{ case Report.type.spy: }}
				
					{{=snip.town(it.town1)}}
				 разведал 
					{{=snip.town(it.town2)}}
				.
				{{ break; }}
			
			{{ case Report.type.countryJoin: }}
				Вступление в {{=snip.country(it.data.country)}}
				{{ break; }}
			{{ case Report.type.countryLeave: }}
				{{?it.data.reason}}
					Тебя выгнали из 
				{{??}}
					Ты покинул страну 
				{{?}}
				{{=snip.country(it.data.country)}}
				{{ break; }}
			{{ case Report.type.bonusEnded: }}
				Окончилось действие бонуса Удачи!
				{{ break; }}
			{{ case Report.type.infoReport: }}
				Инфо отчет. 
				{{?it.isAccReport}}
					Науки {{=snip.accCountry(it.owner, false, {noAccLink:true, link:false})}}
				{{??}}
					{{=snip.townAccCountry(it.town, false, false, {flag:'micro'})}}
				{{?}}
				{{ break; }}
			
			{{ default: }}
				Неизвестный отчет
				{{ break; }}
		{{ } }}
	{{?}}
	{{? it.deleted }} (удален){{?}}
</script><script type="text/plain" id="science.header">
	Науки и технологии
</script>

<script type="text/plain" id="science">
	<div class="view-science">
		<div class="science-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="science.view">
	<div class="PANEL-panel -type-panel">
		{{=snip.wndPanel()}}
		
		<div class="view-incom-wrp"></div>
	</div>
	
	<div class="view-columns-wrp"></div>
</script>

<script type="text/plain" id="science.view.incom">
	<div class="science-bar">
		<table class="science-bar-table tbl-scienceInfo" cellpadding="0" cellspacing="0">
			<tbody>
				<tr>
					<td class="science-bar-block">
						{{=snip.accLink(wofh.account)}}:
						{{=snip.res(Resource.ids.science)}}
						<span data-title="Знания, передаваемые всеми твоими городами, с учетом научного распределения в час">
							{{=utils.formatNum(wofh.account.calcScienceInc(), {mixed:true, uFixed:1})}}
						</span>
						{{var bonus = wofh.town.getLuckBonus(LuckBonus.ids.science);}}
						{{?wBonusTakeNow.canShow(bonus)}}
							&nbsp;<a class="science-addBonus link">(+ еще {{=(bonus.getTypedEffectUp().count/24/7).toFixed(1)}})</a>
						{{?}}
					</td>
					{{?wofh.country}}
						<td class="science-bar-block">
							<div class="science-bar-divider"></div>

							{{=snip.countryLink(wofh.country)}}:
							{{=snip.res(Resource.ids.science)}}
							<span data-title="Знания, передаваемые всеми городами твоей страны, с учетом научного распределения в час">
								{{var inc = Science.getScienceData(true).incReal;}}

								{{=snip.wrp(inc == 0 ? '-warn' : '', utils.formatNum(inc, {mixed:true, fixed:1}))}}
							</span>
						</td>
					{{?}}
					<td class="science-bar-block science-barSpec-block">
						<div class="science-bar-divider"></div>

						{{=tmplMgr.science.specialistStack(it)}}
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</script>	

<script type="text/plain" id="science.specialistStack">
	<table class="science-bar-table tbl-scienceSpec" cellpadding="0" cellspacing="0">
		<tbody>
			<tr>
				{{@it.specialists:specialist:id}}
					{{?utils.toInt(specialist.num * Specialist.inverseBase)}}
						<td>
							{{=snip.nobr('<span class="js-tooltip" data-tooltip-wnd="specialist" data-id="'+id+'" data-prob="'+specialist.prob+'" data-num="'+specialist.num+'">' + snip.icon(snip.c.specialistIcon, Specialist.types[id]) + '<span class="-specialistText lenLim">' + utils.formatNum(specialist.num * Specialist.inverseBase, {int: true, stages: true}) + '</span></span>', false, 'specialistCount-block')}}
						</td>
					{{?}}
				{{@}}
			</tr>
		</tbody>
	</table>
</script>

<script type="text/plain" id="science.view.columns">
	<div class="science-columns">
		{{it.col = it.col1;}}
		{{=tmplMgr.science.column(it)}}
		{{it.col = it.col2;}}
		{{=tmplMgr.science.column(it)}}
		{{
			it.col = it.col3;
			it.col.last = true;
		}}
		{{=tmplMgr.science.column(it)}}
		<svg height="600" width="600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="science-links"></svg>
	</div>
</script>

<script type="text/plain" id="science.column">
	<div class="science-col {{?it.col.last}}science-lastCol{{?}}">
		{{@it.col.sort().getList(): science}}
			{{var active = it.studying.getLength() && it.studying.getElemByPos(0).id == science.id;}}
			{{var inQueue = it.studying.hasElem(science);}}
			{{var selected = science.id == it.curScience;}}
			{{var inSelList = it.selected.hasElem(science);}}
			<div class="science-sci {{?active}}-active bgDark{{?}} {{?!active && inQueue}}-inQueue -size-3{{?}} {{?!active && inSelList}}-selected{{?}}" data-id="{{=science.id}}">
				<div class="science-sci-top"></div>
				<div class="science-sci-center"></div>
				<div class="science-sci-bottom"></div>

				<div class="science-sci-back {{?active}}-active{{?}}" {{?active}}style="background: url(https://test.waysofhistory.com/img/help/sciences/{{=science.id}}.png);"{{?}}></div>

				<div class="js-tooltip" data-tooltip-wnd="scienceinfo" data-id="{{=science.id}}">
					{{?active}}
						<div class="science-sci-coverActive"></div>
					{{?}}
					<div class="science-sci-cover">
						<div class="science-sci-top"></div>
						<div class="science-sci-center"></div>
						<div class="science-sci-bottom"></div>				
					</div>

					<div class="science-sci-icons">
						{{=snip.scienceIcons(science, {builds: true, units: true})}}
					</div>
					<div class="science-sci-name">
						{{?inSelList || active|| inQueue || it.mode == 0}}
							{{=snip.scienceLink(science, {lenLim: 150})}}
						{{??}}
							{{=snip.science(science, {lenLim: 150})}}
						{{?}}
					</div>

					{{?inQueue}}
						{{var pos = +it.studying.getElemPos(science) + 1;}}
						<div class="science-sci-posWrp">
							<div class="science-sci-pos">{{=pos}}</div>
						</div>
					{{?}}
					
					{{?science.isDebt()}}
						<div class="science-sci-progVal">
							{{=snip.res(Resource.ids.science)}}
							{{=utils.stages(science.getCost())}}
						</div>
					{{??}}
						{{var prog = science.getProgressPerc(true);}}

						<div class="science-sci-progScale">
							{{
								var x = prog/100;
								var l = 0.35;/*линия перелома*/
								var gV = 9/16;/*точка перелома по g*/
								var r = ~~(255 * Math.min(1, (1 - x) / (1 - l)));
								var g = ~~(255 * (x < l? x * gV / l: (x - 1) * (gV - 1) / (l - 1) + 1));
							}}
							<div class="science-sci-progScale-val" style="width: {{=prog}}%; background-color: rgba({{=r}}, {{=g}}, 0, 1);"></div>
						</div>

						<div class="science-sci-progPerc">
							<span class="science-sci-progPerc-val">{{=prog}}</span>%
						</div>
						<div class="science-sci-progVal">
							{{=snip.res(Resource.ids.science)}}
							{{=utils.formatNum(science.getProgress(true), {floor: true, stages: true})}}
							<span class="science-sci-progVal-cost"> / {{=utils.stages(science.getCost())}}</span>
						</div>
					{{?}}
					
					{{?active}}
						<div class="science-sci-status">сейчас изучается</div>
					{{?}}
					<div class="science-sci-time">
						{{var scienceTimeLeft = science.getTimeLeft(true, it.studying.getFirst(), true) * 3600;}}
						
						{{?scienceTimeLeft}}
							{{=snip.timer(scienceTimeLeft + timeMgr.getNow(), 'dec', timeMgr.fPeriod(scienceTimeLeft))}}
							 
							{{=snip.hint('Без учета предстоящих событий', {cls:'science-sci-timeHint'})}}
						{{??}}
							∞
						{{?}}
					</div>
				</div>
				
				{{?it.mode && selected}}
					<div class="science-sci-selectWrp">
						{{?it.canChange}}
							{{?inQueue}}
								<a class="button6 -type-red science-sci-select" data-title="Перестать изучать эту науку">
									<span class="iconButton6 -type-close">
								</a>
							{{??it.canToggle}}
								<a class="button6 -type-green science-sci-select" data-title="Изучать эту науку">
									<span class="iconButton6 -type-plus">
								</a>
							{{??}}
								<a class="button6 -type-green science-sci-select -disabled" data-title="Нельзя добавить науку для изучения потому, что очередь заполнена">
									<span class="iconButton6 -type-plus">
								</a>
							{{?}}
						{{??it.canCancel && inQueue && !science.isDebt()}}
							<a class="button6 -type-red science-sci-select" data-title="Перестать изучать эту науку">
								<span class="iconButton6 -type-close">
							</a>
						{{?}}
					</div>
				{{?}}
			</div>
		{{@}}
	</div>
</script>
<script type="text/plain" id="send.header">
	Транспортировка ресурсов
</script>

<script type="text/plain" id="send">
	<div class="view-send">
		<div class="send-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="send.view">
	<div class="send-traders-wrp">
		<div class="send-traders">
			{{=snip.trader()}} 
			<span class="js-send-traders" data-title="Торговцы: Загружены сейчас / Свободно / Всего"></span>
		</div>
		
		<div class="send-traders-capacity">
			<span data-title="Вместимость торговцев города: Загружено сейчас / Свободно / Всего">Вместимость торговцев города: <span class="js-send-traders-capacity"></span></span>
		</div>
	</div>
	<form class="js-send-form">
		<div class="send-towns-wrp">
			{{?it.defTown}}
				<div class="send-towns">
					{{?it.towns.length > 1}}
						<span class="send-townsImg js-send-townsImg">{{=snip.townIconLink(it.defTown)}}</span>
						<select name="town" class="send-towns-select js-send-towns-townSelect">
							{{@it.towns: town: pos}}
								<option value="{{=pos}}" {{?!town.avail}}disabled="disabled"{{?}} {{?pos==0}}selected="selected"{{?}}>{{=town.name}}</option>
							{{@}}
						</select>
					{{??}}
						{{=snip.townLink(it.defTown, undefined, it.defTown.account, wofh.country)}}
						<input type="hidden" class="js-send-towns-townSelect" value="0">
					{{?}}
				</div>
				<div class="send-towns-account js-send-towns-account">
					{{?it.defTown.avail}}
						{{=snip.accCountry(it.defTown.account, wofh.account.isPremium() ? it.defTown.account.country : undefined, {flag: 'normal'})}}
					{{?}}
				</div>
				<br>
				<span class="js-send-towns-path">
					{{?it.defTown.avail}}
						{{=tmplMgr.send.townPath({path:it.defTown.path, dist:it.defTown.dist, noPath:it.defTown.noPath, hasAirWay:it.defTown.hasAirWay})}}
					{{??it.defTown.id}}
						{{=snip.alert('Невозможно осуществить транспортировку в этот город')}}<span class="clr0">Невозможно осуществить транспортировку в этот город</span>
					{{?}}
				</span>
			{{??}}
				<span class="clr0" style="padding: 5px; background-color: white;">У тебя нет ни одного города, куда можно отсюда осуществить доставку</span>
			{{?}}
		</div>
		{{?it.defResList}}
			<div class="send-defResList-block">
				{{?it.order}}
					Ресурсы в заказе: 
				{{?}}
				<span class="send-defResList-wrp"><span>
			</div>
		{{?}}
		{{?wofh.account.isPremium()}}
			<div class="send-loadOptions-wrp">
				<label data-title="Возможность загружать товар партиями">
					{{=snip.checkbox1({cls: 'send-loadOption js-send-load-party', checked: it.loadOptions.party})}} Погрузка партиями
				</label>
				 
				<label data-title="Товар будет ограничен объемом кратным грузоподьемности одного торговца">
					{{=snip.checkbox1({cls: 'send-loadOption js-send-load-trade', checked: it.loadOptions.traders})}} Полная загрузка
				</label>
			</div>
		{{?}}
		<div class="send-res-wrp">
			{{@it.resGroups: resGroup}}
				<div class="send-resGroup">
					{{@resGroup.getList(): res}}
						{{=tmplMgr.send.res({res:res, loadOptions: it.loadOptions})}}
					{{@}}
				</div>
			{{@}}
		</div>
		<div class="send-sending-wrp"></div>
		<div class="send-conditions-wrp">
			<div class="send-conditions-speedUp-wrp js-send-conditions-speedUp-wrp -hidden">
				<div class="-nobr">
					{{=snip.icon(snip.c.anyIcon, 'fuel')}}
					<span class="send-conditions-speedUp js-send-conditions-speedUp">
						{{=tmplMgr.send.speedUp({})}}
					</span>
					&nbsp;
					<span class="send-conditions-speedUpStockAlert js-send-conditions-speedUpStockAlert"></span>
				</div>
				<label class="send-conditions-speedUpAir-wrp">
					{{var checkboxOpt = {name: 'useairway'};}}
					{{?it.defTown && it.defTown.onlyAirWay}}
						{{
							checkboxOpt.checked = true;
							checkboxOpt.disabled = true;
						}}
					{{?}}
					{{=snip.checkbox1(checkboxOpt)}} Доставка воздухом
				</label>
				
				<br>
				<span class="js-send-conditions-speedUpCons send-conditions-speedUpCons" data-title="Ресурсы которые будут затрачены на ускорение транспортировки"></span>
			</div>
			<div class="send-conditions-time-wrp">
				<span class="send-conditions-time -hidden" data-title="Время необходимое для доставки груза"></span>
			</div>
			<div class="send-conditions-reset {{?!it.defResList}}-hidden{{?}} js-send-reset"><span class="fakelink">Сбросить</span></div>
			<div class="send-conditions-send">
				<button class="button1 -type-green -disabled js-send-button">Отправить</button>
			</div>
		</div>
	</form>
</script>

<script type="text/plain" id="send.townPath">
	<span data-title="Расстояние">
		{{=snip.ruler()}}&nbsp;
		<span class="distAir {{?it.noPath}}-noPath{{?}}">{{=Trade.roundDistance(it.dist)}}</span>&nbsp;
	</span>
	(
	<span class="distLand {{?it.noPath}}-noPath{{?}}" data-title="Путь по суше">{{=it.path.land ? Trade.roundDistance(it.path.land) : '-'}}</span>
	&nbsp;/&nbsp;
	<span class="distWater {{?it.noPath}}-noPath{{?}}" data-title="Глубоководный путь">{{=it.path.deepwater ? Trade.roundDistance(it.path.deepwater) : '-'}}</span>
	{{?it.path.water}}
		&nbsp/&nbsp;
		<span class="distWater {{?it.noPath}}-noPath{{?}}" data-title="Путь по мелководью">{{=Trade.roundDistance(it.path.water)}}</span>
	{{?}}
	)
	{{?it.noPath}}
		&nbsp
		<span class="clr0">Нет возможности проложить путь до этого города</span>
	{{?}}
</script>

<script type="text/plain" id="send.res">
	<div class="send-res {{?!utils.toInt(it.res.getCount()) || it.res.hidden}}-hidden{{?}} {{?it.res.hidden}}js-hidden{{?}} js-send-res" data-id="{{=it.res.getId()}}" tabindex="-1">
		<div class="send-res-block">
			<span class="send-res-icon">{{=snip.resBig(it.res)}}</span>
			<input type="tel" class="send-res-input input1 spinbox js-send-res-input" name="{{=it.res.getId()}}" data-type="{{=it.res.getType()}}" data-id="{{=it.res.getId()}}" data-limit="{{=it.res.limit||''}}" data-limitwas="{{=it.res.limitWas||''}}" data-fixlimit="{{=it.res.fixlimit||''}}" value="{{=it.res.defCount||''}}" autocomplete="off"> 
			<span class="send-res-maxLoad-wrp">(<a class="send-res-maxLoad js-maxLoad" tabindex="1" data-title="Добавить максимум" data-id="{{=it.res.getId()}}" data-upd="{{=wSend.checkStockResUpd(it.res.getId())}}">{{=utils.toInt(it.res.getCount())}}</a>)</span>
		</div>
		<div class="send-res-slider-wrp js-send-res-slider-wrp">
			<div class="send-res-slider js-send-res-slider">
				<div class="slider"></div>
			</div>
		</div>
		{{?wofh.account.isPremium()}}
			<div class="send-res-parties-wrp js-send-res-parties-wrp" {{?it.loadOptions.party}}style="display:block;"{{?}}>
				<div class="send-res-parties-dec">
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="-1" data-title="Убавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 1*lib.trade.capacity))}}">-1</a>
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="-5" data-title="Убавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 5*lib.trade.capacity))}}">-5</a>
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="-10" data-title="Убавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 10*lib.trade.capacity))}}">-10</a>
				</div>
				<div class="send-res-parties-inc">
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="1" data-title="Добавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 1*lib.trade.capacity))}}">+1</a>
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="5" data-title="Добавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 5*lib.trade.capacity))}}">+5</a>
					<a class="send-res-party js-send-res-party" tabindex="1" data-count="10" data-title="Добавить {{=utils.escapeHtml(snip.resCount(it.res.getId(), 10*lib.trade.capacity))}}">+10</a>
				</div>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="send.speedUp">
	<select name="speedUp" class="send-conditions-speedUpSelect js-send-conditions-speedUpSelect">
		{{?it.speedUp}}
			<option value="" pathtype="{{?it.speedUp.minEffectPathWayType}}{{=it.speedUp.minEffectPathWayType}}{{??}}{{=it.selectedPath.wayType}}{{?}}">Ничего</option>

			{{@it.speedUp.list: fuel}}
				<option value="{{=fuel.getId()}}" pathtype="{{=fuel.speedUpInfo.path.wayType}}" {{?fuel.speedUpInfo.selected}}selected="selected"{{?}} {{?!fuel.speedUpInfo.stockCount}}disabled="disabled"{{?}}>{{=fuel.getName()}}</option>
			{{@}}

		{{??}}
			<option value="">Ничего</option>
		{{?}}
	</select>
</script>

<script type="text/plain" id="send.confirm">
	<div>
		<div class="send-confirm-title">Транспортировка</div>
		<div class="send-confirm-subTitle">Цель и стоимость доставки:</div>
		<div>{{=snip.townAccLink(it.sendInfo.town)}}</div>
		<div class="send-confirm-params">
			<div>{{=snip.trader(it.curCapacity.busyTraders)}}</div>
			<div class="send-confirm-timer">
				{{=snip.time(timeMgr.fPeriod(it.sendInfo.selectedPath.time) + (wofh.account.isPremium() ? ' в ' + snip.timer(it.sendInfo.selectedPath.time, 'inc') : '') )}}
			</div>
			{{?it.sendInfo.transportCons}}
				<div>{{=snip.resBigCount(it.sendInfo.transportCons)}}</div>
			{{?}}
		</div>
		<div class="send-confirm-subTitle">Отправить ресурсы:</div>
		<div class="send-confirm-params">
			{{@it.sendInfo.resList.getList(): res}}
				<div>{{=snip.resBigCount(res)}}</div>
			{{@}}
		</div>
	</div>
</script>

<script type="text/plain" id="send.tradersInfo">
	<span class="{{?it.available < it.busy}}clr0{{?}}">{{=it.busy}}</span>&nbsp;/&nbsp;<span class="">{{=Math.max(0, it.available - it.busy)}}</span>&nbsp;/&nbsp;<span>{{=it.all}}</span>
</script>

<script type="text/plain" id="send.capacityAlert">
	<div class="send-res-capacityAlert js-send-res-capacityAlert">
		{{=snip.alert('Не хватит текущей вместимости свободных торговцев')}}
	</div>
</script><script type="text/plain" id="sendArmy.header">
	{{?it.commander}}
		{{?it.act == wSendArmy.act.atk}}Военная операция по атаке
		{{??}}Военная операция по защите
		{{?}}
	{{??}}
		{{=snip.townLink(wofh.town, {lenLim: 350})}} — Отправка войск
	{{?}}
</script>

<script type="text/plain" id="sendArmy">
    <div class="view-sendArmy">
		<div class="sendArmy-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="sendArmy.view">
    <div>
		{{?!it.commander && Account.hasAbility(Science.ability.tactics) && !it.targetOwnTown && (!it.target || !it.target.account.isBarbarian()) && (it.target || utils.sizeOf(wofh.towns) > 1) }}
			<div class="tabs tabs-wrp">
				<a class="tabs-btn js-tabLink -active" data-tab="oneattack">Одиночная отправка</a>
				<a class="tabs-btn js-tabLink" data-tab="massattack">Военная операция</a>
			</div>
		{{?}}
		
		<div class="panel-status">
			<table class="tbl-sendArmy-status">
				<tr>
					<td class="aL">
						{{var bonus = it.town.getWarBonus()-1;}}
						
						<span data-title="{{=utils.formatNum(bonus, {toPercent:true, fixed:2})}}%">
							Военный бонус:  {{=utils.formatNum(bonus, {toPercent:true, int:true, servRound:true})}}%
						</span>
					</td>
					{{?it.commander}}
						<td>
							Отправка войск из 
							<select name="town" class="sendArmy-changeTown select1">
								{{@wofh.towns: town}}
									<option value="{{=town.id}}" {{?it.town.id  == town.id}}selected{{?}}>{{=town.name}}</option>
								{{@}}
							</select>
						</td>
					{{?}}
					<td class="aR">
						<label>
							{{=snip.checkbox1({name: 'close', cls: 'js-autoClose', checked: ls.getSendArmyAutoClose(true)})}}Автозакрытие
						</label>
					</td>
				</tr>
			</table>
		</div>
		
		<form class="tabs-cont js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100, 200)}}px;">
			<div class="block1">
				<div class="sendArmy-army block1-cont"></div>
			</div>
			
			<div class="sendarmy_back">
				<div class="send_cont">
					{{?it.commander}}
						<div class='send_head'>Командующий</div>
						<div class="send_info" style="background: url(https://test.waysofhistory.com/img/gui/trash/e0/pagecont0.png) 50% 0!important; margin: 0 8px; color: black">
							{{?it.commander.account}}
								{{=snip.accCountry(wofh.world.getAccount(it.commander.account), wofh.world.getCountryByAccount(it.commander.account), {noBrackets:true, flag:'normal'})}}
							{{??}}
								{{=snip.countryLink(wofh.world.getCountry(it.commander.country))}}
							{{?}}
						</div>
					{{?}}
					<div class='send_head'>Цель</div>
					<div class="send_info" style ="background: url(https://test.waysofhistory.com/img/gui/trash/e0/pagecont0.png) 50% 0!important; margin: 0 8px; color: black">
						<table style="text-align:left; margin: 0 auto;">
							<tbody>
								{{?it.target}}
									<tr>
										<td class="aR" style="padding-right:5px;">{{=snip.townIcon()}}</td>
										<td>{{=snip.townLink(it.target, {noIcon: true})}}</td>
									</tr>
									{{?it.target.account}}
										<tr>
											<td class="aR" style="padding-right:5px;">{{=snip.accIcon(it.target.account)}}</td>
											<td>{{=snip.accCountry(it.target.account, it.target.country, {noIcon: true, noBrackets:true, flag:'normal'})}}</td>
										</tr>
									{{?}}
								{{??}}
									<tr>
										<td></td>
										<td>
											<select class="select1" name="target">
												<option selected disabled="disabled"></option>
												{{@it.towns: town}}
													<option value="{{=town.id}}" class="{{?town.id == it.town.id}}js-own-town -hidden{{?}}">{{=town.name}}</option>
												{{@}}
											</select>
										</td>
									<tr>
								{{?}}
                                
								<tr class="sendarmy_water_wrp">
									<td class="aR" style="padding-right:5px;">
										{{=snip.checkbox1({name: 'water', id: 'to_sheeps'})}}
									</td>
                                    
									<td><label for="to_sheeps"> Посадить армию на корабли</label></td>
								</tr>

								<tr class="sendArmy-transport -type-hidden">
									<td class="aR" style="padding-right:5px;"><img src="https://test.waysofhistory.com/img/_.gif" style="display: inline-block;height: 14px;width: 13px;background: url(https://test.waysofhistory.com/img/gui/icons/sendarmy-a.png) -0 0;" data-title="Погрузиться " /></td>
                                    
									<td><select class="sendArmy-ports select1" id="sendarmy_transp_in" name="it"></select></td>
								</tr>
								
								<tr class="sendArmy-transport -type-hidden">
									<td class="aR" style="padding-right:5px;">
										<img src="https://test.waysofhistory.com/img/_.gif" style="display: inline-block;height: 14px;width: 13px;background: url(https://test.waysofhistory.com/img/gui/icons/sendarmy-a.png) -37px 0;" data-title="Погрузиться ">
									</td>
                                    
									<td>
										<label class="crP">
											{{=snip.radio1({cls: 'js-sendarmy-shipping', name: 'sendarmy-shipping', value: Army.shipping.speed})}}
											&nbsp;По скорости</span>
										</label>
										&nbsp;
										<label class="crP">
											{{=snip.radio1({cls: 'js-sendarmy-shipping', name: 'sendarmy-shipping', value: Army.shipping.size})}}
											&nbsp;По размеру</span>
										</label>
									</td>
								</tr>

								<tr>
									<td class="aR" style="padding-right:5px;"><img src="https://test.waysofhistory.com/img/_.gif" style="display: inline-block;height: 6px;width: 13px;background: url(https://test.waysofhistory.com/img/gui/icons/icons_tgwetc-a-5.png) -31px -41px;" data-title="Дистанция (путь) " /></td>
									<td id="sendarmy_dist">-</td>
								</tr>
								<tr class="sendarmy_period_wrp">
									<td class="aR" style="padding-right:5px;">{{=snip.time(false, 'Время в пути ')}}</td>
									<td>
										<span id="sendarmy_time">-</span>
										<span class="unloading-alert -hidden"> {{=snip.alert()}} Высадка вне порта +{{=timeMgr.fPeriod(lib.war.landingtime)}}</span>
									</td>
								</tr>
								<tr>
									<td class="aR" style="padding-right:5px;"><img src="https://test.waysofhistory.com/img/_.gif" style="display: inline-block;height: 14px;width: 9px;background: url(https://test.waysofhistory.com/img/gui/icons/sendarmy-a.png) -28px 0;" data-title="Прибытие " /></td> 
									<td class="sendArmy-timer">
										{{?it.commander}}
											{{=snip.input1({value: timeMgr.fMoment(it.commander.time), disabled: true})}}
										{{??}}
											{{=snip.input1({type: 'tel', cls: 'arrive-timer -timer-stopped js-timer -hidden', attrs: {'data-time': '', 'data-timertype': 'inc'}, autocomplete: 'off'})}}
											{{=snip.input1({type: 'tel', cls: 'arrive-mask -hidden', autocomplete: 'off'})}}
											<span class="arrive-error">-</span>
										{{?}}
									</td>
								</tr>
							</tbody>
						</table>
					</div>

				</div>
			</div>

			<div class="sendArmy-act">
				{{?it.commander}}
					<input class="but_def fL -disabled" type="button" data-act="{{=wSendArmy.act.def}}" value="Подкрепление" data-title="Отправить войска в подкрепление. Главное помнить, что там на них могут напасть враги."/>
					<input class="but_atk fR -disabled" type="button" data-act="{{=wSendArmy.act.atk}}" value="Атака" data-title="Отправить войска в атаку. Главное помнить, что в бою они могут погибнуть... насмерть... совсем... и, что самое интересное, обратно они тогда не вернутся."/>
                    
					<div class="sendarmy-mass-alert"></div>
				{{??}}
					<input class="js-sendarmy-act but_def fL" type="button" data-act="{{=wSendArmy.act.def}}" value="Подкрепление" data-title="Отправить войска в подкрепление. Главное помнить, что там на них могут напасть враги."/>
					<input class="js-sendarmy-act but_atk fR" type="button" data-act="{{=wSendArmy.act.atk}}" value="Атака" data-title="Отправить войска в атаку. Главное помнить, что в бою они могут погибнуть... насмерть... совсем... и, что самое интересное, обратно они тогда не вернутся."/>
					<input class="js-sendarmy-act but_spy fR -hidden" style="" type="button" data-act="{{=wSendArmy.act.atk}}" value="Разведка" data-title="Разведка">

					<div class="sendarmy-alert"></div>
				{{?}}

				<div id="sendarmy_sbm" class="-hidden cB">
					<div class="sendarmy-alert-wrp"></div>
					<button class="button1 js-sendarmy-send-one">Отправить войска</button>
					<button class="button1 js-sendarmy-send-all -hidden -disabled">Объявить военную операцию</button>
					<br>
					<br>
				</div>
				<div class="cB"></div>
			</div>
		</form>
	</div>
</script>

<script type="text/plain" id="sendArmy.ports">
	<option value=""></option>
    
    {{~it.ports: port: pos}}
        {{?!port.dis}}
            <option value="{{=port.id}}" {{?it.ports.length == 1}}selected{{?}}>{{=port.name}} ({{=port.account.name}})</option>
        {{?}}
    {{~}}
    
</script>

<script type="text/plain" id="sendArmy.units">
    {{var disabled, hasActivePeaceUnits = false;}}
    
    {{@it.army.getList(): unit}}
		{{
            disabled = wSendArmy.isUnitDisabled(unit, it);
            
            hasActivePeaceUnits = hasActivePeaceUnits||(!disabled && unit.hasAbility(Unit.ability.no_attack));
        }}
        
        <span class="nobr sendArmy-units" data-id="{{=unit.id}}">
            {{=snip.unitIconLink(unit, {grey: disabled})}}
			
			{{=snip.input1({cls: 'spinbox', name: 'u'+unit.getId(), value: it.armySel.getCount(unit.getId()), attrs: {'data-id': unit.getId()}, disabled: disabled, autocomplete: 'off'})}}
			
            <span class="sendArmy-unit-maxWrp {{?disabled}}-disabled{{?}}"></span>
        </span>
    {{@}}
    
	{{?it.army.getLength() > 1}}
		<div class="sendarmy-select-block">
			{{var type = it.army.calcType(), defAddfilter;}}
            
			{{?!(type & Army.types.mix)}}
				{{?!(type & Army.types.peace) || it.army.clone().getBattleUnits().getLength()}}
					<label class="sendarmy-select -type-groupSelect" data-filter="{{=type}}">
                        {{=snip.checkbox1({cls: 'filter-all', wrpCls: '-hidden'})}}
                        
						<span class="filterButton -type-all" data-title="Выбрать всех"></span>
					</label>
				{{??}}
					{{defAddfilter = type;}}
				{{?}}
			{{??}}
				{{?type & Army.types.land}}
					<label class="sendarmy-select -type-groupSelect" data-filter="{{=Army.types.land}}">
						{{=snip.radio1({cls: 'filter-units', checked: it.filter & Army.types.land})}}
						&nbsp;
						<span class="filterButton -type-war" data-title="Только сухопутные"></span>
					</label>
				{{?}}
				{{?type & Army.types.water}}
					<label class="sendarmy-select -type-groupSelect" data-filter="{{=Army.types.water}}">
						{{=snip.radio1({cls: 'filter-units', checked: it.filter & Army.types.water})}}
						&nbsp;
						<span class="filterButton -type-fleet" data-title="Только флот"></span>
					</label>
				{{?}}
				{{?type & Army.types.air}}
					<label class="sendarmy-select -type-groupSelect" data-filter="{{=Army.types.air}}">
						{{=snip.radio1({cls: 'filter-units', checked: it.filter & Army.types.air})}}
						&nbsp;
						<span class="filterButton -type-air" data-title="Только авиация"></span>
					</label>
				{{?}}
			{{?}}

			{{?type & Army.types.peace}}
                {{
                    disabled = it.act == wSendArmy.act.atk || !hasActivePeaceUnits;
                }}
				<label class="sendarmy-select -type-addSelect {{?disabled}}-type-disabled{{?}}" data-filter="{{=defAddfilter||it.filter||Army.types.none}}" data-addfilter="{{=Army.types.peace}}">
					{{=snip.checkbox1({cls: 'filter-units', disabled: disabled, checked: !disabled && utils.inArray(it.addfilter, Army.types.peace)})}}
					&nbsp;
					<span class="filterButton -type-peace" data-title="Миротворцы"></span>
				</label>
			{{?}}

			{{?it.commander}}
				<label class="sendarmy-select -type-addSelect" data-filter="{{=it.filter}}" data-addfilter="inTime">
					{{=snip.checkbox1({cls: 'filter-units', checked: utils.inArray(it.addfilter, 'inTime')})}}
					&nbsp;
					{{=snip.time(false, 'Выбрать всех, кто успевает')}}
				</label>
			{{?}}
		</div>
		
		{{
			var canLowWater = type & Army.types.lowwater;
			var canHighWater = type & Army.types.highwater && it.town.hasCoast();
		}}
		
		<div class="sendarmy-select-block {{?!(it.filter & Army.types.water) || !canLowWater || !canHighWater}}-hidden{{?}}">
			{{?canLowWater}}
				<label class="sendarmy-select -type-subSelect" data-filter="{{=Army.types.water}}" data-subfilter="{{=Army.types.lowwater}}">
					{{=snip.checkbox1({cls: 'filter-units', checked: !it.subfilter || utils.inArray(it.subfilter, Army.types.lowwater)})}}
					&nbsp;
					<span>Мелководные</span>
				</label>
			{{?}}
            
			{{?canHighWater}}
				<label class="sendarmy-select -type-subSelect" data-filter="{{=Army.types.water}}" data-subfilter="{{=Army.types.highwater}}">
					{{=snip.checkbox1({cls: 'filter-units', checked: !it.subfilter || utils.inArray(it.subfilter, Army.types.highwater)})}}
					&nbsp;
					<span>Глубоководные</span>
				</label>
			{{?}}
		</div>
	{{??}}
		<div class="sendarmy-select-block"></div>
	{{?}}
</script>


<script type="text/plain" id="sendArmy.unitMax">
    <a class="link crP js-get-all-units {{?it.alertMin}}clr0{{??it.alertMax}}clr3{{?}}" data-id="{{=it.unit.getId()}}">
        {{=it.unit.getCount()}}
        {{?it.alertMin}}
        	{{=snip.alert('Скорость этой единицы не позволяет всей армии вовремя подойти к началу Военной операции')}}
        {{?}}
    </a>
</script>

<script type="text/plain" id="sendArmy.enterCode">
	{{?it.defToEnemy}}
		Ты хочешь отправить подкрепление во вражеский город?
	{{??}}
		Ты хочешь напасть на дружественный город?
	{{?}}
	<br>
    Для подтверждения введи число <b>{{=utils.prepZero(it.rand, 4)}}</b><br>
    {{?it.abort}}<b class="-warn">Неправильно введён код!</b><br>{{?}}
	{{=snip.input1({cls: '-disabled', maxlength: 4})}}
</script>

<script type="text/plain" id="sendArmy.commanderCreateMsg">
    <div class="view-comcreate">
		<p><b>Ссылка для участия</b></p>
		<p>Ты можешь использовать этот тег для того, чтобы создать ссылку на эту <span class="-nobr">{{=snip.eventIconArmy(it.act, 'operation', 0)}}Военную Операцию</span>. Например, ты можешь использовать его в переписке с теми кто будет участвовать в этой операции. Перейдя по ней любой желающий сможет присоединиться к твоей военной операции.</p>
		
		<div>{{=tmplMgr.snipet.clipboard({tag: 'g' + it.id + '/' + it.key})}}</div>
		{{?it.act == wSendArmy.act.tch}}
			<div>{{=tmplMgr.snipet.clipboard({tag: 'g' + it.id2 + '/' + it.key2})}}</div>
		{{?}}
        <div class="m1000">
			{{?it.act != wSendArmy.act.tch && !(it.act == wSendArmy.act.atk && it.target == wofh.town.id)}}
				<a class="button1 sendarmy-comcreate-send -type-green">Отправить войска</a> 
            {{?}}
			<a class="button1 sendarmy-comcreate-close">Перейти в военные дела</a>
        </div>
    </div>
</script>

<script type="text/plain" id="sendArmy.updArmy">
    <div class="sendArmy-updArmy clr0">
		Внимание гарнизон этого города изменился! <a class="link js-updArmy">Обновить данные?</a>
    </div>
</script>

<script type="text/plain" id="sendArmy.timeCorrect">
	<div>
		В {{=snip.townLink(it.target)}}  будут происходить
		<br>
		другие военные действия.
		<br>
		Поэтому твои войска прибудут
		<br>
		<br>
		<b>с задержкой <span class="clr1">{{=timeMgr.fPeriod(it.settime-it.arrivetime)}}</span></b>
		<br>
		<br>
		в <b>{{=timeMgr.fMoment(it.settime)}}</b>
		<br>
		<br>
	</div>
</script>

<script type="text/plain" id="sendArmy.chooseTime">
	<div class="sendarmy-chooseTime">
		<div class="sendarmy-chooseTimeText">
			В {{=snip.townLink(it.target)}} будут происходить
			<br>
			другие военные действия.
			<br>
			Поэтому твои войска не смогут прибыть к цели
			<br>
			в <b>{{=timeMgr.fMoment(it.arrivetime)}}</b>.
			<br>
			<br>
			Выбери какое время подходит больше.
		</div>
		
		<div class="sendarmy-times">
			{{?it.times.length > 1}}
				<span class="sendarmy-time-choose">или</span>
			{{?}}
			{{@it.times:time}}
				<button class="button1 -type-green js-newTime" data-time="{{=time}}">
					{{?time < it.arrivetime}}
						<span class="sendarmy-time-dir">Раньше,</span>
						в 
					{{??}}
						<span class="sendarmy-time-dir">Позже,</span>
						в 
					{{?}}
					{{=timeMgr.fMoment(time)}}
				</button>
			{{@}}
		</div>
		
		<br>
	</div>
</script><script type="text/plain" id="setSpec.header">
	Великий гражданин
</script>

<script type="text/plain" id="setSpec">
	<form class="view-setSpec js-setSpecialist">
		<div class="sld-carousel-block">
			<div class="sld-carousel -type-spec">
				<div class="sld-carousel-list">
					{{@wofh.account.getSpecialists().getSortList('id', true).getList(): specialist: index}}
						<div class="sld-carousel-item -type-spec {{?specialist.getId() == it.specialist.getId()}}-type-selected{{?}}" data-index="{{=index}}" data-id="{{=specialist.getId()}}">
							{{=snip.specialist({specialist:specialist, noTitle:true, noCount:true})}}
						</div>
					{{@}}
				</div>

				<div class="sld-carousel-arrow-block">
					<div class="sld-carousel-arrow -type-left -type-spec"></div>
					<div class="sld-carousel-arrow -type-right -type-spec"></div>
				</div>

				<input type="hidden" name="spec" value="{{=it.specialist.getId()}}">
			</div>
		</div>
		
		<div class="setSpec-info js-setSpec-info">
			{{=tmplMgr.setSpec.info({specialist:it.specialist})}}
		</div>
		
		<div class="setSpec-block">
			Выбери город, в который ты хочешь его поселить навсегда.
		</div>

		<div class="setSpec-block">
			<select class="setSpec-select select1" name="town">
				{{@wofh.towns: town}}
					<option value="{{=town.id}}" {{?it.town.id == town.id}}selected="selected"{{?}}>{{=town.name}}</option>
				{{@}}
			</select>
			<div class="setSpec-block setSpec-effect">
				{{=tmplMgr.setSpec.effect({specialist:it.specialist, town:it.town})}}
			</div>
			<br>
			<br>
			<button class="button1 -type-green">Поселить в городе</button>
			<br>
			<br>
		</div>
	</form>
</script>

<script type="text/plain" id="setSpec.info">
	{{=it.specialist.getDescription()}}
</script>

<script type="text/plain" id="setSpec.effect">
	{{
		var townSpecialist = it.town.getSpecialists().getElem(it.specialist.getId());
		var townSpecialistUp = townSpecialist.getUp();
	}}
	<div>
		<span class="-nobr">
			<span class="dIB vaM">{{=snip.specialistEffectIcon(it.specialist)}}</span> 
			{{=utils.formatNum((townSpecialistUp.getEffect()-1)-(townSpecialist.getEffect()-1), {uFixed:2, sign: true, toPercent:true, servRound:true})}}%
		</span>
		  
		<span class="-nobr">
			{{=snip.specialistTooltip(townSpecialist, snip.icon(snip.c.specialistIcon, townSpecialist.getType(), false, false, 'vaM'))}} 
			
			{{=snip.coloredNum(townSpecialist.getCount(), {int: true, stages:true, noSignColor:true})}}
			
			<b>{{=utils.formatNum(it.specialist.getCount(), {int: true, sign:true})}}</b>
		</span>
	</div>
	
	{{?it.specialist.getId() == Specialist.ids.culture || it.specialist.getId() == Specialist.ids.grown}}
		{{
			var effectDiff = 1 + (townSpecialistUp.getEffect() - townSpecialist.getEffect());
			var count = it.specialist.getId() == Specialist.ids.culture ? it.town.getCult() : it.town.getGrownInc(24);
		}}
		{{?it.specialist.getId() == Specialist.ids.grown}}
			{{var mult = 7;}}
		{{?}}
		
		<div> 
			{{?count}}
				<span class="dIB vaM">{{=snip.specialistEffectIcon(it.specialist)}}</span> 
				<span class="bgLight fakelink" data-title="На данный момент">{{=utils.formatNum(((count * effectDiff) - count) * (mult||1), {int:true, abs:!!mult, stages:true})}}</span>
				{{?mult}}
					 <span class="cl-grey">в неделю</span>
				{{?}}
			{{??}}
				{{=snip.alert()}} {{=snip.warn('Внимание. Сейчас ' + it.specialist.getName() + ' не даст никакого эффекта для этого города.', 'red')}}
			{{?}}
		</div>
	{{??}}
		{{
			var resType = it.specialist.getResType();
			var resIncList = it.town.stock.getIncList(true);
			var resList = ResList.getAll();
		}}

		{{?resType !== false}}
			{{?resType == Resource.prodtypes.food}}
				{{resList.delElem(Resource.ids.food);}}
			{{?}}
		
			{{var hasResInc = false;}}
			{{@resList.getList(): res}}
				{{?res.getProdtype() == resType}}
					{{var resInc = resIncList.getElem(res.id).getCount();}}
					<div>
						{{?resInc}}
							{{
								hasResInc = true;
								var effectDiff = 1 + (townSpecialistUp.getEffect() - townSpecialist.getEffect());
							}}
							<snip class="-nobr">
								{{=snip.res(res.id)}}
								<span class="bgLight fakelink" data-title="На данный момент">{{=utils.formatNum(((resInc * effectDiff) - resInc) * 24 * 7, {int:true, stages:true})}}</span> 
								<span class="cl-grey">в неделю</span>
							</span>
						{{??res.isScience() || res.isMoney()}}
							{{hasResInc = false;}}
						{{?}}
					</div>
				{{?}}
			{{@}}
			{{?!hasResInc}}
				{{=snip.alert()}} {{=snip.warn('Внимание. Сейчас ' + it.specialist.getName() + ' не даст никакого эффекта для этого города.', 'red')}}
			{{?}}
		{{?}}
	{{?}}
</script>
<script type="text/plain" id="shop.header">
    Магазин удачи
</script>

<script type="text/plain" id="shop">
    <div class="view-shop -lang-{{=it.lang}}">
        <div class="spage-body">
            {{~it.packs: item: pos}}
                {{?pos%it.rowLen == 0}}
                    <div class="shop-row">
                {{?}}
				
                <div class="shop-item -id-{{=item.pic}} {{?!item.coins}}-type-custom{{?}}">
                    {{var bonus = item.bonus + Math.min(it.action ? it.action.sum: 0, item.coins);}}
                    {{var bonusPerc = utils.toInt(bonus/item.coins*100);}}
                    <div class="shop-item-title">{{=item.title}}</div>
                    <div class="shop-item-coins -textShine">
                        <span class="luckShine"></span>{{=item.coins}}
                        {{?bonus}} + <span class="shop-item-coins-bonus"><span class="luck"></span><span class="shop-item-coins-bonus-value">{{=bonus}}</span><span class="shop-coins-comment"> в подарок</span></span>{{?}}
                    </div>
                    <div class="shop-item-cost -textShine"> 
						{{?it.lang=='en'}}<span class="cur -lang-{{=it.lang}}"></span>{{?}}
						{{var costdiv = lib.luckbonus.shop_[wofh.platform.id].costdiv||1;}}
						{{=(Math.ceil(item.coins*it.cost)/costdiv).toFixed(utils.log10(costdiv))}}
						{{?it.lang!='en'}}<span class="cur -lang-{{=it.lang}}"></span>{{?}}
                    </div>
                    <button class="spage-button js-shop-item-buy" data-pos="{{=pos}}" title="Купить">Купить</button>
                    {{?it.action}}
                        <div class="shop-item-bonus js-shop-action-highlight">
                            <div class="shop-item-bonus-coins"><span class="luck"></span>{{=Math.round(bonus - item.bonus)}}</div>
                            <div class="shop-item-bonus-comment">дополнительно</div>
                            <div class="shop-item-bonus-timer">{{=snip.time2(snip.timer(it.action.time, 'dec'))}}</div>
                        </div>
                    {{?}}
                    {{?bonusPerc}}
                        <div class="shop-item-profit">
                            <div class="shop-item-profit-title">Выгода</div>
                            <div class="shop-item-profit-value">{{=bonusPerc}}%</div>
                        </div>
                    {{?}}
					{{?it.actionSpecialist && item.coins >= it.actionSpecialist.luck}}
						<div class="shop-item-specialist">
                            <div class="shop-item-specialist-text">
								Великий Гражданин в подарок
							</div>
                        </div>
					{{?}}
                    <div class="shop-item-shadow"></div>
                    <div class="shop-item-arrow"></div>
                </div>
                {{?(pos+1)%it.rowLen == 0 || pos == it.packs.length-1}}
                    </div>
                {{?}}
            {{~}}
			
            <a class="shop-item-free js-shop-item">
                <span class="fakelink">Купить</span> любое количество {{=snip.luck()}}Монет Удачи
                <div class="shop-item-arrow"></div>
            </a>
        </div>
    </div>
</script>

<script type="text/plain" id="shop.details">
    <div class="shop-details -id-{{=it.pack.id+1}}">
        <div class="shop-details-column">
            <div class="shop-details-title">Будни старателя</div>
            <div class="shop-details-coins -textShine">
                <div class="shop-details-coins-main">
                    <span class="shop-details-val">
                        <span class="luckShine"></span>
                        <input class="shop-details-input js-shop-input"/>
                    </span>
                    <span class="shop-details-bonus-wrp">
                        <span> + </span>
                        <span class="shop-details-bonus"><span class="luck"></span><span class="shop-details-bonus-value"></span><span class="shop-coins-comment"> в подарок</span></span>
                    </span>
                </div>
            </div>
            {{?it.action}}
                <div class="shop-details-action js-shop-action-highlight">
                    <div class="shop-details-action-coins -textShine">
                        <span class="shop-details-val"><span class="luck"></span><span class="js-shop-details-action-coins"></span>
                            <div class="shop-details-action-comment">дополнительно</div>
                        </span>
                    </div>
                    <div class="shop-details-action-timer">{{=snip.time2(snip.timer(it.action.time, 'dec'))}}<br/> до окончания</div>
                </div>
            {{?}}
            <div class="shop-details-cost -textShine">
                {{?it.lang=='en'}}
                    <span class="curBig -lang-{{=it.lang}}"></span><span class="js-shop-cost">{{=Math.round(it.pack.coins*it.cost)}}</span>
                {{??}}
                    {{var costdiv = lib.luckbonus.shop_[wofh.platform.id].costdiv||1;}}
                    <span class="js-shop-cost">{{=(it.pack.coins*it.cost/costdiv).toFixed(utils.log10(costdiv))}}+</span>
                    <span class="curBig -lang-{{=it.lang}}"></span>
                {{?}}
            </div>
        </div>
        <div class="shop-details-buttons">
			<button class="spage-button js-shop-item-buy" data-pos="{{=it.pack.id}}" title="Купить">Купить</button>
        </div>
        <div class="shop-details-profit">
            <div class="shop-details-profit-title">Выгода</div>
            <span class="shop-details-profit-value js-shop-details-profit">0</span>%
        </div>
		
		<div class="shop-details-specialist -hidden">
			<div class="shop-details-specialist-text">
				Великий Гражданин в подарок
			</div>
		</div>
		
        <button class="shopModal-close"></button>
    </div>
</script>

<script type="text/plain" id="shop.payment">
	<div class="view-shopModal" id="view-shopModal">
		<div class="shopModal-head">Выбери способ оплаты<button class="shopModal-close js-wnd-close"></button></div>
		<div class="shopModal-buttons">{{=tmplMgr.shop.payment.buttons(it)}}</div>
	</div>
</script>

<script type="text/plain" id="shop.payment.buttons">
    {{@it.pay: pay: payName}}
        {{?pay.btn == 'card'}}<a class="shop-details-pay -type-card {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Способ 1<br>(дешевле)</a>
        {{??pay.btn == 'web'}}<a class="shop-details-pay -type-web {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}js-shop-item-buy" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Электронные деньги</a>
        {{??pay.btn == 'mobile'}}<a class="shop-details-pay -type-mobile {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Мобильные платежи</a>
        {{??pay.btn == 'other'}}<a class="shop-details-pay -type-other {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Способ 2<br>(дороже)</a>
        {{??pay.btn == 'buy'}}<a class="shop-details-button -type-big {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Купить</a>
        {{??pay.btn == 'var1'}}<a class="shop-details-pay -type-var1 {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Основные</a>
        {{??pay.btn == 'var2'}}<a class="shop-details-pay -type-var2 {{?pay.disabled}}-disabled{{??}}js-shop-item-buy{{?}}" data-pos="{{=it.pack.id}}" data-type="{{=payName}}">Дополнительные<br>(дороже)</a>
        {{?}}
    {{@}}
</script>

<script type="text/plain" id="shop.specialists">
	<div class="view-shopModal" id="view-shopModal">
		<div class="shopModal-head">Приятный подарок<button class="shopModal-close js-wnd-close"></button></div>
		<div class="shopModal-spec-text">
			Выбери любого 
			<span class="shopModal-spec-name">
				Великого Гражданина
			</span>
		</div>
		<div class="shopModal-spec-block">
			{{=snip.specialistsSelect({specialists:SpecialistList.getAll().getList()})}}
		</div>
		<button class="spage-button js-shop-buy -disabled" title="К оплате">К оплате</button>
	</div>
</script><script type="text/plain" id="simbattle.header">
    Симулятор боя
</script>

<script type="text/plain" id="simbattle">
    <form class="view-simbattle">
		<div class="simbattle-simhead-wrp">
			<div class="simbattle-simhead-alert-wrp">
				<div class="simbattle-simhead-alert"></div>
			</div>
			
			<table class="simbattle-simhead">
				<tbody>
					<tr>
						<td class="aL">
							{{?ls.getAttDefViewSimbattle(true)}}
								{{=tmplMgr.simbattle.setting.def(it)}}
							{{??}}
								{{=tmplMgr.simbattle.setting.att(it)}}
							{{?}}
						</td>
					
						<td class="aR">
							{{?!ls.getAttDefViewSimbattle(true)}}
								{{=tmplMgr.simbattle.setting.def(it)}}
							{{??}}
								{{=tmplMgr.simbattle.setting.att(it)}}
							{{?}}
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-250, 0), 250)}}px;">
			<table>
				<tr class="lh">
					{{
						var unitsEraTacticGroups = Army.getAll().getEraTacticGroups({ filter: function(unit, era, unitTacticsArr){
							return unit.getEra() == era && utils.inArray(unitTacticsArr, unit.getTactic()) && unit.getHealth() > 0 && !unit.hasAbility(Unit.ability.noFight) && !unit.hasTag(Unit.tags.ship) && !unit.hasTag(Unit.tags.aircraft);
						} });
					}}
					
					<td class="simbattle-army">
						{{?ls.getAttDefViewSimbattle(true)}}
							{{=tmplMgr.simbattle.army.def({it: it, unitsEraTacticGroups: unitsEraTacticGroups})}}
						{{??}}
							{{=tmplMgr.simbattle.army.att({it: it, unitsEraTacticGroups: unitsEraTacticGroups})}}
						{{?}}
					</td>
					
					<td class="simbattle-army">
						{{?!ls.getAttDefViewSimbattle(true)}}
							{{=tmplMgr.simbattle.army.def({it: it, unitsEraTacticGroups: unitsEraTacticGroups})}}
						{{??}}
							{{=tmplMgr.simbattle.army.att({it: it, unitsEraTacticGroups: unitsEraTacticGroups})}}
						{{?}}
					</td>
				</tr>
			</table>
		</div>
		
		<div class="simbattle-footer com-footer">
			<div class="simbattle-actions">
				<label class="report-battleView-wrp">
					{{=snip.checkbox1({cls: 'report-battleView', checked: ls.getAttDefViewSimbattle(true)})}}
					Отображать стороны как в бою
				</label>
				
				<div class="simbattle-links">
					<a id="changeArmy" class="simbattle-changeArmy {{=snip.getFakelinkCls({type: 'green'})}} -hidden" type="submit" name="swap">Поменять местами</a>
					{{=snip.br()}}
					<a id="resetArmy" class="simbattle-resetArmy {{=snip.getFakelinkCls({type: 'red'})}} {{?!it.hasHash}}-hidden{{?}}" type="submit" name="reset">Сбросить</a>
				</div>
			</div>
			<div class="simbattle-show">
				<button type="button" class="button1 -disabled simbattle-run">Симулировать</button>
				{{?debug.isTest('system')}}
					 <button class="button1 js-randomSimBattle">Случайные</button>
				{{?}}
			</div>
		</div>
     </form>
</script>

<script type="text/plain" id="simbattle.setting.def">
	{{?ls.getAttDefViewSimbattle(true)}}
		<div class="imgDefence"></div>
	{{?}}
	
	<div class="simbattle-settings">
		<div>
			<div class="simbattle-setting-icon"></div>

			Военный бонус <input type="text" class="sh input1" name="b2" value="{{?it.b2}}{{=it.b2}}{{??}}0{{?}}">%
		</div>
		
		<div class="simbattle-setTactic-wrp">
			<div class="simbattle-setting-icon">{{=snip.tacticsIcon()}}</div>

			<a class="simbattle-setTactic link -lenLim js-setTactic" data-member="0">
				{{=tmplMgr.simbattle.tactic({})}}
			</a>
		</div>
		
		<div>
			<div class="simbattle-setting-icon">
				{{=snip.buildTabIcon(Slot.tabIds.defence)}}
			</div>

			{{=snip.smplSelect({name:'dt', cls:'select1'})}}

			<span class="simbattle-defLevel-wrp">
				 
				<input type="text" class="input1"  name="dl" value="{{=it.dl||1}}">
				 ур.
			</span>
		</div>
	</div>
	
	{{?!ls.getAttDefViewSimbattle(true)}}
		<div class="imgDefence"></div>
	{{?}}
</script>

<script type="text/plain" id="simbattle.setting.att">
	{{?!ls.getAttDefViewSimbattle(true)}}
		<div class="imgAttack"></div>
	{{?}}
	
	<div class="simbattle-settings">
		<div>
			<div class="simbattle-setting-icon"></div>

			Военный бонус <input type="text" class="sh input1" name="b1" value="{{?it.b1}}{{=it.b1}}{{??}}0{{?}}">%
		</div>

		<div class="simbattle-setTactic-wrp">
			<div class="simbattle-setting-icon">{{=snip.tacticsIcon()}}</div>

			<a class="simbattle-setTactic js-setTactic link -lenLim" data-member="1">
				{{=tmplMgr.simbattle.tactic({})}}
			</a>
		</div>
	</div>
	
	{{?ls.getAttDefViewSimbattle(true)}}
		<div class="imgAttack"></div>
	{{?}}
</script>

<script type="text/plain" id="simbattle.army.def">
	{{
		var unitsEraTacticGroups = it.unitsEraTacticGroups;
		it = it.it;
	}}
	
	{{@unitsEraTacticGroups: eraGroup}}
		<div class="mb10">
			{{@eraGroup: tacticGroup}}
				{{@tacticGroup.getList(): unit}}
					<div class="simbattle-unitval-wrp">
						{{var count = it.a2 && it.a2.getCount(unit.getId());}}
						
						<a href="{{=HashMgr.getHref('#/unitinfo/'+unit.getId())}}" class="simbattle-unit {{?!count}}-type-empty{{?}}" tabindex="-1">{{=snip.unitIcon(unit)}}</a>
						<br>
						<input type="tel" value="{{=count||''}}" name="d{{=unit.getId()}}" class="simbattle-unitval -sim-army-defense input1" data-id="{{=unit.getId()}}" autocomplete="off">
					</div>
				{{@}}
			{{@}}
		</div>
	{{@}}
</script>

<script type="text/plain" id="simbattle.army.att">
	{{
		var unitsEraTacticGroups = it.unitsEraTacticGroups;
		it = it.it;
	}}
	
	{{@unitsEraTacticGroups: eraGroup}}
		<div class="mb10">
			{{var no_attackUnits = [];}}

			{{@eraGroup: tacticGroup}}
				{{@tacticGroup.getList(): unit}}
					/* Добавляем к списку атакеров "невидимых" миротворцев для выравнивания блоков */
					{{?unit.hasAbility(Unit.ability.no_attack)}}
						{{
							no_attackUnits.push(unit);
							continue;
						}}
					{{?}}

					<div class="simbattle-unitval-wrp">
						{{var count = it.a1 && it.a1.getCount(unit.getId());}}

						<a href="{{=HashMgr.getHref('#/unitinfo/'+unit.getId())}}" class="simbattle-unit {{?!count}}-type-empty{{?}}" tabindex="-1">{{=snip.unitIcon(unit)}}</a>
						<br>
						<input type="tel" value="{{=count||''}}" name="a{{=unit.getId()}}" class="simbattle-unitval -sim-army-attack input1" data-id="{{=unit.getId()}}" autocomplete="off">
					</div>
				{{@}}
			{{@}}

			{{@no_attackUnits: no_attackUnit}}
				<div class="simbattle-unitval-wrp -invis">
					<a tabindex="-1">{{=snip.unitIcon(no_attackUnit)}}</a>
					<br>
					<input type="number" class="simbattle-unitvalFake input1" disabled="disabled" tabindex="-1">
				</div>
			{{@}}
		</div>
	{{@}}
</script>	
	
<script type="text/plain" id="simbattle.tactic">
	{{?it.tactic}}
		{{=snip.tactic(it.tactic.getName(), {noIcon: true})}}
		<button class="simbattle-delTactic button2-small -type-delete"></button>
	{{??}}
		{{=snip.tactic('Выбрать тактику', {cls:'-warn -type-red', noIcon:true})}}
	{{?}}
</script>

<script type="text/plain" id="simbattle.code">
	<div class="wnd-panelLR bgDark -type-header">Код</div>
	<div class="simbattle-code-block">
		<textarea class="simbattle-code-edit">{{=it.code}}</textarea>
	</div>
</script>  <script type="text/plain" id="slotbld.header">
	{{?it.slot.getLevel()}}
		{{=snip.lenlim(snip.slotNameLevel(it.slot), {lenLim: 515})}}
	{{??}}
		{{=tmplMgr.slotnew.header(it)}}
	{{?}}
</script>

<script type="text/plain" id="slotbld">
	<div class="view-slotbld js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-40, 240)}}px;">
		<div class="slotbld-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="slotbld.view">
	<div class="tabs tabs-wrp slotbld-tabs-wrp {{?!it.slotEvents.length}}-hidden{{?}}"></div>
	
	<div class="tabs-cont"></div>
</script>

<script type="text/plain" id="slotbld.tab">
	<div class="slotbld-info">
		<div class="slotbld-left">
			{{var offset = it.slot.getDisp(true);}}
			
			<div class="slotbld-imgWrp">
				{{=snip.buildLinkOpen(it.slot, { cls: 'slotbld-slotLink', attrs: {head: it.slotEventTitle} })}}
					<div class="slotbld-imgBack -clim-{{=it.slot.getTown(wofh.town).climate}} -type-{{=it.slot.getImgBack()}} {{?it.slot.isOff()}}-disabled{{?}}">
						<div class="slotbld-imgSlot">
							<div class="slotbld-img" style="top: {{=offset.y}}px; left: {{=offset.x}}px;">
								{{=snip.buildImgBig(it.slot.clone().clearEvents().addAction(it.event), undefined, {noTitle:true})}}
							</div>
						</div>
						
						{{?it.event}}
							{{var action = Slot.actions[it.event.getAction()];}}
							
							<span class="town2-bldEvent-icon slotAction {{?it.curEvent}}-type-active{{?}} -type-{{=action.name}}"></span>
							<span class="town2-bldEvent-timeLeft">
								{{=snip.timer(it.event.getTime(), 'dec')}}
							</span>
						{{?}}
					</div>
				{{=snip.linkClose()}}

				{{?debug.isTest('system') && debug.isSuperAdmin() && it.noActions && it.slot.canUp() }}
					<a class="slotbld-btnWrp -type-buildAdm js-slotbld-build -type-lvl20">
						{{=snip.slotBuildButton(new Slot(it.slot.id, lib.build.maxlevel - 1), Slot.buildErr.ok, true)}}
					</a>
				{{?}}

				{{?it.last}}
					{{?it.slot.isEmpty()}}
						<a class="slotbld-btnWrp -type-build js-openSlotNew">
							{{=snip.slotBuildButton(it.slot, Slot.buildErr.ok)}}
						</a>
					{{??}}
						{{?it.slot.canUp()}}
							<a class="slotbld-btnWrp -type-build js-slotbld-build">
								{{=snip.slotBuildButton(it.slot)}}
							</a>
						{{?}}
						{{?it.slot.canRebuild()}}
							<div class="slotbld-btnWrp -type-rebuild">{{=snip.slotRebuildButton(it.slot)}}</div>
						{{?}}
						{{?Ability.bldDestroy()}}
							<div class="slotbld-btnWrp -type-destroy">{{=snip.slotDestroyButton(it.slot)}}</div>
						{{?}}
					{{?}}
				{{?}}

				{{?it.noActions && Ability.swap()}}
					<div class="slotbld-btnWrp -type-swap">{{=snip.slotSwapButton(it.slot)}}</div>
				{{?}}
			</div>

			{{?it.first && !it.slot.isEmpty() && it.slot.getLevel() && (!it.slot.getActive() || it.slot.getSwitchCost()) && !it.slot.isWonder()}}
				{{?it.slot.getActive()}}
					<div class="slotbld-switchBtnWrp -type-off"><a class="slotbld-switchBtn -type-active js-slotbld-switchOff">Отключить</a></div>
				{{??}}
					{{?it.slot.getSwitchCost()}}
						{{?it.slot.getSwitchCost() < (wofh.account.money.sum - (wofh.account.money.reserve||0))}}
							<div class="slotbld-switchBtnWrp -type-on">
								<a class="slotbld-switchBtn -type-active js-slotbld-switchOn">Включить за</a>
						{{??}}
							<div class="slotbld-switchBtnWrp -type-on">
								<a class="slotbld-switchBtn" title="Недостаточно денег для включения">Включить за</a>
						{{?}}
								<div class="slotbld-switchMoney"><img class="res -r1" src="https://test.waysofhistory.com/img/_.gif" title="Деньги">{{= utils.toInt(it.slot.getSwitchCost()) }}</div>
							</div>
					{{??}}
						<div class="slotbld-switchBtnWrp -type-on"><a class="slotbld-switchBtn -type-active js-slotbld-switchOn">Включить</a></div>
					{{?}}
				{{?}}
			{{?}}
		</div>

		<div class="slotbld-right">
			<div class="slotbld-cost-tableWrapper">
				{{?it.last && !it.slot.isEmpty()}}
					{{
						var cost = it.slot.getUp().getCost();
						var bonus = it.slot.getTown(wofh.town).getLuckBonus(LuckBonus.ids.productionPack);
						var canAddBonus = wBonusTakeNow.canShow(bonus);
						var canMakeOrder = wofh.country && wofh.country.hasOrdersRes();
					}}
					<div class="slotbld-cost {{?canAddBonus}}-can-addBonus{{?}} {{?canMakeOrder}}-can-makeOrder{{?}}">
						{{?it.slot.canUp()}}
							{{?canAddBonus}}
								<a class="slotBld-cost-addBonus btnAddBonus"></a>
							{{?}}
							{{=snip.time(timeMgr.fPeriod(it.slot.getUp().getTime()))}}
							{{=snip.resListCheck(cost, it.slot.getTown(wofh.town))}}
						{{?}}
						{{?canMakeOrder}}
							<div class="slotBld-cost-makeOrder-wrp">
								{{?it.slot.canUp()}}
									<a class="slotBld-cost-makeOrder iconBuildSlot -act-order" data-title="Заявка на ресурсы"></a>
								{{?}}

								{{?it.slot.canRebuild()}}
									<a class="slotBld-cost-makeOrder iconBuildSlot -act-order -type-rebuild" data-title="Заявка на ресурсы"></a>
								{{?}}
							</div>
						{{?}}
					</div>
				{{??}}
					<div class="slotbld-cost"></div>
				{{?}}
			</div>
			
			<div class="slotbld-features">
				{{?!it.slot.isEmpty()}}
                    {{=tmplMgr.slotbld.eventLabel(it, {
                        features: true,
                        noDesc: it.slot.getType() == Build.type.fake
                    })}}
                    
					<table>{{=snip.buildParams(it.slot, true)}}</table>
					
					{{=it.slot.getSpeciale()}}
				{{?}}
			</div>
		</div>
	</div>
	
	<div class="slotbld-other">
		{{?it.slot.canTrainUnits()}}
			<div class="slotbld-train-wrp {{=it.tabName}}-train-wrp"></div>
		{{?}}
		
		{{?it.slot.getLevel() || it.slot.isWonder()}}
			<div class="slotbld-other-wrp {{=it.tabName}}-other-wrp"></div>
		{{?}}
		
		{{?it.slot.isOff()}}
			<div class="slotbld-switchInd">Строение отключено.</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="slotbld.other">
    {{
        var slotType = it.slot.getType();
        var cont = tmplMgr.slotbld.other.cont(it).trim();
    }}
    
    {{=tmplMgr.slotbld.eventLabel(it, {
        noDesc: !cont || slotType == Build.type.trade || slotType == Build.type.wonder || slotType == Build.type.airdef
    })}}
	
	{{=cont}}
</script>

<script type="text/plain" id="slotbld.other.cont">
    {{
        var slotTown = it.slot.getTown(wofh.town);
        var slotType = it.slot.getType();
    }}
    
    {{?slotType == Build.type.prodBoost}}
		<div class="slodbld-prodBoost-title">{{=snip.icon(snip.c.anyIcon, 'maxWorkers')}}Дополнительные рабочие места</div>
		
		{{@slotTown.getSlots().getPromSlots().getList(): slot}}
			<div class="slodbld-prodBoost-slot">
				{{
					var prodList = slot.getProductresForTown();
					var isOff = slot.isOff();
				}}
                
				<a class="js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=slot.getId()}}" data-pos="{{=slot.getPos()}}" data-town="{{=slotTown.id}}" data-head="{{=snip.slotTitle(slot)}}" href="{{=hashMgr.getWndHref('slot', slot.getPos() + '&town=' + slotTown.id)}}">
					{{=snip.slotFrame(slot, snip.slotLevel(slot), {noTitle: true, grey: (isOff || !prodList.getLength()), disabled: isOff})}}
				</a>
				
				<div class="slodbld-prodBoost-slotInfo">
					{{=snip.hintWrp('Дополнительные рабочие места', snip.pop(utils.toInt(it.slot.getProdBoostEffect(slot))))}}
					
                    <br>
					
                    {{?it.slot.canUp()}}
						{{=snip.hintWrp('После улучшения до следующего уровня', '+'+utils.toInt(it.slot.getProdBoostEffectUp(slot)))}}
					{{?}}
                    
					{{?!prodList.getLength()}}
						<div>{{=snip.alert('Здание не может сейчас функционировать')}}</div>
					{{?}}
				</div>
			</div>
		{{@}}
        
		<br>
	{{??slotType == Build.type.store}}
		<div>
			<center>
				<table class="slodbld-store-tbl">
					{{var townStock = slotTown.getStock();}}
                    
					<div>
                        Суммарная вместимость всех складских зданий этого города: {{=snip.capacityIcon()}}{{=utils.formatNum(townStock.getMax(), {int:true, stages:true})}}
                    </div>
                    
                    <br>
                    
					{{=tmplMgr.slotbld.stock.res({res: townStock.getElem(Resource.ids.food), town: slotTown})}}
					
					{{@townStock.getList(): res}}
						{{?res.isGrown() && (utils.toInt(res.updateHour) != 0 || utils.toInt(res.has) != 0)}}
							{{=tmplMgr.slotbld.stock.res({res:res, town: slotTown})}}
						{{?}}
					{{@}}
					
					{{@townStock.getList(): res}}
						{{?res.isStockable() && !res.isGrown() && (utils.toInt(res.updateHour) != 0 || utils.toInt(res.has) !=0)}}
							{{=tmplMgr.slotbld.stock.res({res:res, town: slotTown})}}
						{{?}}
					{{@}}
				</table>
			</center>
		</div>
        
		<br>
	{{??slotType == Build.type.grown || slotType == Build.type.culture || slotType == Build.type.administration}}
		<div>
			{{var townPop = slotTown.getPop();}}
			
			{{=snip.pop()}} Население - {{=utils.toInt(townPop.has)}}/{{=utils.toInt(townPop.culture)}} ({{=snip.sign(utils.toFixed(townPop.incReal, 1))}}  в день)
            
			<br>
            
			{{?townPop.incReal > 0}}
				{{var popOverflowTime = slotTown.calcPopOverflowTime() + (slotTown.prevEventTimeLeft||0);}}
				
                {{?slotTown.hasFurtherEvent}}Ориентировочно предел культуры будет достигнут{{??}}Предел культуры будет достигнут{{?}} /* Обсудить */
				
				 через {{=snip.timer(timeMgr.getNow() + popOverflowTime, 'dec')}} в {{=timeMgr.fMoment(popOverflowTime + timeMgr.getNow())}}
			{{??townPop.incReal == 0}}
				Население не растет
			{{??}}
				Население убывает
			{{?}}
		</div>
        
		<br>
	{{??slotType == Build.type.trade}}
		<div>
			<a class="button1" href="{{=hashMgr.getWndHref(Account.hasAbility(Science.ability.money)?'trade':'barter')}}">Торговля</a>  
		</div>
        
		<br>
	{{??slotType == Build.type.embassy}}
		<div>
			<p>Даёт  <b>{{=utils.toInt(it.slot.getEffect())}}</b> очков дипломатии</p>
            
			{{?wofh.country}}
				<p>Твоя страна: {{=snip.countryLink(wofh.country)}}</p>
			{{??!it.realSlot.isEmpty()}}
				{{var timeJoin = wofh.account.getNewCountryMoment();}}
                
				{{?timeJoin > timeMgr.getNow()}}
					<p>Создание страны возможно через {{=snip.timer(timeJoin, 'dec')}}</p>
                    
					<p><button class="button1 -disabled">Создать</button></p>
				{{??}}
					<p>Создать новую страну</p>
                    
					<form class="js-slotbld-newCountry"><p>Название: <input class="js-slotbld-newCountry-input" autocomplete="off" maxlength="{{=lib.country.namelimit[1]}}" name='name' value=""></p><p><button class="button1 js-slotbld-newCountry-button -disabled">Создать</button></p></form>
				{{?}}
			{{?}}
		</div>
        
		<br>
	{{??slotType == Build.type.corruption}}
		<div>
			{{
				var townStock = slotTown.getStock();
				var incCourt = townStock.getIncList(true).diffList(townStock.calcIncNoCourt());
				
				if( it.slot.canUp() ){
					var incCourtUp = townStock.calcIncCourtUp();
                    
					incCourtUp = incCourtUp.diffList(townStock.getIncList(true));
				};
			}}
			
			<table class="s-tbl slodbld-corruption-tbl">
				<thead>
					<tr>
						<td>Выгода</td>
                        
						{{?it.slot.canUp()}}<td>После улучшения</td>{{?}}
					</tr>
				</thead>
                
				<tbody>
					{{@incCourt.getList() : res}}
						<tr>
							<td>{{=snip.resBigCount(res, utils.toFixed(res.getCount(), 1))}}  в час</td>
                            
							{{?it.slot.canUp()}}
                                {{res = incCourtUp.getElem(res);}}
                                
								<td>+ {{=snip.resBigCount(res, utils.toFixed(res.getCount(), 1))}}  в час</td>
							{{?}}
						</tr>
					{{@}}
				</tbody>
			</table>
		</div>
	
		<br>
	{{??slotType == Build.type.wonder}}
		<div>
			<div>
				{{=snip.link(hashMgr.getWndHref('wonders', {town: slotTown.id}), 'Все Чудеса', 'button1 -type-green mt05')}}
			</div>
            
			{{?it.showActivateBtn}}
				<button class="slotbld-switchWonder js-slotbld-switchOn">Активировать Чудо</button>
			{{?}}
		</div>
        
		<br>
        
		{{?it.slot.getId() == Slot.ids.cosmodrome}}
			<div>
				{{var event = wofh.events.getTrainQueue(it.slot)[0];}}
				
				{{?event}}
					<p>До конца сборки космического корабля осталось {{=snip.timer(event.time, 'dec')}}</p>
					<p>Не допускайте, чтобы рабочие, поселенцы или компоненты корабля нуждались в отсутствующих ресурсах.</p>
				{{??}}
					<table class="slotbld-cosmodrome-tbl">
						{{@lib.spaceship.components: row}}
							<tr>
								<td>{{=snip.unitNameLink(row.id)}}<td>
								<td>{{=slotTown.army.intown.getCount(row.id)}} / {{=row.count}}</td>
							</tr>
						{{@}}
					</table>
                    
					<br>
                    
					<div class="pt">
						{{var err =slotTown.getAssembleSpaceshipErr();}}
						{{?err==Town.spaceshipErr.level}}Нельзя начать сборку. Космодром не достроен.
						{{??err==Town.spaceshipErr.units}}Нельзя начать сборку. Недостаточно компонентов.
						{{??}}<a class="link js-slotbld-assemble">Собрать корабль</a>{{?}}
					</div>
				{{?}}
			</div>
            
			<br>
		{{?}}
        
		{{?it.slot.isSpaceship()}}
			<div>
				В стране активировано {{=wofh.country.getMccCount()}} ЦУП из {{=lib.spaceship.controlcenterssum}}
			</div>
            
			<br>
			
            <div>
				<button class="button1 js-slotbld-launch {{?!wofh.country.canLaunchSpaceship()}}-disabled{{?}}">Запустить</button>
			</div>
		{{?}}
        
		{{?slotTown.getSlots().wonderEffect[WonderEffect.ids.oracle]}}
			{{var oracleT = it.slot.getOracleTime();}}
			
			{{?oracleT.ongoing}}
                До окончания работы: {{=snip.timer(oracleT.limit, 'dec')}}
			{{??}}
                До начала работы: {{=snip.timer(oracleT.limit, 'dec')}}
			{{?}}
		{{?}}
	{{??slotType == Build.type.fake}}
		<div>
			{{
				var curDamage = utils.toInt(it.slot.getCost().calcSum());
                
				if( it.slot.canUp() )
					var nextDamage = utils.toInt(it.slot.getUp().getCost().calcSum());
			}}
			
			Текущий уровень муляжа рассчитан на  {{=utils.formatNum(it.slot.calcTotalCost().calcSum(), {int:true, stages:true})}}  урона.<br>Урон менее  {{=utils.formatNum(curDamage, {stages:true})}}  не нанесет вреда муляжу, но нанесет урон другим объектам.
			
            {{?it.slot.canUp()}} 
                <br>
                
                Следующий уровень муляжа добавит {{=utils.formatNum(nextDamage, {stages:true})}} прочности.{{?}}
			{{?slotTown.hasDeposit()}}
				{{var depDamage = utils.toInt(wofh.account.getDepositDamage());}}
                
				<br>
                
				Для разрушения колонии этого города требуется {{=utils.formatNum(depDamage, {stages:true})}} урона.
                
				{{?curDamage > depDamage}}
                    <br>
                    
                    Внимание, муляж столь высокого уровня не защитит колонию от разрушения.
				{{??it.slot.canUp() && nextDamage > depDamage}}
                    <br>
                    
                    Если улучшить муляж, то он не сможет защитить колонию от разрушения.
				{{?}}
			{{?}}
		</div>
        
		<br>
	{{??slotType == Build.type.airdef}}
		<div>
			<p>Нанесено урона вражеской авиации: {{=utils.toInt(slotTown.aad)}}</p>
		</div>
        
		<br>
	{{?}}
</script>

<script type="text/plain" id="slotbld.eventLabel">
    {{var params = arguments[1]||{};}}
    
	{{?!it.noActions && !params.noDesc}}
		<div class="slotbld-desc">
			{{?it.event}}
                {{=snip.title(params.features ? 'Характеристики после окончания строительства/сноса и т.д.' : 'Данные после окончания строительства/сноса и т.д.', 'Для текущего состояния города', 'fakelink crH')}}
            {{??}}
                {{=params.features ? 'Характеристики на текущий момент' : 'Данные на текущий момент'}}
            {{?}}
		</div>
        
		<br>
	{{?}}
</script>

<script type="text/plain" id="slotbld.stock.res">
	{{
		var res = it.town.getStock().getElem(it.res).updHas();
		var time = res.calcStockFillTime();
		var style = 2;
		
		if( utils.toInt(it.res.updateHour) != 0 ) {
            time += (res.getTown().prevEventTimeLeft||0);
            
			style += (it.res.updateHour > 0 ? 1 : -1) * (time > 12 * 3600 ? 1 : 2);
		}
	}}
    
	<tr class="slotbld-stock-res -t{{=style}}">
		<td></td>
		<td align="left" {{?it.res.isFood()}}colspan="3"{{?}}>
			{{?it.res.isGrown()}}<span class="slotbld-stock-resGrown"></span>{{?}}
			{{=snip.resBig(it.res.getId())}}
			{{=utils.stages(utils.toInt(it.res.has))}}
		</td>
		{{?!it.res.isFood()}}
			<td style="vertical-align: bottom">
				{{?utils.toInt(it.res.updateHour) != 0}}
					{{=snip.sign(utils.toInt(it.res.updateHour))}} в час
				{{?}}
			</td>
			<td align=right style="vertical-align: bottom">
				{{?time}}
					{{=snip.timer(time + timeMgr.getNow(), 'dec')}}
				{{?}}
			</td>
		{{?}}
	</tr>
</script>


<script type="text/plain" id="slotbld.alert">
	{{?it.name == 'switchOn'}}
		Ты действительно хочешь<br/> включить здание?
	{{??it.name == 'switchOnOff'}}
		Ты действительно хочешь включить это здание? В этом случае все несовместимые с данным<br>строения будут отключены и обучающиеся в них войска/рабочие/поселенцы пропадут.
	{{??it.name == 'switchOff'}}
		Ты действительно хочешь<br/> отключить здание?<br/><b>Внимание!<br/>Будет прервано всё обучение войск и отменены текущие и запланированные строительные работы.<br>Также, включение здания не бесплатно.<br/>Потребуется заплатить определенную сумму  <img src="https://test.waysofhistory.com/img/_.gif" class="res r1"> денег.</b>
	{{?}}
</script>

<script type="text/plain" id="slotbld.buildAlert">
	{{
		var slotApply = it.slot;
		var slotTown = slotApply.getTown(wofh.town);
		var err = it.err;
		var title = snip.slotBuildTitle(slotApply, err);
		var isOff = slotApply.isOff();
	}}
	<div class="slotbld-buildWnd">
		<div class="slotbld-alertWnd-title">Построить</div>
		<div>{{=snip.slotBuildIcon(slotApply)}}{{=snip.slotFrame2(slotApply.getUp(), {grey: isOff, disabled: isOff})}}</div>
		<div>{{=snip.buildLink(slotApply, snip.slotName(slotApply.getUp()))+snip.slotLevelInfo(slotApply.getUp())}}</div>
		<div class="slotbld-alertWnd-time">
			{{=snip.time()}} {{=timeMgr.fPeriod(slotApply.getUp().getTime())}}

			{{=snip.resBigListCheck(slotApply.getUp().getCost(), slotTown)}}
		</div>
		
		{{?it.hasPay}}
			<div class="slotnew-info-warn -type-yellow"><span class="slot-warnIcon -type-pay"></span> Здание требует денежного содержания</div>
		{{?}}
		{{?err == Slot.buildErr.ok}}<div class="slot-action"><button class="button1 js-slotAction-accept">Строить</button></div>
		{{??err == Slot.buildErr.res || err == Slot.buildErr.needBonus}}
			<div class="slotnew-info-warn -type-red">
				<span class="slo-warnIcon -type-res"></span> Недостаточно ресурсов для строительства
				<div>
					{{var cost = slotApply.getUp().getCost();}}
					{{var readyMoment = slotTown.stock.calcEnoughMoment(cost);}}
					
					{{?readyMoment}}
						{{=snip.title(snip.time(snip.timer(readyMoment + 2, 'dec', false, '', {notifs: [Notif.ids.townBuildResCollected]})), 'Прогноз по накоплению необходимых ресурсов для строительства')}}
					{{?}}

					{{=snip.resBigList(cost.excludeResList(slotTown.stock.getHasList()).onlyPositive().ceil())}}
				</div>
			</div>
			{{?err == Slot.buildErr.needBonus}}
				{{var bonus = slotTown.getLuckBonus(LuckBonus.ids.productionPack);}} 
				{{?wBonusTakeNow.canShow(bonus)}}
					<div class="slotnew-info-warn -type-blue bgDark">
						<a class="link slotbld-addBonus">Получить ресурсы</a><br>
						{{=snip.resBigList(bonus.getUp().getTypedEffect())}}
					</div>
				{{?}}
			{{?}}
			<div class="slotnew-info-warn -type-red">
				<button class="button1 -disabled">Строить</button>
			</div>
		{{??}}
			<div class="slotnew-info-warn -type-yellow">
				<div class="p05">{{=title}}</div>
				<button class="button1 -disabled mb05">Строить</button>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="slotbld.rebuildAlert">
	{{
		var slotApply = it.slot;
		var slotTown = slotApply.getTown(wofh.town);
	}}
	<div class="slotbld-rebuildWnd">
		<div class="slotbld-alertWnd-title">Это здание можно перестроить в</div>
		<div>{{=snip.slotRebuildIcon(slotApply)}}{{=snip.slotFrame2(slotApply.getRebuild())}}</div>
		<div>{{=snip.buildLink(slotApply.getRebuild(), snip.slotName(slotApply.getRebuild()))+snip.slotLevelInfo(slotApply.getRebuild())}}</div>
		{{?slotApply.canTrainUnits() && slotApply.isConflictWith(slotApply.getRebuild())}}
			<div>В этом случае все такие же здания будут отключены и обучающиеся<br/>в них войска/рабочие/поселенцы пропадут.</div>
		{{?}}
		<div class="slotbld-alertWnd-time">
			{{=snip.time()}} {{=timeMgr.fPeriod(slotApply.getRebuild().getTime())}}
			{{=snip.resBigListCheck(slotApply.getRebuildCost(), slotTown)}}
		</div>

		{{?slotApply.getRebuild().getPay()}}
			<div class="slotnew-info-warn -type-yellow"><span class="slot-warnIcon -type-pay"></span> Здание требует денежного содержания</div>
		{{?}}

		{{var err = slotApply.canRebuildErr();}}
		{{?err == Slot.buildErr.work}}<div class="slotnew-info-warn -type-yellow">Нельзя перестроить, здание работает<br/><button class="button1 -disabled">Перестроить</button></div>
		{{??err == Slot.buildErr.queue}}<div class="slotnew-info-warn -type-yellow">Очередь строительства заполнена<br/><button class="button1 -disabled">Перестроить</button></div>
		{{??err == Slot.buildErr.building}}<div class="slotnew-info-warn -type-yellow">Нельзя перестроить, здание строится<br/><button class="button1 -disabled">Перестроить</button></div>
		{{??err == Slot.buildErr.ok}}<div class="slot-action"><button class="button1 js-slotAction-accept">Перестроить</button></div>
		{{??err == Slot.buildErr.money}}<div class="slotnew-info-warn -type-yellow">Нельзя перестроить, деньги не изобретены<br/><button class="button1 -disabled">Перестроить</button></div>
		{{??err == Slot.buildErr.res || err == Slot.buildErr.needBonus}}
			<div class="slotnew-info-warn -type-red">
				<span class="slot-warnIcon -type-res"></span> Недостаточно ресурсов для строительства
				<div>
					{{var cost = slotApply.getRebuildCost();}}
					{{var readyMoment = slotTown.stock.calcEnoughMoment(cost);}}
					{{?readyMoment}}
						{{=snip.title(snip.time(snip.timer(readyMoment + 2, 'dec', false, '', {notifs: [Notif.ids.townBuildResCollected]})), 'Прогноз по накоплению необходимых ресурсов для строительства')}}
					{{?}}

					{{=snip.resBigList(cost.excludeResList(slotTown.stock.getHasList()).onlyPositive().ceil())}}
				</div>
			</div>
			{{?err == Slot.buildErr.needBonus}}
				{{var bonus = slotTown.getLuckBonus(LuckBonus.ids.productionPack);}} 
				{{?wBonusTakeNow.canShow(bonus)}}
					<div class="slotnew-info-warn -type-blue bgDark">
						<a class="link slotbld-addBonus">Получить ресурсы</a><br>
						{{=snip.resBigList(bonus.getUp().getTypedEffect())}}
					</div>
				{{?}}
			{{?}}
			<div class="slotnew-info-warn -type-red">
				<button class="button1 -disabled">Перестроить</button>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="slotbld.destroyAlert">
	{{var slotApply = it.slot;}}
	
	<div class="slotbld-destroyWnd">
		<div class="slotbld-alertWnd-title">Снести</div>
		<div>{{=snip.slotDestroyIcon(slotApply)}}{{=snip.slotFrame2(slotApply)}}</div>
		<div>{{=snip.buildLink(slotApply, snip.slotName(slotApply))+snip.slotLevelInfo(slotApply)}}</div>
		<div class="slotbld-alertWnd-time">{{=snip.time()}} {{=timeMgr.fPeriod(slotApply.getTime())}}</div>
		
		<br>
		
		{{var err = slotApply.canDestroyErr();}}
		{{?err == Slot.buildErr.ok}}
			<div>
				{{?slotApply.getLevel() != 1 && !slotApply.isWonder()}}
					<button class="button1 js-slotDestroy" data-onelevel="1">1 уровень</button>&nbsp;
				{{?}}
				<button class="button1 js-slotDestroy">Полностью</button>
			</div>
		{{??}}
			<div class="slotnew-info-warn -type-yellow">
				{{?err == Slot.buildErr.work}}Нельзя снести, здание работает
				{{??err == Slot.buildErr.queue}}Очередь строительства заполнена
				{{?}}
				<br/>
				{{?slotApply.getLevel() != 1}}
					<button class="button1 -disabled">1 уровень</button>&nbsp;
				{{?}}
				<button class="button1 -disabled">Полностью</button>
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="slotbld.swapAlert">
	<div class="slotbld-swapWnd">
		<div class="slotbld-alertWnd-title">Поменять местами</div>

		{{=tmplMgr.slotbld.swapAlert.slot({slot: it.slot1})}}

		<br>
		<br>

		{{=tmplMgr.slotbld.swapAlert.slot({slot: it.slot2})}}

		<br>
		<br>

		<div class="slotbld-alertWnd-title">
			Поменять местами эти здания за {{=snip.resCount(Resource.ids.luck, lib.luckbonus.swapslotcost)}}?
		</div>

		<br>
	<div>
</script>

<script type="text/plain" id="slotbld.swapAlert.slot">
	{{?it.slot.isEmpty()}}
		<div>{{=snip.emptySlot2(it.slot)}}</div>
		<div>{{=it.slot.getPos()}} квартал</div>
	{{??}}
		<div>{{=snip.slotFrame2(it.slot)}}</div>
		<div>{{=snip.buildLink(it.slot, snip.slotName(it.slot))+snip.slotLevelInfo(it.slot)}}</div>
	{{?}}
</script>

<script type="text/plain" id="slotbld.stockDestroyAlert">
	Внимание. Снос этого здания уменьшит вместимость складских помещений этого города на {{=utils.toInt(it.capacity)-utils.toInt(it.capacityNew)}} и составит {{=utils.toInt(it.capacityNew)}}.<br>
	Потери могут составить:<br>
	{{=snip.resList(it.looseRes)}}<br>
	Ты хочешь отдать команду на снос?
</script>

<script type="text/plain" id="slotbuy.header">
	{{=snip.slotTerrName(it.slot)}}. {{=it.slot.getPos()}} квартал
</script>

<script type="text/plain" id="slotbuy">
	{{var moneyEnough = it.cost <= (wofh.account.money.sum||0) - (wofh.account.money.reserve||0);}}
	
	<div class="view-slotbuy">
		<p>Потратив всего <span data-color="{{?it.cost>wofh.account.money.sum}}red{{?}}">{{=snip.resBigCount(new Resource(Resource.ids.money, it.cost))}}</span>, ты сможешь купить новое место под строительство здания.</p>
		
        <p>{{=snip.emptySlot({terrain: it.slot.getSlotType(), money: true})}}{{=snip.slotArrow()}}{{=snip.emptySlot({terrain: it.slot.getSlotType()})}}</p>
		
        {{?!moneyEnough}}
			<p>Но, к сожалению, пока тебе не хватает на это <b>{{=snip.resBigCount(new Resource(Resource.ids.money, Math.ceil(it.cost + (wofh.account.money.reserve||0) - wofh.account.money.sum)))}}</b>.</p>
		{{?}}
        
		<button class="button1 {{?!moneyEnough}}-disabled{{?}} js-slotbuy-btn">Купить</button>
	</div>
</script><script type="text/plain" id="slotnew.header">
    {{=snip.slotTerrName(it.slot)}}{{?!it.slot.isWonder()}}. {{=it.slot.getPos()}} квартал{{?}}
</script>

<script type="text/plain" id="slotnew">
    <div class="view-slotnew">
        {{?utils.sizeOf(it.tabs) == 0}}
            <div>Нет ни одного строения, которое сейчас можно здесь построить.<br>Но изучение новых наук или выполнение Начальных Заданий даст шанс исправить эту досадную ситуацию.</div>
        {{??}}
            {{?utils.sizeOf(it.tabs) > 1}}
                <div class="buildTabs">
                        {{@it.tabs: builds: tabId}}
							{{=snip.buildTab(tabId, {cls:'js-slotNew-tab'})}}
                        {{@}}
						{{=snip.buildTab(Slot.tabIds.all, {cls:'js-slotNew-tab'})}}
						
						{{?it.slot.isWonder()}}
							{{=snip.link(hashMgr.getWndHref('wonders', {town: it.slot.getTown(wofh.town).id}), 'Все Чудеса', 'slotNew-showWonders button1s -type-green')}}
						{{?}}
						
                        <a class="js-slotNew-canBuildBtn slotNew-canBuildBtn" data-title="Все здания"></a>
                        <a class="js-slotNew-canBuildBtn slotNew-canBuildBtn -active -hidden" data-title="Хватает ресурсов для строительства"></a>
                        
						<a class="js-slotNew-conflictBtn slotNew-conflictBtn" data-title="Отображение несовместимых зданий"></a>
                </div>
            {{?}}

            <div class="slotnew-center">
                <div class="slotnew-list-wrp">
                    <div class="slotnew-list">
						{{
							var slotsApply = it.slot.getTown(wofh.town).slots.clone().applyEvents();
							var futureBuilds = [];
						}}
						
                        {{@it.builds.getList(): slot}}
                            {{?slot.needScience}}
								{{futureBuilds.push(slot);}}
							{{??}}
                                {{
									var slot0 = slot.clone().setLevel(0);
									var hasConflictSlots = !slotsApply.getConflictSlots(slot).isEmpty();
								}}
                                <div 
    									class="slotnew-item js-slotNew-item" 
    									data-group="{{~slot.tabs: tab}}{{=tab}},{{~}}" 
    									data-id="{{=slot.getId()}}" 
    									data-conflict="{{=hasConflictSlots}}"
    									data-cantbuild="{{=slot0.canBuildErr() != Slot.buildErr.ok && slot0.canBuildErr() != Slot.buildErr.queue}}">
                                
                                    {{?slot0.canBuildErr() == Slot.buildErr.res}}
                                        <div class="slotnew-item-shadow"></div>
                                    {{?}}

                                    <div class="buildTabs-bar -lenLim -type-{{=Slot.tabs[slot.tabs[0]].name}}">
                                        {{=slot.getName()}}
                                        <div class="slotnew-bldWarnWrp">
                                            {{?slot0.canBuildErr() == Slot.buildErr.res}}
                                                <span class="slot-warnIcon -type-res" data-title="Недостаточно ресурсов для строительства"></span>
                                            {{?}}
                                            {{?slot.getPay()}}
                                                <span class="slot-warnIcon -type-pay" data-title="Здание требует денежного содержания"></span>
                                            {{?}}
                                            {{?hasConflictSlots}}
                                                <span class="slot-warnIcon -type-conflict" data-title="В городе несовместимое здание"></span>
                                            {{?}}
                                        </div>
                                    </div>

                                    <div class="slotnew-bldData">
                                        <div class="slotnew-bldTime" data-title="Время строительства">{{=timeMgr.fPeriod(slot.getTime())}}</div>
                                        <div class="slotnew-bldImgWrp">{{=snip.slotFrame2(slot)}}</div>
                                        <div class="slotnew-bldRes">{{=snip.resBigListCheck(slot.getCost(), it.slot.getTown(wofh.town))}}</div>
                                        <div class="slotnew-bldAction">{{=snip.slotStartBuildIcon(slot0)}}</div>
                                    </div>
                                </div>
                            {{?}}
                        {{@}}
						
                        {{@futureBuilds: slot}}
							{{var slot0 = slot.clone().setLevel(0);}}
							<div 
									class="slotnew-item js-slotNew-item -type-half -type-needScience" 
									data-group="{{~slot.tabs: tab}}{{=tab}},{{~}}"
									data-future="1">

								<div class="slotnew-item-shadow"></div>

								<div class="buildTabs-bar -lenLim -type-{{=Slot.tabs[slot.tabs[0]].name}}">
									{{=slot.getName()}}
								</div>

								<div class="slotnew-bldData">
									<div class="slotnew-bldImgWrp -type-unknown">{{=snip.slotFrame2(slot, {grey: true})}}</div>

									<div class="slotnew-needScience">
										<span class="needScience-text">Необходимо изучить</span>
                                        
										{{var pos = 0;}}
									
										{{@slot.needScience.getSortList(ScienceList.sortByAvailCost).getList(): science}}
											{{?pos++<2}}
												<div>{{=snip.scienceLink(science, {highlight: true, byCountry:true, ignoreParent:true})}}</div>
											{{?}}
										{{@}}
									</div>
								</div>
							</div>
                        {{@}}
                    </div>
                </div>
				
                <div class="slotnew-info js-slotNew-info"></div>
            </div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="slotnew.build">
    <div class="slotnew-info-top">
        {{var slotAct = it.slot.clone().setActive(false);}}
        <div class="slotnew-info-name -type-{{=Slot.tabs[it.tab].name}}" >{{=snip.buildLink(slotAct, false, {level: false})}}</div>


        <div class="slotnew-info-img-wrp">
            <div class="slotnew-info-img-slot">
                {{var disp = it.slot.getDisp(true); }}

                <div class="slotnew-info-img" style="top: {{=disp.y}}px;left: {{=disp.x}}px;">
                    {{=snip.buildImgBig(it.slot)}}
                </div>
            </div>
        </div>



        <table class="slotnew-info-params">{{=snip.buildParams(it.slot, false)}}</table>

        <div>
            {{var train = it.slot.getTrainUnits();}}
            {{?!train.isEmpty()}}
                <div class="slotnew-info-train">Обучаются в здании:</div>
            {{?}}
            {{@train.getList() : unit}}
                <div class="slotnew-info-unit">
                    {{=snip.unitLink(unit, snip.unitIcon(unit) + '<div class="slotnew-info-unitName -lenLim">' + unit.getName() + '</div>')}}
                </div>
            {{@}}
        </div>
    </div>

    <div class="slotnew-info-bottom">
        {{
			var slot0 = it.slot.clone().setLevel(0);
			var slotsApply = it.slot.getTown(wofh.town).slots.clone().applyEvents();
		}}

        {{?it.slot.getPay()}}
            <div class="slotnew-info-warn -type-yellow">
                <span class="slot-warnIcon -type-pay"></span> Здание требует денежного содержания
            </div>
        {{?}}
        {{?!slotsApply.getConflictSlots(it.slot).isEmpty()}}
            <div class="slotnew-info-warn -type-pink" style="background-color:#F1A589">
                <span class="slot-warnIcon -type-conflict"></span> В городе несовместимое здание
            </div>
        {{?}}
        <div class="slotnew-info-sbmWrp">
			{{?wofh.country && wofh.country.hasOrdersRes()}}
				<a class="slotnew-cost-makeOrder iconBuildSlot -act-order" data-title="Заявка на ресурсы"></a>
			{{?}}
            <a class="slotnew-info-bldAction js-slotbld-build">{{=snip.slotBuildButton(slot0)}}</a>
            <div class="slotnew-info-bldTime" data-title="Время строительства">{{=snip.time(timeMgr.fPeriod(it.slot.getTime()))}}</div>
            <div class="slotnew-info-bldRes">{{=snip.resBigListCheck(it.slot.getCost(), it.slot.getTown(wofh.town))}}</div>
        </div>
		{{var error = slot0.canBuildErr();}}
        {{?error == Slot.buildErr.needBonus}}
			{{var bonus = it.slot.getTown(wofh.town).getLuckBonus(LuckBonus.ids.production);}} 
			{{?wBonusTakeNow.canShow(bonus)}}
               	<div class="slotnew-info-warn -type-blue bgDark">
					<a class="link slotnew-addBonus">Получить ресурсы</a><br>
					{{=snip.resBigList(bonus.getUp().getTypedEffect())}}
               	</div>
			{{?}}
		{{?}} 
        {{?error == Slot.buildErr.res || error == Slot.buildErr.needBonus}}
            <div class="slotnew-info-warn -type-red">
                <span class="slot-warnIcon -type-res"></span> Недостаточно ресурсов для строительства
                <div>
                    {{var readyMoment = it.slot.getTown(wofh.town).stock.calcEnoughMoment(it.slot.getCost());}}
                    {{?readyMoment}}
                        {{=snip.title(snip.time(snip.timer(readyMoment, 'dec')), 'Прогноз по накоплению необходимых ресурсов для строительства')}}
                    {{?}}
					
                    {{=snip.resBigList(it.slot.getCost().excludeResList(it.slot.getTown(wofh.town).stock.getHasList()).onlyPositive().ceil())}}
                </div>
            </div>
        {{?}}
    </div>
</script>



		<script type="text/plain" id="stream.header">
	Снабжение
</script>

<script type="text/plain" id="stream.main">
	<div id="view-stream" class="view-stream">
		<div class="market-panel-wrp"></div>
		
		<div class="market-tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>


<script type="text/plain" id="stream.info">
    <div class="stream-info-block">
        <div class="stream-info-border -top"></div>
        <div class="stream-info">
            <div class="stream-info-resFilter-wrp">
                <div class="stream-info-resFilter-block js-resFilter-block">
                    {{=snip.resFilter({type: ResList.filter.type.select, select: it.initStream.res})}}
                    <input class="js-resFilterVal" type="hidden" name="res" value="{{=it.initStream.res}}">
                </div>
            </div>
            <div class="stream-info-settings">
                <table class="stream-info-settings-table">
                    <tr>
                        <td></td>
                        <td colspan="2">
                            <div class="stream-info-towns-wrp">
                                {{?it.defTown}}
                                    <div class="stream-info-towns">
                                        {{?it.towns.length > 1}}
                                            <span class="stream-info-townsImg js-stream-info-townsImg">{{=snip.townIconLink(it.defTown)}}</span>
                                            <select name="town" class="stream-info-towns-select js-stream-info-towns-townSelect">
                                                {{@it.towns: town: pos}}
                                                    <option value="{{=pos}}" {{?town.id==0}}disabled{{?}} {{?pos==0}}selected{{?}}>{{=town.name}}</option>
                                                {{@}}
                                            </select>
                                        {{??}}
                                            {{=snip.townLink(it.defTown)}}
                                            <input type="hidden" class="js-stream-info-towns-townSelect" value="0">
                                        {{?}}
                                    </div>
                                    <div class="stream-info-towns-account js-stream-info-towns-account">
                                        {{?it.defTown.avail}}
                                            {{=snip.accCountry(it.defTown.account, wofh.account.isPremium() ? it.defTown.account.country : undefined, {flag: 'normal'})}}
                                        {{?}}
                                    </div>
                                    <br>
                                    <span class="stream-info-towns-path js-stream-info-towns-path">
                                        {{?it.defTown.avail}}
                                            {{=tmplMgr.send.townPath({path:it.defTown.path, dist:it.defTown.dist, noPath:it.defTown.noPath})}}
                                        {{?}}
                                    </span>
                                    &nbsp;
                                    <span class="js-stream-info-time" data-title="Время необходимое для доставки груза"></span>
                                {{??}}
                                    <span class="clr0" style="padding: 5px; background-color: white;">У тебя нет ни одного города, куда можно отсюда осуществить доставку</span>
                                {{?}}
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>Ресурс:</td>
                        <td>
                            <span class='stream-info-res js-stream-info-res'>{{=snip.resBig(it.initStream.res)}}</span>
                            <input class='stream-info-input js-stream-info-res-input' autocomplete="off" min="1" value="{{=it.initStream.count}}" type='number' {{?!it.defTown}}disabled{{?}}>  в час
                        </td>
                        <td width="130px"></td>
                    </tr>
                    <tr>
                        <td>Торговцы:</td>
                        <td>
                        	{{=snip.trader()}}
                            <input 
									class='stream-info-input js-stream-info-traders-input' 
									autocomplete="off" 
									min="1" 
									value="{{=it.initStream.traders}}" 
									type='number' 
									{{?!it.defTown}}disabled{{?}}> в час
                        </td>
                        <td width="130px" style="padding-right:20px;text-align:right">Залог:</td>
                    </tr>
                    <tr>
                        <td>Цена {{=snip.hint('За 1000 единиц товара')}}:</td>
                        <td>
                            <span class='stream-info-res'>
                                {{=snip.resBig(Resource.ids.money)}}
                            </span>
                            <input 
                            		class="stream-info-input js-stream-info-cost-input" 
                            		autocomplete="off" 
                            		min="0" 
                            		value="{{=it.initStream.cost}}" 
                            		type='number' 
                            		name='cost' 
                            		{{?!it.defTown}}disabled{{?}}>
                        </td>
                        <td class="stream-info-pledge-wrp">
                            <span class="nobr">
                            	<span class='js-stream-info-resPledge'>{{=snip.resBig(it.initStream.res)}}</span>
                            	<span class="js-stream-info-resPledgeCount">{{=Trade.calcPledge(it.initStream.count)}}</span>
                            </span>
                        </td>
                    </tr>
                    <tr class="js-stream-info-speedUp-wrp -invis">
                        <td>Ускорение:</td>
                        <td>
                            <div class="stream-info-speedUp-wrp">
                                {{=snip.icon(snip.c.anyIcon, 'fuel')}}
                                <span class="stream-info-speedUp js-stream-info-speedUp">
                                    {{=tmplMgr.stream.speedUp({})}}
                                </span>
                                <span class="stream-info-speedUpCons js-stream-info-speedUpCons" data-title="Ресурсы которые будут затрачены на ускорение транспортировки"></span>
                            </div>
							
							<label class="stream-info-speedUpAir-wrp">
								{{var checkboxOpt = {name: 'useairway'};}}
								{{?it.defTown && it.defTown.onlyAirWay}}
									{{
										checkboxOpt.checked = true;
										checkboxOpt.disabled = true;
									}}
								{{?}}
								{{=snip.checkbox1(checkboxOpt)}} Доставка воздухом
							</label>
                        </td>
                        <td class="stream-info-pledge-wrp">
                            <span class="js-stream-info-speedUpPledge"></span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="stream-info-border -bottom"></div>

        <button class="button1 stream-info-performStream js-performStream -disabled" {{?!it.defTown}}disabled{{?}}>Выполнить</button>
    </div>


    <div class="tbl stream-info-streams js-stream-info-streams">
        <div class="tbl-thead">
            <div class="tbl-tr">
                <div class="tbl-th stream-info-streams-col-dir">{{=snip.btnTable('dir')}}</div>
                <div class="tbl-th stream-info-streams-col-water">{{=snip.btnTable('water')}}</div>
                <div class="tbl-th stream-info-streams-col-ally"></div>
                <div class="tbl-th stream-info-streams-col-acc">{{=snip.btnTable('account', snip.nobr(snip.townIcon() + snip.accIcon()), '')}}</div>
                <div class="tbl-th stream-info-streams-col-res">{{=snip.btnTable('res')}}</div>
                <div class="tbl-th stream-info-streams-col-count">{{=snip.btnTable('count')}}</div>
                <div class="tbl-th stream-info-streams-col-price">{{=snip.btnTable('price', 'Стоимость')}}</div>
                <div class="tbl-th stream-info-streams-col-fuel">{{=snip.btnTable('fuel', 'Содержание')}}</div>
                <div class="tbl-th stream-info-streams-col-traders">{{=snip.btnTable('traders', snip.trader())}}</div>
                <div class="tbl-th stream-info-streams-col-tax">Налог</div>
                <div class="tbl-th stream-info-streams-col-opt"></div>
            </div>
        </div>
		
        <div class="tbl-tbody js-stream-info-streams" style="max-height: {{=Math.max(utils.getWindowHeight(-369, 0), 100)}}px;"></div>
    </div>
</script>

<script type="text/plain" id="stream.tableStreams">
	{{@it.list: stream}}
		<div class="tbl-tr stream-info-stream-tr -dir-{{=stream.getDir()}} js-stream-info-stream" data-id="{{=stream.id}}" data-stage="{{=stream.getStage()}}">
			{{?stream.getStage() == Stream.stages.opening || stream.getStage() == Stream.stages.offer}}
				<div class="stream-info-streams-preparing"></div>
			{{?}}
			<div class="tbl-td stream-info-streams-col-dir">
				{{?wofh.country && wofh.country.id == (wofh.world.getCountryByTown(stream.getTown())||{}).id}}
					{{=snip.crown('Предложение в стране')}}
					<br>
				{{?}}
				<div class="stream-info-dir -dir-{{=stream.getDir()}}"></div>
			</div>
			<div class="tbl-td stream-info-streams-col-water -lenLim">
				{{?stream.getData('wayType') == Trade.wayType.w}}<div class="stream-info-water"></div>{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-ally">
				{{?stream.getData('ally')}}
					{{=snip.tradeUnion(undefined, wofh.tradeAllies.getElem(stream.getData('ally')).name)}}
				{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-acc -lenLim">
				{{=snip.townAccUnder(wofh.world.getTown(stream.getTown()))}}
			</div>
			<div class="tbl-td stream-info-streams-col-res">
				{{=snip.res(stream.getData('res'))}}
			</div>
			<div class="tbl-td stream-info-streams-col-count">
				<span class="{{?stream.getDir() == Stream.dirs.out}}stream-info-spend{{?}}" {{?stream.getDir() == Stream.dirs.out}}data-title="{{=utils.escapeHtml(tmplMgr.stream.pledge({res:stream.getData('res'), count:stream.getCount()}))}}"{{?}}>
					{{?stream.getDir() == Stream.dirs.out}}-{{?}}{{=utils.formatNum(stream.getCount(), {mixed: true})}}
				</span>
			</div>
			<div class="tbl-td stream-info-streams-col-price">
				{{?stream.calcPrice()}}
					{{=snip.res(Resource.ids.money)}}<span {{?stream.getDir() == Stream.dirs.in}}class="stream-info-spend"{{?}}><span data-title='{{=snip.res(Resource.ids.money)}}{{?stream.getDir() == Stream.dirs.in}}-{{?}}{{=utils.toFixed(stream.calcPrice(), 3)}}'>{{?stream.getDir() == Stream.dirs.in}}-{{?}}{{=utils.formatNum(stream.calcPrice(), {int: true, stages: true})}}</span></span>
				{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-fuel">
				{{var fuel = stream.getFuel();}}
				{{?stream.getDir() == Stream.dirs.out && fuel}}
					{{=snip.resCount(fuel.id, fuel.count.toFixed(1))}}
				{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-traders">
				{{?stream.getDir() == Stream.dirs.out && stream.getStage() != Stream.stages.offer}}{{=stream.getData('traders')}}{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-tax">
				{{var tax = utils.toInt(stream.getDir() == Stream.dirs.out ? stream.getTax1() : stream.getTax2());}}
				
				{{?tax}}
					{{=snip.resCount(Resource.ids.money, tax)}}
				{{?}}
			</div>
			<div class="tbl-td stream-info-streams-col-opt">
				{{?stream.getStage() == Stream.stages.offer && stream.getDir() == Stream.dirs.in}}
					<button class="button2 -type-accept js-acceptStream" data-title="Подтвердить"></button>
				{{?}}
				{{?stream.getStage() == Stream.stages.open}}
					<a class="button2 -type-menu" href="{{=HashMgr.getHref('#/streamChange/id='+stream.id)}}" data-title="Изменить"></a>
				{{?}}
				{{?stream.getStage() == Stream.stages.opening}}
					<div class="stream-info-timer">
						Подготовка
						<br>
						{{=snip.timer(stream.time, 'dec', timeMgr.fPeriod(stream.time - timeMgr.getNow()))}}
					</div>
					<button class="button2 -type-immediate js-immediateStream" data-title='{{=tmplMgr.stream.immediate({luck: stream.calcImmediateCost()})}}'></button>
				{{?}}
				<button class="button2 -type-delete fR js-delStream" data-id="{{=stream.id}}" data-title="Отменить"></button>
			</div>
		</div>
	{{@}}
</script>

<script type="text/plain" id="stream.sell">
    <div>
		<div class="stream-sell">
			<a class="button1" href="{{=HashMgr.getHref('#/streamOffer')}}">Выставить предложение</a>
		</div>
		<div class="tbl stream-sell-offers js-stream-sell-offers">
			<div class="tbl-thead">
				<div class="tbl-tr stream-sell-offers-tr">
					<div class="tbl-th stream-sell-offers-col-activity">{{=snip.btnTable('activity', snip.hint('Ручное управление присутствием предложения на рынке'),'')}}</div>
					<div class="tbl-th stream-sell-offers-col-res">{{=snip.btnTable('res')}}</div>
					<div class="tbl-th stream-sell-offers-col-count">{{=snip.btnTable('count')}}</div>
					<div class="tbl-th stream-sell-offers-col-type">{{=snip.btnTable('sell','Операция','')}}</div>
					<div class="tbl-th stream-sell-offers-col-cost">{{=snip.btnTable('cost','Цена','')}}</div>
					<div class="tbl-th stream-sell-offers-col-tcost">{{=snip.btnTable('tcost','Цена за торговца','')}}</div>
					<div class="tbl-th stream-sell-offers-col-distance">{{=snip.btnTable('distance',snip.ruler(),'')}}</div>
					<div class="tbl-th stream-sell-offers-col-text"></div>
					<div class="tbl-th stream-sell-offers-col-option"></div>
				</div>
			</div>
			<div class="tbl-tbody js-stream-offers" style="max-height: {{=Math.max(utils.getWindowHeight(-205, 0), 100)}}px;"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="stream.buy">
	<form class="js-stream-buy">
		<div class="stream-buy-resFilter-wrp js-stream-buy-resFilter-wrp">
			<div class="stream-buy-resFilter-block-res js-resFilter-block">
				{{=snip.resFilter.inline({type:ResList.filter.type.extend, select:ls.getStreamFilter(Trade.getStreamFilter()).res, showAll:true})}}
				
				<input class="js-resFilterVal" type="hidden" name="res" value="{{=ls.getStreamFilter(Trade.getStreamFilter()).res}}">
			</div>
			
			<div class="stream-buy-stream">
				<label class="crP">{{=snip.radio1({cls:'js-resFilterVal', title: 'Продавать', name:'type', value: Trade.type.sell, checked: Trade.isSell(ls.getStreamFilter(Trade.getStreamFilter()).type)})}}Продавать</label>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<label class="crP">{{=snip.radio1({cls:'js-resFilterVal', title: 'Покупать', name:'type', value: Trade.type.buy, checked: Trade.isBuy(ls.getStreamFilter(Trade.getStreamFilter()).type)})}}Покупать</label>
				
				{{?wofh.country}}
					&nbsp;&nbsp;&nbsp;&nbsp;
					<label class="crP">{{=snip.checkbox1({cls:'js-resFilterVal', title:'Только в стране', name:'onlycountry', checked: ls.getStreamFilter(Trade.getStreamFilter()).onlycountry})}} Только в стране</label>
				{{?}}
			</div>
		</div>
		
		<div class="list-page-nav-wrp">
			<a class="page-nav-prev"></a>
			<a class="page-nav-next"></a>

			<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-170, 0), 100)}}px;">
				<div class="buy-list-wrp"></div>
			</div>
		</div>
	</form>
</script>

<script type="text/plain" id="stream.buy.list">
	<table class="table01 stream-buy-offersTable" cellspacing="0">
		<colgroup>
			<col class="stream-offersTable-col1">
			<col class="stream-offersTable-col2">
			<col class="stream-offersTable-col3">
			<col class="stream-offersTable-col4">
			<col class="stream-offersTable-col5">
			<col class="stream-offersTable-col6">
			<col class="stream-offersTable-col7">
			<col class="stream-offersTable-col8">
		</colgroup>
		
		<thead>
			<tr class="cw_head_tr">
				<td></td>
				<td></td>
				<td><div>Город</div></td>
				<td><div class="t_cw_sep_l">Ресурс</div></td>
				<td><div class="t_cw_sep_l">Стоимость</div></td>
				<td><div class="t_cw_sep_l">Время</div></td>
				<td></td>
				<td></td>
			</tr>
		</thead>
		
		<tbody>
			{{~it.offers: offer: pos}}
				<tr class="trow js-stream-buy-offer {{?!+offer.count}}cl-grey{{?}}" data-pos="{{=pos}}">
					<td class="aC">
						{{?offer.inCountry}}
							{{=snip.crown('Предложение в стране')}}
						{{?}}
					</td>
					<td>
						{{?offer.ally}}
							<div class="lenLim indent">
								{{?offer.ally == it.countryAlly}}
									{{=snip.countryFlag(wofh.country, {flag:'normal'})}}
								{{??}}
									{{=snip.tradeUnion(wofh.tradeAllies.getElem(offer.ally).name)}}
								{{?}}
							</div>
						{{?}}
					</td>
					<td>
						<div class="lenLim stream-buy-town indent">
							{{?offer.town}}
								{{=snip.townAccUnder(offer.town)}}
							{{??}}
								<span class="fwN">{{=snip.townLink()}}</span>
							{{?}}
						</div>
					</td>
					<td class="nobr"><div class="indent">{{=snip.resCount(offer.res, offer.count)}}</div></td>
					<td class="nobr"><div class="indent">{{=snip.resCount(Resource.ids.money, utils.toFixed((offer.cost + offer.tSum) * 0.001, 3))}}</div></td>
					<td class="aC">
						{{?offer.time}}
							{{=timeMgr.fPeriod(offer.time)}}
						{{??}}
							?
						{{?}}
					</td>
					<td class="aL">
						{{=utils.lenLim(offer.text)}}
					</td>
					<td class="aC">
						<input type="submit" class="stream-buy-buyOffer {{?it.type != 'buy'}}-sell{{?}}" value="{{?it.type=='buy'}}Купить{{??}}Продать{{?}}">
					</td>
				</tr>
			{{~}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="stream.buyOfferPopUp">
	<form class="streamPopup-buy-offer js-streamPopup-buy-offer">
		{{?it.alert}}
			<div class="streamPopup-buy-offer-alert">
				{{=it.alert}}
			</div>
		{{?}}
		
		<div class="streamPopup-buy-offer-slider js-streamPopup-buy-offer-slider">
			<div class="slider"></div>
		</div>
		
		<table class="streamPopup-buy-offer-table">
			<tr>
				<td>Поставка:</td>
				<td>
                    {{=snip.res(it.offer.res)}}
					{{=snip.input1({cls: 'streamPopup-buy-offer-resInput spinbox', name: 'res', disabled: it.type != 'res' || !it.sell, autocomplete: 'off'})}}
					
					{{?it.sell}}
						{{=snip.radio1({name: 'type', value: 'res', checked: it.type == 'res'})}}
					{{?}}
				</td>
				<td>в час</td>
			</tr>
			<tr>
				<td>Торговцы:</td>
				<td>
					{{=snip.input1({cls: 'streamPopup-buy-offer-tradersInput spinbox', name: 'traders', disabled: it.type != 'traders', autocomplete: 'off'})}}
					
					{{?it.sell}}
						{{=snip.radio1({name: 'type', value: 'traders', checked: it.type == 'traders'})}}
					{{?}}
				</td>
				<td>в час</td>
			</tr>
			<tr>
				<td>За {{=snip.trader()}}:</td>
				<td>
					{{=snip.title(snip.resCount(Resource.ids.money, utils.toFixed(it.offer.tcost * 0.001, 3)), '+' + snip.resCount(Resource.ids.money, utils.toFixed(it.offer.tSum * 0.001, 3)) + ' к каждой единице ресурса', '', {escape:true})}}
				</td>
				<td>в час</td>
			</tr>
			<tr style="border-bottom: 1px solid black;">
				<td>За ед. товара:</td>
				<td>{{=snip.resCount(Resource.ids.money, utils.toFixed(it.offer.cost * 0.001, 3))}}</td>
				<td>в час</td>
			</tr>
			<tr>
				<td>Стоимость:</td>
				<td>
                    {{=snip.res(Resource.ids.money)}}
					<span class="streamPopup-buy-offer-summ js-offer-sum"></span>
				</td>
				<td>в час</td>
			</tr>
			<tr>
				<td>Залог:</td>
				<td>
					{{?it.sell}}
                        {{=snip.res(it.offer.res)}}
					{{??}}
						{{=snip.res(Resource.ids.money)}}
					{{?}}
					<span class="streamPopup-buy-offer-pledge js-offer-pledge"></span>
				</td>
			</tr>
		</table>
		
		<button type='submit' class="button1 -disabled js-makeStream">Ок</button>
	</form>
</script>

<script type="text/plain" id="stream.speedUp">
    <select name="speedUp" class="stream-info-speedUpSelect js-stream-info-speedUpSelect js-select-styled">
        {{?it.speedUp}}
            <option value="" pathtype="{{?it.speedUp.minEffectPathWayType}}{{=it.speedUp.minEffectPathWayType}}{{??}}{{=it.selectedPath.wayType}}{{?}}" class="select-default">Ничего</option>
			
			{{@it.speedUp.list: fuel}}
				<option value="{{=fuel.getId()}}" pathtype="{{=fuel.speedUpInfo.path.wayType}}" {{?fuel.speedUpInfo.selected}}selected="selected"{{?}} class="select-normal">{{=fuel.getName()}}</option>
			{{@}}

        {{??}}
            <option value="">Ничего</option>
        {{?}}
    </select>
</script>

<script type="text/plain" id="stream.pledge">
	Залог: {{=snip.resCount(it.res, Trade.calcPledge(it.count))}}
</script>

<script type="text/plain" id="stream.immediate">
	{{?wofh.account.getCoinsAll() < it.luck && !wofh.account.isAdmin()}}
		{{=tmplMgr.snipet.noCoins({popUp:true})}}
		<br>
		<br>
	{{?}}
	Открыть немедленно за {{=it.luck}} Мон. Удачи
</script>

<script type="text/plain" id="stream.tableSellOffers">
	{{@it.list: offer}}
		<div class="tbl-tr stream-sell-offersData-tr {{?!offer.isAvail()}}-unAvail{{?}} js-editOffer" data-id="{{=offer.id}}">
			<div class="tbl-td stream-sell-offers-col-activity">
				<span class="js-activity-wrp">
					{{=snip.checkbox1({cls: 'js-changeOfferAvailability', attrs: {'data-id': offer.id}, checked: offer.isAvail()})}}
				</span>
			</div>
			<div class="tbl-td stream-sell-offers-col-res">
				{{=snip.res(offer.res)}}
			</div>
			<div class="tbl-td stream-sell-offers-col-count">
				{{=utils.formatNum(offer.getCount(), {stages:true})}}
			</div>
			<div class="tbl-td stream-sell-offers-col-type -lenLim">
				{{var ally = wofh.tradeAllies.getElem(offer.ally);}}
				{{?offer.sell}}
					{{?offer.ally == 0}}
						продаю
					{{??offer.ally == lib.tradeally.blackmarket}}
						продаю на черном рынке
					{{??offer.ally > 0}}
						{{?ally.country}}
							продаю в стране
						{{??}}
							продаю в {{=snip.tradeUnion(ally.name)}}
						{{?}}
					{{?}}
				{{??}}
					{{?offer.ally == 0}}
						покупаю
					{{??}}
						{{?ally.country}}
							покупаю в стране
						{{??}}
							покупаю в {{=snip.tradeUnion(ally.name)}}
						{{?}}
					{{?}}
				{{?}}
			</div>
			<div class="tbl-td stream-sell-offers-col-cost">
				{{=snip.resCount(Resource.ids.money, utils.toFixed(offer.cost * 0.001, 3))}}
			</div>
			<div class="tbl-td stream-sell-offers-col-tcost">
				{{=snip.resCount(Resource.ids.money, utils.toFixed(offer.tcost * 0.001, 3))}}
			</div>
			<div class="tbl-td stream-sell-offers-col-distance">
				{{=offer.distance}}
			</div>
			<div class="tbl-th stream-sell-offers-col-text">
				{{=tmplMgr.stream.tableSellOffers.text({offer: offer})}}
			</div>
			<div class="tbl-td stream-sell-offers-col-option">
				<button class="button2 -type-menu" data-id="{{=offer.id}}"></button>
				<button class="button2 -type-delete js-delOffer" data-id="{{=offer.id}}"></button>
			</div>
		</div>
	{{@}}
</script>

<script type="text/plain" id="stream.tableSellOffers.text">
	{{=utils.lenLim(it.offer.text, {length:18})}}
</script>	

<script type="text/plain" id="stream.offerTax">
	Налог {{=snip.res(Resource.ids.money) + utils.toFixed(it.tax, 2)}}
</script>

<script type="text/plain" id="stream.confirm">
	<div>
		<table class="stream-info-performConfirm">
			<tbody>
				<tr>
					<td class="aR">Город:</td>
					<td>{{=snip.townAccLink(it.streamInfo.town)}}</td>
				</tr>
				<tr>
					<td class="aR">Торговцев:</td>
					<td>{{=it.streamInfo.traders}}</td>
				</tr>
				<tr>
					<td class="aR">Время:</td>
					<td>
						{{=snip.time(timeMgr.fPeriod(it.streamInfo.selectedPath.time) + (wofh.account.isPremium() ? ' в ' + snip.timer(it.streamInfo.selectedPath.time, 'inc') : '') )}}
					</td>
				</tr>
				<tr>
					<td class="aR">Операция:</td>
					<td>продажа</td>
				</tr>
				<tr>
					<td class="aR">Объем:</td>
					<td>{{=snip.resBigCount(it.streamInfo.res)}}  в час</td>
				</tr>
				<tr>
					<td class="aR">Оплата:</td>
					<td>
						{{=snip.resCount(Resource.ids.money, (it.streamInfo.cost * it.streamInfo.res.getCount() * 0.001).toFixed(3))}}  в час 
						({{=snip.resCount(Resource.ids.money, (it.streamInfo.cost * 0.001).toFixed(3))}} за ед.)
					</td>
				</tr>
				{{?it.streamInfo.transportCons}}
					<tr>
						<td class="aR">Транспорт:</td>
						<td>{{=snip.resBigCount(it.streamInfo.transportCons)}}</td>
					</tr>
				{{?}}
				<tr>
					<td class="aR">Залог:</td>
					<td>
						{{?it.streamInfo.res.needPledge()}}
							{{=snip.nobr( snip.resBigCount(it.streamInfo.res.id, Trade.calcPledge(it.streamInfo.res.count)) )}}
						{{?}}
						{{?it.streamInfo.transportCons}}
							{{=snip.nobr( snip.resBigCount(it.streamInfo.transportCons.id, Trade.calcPledge(it.streamInfo.transportCons.count)) )}}
						{{?}}
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</script>





<script type="text/plain" id="streamOffer.header">
	{{?it.offer.id}}Изменение предложения{{??}}Выставить свое предложение{{?}}
</script>

<script type="text/plain" id="streamOffer">
	<form class="streamPopup-sell-offer js-streamPopup-sell-offer">
		<div class="streamPopup-resFilter-wrp">
			<div class="streamPopup-resFilter-type">
				<label class="button1 {{?it.offer.sell != undefined && it.offer.sell}}-active{{??it.offer.id}}-disabled{{?}} {{?!it.offer.id}}crP{{?}}">
					<input type="radio" name="type" value="sell" class="operation-type dN js-operation-type" {{?it.offer.sell != undefined && it.offer.sell}}checked="checked"{{?}}>
					Продать
				</label>
				<br><br>
				<label class="button1 {{?it.offer.sell != undefined && !it.offer.sell}}-active{{??it.offer.id}}-disabled{{?}} {{?!it.offer.id}}crP{{?}}">
					<input type="radio" name="type" value="buy" class="operation-type dN js-operation-type" {{?it.offer.sell != undefined && !it.offer.sell}}checked="checked"{{?}}>
					Купить
				</label>
			</div>
			
			<div class="streamPopup-resFilter js-streamPopup-resFilter js-resFilter-block">
				{{=snip.resFilter({type: ResList.filter.type.select, disabled: it.disabled, select: it.offer.res})}}
				<input class="js-resFilterVal" type="hidden" name="res" value="{{=it.offer.res}}">
			</div>
			
			<div class="streamPopup-text-wrp">
				<textarea class="streamPopup-text textarea1 bgLight" {{?!wofh.account.canMessage()}}disabled="disabled"{{?}} name="text" maxlength="{{=lib.trade.maxstreamoffertext}}">{{=it.offer.text}}</textarea>
				{{?!wofh.account.canMessage()}}
					{{=snip.alert(snip.alertTmpl.blocked.message())}}
				{{?}}
			</div>
			
		</div>
		
		<div class="streamPopup-offerCount-wrp">
			<div>Количество (в час)</div>
			<div class="streamPopup-offerCount-slider js-streamPopup-offerCount-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="streamPopup-offerTcost-wrp">
			<div>Цена за торговца (в час)</div>
			<div class="streamPopup-offerTcost-slider js-streamPopup-offerTcost-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="streamPopup-offerCost-wrp">
			<div>Цена</div>
			<div class="streamPopup-offerCost-slider js-streamPopup-offerCost-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="streamPopup-offerDist-wrp js-streamPopup-offerDist-wrp">
			<div>
				Расстояние
			</div>
			<div class="streamPopup-offerDist-slider js-streamPopup-offerDist-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="streamPopup-offerAlly-wrp">
			{{?it.offer.id}}
				{{var ally = wofh.tradeAllies.getElem(it.offer.ally);}}
				{{?it.offer.ally == 0}}
					{{=snip.tradeUnion('Для всех')}}
				{{??ally.country}}
					{{=snip.tradeUnion('Страна')}}
				{{??}}
					{{=snip.tradeUnion(ally.name)}}
				{{?}}
				<input type="hidden" name="ally" value="{{=it.offer.ally}}">
			{{??}}
				<select class="select1" name="ally">
					<option value="0">Для всех</option>
					{{@wofh.tradeAllies.getList():ally}}
						<option value="{{=ally.id}}" {{?it.offer.ally == ally.id}}selected="selected"{{?}}>{{?ally.country}}Страна{{??}}{{=ally.name}}{{?}}</option>
					{{@}}
				</select>
			{{?}}
		</div>
		<p>
			<button type='submit' class="button1 js-setOffer">Выставить предложение</button>
			{{?it.offer.id}} 
				<a class="button1 -type-red streamPopup-delOffer js-delOffer">Удалить</a>
			{{?}}
		</p>
	</form>
</script>






<script type="text/plain" id="streamChange.header">
	Изменить объем снабжения   из  {{=snip.town(it.stream.town1, it.stream.account1, wofh.country)}}  в  {{=snip.town(it.stream.town2, it.stream.account2, wofh.country)}}
</script>

<script type="text/plain" id="streamChange">
	<div class="streamPopup-changeStream">
		<form class="streamPopup-changeStream-settings js-settings">
			<table>
				<colgroup>
					<col width="30%">
					<col width="70%">
				</colgroup>
				
				<tbody>
					<tr>
						<td align=right>Количество: </td>
						<td align=left>
							{{=snip.resBig(it.stream.res)}}
							<input class="streamPopup-changeStream-input js-changeStream-count input1 spinbox" type="tel" autocomplete="off" value="{{=it.stream.getCount()}}" name="count">&nbsp;<span class="js-chgPopupCount"></span> в час</td>
					</tr>
					<tr>
						<td align=right>Число торговцев:</td>
						<td align=left>
							{{=snip.trader()}}
							<input class="streamPopup-changeStream-input js-changeStream-traders input1 spinbox" type="tel" autocomplete="off" value="{{=it.stream.traders}}" name="traders">
							<div class="streamPopup-changeStream-slider slider js-tradersSlider"></div>
							&nbsp;
							<span class="js-chgPopupTraders"></span>
						</td>
					</tr>
					{{?it.stream.changePrice}}
						<tr>
							<td align=right>Цена {{=snip.hint('За 1000 единиц товара')}}:</td>
							<td align=left>
								{{=snip.res(Resource.ids.money)}}<input class="streamPopup-changeStream-input input1 spinbox" type="tel" name="cost" autocomplete="off" value="{{=utils.toInt(it.stream.cost)}}">
								<div class="streamPopup-changeStream-slider slider js-costSlider" data-icon="money"></div>
								{{?it.stream.timer}}{{=snip.alert('Повысить цену можно будет через: '+it.stream.timer)}}{{?}}
								&nbsp;
								<span class="js-chgPopupCost"></span>
							</td>
						</tr>
						<tr>
							<td align=right>Цена за торговца:</td>
							<td align=left>
								{{=snip.res(Resource.ids.money)}}
								<input class="streamPopup-changeStream-input input1 spinbox" data-spinbox-float="true"  data-spinbox-step="0.1" type="number" name="tcost" autocomplete="off" value="{{=utils.formatNum(it.stream.tcost * 0.001, {uFixed:1})}}">
								<div class="streamPopup-changeStream-slider slider js-tcostSlider" data-icon="money"></div>
								{{?it.stream.timer}}
									{{=snip.alert('Повысить цену можно будет через: '+it.stream.timer)}}
								{{?}}
								&nbsp;
								<span class="js-chgPopupTcost"></span>
							</td>
						</tr>
					{{??}}
						<tr>
							<td align=right>Цена {{=snip.hint('За 1000 единиц товара')}}:</td>
							<td align=left>
								{{=snip.resCount(Resource.ids.money, utils.toInt(it.stream.cost))}}
							</td>
						</tr>
						<tr>
							<td align=right>Цена за торговца:</td>
							<td align=left>
								{{=snip.resCount(Resource.ids.money, it.stream.tcost * 0.001, {filter:'formatNum', fixed:1})}}
							</td>
						</tr>
					{{?}}
					<tr>
						<td align=right>Оплата: </td>
						<td align=left>{{=snip.res(Resource.ids.money)}}<span class="js-popupPrice">{{=utils.stages(it.stream.price.toFixed(1))}}</span><span class="js-chgPopupPrice"></span><span class="clr5"> в час</span></td>
					</tr>
					{{?it.stream.dir == 'out'}}
						<tr class="js-popupFuelRow">
							<td align=right>Содержание:</td>
							<td align=left class="js-popupFuelWrp"></td>
						</tr>
					{{?}}
					<tr>
						<td align=right class="js-popupPledgeTitle">Залог:</td>
						<td align=left class="js-popupPledgeWrp"></td>
					</tr>
					{{?it.stream.dir == 'out' && it.stream.canUpFuel()}}
						<tr>
							<td align=right>Ресурс для ускорения:</td>
							<td align=left>
							    <select class="streamChg-speedUp js-select-styled select1" name="fuel">
							    	{{?it.stream.fuel}}
		                                <option value="{{=it.stream.fuel.id}}" class="select-normal">{{=it.stream.fuel.getName()}}</option>
							        {{??}}
		                                <option value="0" class="select-default">Ничего</option>
							        {{?}}
									{{@ it.stream.getUpFuels().sortByCount(true).getList(): res}}
		                                {{?Trade.isFuelScienceAvailable(res.id)}}
		                                    <option value="{{=res.id}}" class="select-normal">{{=res.getName()}}</option>
		                                {{?}}
									{{@}}
							    </select>
							</td>
						</tr>
					{{?}}
					
					<tr>
						<td colspan=2>
							<br>
							<button type="button" class="button1 -disabled js-change">Установить</button>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
</script>

<script type="text/plain" id="streamChange.fuel">
	<div>
		{{@it.list.getList(): res}}
			<div>
				{{=snip.resCount(res, res.count.toFixed(1))}}&nbsp;
				{{?res.count != res.countOld}}
					{{var delta = res.count - res.countOld;}}
					(<span class="cl-{{=delta > 0? 'green' : 'red'}}">{{=snip.sign(delta, utils.stages(delta.toFixed(1)))}}</span>)
				{{?}}
				<span class="clr5"> в час</span>
			</div>
		{{@}}
		{{?it.list.isEmpty()}} - {{?}}
	</div>
</script>

<script type="text/plain" id="streamChange.pledge">
	<div>
		{{@it.list.getList(): res}}
			<div>
				{{=snip.resCount(res, res.count.toFixed(1))}}&nbsp;
				
				{{?res.count != res.countOld}}
					{{var delta = res.count - res.countOld;}}
					(<span class="cl-{{=delta > 0? 'green' : 'red'}}">{{=snip.sign(delta, utils.stages(delta.toFixed(1)))}}</span>)
					
					{{var stockOverflow = (wofh.town.getRes(res).getHas() - delta) - wofh.town.getStock().getMax();}}
					
					{{?stockOverflow > 0}}
						 
						{{=tmplMgr.streamChange.pledge.alert({dir:Stream.dirs.out, res:res, stockOverflow:stockOverflow})}}
					{{?}}
				{{?}}
			</div>
		{{@}}
	</div>
</script>

<script type="text/plain" id="streamChange.pledge.alert">
	{{?it.dir == Stream.dirs.out}}
		{{var text = 'Внимание. Текущей вместимости хранилища города не хватит, чтобы вместить весь объем залога. Будет потеряно безвозвратно '+ snip.resCount(it.res, it.stockOverflow, {filter: 'formatNum', int: true}) +'.';}}
	{{??}}
		{{var text = 'Изменения условий снабжения может привести к высвобождению залоговых ресурсов. При этом они могут не поместиться в хранилища '+ snip.town(it.town) +'.';}}
	{{?}}

	 {{=snip.alert(text)}}
</script>	
<script type="text/plain" id="support.header">
    Поддержка
</script>

<script type="text/plain" id="support">
    <div class="view-support">
		<div class="support-consoleErrors-wrp"></div>
		
		<div class="tabs tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
    </div>
</script>

<script type="text/plain" id="support.consoleErrors">
	<button class="consoleErrors-button button1s">
		Важные данные
		 
		{{=snip.alert('Важные данные', {blink: true})}}
	</button>
</script>

<script type="text/plain" id="support.private">
	{{?!debug.isAdmin()}}
		<div class="static">
			<div class="sup-head">
				<form>
					<dl>
						<dt>Заголовок:</dt>
						<dd>
							<input type="text" name="topic" class="input1 js-inpTopic" value="{{=it.ticketTxtBackup.topic||''}}">
							<div class="aR">Осталось  <span class="js-inpTopicLength"></span>  символов.</div>
						</dd>
						
						<dt>Суть проблемы:</dt>
						<dd>
							<textarea name="text" class="textarea1 js-txtaText">{{=it.ticketTxtBackup.text||''}}</textarea>
							<div class="aR">Осталось  <span class="js-txtaTextLength"></span>  символов.</div>
							<div class="sup-hint">Все поля должны быть заполнены</div>
						</dd>
					</dl>
					<br>
					<div class="aC"><button class="button1 -disabled js-addTicket" type="submit" class="">Отправить</button></div>
				</form>
			</div>
		</div>
	{{?}}
	
	<div class="tickets">
		<h4 class="js-ticketsHeader {{?!it.list || it.list.length}}hidden{{?}}">Другие твои обращения:</h4>
		
		{{=tmplMgr.support.tickets(it)}}
	</div>
</script>

<script type="text/plain" id="support.tickets">
	<div class="sup-list-wrp js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(it.maxHeightOffset||-400, 0), 200)}}px;">
		{{=tmplMgr.support.tickets.cont(it)}}
	</div>
</script>

<script type="text/plain" id="support.tickets.cont">
	<ul class="sup-list scroll">
		{{~it.list: ticket: pos}}
			{{=tmplMgr.support.ticket({ticket:ticket, pos:pos, page: it.page})}}
		{{~}}
	</ul>
</script>

<script type="text/plain" id="support.ticket">
	{{?debug.isAdmin()}}
		{{var label = Ticket.getLabelFromLS(it.ticket.id);}}
	{{?}}
	
	<li class="ticket-item" data-label="{{=label||''}}" data-id="{{=it.ticket.id}}">
		<a href="#ticket" class="js-ticket" data-id="{{=it.ticket.id}}">
			{{?it.ticket.account}}<div>{{=it.pos+(it.page||0)+1}} <b>{{=snip.acc(new Account(it.ticket.account))}}</b></div>{{?}}
			<div><b>{{=it.ticket.topic}}</b></div>
			{{?debug.isAdmin()}}
				<div>
					<span class="ticket-num">№ {{=it.ticket.id}}</span>
					
					<span class="ticket-label" data-type="{{=label}}"></span>
				</div>
			{{?}}
			<div class="status{{=it.ticket.status}}">
				{{?it.ticket.status  == wTicket.ids.userSend}}Открыто
				{{??it.ticket.status == wTicket.ids.adminSend}}Ответ дан
				{{??it.ticket.status == wTicket.ids.userClose}}Решено
				{{??it.ticket.status == wTicket.ids.adminClose}}Закрыто
				{{??it.ticket.status == wTicket.ids.hold}}В работе
				{{?}}
			</div>
		</a>
	</li>
</script>



<script type="text/plain" id="ticket.header">
    Обращение  {{=it.id}}
</script>

<script type="text/plain" id="ticket">
    <div class="view-ticket">
		<div class="ticket-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="ticket.view">		
	{{?it.admin}}
		<div class="sup-admin">
			<div class="ticket-selectLabel">
				{{var label = Ticket.getLabelFromLS(it.id);}}
				
				<select class="select1" name="label">
					{{@Ticket.labels: labelInfo}}
						<option value="{{=labelInfo.type}}" {{?label == labelInfo.type}}selected{{?}}>{{=labelInfo.type}}</option>
					{{@}}
				</select>
				
				<span class="ticket-label" data-type="{{=label}}"></span>
			</div>
			
			<div class="sup-templ">
				<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-100)}}px; min-height: 20px;">
					<ul class="scroll">{{=tmplMgr.ticket.templates(it.templates)}}</ul>
				</div>
				<form method="post" class="-disabled">
					<textarea name="text" class="textarea1"></textarea>
					<button type="submit" class="button1 -disabled">Добавить шаблон ответа</button>
				</form>
			</div>
		</div>
	{{?}}
	
	<div class="sup-ticket{{?it.admin}} admin{{?}}">
		<h4 class="aC">Заголовок: {{=it.topic}}</h4>

		{{?wofh.account.isAdmin()}}<div class="sup-agentinfo">{{=it.agent}}</div>{{?}}
		
		<div class="js-scroll-wrp" style="max-height: {{=utils.getWindowHeight( -150 )}}px; min-height: 55px;">
			<ul class="sup-list scroll">{{=tmplMgr.ticket.messages(it)}}</ul>
			{{?it.status  == wTicket.ids.userClose || it.status  == wTicket.ids.adminClose}}
				<p class="aC">Обращение закрыто</p>
				{{?it.status==2}}
					<p class="aC">Оценка ответа:</p>
					<div class="sup-stars rate{{=it.rate}} finished"></div>
				{{?}}
			{{??}}
				<form class="sup-sendMessage" method="post">
					<div class="sup-reply" style="position: relative;">
						<div class="sup-reply-text">
							<textarea name="text" class="textarea1 js-txtaText"></textarea>
							<div class="aR">Осталось  <span class="js-txtaTextLength"></span>  символов.</div>
						</div>
						
						<button class="button1 -type-green" type="submit">Ответить</button>

						{{?it.admin && it.status == wTicket.ids.userSend}}
							<a class="sup-hold-show button1 -type-grey">Отложить</a>
							<div class="sup-hold-wrp -hidden" style="position: absolute;">
								{{var colors = ['grey', 'blue', 'green', 'gold', 'brown', 'red'];}}
								{{@lib.ticket.holdtime: time: i}}
									<a class="sup-hold button1 -type-{{=colors[i]}}" data-time="{{=time * 3600}}">на {{=timeMgr.fPeriod(time * 3600)}}</a>
								{{@}}
							</div>
						{{?}}

						<a class="sup-close button1 -type-red">{{?it.admin}}Закрыть обращение{{??it.author}}Проблема решена, закрыть обращение{{?}}</a>
					</div>

					<div class="sup-vote dN aC">
						<p>Обращение закрыто.</p>
						<p>Оцени ответ поддержки:</p>
						<div class="sup-stars"></div>
					</div>
				</form>
			{{?}}
			{{?it.admin}}
				<form class="sup-info">
					<h4>Примечания</h4>
					<textarea name="text" class="textarea1">{{=it.info}}</textarea>
					<div class="aC"><button type="submit" class="button1 js-saveSupInfo -type-green">Сохранить</button></div>
				</form>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="ticket.templates">
	{{~it :template}}
		<li><a class="iconDel js-delTemplate" data-ttid="{{=template.id}}"></a><a class="sup-useTempl">{{=template.text}}</a></li>
	{{~}}
</script>

<script type="text/plain" id="ticket.messages">
	{{~it.messages: message}}
		<li data-tmid="{{=message.id}}">
			<div>
				{{?it.admin}}<a class="iconDel js-delMessage" data-id="{{=it.id}}" data-tmid="{{=message.id}}"></a>{{?}}
				{{=snip.accLink(message.account)}}&nbsp;
				<span>{{=timeMgr.fMoment(message.time)}}</span>
			</div class="sup-text">
			<div>{{=TextParser.prepare(message.text, {extLinks: true})}}</div>
		</li>
	{{~}}
</script>




<script type="text/plain" id="swapSlotWnd.header">
	Перепланировка 
</script>

<script type="text/plain" id="swapSlotWnd">
    <div class="view-swapSlotWnd">
		<div class="swapSlot-slots" data-type="{{=wSwapSlot.defSlotType}}">
			{{@it.town.getSlots().getList(): slot}}
				{{?slot.canSwapErr() != Slot.buildErr.ok}}{{continue;}}{{?}}
				
				<div class="swapSlot-slot" data-pos="{{=slot.getPos()}}" data-type="{{=slot.getSlotType()}}">
					{{?slot.isEmpty()}}
						{{=snip.emptySlot2(slot)}}
					{{??}}
						{{=snip.slotFrame2(slot, {grey: !slot.isActive(), showLabel: true})}}
					{{?}}
				</div>
			{{@}}
		</div>
	</div>
</script>
<script type="text/plain" id="tactics.header">
	Шаблоны тактик боя
</script>

<script type="text/plain" id="tactics">
    <div class="view-tactics">
		<div class="tabs tabs-wrp"></div>

		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="tactics.list">
	<div class="view-tactics-list js-scroll-wrp" style="height: {{=utils.getWindowHeight(-177)}}px;">
		{{?debug.isTest('later') && false}}
			{{?it.tactics.isMaxOverflow()}}
				<div class="view-tactics-list-alertOverflow">
					{{=tmplMgr.alert.tactics.overflow({count:it.tactics.getMaxOverflowCount()})}}
				</div>
			{{?}}
			
			{{
				var tactics = new TacticsList();
				var tacticsCount = Math.max(it.tactics.getLength(), it.tactics.getMaxLength());
				for(var i = 0; i < tacticsCount; i++){
					tactics.addElem((it.tactics.getElem(i)||new Tactic()).clone());
				}
			}}
			
			{{@tactics.getList():tactic}}
				{{=tmplMgr.tactics.list.tactic({tactic:tactic})}}
			{{@}}
		{{??}}
			<div class="view-tactics-listItem -addNewTactic view-tactics-common -com-rounded -com-shadow-black -com-shadowEffect" data-title="Перейти к созданию нового шаблона тактики">
				Создать новый шаблон тактики
				
				<div class="view-tactics-addIcon -addNewTactic view-tactics-addIcon"></div>
			</div>
			
			{{=tmplMgr.tactics.list.list({tactics:it.tactics})}}
		{{?}}
	</div>
</script>



<script type="text/plain" id="tactics.list.list">
	{{var oneTactic = false;}}
	{{?it.tactics.getLength() == 1}}
		{{oneTactic = true;}}
	{{??it.tactics.getLength() == 2}}
		{{var secondTactic = it.tactics.getLastElem();}}
		{{?secondTactic.getWaves().getLength() || secondTactic.getRules().getLength() || secondTactic.getReserve2().getArmy().getLength()}}
			/**/
		{{??}}
			{{oneTactic = true;}}
		{{?}}
	{{?}}
	
	{{?oneTactic}}
		<span class="view-tactics-editMain-oneTactic"></span>
	{{?}}
	
	{{@it.tactics.getList():tactic}}
		{{?!tactic.isEmpty()}}
			{{=tmplMgr.tactics.list.tactic({tactic:tactic})}}
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="tactics.list.tactic">
	{{?debug.isTest('later') && false}}
		{{?it.tactic.getId()}}
			<div class="view-tactics-listItem view-tactics-common -com-bg -com-rounded {{?it.tactic.getIndex() > TacticsList.getMaxLength()}}-com-shadow-red{{??}}-com-shadow{{?}} -com-shadowEffect" data-index="{{=it.tactic.getIndex()}}" data-id="{{=it.tactic.getId()}}">
				<span class="view-tactics-listItemInfo">
					
					<div class="view-tactics-listItemName lenLim" data-title="{{=it.tactic.getName()}} ({{=it.tactic.getWaves().getLength()}})">
						{{var text = it.tactic.getName() + ' ('+it.tactic.getWaves().getLength()+')';}}

						{{?it.tactic.getId() && it.tactic.getSecret()}}
							<div class="view-tactics-listItemNameTag">
								{{=snip.clipboardWrp(tmplMgr.snipet.clipboard({tag:'i' + it.tactic.getId() + '/' + it.tactic.getSecret(), active:true}))}}
							</div>
							<div class="view-tactics-listItemNameText">
								{{=text}}
							</div>
						{{??}}
							{{=text}}
						{{?}}
					</div>

					<br>
					<span class="view-tactics-listItemRules">
						Правил: {{=it.tactic.getRules().getLength()}}
						<br>
						В резерве: {{=it.tactic.getReserve2().getArmy().getLength()}}
					</span>
				</span>

				{{?it.tactic.getRules().getLength()}}
					<div class="view-tactics-listItemRulesArmy">
						{{@it.tactic.getRules().getList():rule}}
							{{?rule.getIndex() > 4}}{{break;}}{{?}}
							{{?rule.getConds().getLength()}}
								{{=tmplMgr.tactics.ruleCondsList({conds:rule.getConds(), onlyUnit:true})}}
							{{?}}
						{{@}}
					</div>
				{{?}}

				<div class="view-tactics-listItemOption -editTactic button2 -type-menu" data-title="Перейти к редактированию шаблона этой тактики"></div>
				<div class="view-tactics-listItemOption -deleteTactic button2 -type-delete" data-title="Удалить шаблон этой тактики"></div>
				<div class="view-tactics-listItemOption -useTactic">
					<button class="button1 -type-green js-useTactic">Использовать</button>
					<span class="js-useTacticAlert"></span>
				</div>
			</div>
		{{??}}
			<div class="view-tactics-listItem -addNewTactic view-tactics-common -com-rounded -com-shadow-black -com-shadowEffect" data-title="Перейти к созданию нового шаблона тактики">
				Создать новый шаблон тактики
				
				<div class="view-tactics-addIcon -addNewTactic view-tactics-addIcon"></div>
			</div>
		{{?}}
	{{??}}
		<div class="view-tactics-listItem view-tactics-common -com-bg -com-rounded -com-shadow -com-shadowEffect" data-index="{{=it.tactic.getIndex()}}" data-id="{{=it.tactic.getId()}}">
			<span class="view-tactics-listItemInfo">

				<div class="view-tactics-listItemName lenLim" data-title="{{=it.tactic.getName()}} ({{=it.tactic.getWaves().getLength()}})">
					{{var text = it.tactic.getName() + ' ('+it.tactic.getWaves().getLength()+')';}}

					{{?it.tactic.getId() && it.tactic.getSecret()}}
						<div class="view-tactics-listItemNameTag">
							{{=snip.clipboardWrp(tmplMgr.snipet.clipboard({tag:'i' + it.tactic.getId() + '/' + it.tactic.getSecret(), active:true}))}}
						</div>
						<div class="view-tactics-listItemNameText">
							{{=text}}
						</div>
					{{??}}
						{{=text}}
					{{?}}
				</div>

				<br>
				<span class="view-tactics-listItemRules">
					Правил: {{=it.tactic.getRules().getLength()}}
					<br>
					В резерве: {{=it.tactic.getReserve2().getArmy().getLength()}}
				</span>
			</span>

			{{?it.tactic.getRules().getLength()}}
				<div class="view-tactics-listItemRulesArmy">
					{{@it.tactic.getRules().getList():rule:index}}
						{{?index > 4}}{{break;}}{{?}}
						{{?rule.getConds().getLength()}}
							{{=tmplMgr.tactics.ruleCondsList({conds:rule.getConds(), onlyUnit:true})}}
						{{?}}
					{{@}}
				</div>
			{{?}}

			<div class="view-tactics-listItemOption -editTactic button2 -type-menu" data-title="Перейти к редактированию шаблона этой тактики"></div>
			<div class="view-tactics-listItemOption -deleteTactic button2 -type-delete" data-title="Удалить шаблон этой тактики"></div>
			<div class="view-tactics-listItemOption -useTactic">
				<button class="button1 -type-green js-useTactic">Использовать</button>
				<span class="js-useTacticAlert"></span>
			</div>
		</div>
	{{?}}
</script>



<script type="text/plain" id="tactics.edit">
	<div>
		<div class="view-tactics-editWrp">
			<div class="view-tactics-edit view-tactics-editMain">
				<div class="view-tactics-editMain-tacticListWrp">

					<div class="view-tactics-editMain-addNewTactic" data-title="Создать новый шаблон тактики"></div>

					<div class="view-tactics-editMain-tacticListScroll">
						<div class="view-tactics-editMain-tacticList">
							{{=tmplMgr.tactics.namesList({tactics:it.tactics})}}
						</div>
					</div>
				</div>
				
				<div class="activeTactic-scroll-block" style="max-height: {{=utils.getWindowHeight(-200)}}px;">
					<div class="view-tactics-editMain-tacticData">
						{{=tmplMgr.tactics.tactic.data({tactic:it.activeTactic})}}
					</div>
				</div>

				<div class="view-tactics-editMain-saveTacticWrp">
					<div class="view-tactics-editMain-saveTacticAlertWrp"></div>
					
					<button class="button1 -type-green -disabled js-saveTactic">Сохранить шаблон тактики</button>
					
					{{?it.canUseTactic}}
						<button class="button1 -type-gold -disabled js-useTactic">
							<span class="view-tactics-editMain-useTactic-wrp">Использовать</span>
						</button>
						{{?it.noTacticsChange}}
							<span class="js-useTacticAlert">
								{{=snip.alert('Нельзя изменить тактику во время боя')}}
							</span>
						{{?}}
					{{?}}
				</div>
			</div>

			<div class="view-tactics-edit view-tactics-editTemplates js-view-tactics-editTemplates">
				<div class="view-tactics-editTemplates-title">Шаблоны отрядов</div>
				
				<div class="tactics-templateList-wrp js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-203)}}px;">
					<div class="view-tactics-editTemplates-templateList view-tactics-common -com-rounded">
						{{=tmplMgr.tactics.templates({templates: it.templates})}}
					</div>
				</div>
			</div>
		</div>

		<div class="view-tactics-editShadow"></div>
		
		<div class="view-tactics-editSaving js-view-tactics-editSaving"></div>
	</div>
</script>

<script type="text/plain" id="tactics.namesList">
	{{?!debug.isTest('later') && false}}
		{{?it.tactics.getLength() < 2}}
			<span class="view-tactics-editMain-oneTactic"></span>
		{{?}}
	{{?}}
	
	{{@it.tactics.getList():tactic}}
		{{=tmplMgr.tactics.tacticName({tactic:tactic})}}
	{{@}}
</script>

<script type="text/plain" id="tactics.tacticName">
	<span class="view-tactics-editMain-tacticNameWrp {{?it.tactic.active}}-active{{?}}" data-index="{{=it.tactic.getIndex()}}" data-id="{{=it.tactic.getId()||''}}" data-title="{{?it.tactic.active}}Переименовать шаблон тактики{{??}}Перейти к шаблону этой тактики{{?}}">
		<span class="view-tactics-editMain-tacticName">{{=it.tactic.getName()}}</span>
		<div class="view-tactics-editMain-deleteTactic button2 -type-delete" data-title="Удалить шаблон этой тактики"></div>
		<div class="view-tactics-editMain-saveTacticName button2 -type-accept" data-title="Подтвердить"></div>
		<div class="view-tactics-editMain-cancelTacticName button2 -type-cancel" data-title="Отменить"></div>
	</span>
</script>

<script type="text/plain" id="tactics.tacticNameEdit">
	<input type="text" value="{{=it.name}}" class="view-tactics-editMain-tacticNameEdit">
</script>

<script type="text/plain" id="tactics.tactic.data">
	{{?it.tactic}}
		<div class="view-tactics-editMain-wavesWrp">
			{{=tmplMgr.tactics.waves({waves:it.tactic.getWaves()})}}
		</div>
		
		<div class="view-tactics-editMain-addNewWave view-tactics-common -com-rounded -com-shadow-black -com-shadowEffect {{?it.tactic.getWaves().getLength() >= lib.war.tactics.maxwaves}}-hidden{{?}}">
			<div class="view-tactics-editMain-addNewWaveTitle">Создать новый отряд</div>
			<div class="view-tactics-editMain-addNewWaveIcon view-tactics-addIconBig"></div>
		</div>
		
		<div class="view-tactics-editMain-rulesWrp view-tactics-common -com-shadow-black">
			<div class="view-tactics-editMain-rulesTitle">Условие для правил выхода остальных отрядов</div>
			<div class="view-tactics-editMain-rules">
				{{=tmplMgr.tactics.rules({rules:it.tactic.getRules()})}}
			</div>
		</div>
		
		<div class="view-tactics-editMain-reserve2Wrp view-tactics-common -com-shadow-black -com-shadowEffect">
			<div class="view-tactics-editMain-reserve2Title">Войска второго резерва {{=snip.hint('Войска второго резерва вступают в бой только после окончания первого резерва')}}</div>
			<div class="view-tactics-editMain-reserve2">
				{{=tmplMgr.tactics.reserve2({reserve2: it.tactic.getReserve2()})}}
			</div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="tactics.waves">
	{{@it.waves.getList():wave}}
		{{=tmplMgr.tactics.wave({wave:wave})}}
	{{@}}
</script>

<script type="text/plain" id="tactics.wave">
	<div class="view-tactics-editMain-wave view-tactics-common -com-bg -com-rounded -com-shadow -com-shadowEffect" data-index="{{=it.wave.getIndex()}}">
		{{=tmplMgr.tactics.wave.cont({wave:it.wave})}}
	</div>
</script>

<script type="text/plain" id="tactics.wave.cont">
	<span class="view-tactics-editMain-waveRange view-tactics-common -com-bg-light -com-rounded -com-shadow -com-shadowEffect">{{=it.wave.getRange().start}}{{?it.wave.getRange().end}}-{{=it.wave.getRange().end}}{{?}}</span>
	<span class="view-tactics-editMain-waveUpls-wrp">
		{{=tmplMgr.tactics.wave.upls({upls:it.wave.getUpls()})}}
	</span>
	<div class="view-tactics-editMain-deleteWave button2 -type-delete"></div>
	<div class="view-tactics-editMain-appendToTemplate"><a class="link">Добавить в шаблон</a></div>

	<div class="view-tactics-editMain-waveData">
		{{=tmplMgr.tactics.wave.data({wave:it.wave})}}
	</div>
</script>

<script type="text/plain" id="tactics.wave.upls">
	<span class="{{?utils.formatNum(it.upls||wTactics.uplsDef, {toPercent:true, epsilon:true, int:true}) == utils.formatNum(wTactics.uplsDef, {toPercent:true})}}cl-grey{{?}}">
		Отряд <input class="view-tactics-editMain-upls input1 spinbox" data-spinbox-step="5" type="text" value="{{=utils.toPercent(it.upls||wTactics.uplsDef)}}"> единиц
	</span>
</script>

<script type="text/plain" id="tactics.wave.data">
	<div class="view-tactics-editMain-waveArmy">
		{{var index = 0;}}
		{{@it.wave.getArmy().getList(): unit}}
			<span class="view-tactics-editMain-army-unitWrp {{?(++index) != it.wave.getArmy().getLength()}}-separator{{?}}" style="width: {{=utils.toInt(unit.getCount())}}%">
				<span class="view-tactics-editMain-army-unit">
					{{=tmplMgr.tactics.editWaveUnit({unit:unit})}}
					<div class="view-tactics-editMain-army-unitPercent">{{=utils.formatNum(unit.getCount(), {uFixed:0})}}%</div>
					<div class="view-tactics-editWave-armyUnitPlaces">
						{{=tmplMgr.tactics.editWaveUnitPlaces({unit:unit, upls:it.wave.getUpls()})}}
					</div>
				</span>
			</span>
		{{@}}
	</div>
</script>

<script type="text/plain" id="tactics.wave.range">
	<div class="view-tactics-editMain-waveRangeWrp">
		<div>Диапазон волн атаки</div>
		
		<div class="slider view-tactics-editMain-waveRangeSlider"></div>
		
		<button class="button1 js-saveWaveRange">Сохранить</button>
	</div>
</script>

<script type="text/plain" id="tactics.rules">
	{{@it.rules.getList():rule}}
		{{=tmplMgr.tactics.rule({rule:rule})}}
	{{@}}
	
	{{?it.rules.getLength() < lib.war.tactics.maxrules}}
		<div class="view-tactics-editMain-addNewRule view-tactics-common -com-rounded -com-shadow-black -com-shadowEffect">
			<div class="view-tactics-editMain-addNewRuleTitle">Создать новое правило</div>
			<div class="view-tactics-editMain-addNewRuleIcon view-tactics-addIconBig"></div>
			<div class="view-tactics-editMain-ruleData"></div>
		</div>
	{{?}}
</script>

<script type="text/plain" id="tactics.rule">
	<div class="view-tactics-editMain-rule view-tactics-common -com-bg -com-rounded -com-shadow -com-shadowEffect" data-index="{{=it.rule.getIndex()}}">
		{{=tmplMgr.tactics.rule.cont(it)}}
	</div>
</script>

<script type="text/plain" id="tactics.rule.cont">
	<div class="view-tactics-editMain-ruleSorter"></div>
	
	<div class="view-tactics-editMain-ruleData">
		{{=tmplMgr.tactics.rule.data({rule:it.rule})}}
	</div>

	<div class="view-tactics-editMain-ruleOption -editRule button2 -type-menu"></div>
	<div class="view-tactics-editMain-ruleOption -deleteRule button2 -type-delete"></div>
	<div class="view-tactics-editMain-ruleArrow"></div>
</script>

<script type="text/plain" id="tactics.rule.data">
	<div class="view-tactics-editMain-ruleData-units">
		{{@it.rule.getArmy().getList(): unit}}
			<span class="view-tactics-editMain-ruleData-unit">
				{{=snip.unitIcon(unit, {tooltip:true})}}
			</span>
		{{@}}
	</div>
	<div class="view-tactics-editMain-ruleData-rule">
		{{?it.rule.getConds().getLength()}}
			{{=tmplMgr.tactics.ruleCondsList({conds:it.rule.getConds(), showSpoiler:true})}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="tactics.reserve2">
	<div class="view-tactics-editMain-reserve2AddWrp">
		<div class="view-tactics-editMain-reserve2Add view-tactics-common -com-rounded -com-shadow-black">
			<div class="view-tactics-editMain-reserve2AddIcon view-tactics-addIcon"></div>
		</div>
		<br>
		Добавить
	</div>
	
	{{var index = 0;}}
	{{@it.reserve2.getArmy().getList(): unit}}
		<span class="view-tactics-editMain-army-unitWrp -reserve2Unit {{?(++index) != it.reserve2.getArmy().getLength()}}-separator{{?}}">
			<span class="view-tactics-editMain-army-unit">
				{{=tmplMgr.tactics.editWaveUnit({unit:unit})}}
				<div class="view-tactics-editMain-army-unitPercent"><span class="view-tactics-common -com-fsize-16">{{=utils.formatNum(unit.getCount(), {uFixed:0})}}</span>%</div>
			</span>
		</span>
	{{@}}
</script>

<script type="text/plain" id="tactics.editWaveUnitCount">
	{{var count = Math.min(it.ruleCond.getCountMax(), Math.max(it.ruleCond.getCount(), it.ruleCond.getCountMin()));}}
	
	{{?it.ruleCond.isFortUnit()}}
		<select class="view-tactics-editWave-ruleCount select1 js-ruleCount">
			{{for(var i=it.ruleCond.getCountMin(); i<=it.ruleCond.getCountMax(); i++){}}
				<option value="{{=i}}" {{?count==i}} selected{{?}}>{{=i}}</option>
			{{ } }}
		</select>
	{{??}}
		<input class="view-tactics-editWave-ruleCount -type-input input1 spinbox js-ruleCount" data-min="{{=it.ruleCond.getCountMin()}}" data-max="{{=it.ruleCond.getCountMax()}}" type="text" value="{{=count}}">
		
		<input type="button" class="view-tactics-editWave-ruleCountType select1 js-ruleCountType {{?!it.ruleCond.hasUnit() || it.ruleCond.isOnlyNumericCountType()}}-type-fixCountType{{?}}" data-type="{{=it.ruleCond.getCountType()}}" {{?it.ruleCond.isNumericCountType()}}data-title="Габаритные единицы — количество мест занимаемое в бою"{{?}} value="{{=it.ruleCond.getCountTypeText()}}">
	{{?}}
</script>

<script type="text/plain" id="tactics.editWaveUnit">
	<div class="view-tactics-editWave-unit {{?it.noDrag}}-type-noDrag{{?}} {{?it.selected}}-selected{{?}} {{?it.canSelect}}js-selectUnit{{?}} {{?it.unit.isTemplate()}}-unitTemplate js-unitTemplate{{?}} {{?it.tagFilter && !it.tagFilter.match('[' + it.unit.getTagsCodes() + ']')}}-unitLongFiltered{{?}} {{?it.unit.data.editing}}-editing{{?}}" data-id="{{=it.unit.getId()}}">
		{{=snip.unitIcon(it.unit, {tooltip:true, cls:' crP'})}}
		{{?it.showBattleCost}}
			<div class="view-tactics-editWave-unitBattleCost">
				{{=it.unit.getBattleCost()}}
			</div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="tactics.editWaveUnitPlaces">
	{{var places = it.unit.isTemplate() ? 0 : utils.toFixed(it.unit.getCount()*(it.upls||wTactics.uplsDef)/it.unit.getBattleCost(), 1);}}
	{{?places}}<span data-title="{{=places}} мест в отряде из расчета на {{=utils.toPercent(it.upls||wTactics.uplsDef)}} единиц">{{=places}}</span>{{?}}
</script>

<script type="text/plain" id="tactics.editWaveArmyUnits">
	{{var army = it.army;}}
	{{?army && army.getLength()}}
		{{var index = 0;}}
		{{@army.getList(): unit}}
			<span class="view-tactics-editWave-armyUnitWrp {{?(++index) != army.getLength()}}-separator{{?}}" data-id="{{=unit.getId()}}" style="width: {{?army.isReserve}}80px{{??}}{{=unit.getCount()}}%{{?}}">
				<span class="view-tactics-editWave-armyUnit js-selectArmyUnit {{?!army.isReserve && (army.getLength() == 1 || army.getLength() == army.maxLength) }}-cantChange{{?}}">
					{{=tmplMgr.tactics.editWaveUnit({unit:unit, tagFilter:it.tagFilter})}}
					<div class="view-tactics-editWave-armyUnitPercent {{?army.getLength() > 1 && army.getLength() < army.maxLength || army.isReserve}}-canChange{{?}}">
						{{=tmplMgr.tactics.editWaveArmyUnitPercentText({percent:utils.toFixed(unit.getCount(), 0)})}}
					</div>
					<div class="view-tactics-editWave-armyUnitPlaces">
						{{=tmplMgr.tactics.editWaveUnitPlaces({unit:unit, upls:it.upls})}}
					</div>
					<div class="view-tactics-editWave-armyUnitOption -increase">+</div>
					<div class="view-tactics-editWave-armyUnitOption -reduce">-</div>
					<div class="view-tactics-editWave-armyUnitOption -deleteArmyUnit button2 -type-delete"></div>
				</span>
			</span>
		{{@}}
	{{??}}
		<div class="view-tactics-editWave-armyUnitDrop">
			<span class="view-tactics-editWave-armyUnitDropText -nobr">Добавить сюда любые войска</span>
		</div>
		<div class="view-tactics-editWave-armyTemplateDrop">
			<span class="view-tactics-editWave-armyTemplateDropText -nobr">или шаблоны войск...</span>
		</div>
	{{?}}
</script>

<script type="text/plain" id="tactics.editWaveArmyUnitPercentText">
	<span class="bgLight fakelink input1-bg">{{=it.percent}}%</span>
</script>

<script type="text/plain" id="tactics.editWaveArmyUnitPercent">
	<input class="view-tactics-editWave-armyUnitPercentSet spinbox js-percentSet" value="{{=it.count}}">
</script>

<script type="text/plain" id="tactics.editWaveUnits">
	{{  
		units = Army.getAll();
		for (var era = 0; era < Unit.erasLength; era++) {
	}}
			{{@ units.getList(): unit }}
				{{? unit.getHealth() > 0 && unit.getEra() == era && !unit.hasAbility(Unit.ability.no_attack) && !unit.hasAbility(Unit.ability.noFight) && !unit.hasTag(Unit.tags.aircraft) && !unit.hasTag(Unit.tags.ship)}}
					{{=tmplMgr.tactics.editWaveUnit({unit:unit, canSelect:true, showBattleCost:true, selected:it.army.hasElem(unit.getId()), tagFilter:it.tagFilter})}}
				{{?}}
			{{@}}
	{{ } }}
	{{?it.WRTR.isRule() || it.WRTR.isTemplate()}}
		<div class="mt25">
			{{=tmplMgr.tactics.editWaveUnit({unit:new Unit(Unit.ids.fort), canSelect:false, showBattleCost:true, noDrag:it.WRTR.getConds().hasFortUnit()})}}
			
			{{=tmplMgr.tactics.editWaveUnit({unit:new Unit(Unit.ids.any), canSelect:false, showBattleCost:true,})}}
		</div>
	{{?}}
</script>

<script type="text/plain" id="tactics.cleanTmplUnit">
	<span class="unit -uTmpl -clean" data-title="{{?it && it.title}}{{=it.title}}{{?}}"></span>
</script>

<script type="text/plain" id="tactics.unitsSetting">
	<div class="view-tactics-editWave-unitsSetting">
		<div class="view-tactics-editWave-unitsSetting-view">
			<div class="view-tactics-editWave-unitsSetting-tagsSelected">
				<div class="view-tactics-editWave-unitsSetting-tagsSelected-necessarily -negativeTemplate">
					{{?it.getTmplFirstTag()}}
						<label><input type="checkbox" class="js-negativeFirstTag" {{?it.isTmplFirstTagNeg()}}checked="checked"{{?}}>Не</label>
					{{?}}
				</div>
				
				<div class="view-tactics-editWave-unitsSetting-tagsSelected-desirable -negativeTemplate">
					{{?it.getTmplSecondTag()}}
						<label><input type="checkbox" class="js-negativeSecondTag" {{?it.isTmplSecondTagNeg()}}checked="checked"{{?}}>Не</label>
					{{?}}
				</div>
				
				<div class="view-tactics-editWave-unitsSetting-tagsSelected-necessarily">
					{{?it.getTmplFirstTag()}}
						<div class="view-tactics-editWave-unitsSetting-tag js-selectTag -tagBig -selected js-necessarily" data-code="{{=Unit.getTagCode(it.data.firstTag)}}">
							<span>{{=utils.lenLim(Unit.getTagName(it.data.firstTag, it.isTmplFirstTagNeg()), {length: 16, noDecor: true})}}</span>
						</div>
					{{??}}
						<div class="view-tactics-editWave-unitsSetting-tagsSelected-empty">
							<div class="view-tactics-editWave-unitsSetting-tagsSelected-addIcon view-tactics-addIcon"></div>
						</div>
					{{?}}
				</div>
				
				<div class="view-tactics-editWave-unitsSetting-tagsSelected-desirable">
					{{?it.getTmplSecondTag()}}
						<div class="view-tactics-editWave-unitsSetting-tag js-selectTag -tagBig -selected js-desirable" data-code="{{=Unit.getTagCode(it.data.secondTag)}}">
							<span>{{=utils.lenLim(Unit.getTagName(it.data.secondTag, it.isTmplSecondTagNeg()), {length: 16, noDecor: true})}}</span>
						</div>
					{{??it.getTmplFirstTag()}}
						<div class="view-tactics-editWave-unitsSetting-tagsSelected-empty">
							<div class="view-tactics-editWave-unitsSetting-tagsSelected-addIcon view-tactics-addIcon"></div>
						</div>
					{{?}}
				</div>

			</div>
			
			<div class="view-tactics-editWave-unitsSetting-preview">
				{{=tmplMgr.tactics.editWaveUnitTemplate(it)}}
			</div>

			<div class="view-tactics-editWave-unitsSetting-tagsPriority">
				<div class="view-tactics-editWave-unitsSetting-tagsPriority-necessarily">
					Обязательно
				</div>
				
				{{?it.getTmplFirstTag()}}
					<div class="view-tactics-editWave-unitsSetting-tagsPriority-desirable">
						<div class="view-tactics-editWave-unitsSetting-tagsChangePriority">
							{{?it.getTmplPriority()}}
								Желательно
							{{??}}
								Обязательно
							{{?}}
						</div>
					</div>
				{{?}}
				
			</div>
		
		</div>
		
		<div class="view-tactics-editWave-unitsSetting-tags">
			{{=tmplMgr.tactics.editWaveUnitTags(it)}}
		</div>
		
		{{?it.isTemplate()}}
			<button class="button1 -type-green js-saveUnitTemplate">Сохранить</button>
			<div class="editWave-actionDelimiter"></div>
			<button class="button1 -type-red js-deleteUnitTemplate">Удалить</button>
		{{?}}
	</div>
</script>

<script type="text/plain" id="tactics.editWaveUnitTemplate">
	{{?it && it.isTemplate()}}
		{{=snip.unitIcon(it, {tooltip:true})}}
	{{??}}
		<div class="view-tactics-editWave-unitTemplate -clean"></div>
	{{?}}
</script>

<script type="text/plain" id="tactics.editWaveUnitTags">
	{{@Unit.tags: tag: tagKey}}
		{{var tagName = Unit.getTagName(tag);}}
		{{?tagName && Unit.isTacticsTag(tag)}}
			<div class="view-tactics-editWave-unitsSetting-tag {{?it}}-tagBig js-selectTag {{?it.data.firstTag == tag || it.data.secondTag == tag}}-selectedInList{{?}}{{??}}-tagFilter js-tagFilter{{?}}" data-code="{{=Unit.getTagCode(tag)}}">
				{{=snip.icon(snip.c.unitTagIcon, tagKey)}} <span class="tactics-editWave-tagName">{{=utils.lenLim(tagName, {length: it ? 11 : 9, noDecor: true})}}</span>
			</div>
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="tactics.templates">
	{{@it.templates.getList(): template}}
		{{=tmplMgr.tactics.template({template: template})}}
	{{@}}
	
	<div class="view-tactics-editTemplates-emptyTemplate js-emptyTemplate">
		<div class="view-tactics-editTemplates-templateData"></div>
	</div>
</script>

<script type="text/plain" id="tactics.template">
	<div class="view-tactics-editTemplates-template view-tactics-common -com-bg -com-rounded -com-shadow -com-shadowEffect {{?it.template.getConds().getLength()}}js-hasRule{{?}}" data-index="{{=it.template.getIndex()}}">
		{{=tmplMgr.tactics.template.cont(it)}}
	</div>
</script>

<script type="text/plain" id="tactics.template.cont">
	<div class="view-tactics-editTemplates-templateData">
		{{=tmplMgr.tactics.template.data({template: it.template})}}
	</div>
	
	<div class="view-tactics-editTemplates-templateOption -editTemplate button2 -type-menu"></div>
	
	<div class="view-tactics-editTemplates-templateOption -deleteTemplate button2 -type-delete"></div>
</script>

<script type="text/plain" id="tactics.template.data">
	<div class="view-tactics-editTemplates-templateData-units">
		{{@it.template.getArmy().getList(): unit}}
			<span class="view-tactics-editTemplates-templateData-unit">
				{{=snip.unitIcon(unit, {tooltip:true})}}
			</span>
		{{@}}
	</div>
	<div class="view-tactics-editTemplates-templateData-rule">
		{{?it.template.getConds().getLength()}}
			{{=tmplMgr.tactics.ruleCondsList({conds:it.template.getConds()})}}
		{{??}}
			<span class="-warn" style="text-decoration: underline;"><strong>Без правила</strong></span>
		{{?}}
	</div>
</script>

<script type="text/plain" id="tactics.ruleCondsList">
	{{?it.onlyUnit}}
		{{
			var conds = new TacticRuleCondsList();
			conds.addElem(it.conds.getFirstElem());
			it.conds = conds;
		}}
	{{?}}
	
	{{?it.showSpoiler}}
		<div class="view-tactics-editMain-ruleData-spoiler">
	{{?}}

	{{@it.conds.getList(): ruleCond}}
		{{?!it.showSpoiler && ruleCond.getIndex() > 2}}{{continue;}}{{?}}
		{{=tmplMgr.tactics.ruleCondSnipet({ruleCond: ruleCond, onlyUnit:it.onlyUnit, condsType:it.conds.getType()})}}
	{{@}}

	{{?it.showSpoiler}}
		</div>
		{{?it.conds.getLength()>3}}
			<div class="view-tactics-ruleCondSpoiler">...</div>
		{{?}}
	{{?}}
</script>

<script type="text/plain" id="tactics.ruleCondSnipet">
	{{?it.onlyUnit}}
		{{return snip.unitIcon(it.ruleCond.getUnit(), {tooltip:true});}}
	{{?}}
	
	<span {{?it.ruleCond.getIndex()>2}}class="view-tactics-ruleOtherCond"{{?}}>
		{{?+it.ruleCond.getIndex() && it.condsType == TacticRuleCondsList.type.AND}}
			<div class="view-tactics-ruleCondType">+</div>
		{{?}}
		
		<div class="view-tactics-ruleCond -type-{{?it.ruleCond.isMySide()}}my{{??}}enemy{{?}}">
			{{=snip.unitIcon(it.ruleCond.getUnit(), {tooltip:true})}}
			<div class="view-tactics-ruleCondInfo">
				{{=it.ruleCond.getEquality()}}{{=it.ruleCond.getCount()}}
				{{?!(it.ruleCond.isFortUnit() || it.ruleCond.isNumericCountType())}}
					<span class="view-tactics-ruleCondPercent">%</span>
				{{?}}
			</div>
		</div>
	</span>
</script>

<script type="text/plain" id="tactics.alertBufferSize">	
	{{?it.err}}
		Ты не можешь сохранить 
		{{?it.type == 'template'}}
			этот шаблон
		{{??it.type == 'unitTemplate'}}
			этот шаблон юнита
		{{?}}
		. 
		<br>
		Хранилище данных переполнено. {{=snip.hint('Хранилище используется для информации о тактиках, шаблонах и прочих настройках. Его объем достаточен для обычной игры. Но активные игроки могут столкнуться с нехваткой места.')}}
	{{??}}
		Место в хранилище данных заканчивается. {{=snip.hint('Хранилище используется для информации о тактиках, шаблонах и прочих настройках. Его объем достаточен для обычной игры. Но активные игроки могут столкнуться с нехваткой места.')}}
		<br>
		Скоро ты не сможешь добавить туда новые 
		{{?it.type == 'template'}}
			шаблоны
		{{??it.type == 'unitTemplate'}}
			шаблоны юнитов
		{{?}}
		. 
	{{?}}
	<br>
	Попробуй удалить ненужные или оптимизировать существующие шаблоны.
</script>



<script type="text/plain" id="editWRTR">
	<div class="view-tactics-editWaveWrp">
		<div class="view-tactics-editWaveCont js-scroll-wrp" style="max-height: {{=utils.getWindowHeight(-110, 300)}}px;">
			<div class="view-tactics-editWaveTitle">
				{{?!it.WRTR.isReserve2()}}
					Из расчета на 
					<input class="view-tactics-editWave-upls input1 spinbox" data-spinbox-step="5" type="text" value="{{=utils.toPercent(it.WRTR.getUpls()||wTactics.uplsDef)}}">
					 единиц
				{{?}}
				
				<label class="view-tactics-editWaveShowBattleCost" data-title="Габаритные единицы — количество мест занимаемое в бою">
					{{=snip.checkbox1({title:'Габаритные единицы — количество мест занимаемое в бою', name:'showbattlecost', checked:ls.getBarterFilter(Trade.getBarterFilter()).onlycountry})}}
					Отобразить габаритные единицы
				</label>
			</div>

			<div class="view-tactics-editWave-armyWrp view-tactics-common -com-bg -com-rounded -com-shadow">
				<div class="view-tactics-editWave-army">
					{{=tmplMgr.tactics.editWaveArmyUnits({army:it.WRTR.getArmy(), upls:it.WRTR.getUpls()})}}
				</div>
			</div>

			{{?it.WRTR.isRule() || it.WRTR.isTemplate()}}
				<div class="view-tactics-editWave-ruleWrp {{?it.WRTR.getConds().isEmpty()}}-noRule{{?}}">
					<div class="view-tactics-editWave-ruleTitle">Условие выхода отряда на поле боя</div>

					<div class="view-tactics-editWave-condList">
						{{=tmplMgr.editWRTR.conditions({ruleConds: it.WRTR.getConds()})}}
					</div>

					<div>
						<span class="view-tactics-editWave-addRuleCond js-addRuleCond fakelink">Добавить условие</span>
					</div>
				</div>
			{{??}}
				<div class="view-tactics-editWave-armyDelimiterp"></div>
			{{?}}
			
			<div class="editWave-units-wrp">
				<div class="view-tactics-editWave-unitsWrp view-tactics-common -com-rounded">
					<div class="view-tactics-editWave-unitsTitle">Войска</div>
					
					<div class="view-tactics-editWave-units">
						{{=tmplMgr.tactics.editWaveUnits({army:it.WRTR.getArmy(), WRTR:it.WRTR})}}
					</div>
				</div>

				<div class="view-tactics-editWave-unitsWrp -unitsLegend">
					{{=tmplMgr.tactics.editWaveUnitTags()}}
				</div>

				<div class="view-tactics-editWave-unitsWrp -unitsTemplates view-tactics-common -com-rounded">
					<div class="view-tactics-editWave-unitsTitle">Шаблоны войск</div>

					<div class="view-tactics-editWave-unitsTemplates">
						{{=tmplMgr.editWRTR.editWaveUnitsTemplates({unitTemplates:it.unitTemplates, army:it.WRTR.getArmy()})}}
					</div>

					<div class="view-tactics-editWave-unitsSettingWrp"></div>
				</div>
			</div>
		</div>
		
		<div class="wnd-footer cB">
			<button class="button1 -type-green -disabled js-saveWaveArmy">{{?it.WRTR.isReserve2()}}Сохранить резерв{{??}}Сохранить отряд{{?}}</button>
		</div>
	
		<div class="view-tactics-editShadow"></div>
	</div>
</script>

<script type="text/plain" id="editWRTR.conditions">
	{{@it.ruleConds.getList(): ruleCond}}
		{{?+ruleCond.getIndex()}}
			{{=tmplMgr.editWRTR.ruleCond({ruleCondsType:it.ruleConds.getType()})}}
		{{?}}
		{{=tmplMgr.editWRTR.rule({ruleCond: ruleCond})}}
	{{@}}
</script>

<script type="text/plain" id="editWRTR.ruleCond">
	<div class="view-tactics-editWave-ruleCond">
		<span class="fakelink js-changeRuleCond" data-cond="{{=it.ruleCondsType}}">
			{{?it.ruleCondsType == TacticRuleCondsList.type.AND}}
				И
			{{??}}
				ИЛИ
			{{?}}
		</span>
	</div>
</script>

<script type="text/plain" id="editWRTR.rule">
	<div>
		<div class="view-tactics-editWave-rule" data-index="{{=it.ruleCond.getIndex()}}">
			<span>Если у </span>
			&nbsp;
			<select class="select1 js-ruleSide">
				<option value="{{=TacticRuleCond.side.enemy}}" {{?!it.ruleCond.isMySide()}}selected{{?}}>противника</option>
				<option value="{{=TacticRuleCond.side.my}}" {{?it.ruleCond.isMySide()}}selected{{?}}>меня</option>
			</select>
			&nbsp;
			<div class="view-tactics-editWave-ruleUnit {{?it.ruleCond.isTemplateUnit()}}js-unitTemplate{{?}}" {{?it.ruleCond.hasUnit()}}data-id="{{=it.ruleCond.getUnit().getId()}}"{{?}}>
				{{?it.ruleCond.hasUnit()}}
					{{=snip.unitIcon(it.ruleCond.getUnit(), {tooltip:true})}}
				{{??}}
					<div class="view-tactics-editWave-unitTemplate -clean"></div>
				{{?}}
			</div>
			&nbsp;
			<select class="select1 js-ruleEquality">
				<option value="{{=TacticRuleCond.equality.more}}" {{?it.ruleCond.getEquality() == TacticRuleCond.equality.more}}selected{{?}}>более чем</option>
				<option value="{{=TacticRuleCond.equality.notmore}}" {{?it.ruleCond.getEquality() == TacticRuleCond.equality.notmore}}selected{{?}}>не более, чем</option>
			</select>
			&nbsp;
			<div class="view-tactics-editWave-ruleCountWrp">
				{{=tmplMgr.tactics.editWaveUnitCount({ruleCond:it.ruleCond})}}
			</div>
			
			{{?+it.ruleCond.getIndex()}}
				<button class="button2-small -type-delete vaM js-delRuleCond"></button>
			{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="editWRTR.editWaveUnitsTemplates">
	<span class="view-tactics-editWave-unit -unitTemplate js-addUnitTemplate {{?it.editMode}}-editing{{??!it.unitTemplates.getLength()}}-addUnitTemplate{{?}}">
		{{?it.unitTemplates.getLength() || it.editMode}}
			{{=tmplMgr.tactics.cleanTmplUnit({title:'Создать шаблон'})}}
		{{??}}
			<div class="view-tactics-editWave-addUnitTemplateIcon view-tactics-addIcon" data-title="Создать шаблон">
				<div class="view-tactics-editWave-addUnitTemplateHint">
					<div class="view-tactics-editWave-addUnitTemplateHintText -nobr">Создать свой первый шаблон войск</div>
				</div>
			</div>
		{{?}}
	</span>
	
	{{@it.unitTemplates.getList(): unitTemplate}}
		{{=tmplMgr.tactics.editWaveUnit({unit:unitTemplate, canSelect:true, selected:(it.editMode ? false : wTactics.checkTmplUnitInWave(it.army, unitTemplate)), tagFilter:it.tagFilter})}}
	{{@}}
	
	<div class="view-tactics-editWave-unitsTemplatesEditMode">
		<button class="button1 -type-green view-tactics-editWave-unitsTemplatesEditModeOn" {{?it.editMode}}style="display: none;"{{?}}>Режим редактирования</button>
		<button class="button1 -type-red view-tactics-editWave-unitsTemplatesEditModeOff" {{?!it.editMode}}style="display: none;"{{?}}> >>> </button>
	</div>
</script><!-- 19.06.2019 --><script type="text/plain" id="townInfo.header">
	<div class="townInfo-header -lenLim">
		{{=tmplMgr.townInfo.headerCont(it)}}
    </div>
	
	{{?it.town && debug.isAdmin()}}
		&nbsp;<span class="button2-small -type-delete js-townInfo-clearTownName"></span>
	{{?}}
</script>

<script type="text/plain" id="townInfo.headerCont">
	{{?it.town}}
		{{=snip.town(it.town)}}
	{{??it.unknownTown}}
		{{=snip.townIcon(undefined, undefined, true)}} Неизвестный город
	{{??}}
		Информация о местности
	{{?}}
</script>

<script type="text/plain" id="townInfo">
	<div class="view-townInfo">
		<div class="townInfo-view-wrp"></div>
	</div>
</script>



<script type="text/plain" id="townInfo.view">
	<div class="townInfo-col -type-left">
		{{?it.deposit === undefined && it.slots}}
			<div class="townInfo-block">
				<span class="townInfo-slot -hill" data-title="Холмовые слоты города">&nbsp;{{=it.slots.hill}}</span>&nbsp;
				<span class="townInfo-slot -ground" data-title="Равнинные слоты города">&nbsp;{{=it.slots.ground}}</span>&nbsp;
				<span class="townInfo-slot -water" data-title="Водные слоты города">&nbsp;{{=it.slots.water}}</span>
			</div>
		{{?}}

		{{?it.town && Town.hasDefMoment(it.town.army)}}
			<div class="townInfo-block">
				{{=snip.defMoment(it.town.army.defmoment)}}
			</div>
		{{?}}

		<div class="townInfo-block -hoverOptions">
			{{?it.town && !it.unknownTown && it.town.climate && it.town.terrain}}
				{{=snip.townImg({town:it.town})}}

				<div class="townInfo-hoverOptions">
					{{?it.show.enter}}
						<a class="townInfo-option mapButton -type-enter" href="{{=hashMgr.getTownHref(it.town, it.account)}}" data-title="Войти в город"></a>
					{{?}}
					{{?it.show.onMap}}
						<a class="townInfo-option mapButton -type-map" 
								href="{{=HashMgr.getHref('#map/o='+it.coor.o+'&x='+it.coor.x+'&y='+it.coor.y)}}" 
								data-title="Показать этот город на карте"></a>
					{{?}}
				</div>
			{{??}}
				<div class="accTownImg map-town -empty"></div>
			{{?}}
		</div>

		<div class="townInfo-options">
			{{?it.show.army}}
				<a class="townInfo-option mapButton -type-army" href="{{=HashMgr.getHref('#/sendArmy/target='+it.town.id)}}" data-title="Отправить войска"></a>
				<br>
			{{?}}
			{{?it.show.resSend}}<a class="townInfo-option mapButton -type-resSend" href="{{=HashMgr.getHref('#/send/target='+it.town.id)}}" data-title="Транспортировать ресурсы"></a>{{?}}
			{{?it.show.resStream}}<a class="townInfo-option mapButton -type-resStream" href="{{=HashMgr.getHref('#/stream/'+it.town.id)}}" data-title="Начать снабжение"></a>{{?}}
		</div>

	</div>

	<div class="townInfo-col -type-right">
		{{?it.distance}}
			<div class="townInfo-block">
				{{=snip.distance(it.distance)}}
			</div>
		{{?}}
		{{?it.town}}
			<div class="townInfo-block">
				<div>
					{{=snip.pop(utils.stages(~~it.town.pop.hasall))}}
				</div>
				{{?it.deposit && !it.deposit.isEmpty()}}
					<div>{{=snip.depositLink(it.deposit)}}</div>
				{{?}}
				{{?debug.isAdmin()}}
					<div class="townInfo-adminHistory">
						<a class="link clr6 js-adminArmyHistory">Операции с войсками</a>
					</div>
				{{?}}
			</div>
		{{?}}
		{{?it.town && it.town.account}}
			<div class="townInfo-block">
				<span class="-nobr" style="padding-right: 20px;">{{=snip.accLink(it.town.account)}} {{?it.town.account.id != wofh.account.id && !it.town.account.isBarbarian()}}<a class="info_msgg dIBi fNi" href="{{=HashMgr.getHref('#/messages/write&player='+it.town.account.id)}}" title="Отправить сообщение"></a>{{?}}</span>
			</div>
		{{?}}
		{{?it.town && it.town.account.country}}
			<div class="townInfo-block">
				{{=snip.countryLink(it.town.account.country)}}
			</div>
		{{?}}
		{{?it.wonder}}
			<div class="townInfo-block">
				{{=snip.buildLink(it.wonder)}}
			</div>
		{{?}}
		{{?it.town && it.town.attacks}}
			<div class="townInfo-block">
				<a class="link js-attacks">Атаки ({{=it.town.attacks}})</a>
			</div>
		{{?}}
	</div>
	
	<div class="cB"></div>
	
	{{?!it.town}}
		<div class="unknownTownInfo-desc">
			Возможно этот город утонул в прахе истории...<br>Или же он никогда и не был воздвигнут. И это лишь тень мечтаний о нем...<br>Но, кто знает, быть может придет время и он воплотится в этом мире уже не смутной тенью манящего миража, а вполне реальным себе населенным пунктом районного значения городского типа.
		</div>
	{{?}}
</script><script type="text/plain" id="towns.header">
	Обзор твоих городов
</script>

<script type="text/plain" id="towns">
	<div class="view-towns">
		<div class="tabs tabs-wrp"></div>
		
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-70, 0), 300)}}px;">
			<div class="towns-tabs-block tabs-cont"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="towns.tabMain">
	<table class="town-main-table">
		<tbody>
			{{@wofh.towns: town}}
				<tr class="town-item-tr">
					<td class="col-town">
						<div class="townsCount-block">
							<table class="town-info-table">
								<tbody>
									<tr>
										<td>
											{{=tmplMgr.towns.block.bestRes({town:town})}}
											{{=tmplMgr.towns.block.town({town:town})}}
											{{=tmplMgr.towns.block.deposit({town:town})}}
										</td>
									</tr>
									<tr>
										<td>
											<br>
											{{=tmplMgr.towns.block.population({pop:town.pop, town:town})}}
										</td>
									</tr>
									<tr>
										<td>
											<br>
											Торговцы: {{=town.traders.count-town.traders.busy}}/{{=town.traders.count}}
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</td>
					<td class="col-res">
						<div>
							<b>Склад: {{=~~town.getStock().getMax()}}</b><br><br>
							<div class="resList">
								{{@town.stock.getList(): res}}
									{{?res.isStockable() && ~~res.has}}
										{{?res.has<-res.updateHour*24}}
											<span class='resItem -warn -type-red' data-title="Заканчивается">
										{{??res.has>=town.getStock().getMax()-0.01}}
											<span class='resItem -warn -type-blue' data-title="Переполняется">
										{{??res.has+res.updateHour*24 > town.getStock().getMax()}}
											<span class='resItem -warn -type-green' data-title="Переполняется">
										{{??}}
											<span class='resItem -warn -type-black'>
										{{?}}
												{{=snip.resCount(res, ~~res.has)}}
											</span>
											<br>
									{{?}}
								{{@}}
							</div>
						</div><br>
					</td>
					<td class="col-army">
						<div class="armyList">
							{{=snip.army(town.army.intown)}}
						</div>
					</td>
					<td class="col-events">
						<div class="eventsList">
							{{
								var buildEvents = wofh.events.getTownEvents(town).leaveEventTypes([EventCommon.type.buildI]);
								var commonEvents = wofh.events.getTownEvents(town).removeEventType(EventCommon.type.market, town.id).leaveEventTypes([EventCommon.type.spaceship, EventCommon.type.train, EventCommon.type.defence, EventCommon.type.attack, EventCommon.type.spy, EventCommon.type.armyreturn, EventCommon.type.maketown, EventCommon.type.makeres, EventCommon.type.makeroad, EventCommon.type.makeimp, EventCommon.type.trade, EventCommon.type.market, EventCommon.type.stream, EventCommon.type.explore, EventCommon.type.battle]);
								var extPanel = buildEvents.getLength() > wTowns.eventsExtPanelCount || commonEvents.getLength() > wTowns.eventsExtPanelCount;
							}}
							<div class="eventsView">
								<div class="eventsCol">
									{{=tmplMgr.towns.block.events({town: town, events: buildEvents})}}
								</div>
								<div class="eventsCol">
									{{=tmplMgr.towns.block.events({town: town, events: commonEvents})}}
								</div>
								{{?extPanel}}
									<a class="eventsExtPanel js-eventsExtPanel">Все события ({{=buildEvents.getLength() + commonEvents.getLength()}})</a>
								{{?}}
							</div>
							
							{{?extPanel}}
								<div class="eventsView -ext -hidden">
									<div class="eventsCol">
										{{=tmplMgr.towns.block.events({town: town, events: buildEvents, all:true})}}
										{{=tmplMgr.towns.block.events({town: town, events: commonEvents, all:true})}}
									</div>
									{{?extPanel}}
										<a class="eventsExtPanel js-eventsExtPanel">Кратко</a>
									{{?}}
								</div>
							{{?}}
						</div>
					</td>
				</tr>
			{{@}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="towns.build">
	<ol>
		{{@wofh.towns: town}}
			<li data-town="{{=town.id}}">
				<div class="town-block">
					<span class="budget-icon">
						{{=tmplMgr.towns.block.bestRes({town: town})}}
					</span>
					
					{{=tmplMgr.towns.block.town({town:town})}}
					
					{{=tmplMgr.towns.block.deposit({town:town})}}
				</div>
				
				<div class="builds-block">
					{{
						var slot;
						var slotAfterEvent;
						var slotEventQueue = {};
					}}
					{{@wofh.events.getBldQueue(false, town).getSortList('time', true).getList(): event: pos}}
						{{
							slot = slotEventQueue[event.data.pos]||town.slots.getElem(event.data.pos).clone();
							slotAfterEvent = slot.applyEvent(event);
						}}
						
						{{?event.getAction() == Slot.actionsIds.destroy || event.getAction() == Slot.actionsIds.destroylevel}}
							<div class="act-d build-block js-build-block">

								<span class="act-time">{{=timeMgr.fMoment(event.time)}}</span>

								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}

								{{=snip.slotEventArrow('destroy')}}
						{{??event.getAction() == Slot.actionsIds.build}}
							<div class="act-b build-block js-build-block">
								<span class="act-time">{{=timeMgr.fMoment(event.time)}}</span>

								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}

								{{=snip.slotEventArrow('build')}}
						{{??}}
							<div class="act-r build-block js-build-block">
								<span class="act-time">{{=timeMgr.fMoment(event.time)}}</span>

								{{=tmplMgr.towns.block.slot({slot:slot})}}

								{{=snip.slotEventArrow('rebuild')}}

								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}
						{{?}}
								<a class="build-event button2 -type-delete js-build-event js-type-del" data-event="{{=event.getId()}}" data-pos="{{=pos}}" data-town="{{=town.id}}" data-title="Отменить"></a>

								{{?pos == 0 && slot.canImm()}}
									<a class="build-event button2 -type-immediate js-build-event js-type-imm" data-town="{{=town.id}}"  data-title='{{=tmplMgr.bldqueue.alert.immediate({popUp:true})}}'></a>
								{{?}}
							</div>
						{{slotEventQueue[event.data.pos] = slotAfterEvent;}}
					{{@}}
				</div>
				
				<div class="cB"></div>
				
				<div class="slot-list-block">
					<ul class="slot-list">
						{{var canBuySlots = ~~town.canBuySlots();}}
						{{@town.getSlots().getList(): slot}}
							
							{{slot = slot.dispPrepare();}}
							
							<li data-slot="{{=slot.getPos()}}">
								{{=tmplMgr.towns.block.slot({slot:slot})}}
							</li>
						{{@}}
					</ul>
				</div>
			</li>
		{{@}}
	</o>
</script>

<script type="text/plain" id="towns.prom">
	<ol class="aL">
		{{@wofh.towns:town}}
			<li class="js-town" data-town="{{=town.id}}">
				<div class="town-block">
					{{=tmplMgr.towns.block.bestRes({town:town})}}
					{{=tmplMgr.towns.block.town({town:town})}}
					<div class="cB"></div>
					{{=tmplMgr.towns.block.deposit({town:town})}}
					<br>
					{{=tmplMgr.towns.block.population({pop:town.pop, town:town})}}
					{{=tmplMgr.towns.block.corruption({town:town})}}
					<img class="icnb ic6" src="https://test.waysofhistory.com/img/_.gif" title="Вместимость"> {{=~~town.getStock().getMax()}}
				</div>
				
				<form class="stock-block js-stock-block" data-town="{{=town.id}}">
					{{
						var resGroups = town.stock.getResGroups();
						var showConsumpt = Quest.isAvail(lib.quest.ability.consumption);
						var canConsumpt = showConsumpt && town.stock.getConsBinList().getLength() < town.getStock().calcMaxConsCount();
					}}
					<ul> 
						<li>
							{{=tmplMgr.towns.block.stockStatic({town: town})}}
							{{=tmplMgr.towns.block.res({town: town, resGroup: (resGroups[0]||{}), showConsumpt: showConsumpt, canConsumpt: canConsumpt})}}
						</li>
						<li>{{=tmplMgr.towns.block.res({town: town, resGroup: (resGroups[1]||{}), showConsumpt: showConsumpt, canConsumpt: canConsumpt})}}</li>
						<li>{{=tmplMgr.towns.block.res({town: town, resGroup: (resGroups[2]||{}), showConsumpt: showConsumpt, canConsumpt: canConsumpt})}}</li>
						<li>{{=tmplMgr.towns.block.res({town: town, resGroup: (resGroups[3]||{}), showConsumpt: showConsumpt, canConsumpt: canConsumpt})}}</li>
					</ul>
					<br>
					<button type="submit" class="button1 -hidden js-setConsumption">Подтвердить потребление</button>
				</form>
			</li>
		{{@}}
	</ol>
</script>

<script type="text/plain" id="towns.trade">
	<ol class="{{?Trade.isBarterAllowed()}} -barter-allowed{{?}}{{?Account.hasAbility(Science.ability.money)}} -has-trade{{?}}">
		{{@wofh.towns: town}}
			<li class="town{{=town.id}}" data-id="{{=town.id}}">
				<div class="market-block town-block">
					<div class="market-column">
						{{=tmplMgr.towns.block.bestRes({town:town})}}
						<div class="-nameLim lenLim">
							{{=tmplMgr.towns.block.town({town:town})}}
						</div>
						<div class="cB"></div>
						{{=tmplMgr.towns.block.deposit({town:town})}}
						<div class="town-item">
							Вместимость: {{=(town.traders.count-town.traders.busy)*lib.trade.capacity}}/{{=town.traders.count * lib.trade.capacity}}
						</div>
						<div class="town-item">
							Торговцы: {{=town.traders.count-town.traders.busy}}/{{=town.traders.count}}
						</div class="town-item">
						<div class="town-item">
							Резерв торговцев: <input type="number" value="{{=town.traders.reserve}}" class="traders-reserve js-traders-reserve">
							<br>
							<a class="button1 -type-green set-traders-reserve js-set-traders-reserve -hidden" data-town="{{=town.id}}">Установить</a>
						</div>
					</div>
				</div>
				
				{{?Trade.isBarterAllowed()}}
					<div class="market-block barter-offers-block -brief">
						<div class="market-column">
							<div class="market-title">Бартерный обмен</div>
							<ul class="market-list">{{=tmplMgr.towns.block.barterOfferList({town:town})}}</ul>
						</div>
						{{var offersCount = wofh.barterOffers.getTownOffers(town, true);}}
						<a class="market-showPanel {{?offersCount > tabTownsTrade.showOffersCount}} js-market-showPanel{{??}}-inactive{{?}}">
							<span class="iconTab -type-tab -id-0 fL"></span>
							<span class="full-panel">Все предложения ({{=offersCount}})</span>
							<span class="brief-panel">Кратко</span>
						</a>
					</div>
				{{?}}
				{{?Account.hasAbility(Science.ability.money)}}
					<div class="trade-barterOffers-wrp market-block trade-offers-block -brief">
						<div class="market-column -half">
							<div class="market-title">Покупка</div>
							<ul class="market-list">
								{{=tmplMgr.towns.block.tradeOfferList({town:town, sell: false})}}
							</ul>
						</div>
						<div class="market-column -half">
							<div class="market-title">Продажа</div>
							<ul class="market-list">
								{{=tmplMgr.towns.block.tradeOfferList({town:town, sell: true})}}
							</ul>
						</div>
						{{var offersCount = wofh.tradeOffers.getTownOffers(town, true);}}
						<a class="market-showPanel {{?offersCount > tabTownsTrade.showOffersCount}}js-market-showPanel{{??}}-inactive{{?}}">
							<span class="iconTab -type-tab -id-2 fL"></span>
							<span class="full-panel">Все предложения ({{=offersCount}})</span>
							<span class="brief-panel">Кратко</span>
						</a>
					</div>
					<div class="market-block stream-offers-block -brief">
						<div class="market-column -half">
							<div class="market-title">Покупка</div>
							<ul class="market-list">
								{{=tmplMgr.towns.block.streamOfferList({town:town, sell: false})}}
							</ul>
						</div>
						<div class="market-column -half">
							<div class="market-title">Продажа</div>
							<ul class="market-list">
								{{=tmplMgr.towns.block.streamOfferList({town:town, sell: true})}}
							</ul>
						</div>
						{{var offersCount = wofh.streamOffers.getTownOffers(town, true);}}
						<a class="market-showPanel {{?offersCount > tabTownsTrade.showOffersCount}}js-market-showPanel{{??}}-inactive{{?}}">
							<span class="iconTab -type-tab -id-5 fL"></span>
							<span class="full-panel">Все предложения ({{=offersCount}})</span>
							<span class="brief-panel">Кратко</span>
						</a>
					</div>
					<div class="market-block streams-block -brief">
						<div class="market-column -half">
							<div class="market-title">Входящие</div>
							<ul>
								{{=tmplMgr.towns.block.streamList({town:town, dir: Stream.dirs.in})}}
							</ul>
						</div>
						<div class="market-column -half">
							<div class="market-title">Исходящие</div>
							<ul>
								{{=tmplMgr.towns.block.streamList({town:town, dir: Stream.dirs.out})}}
							</ul>
						</div>
						{{var streamsCount = wofh.streams.getTownStreams(town, true);}}
						<a class="market-showPanel {{?streamsCount > tabTownsTrade.streamCount}}js-market-showPanel{{??}}-inactive{{?}}">
							<span class="iconTab -type-tab -id-5 fL"></span>
							<span class="full-panel">Все потоки снабжения ({{=streamsCount}})</span>
							<span class="brief-panel">Кратко</span>
						</a>
					</div>
				{{?}}
				<div class="market-block events-block -brief">
					<div class="market-column">
						{{
							var events = wofh.events.getTownEvents(town).removeEventType(EventCommon.type.market, town.id).leaveEventTypes([EventCommon.type.trade, EventCommon.type.market, EventCommon.type.stream]);
							var eventsCount = events.getLength();
						}}
						{{=tmplMgr.towns.block.events({town: town, events: events, all: true})}}
					</div>
					
					<a class="market-showPanel {{?eventsCount > tabTownsTrade.showEventCount}}js-market-showPanel{{??}}-inactive{{?}}">
						<span class="full-panel">Все события ({{=eventsCount}})</span>
						<span class="brief-panel">Кратко</span>
					</a>
				</div>
			</li>
		{{@}}
	</ol>
</script>

<script type="text/plain" id="towns.army">
	<ol class="aL">
		{{@wofh.towns: town}}
			<li class="event-attack{{?town.army.underAttack}}1{{?}}" data-town="{{=town.id}}">
				<div class="town-block">
					<span>{{=tmplMgr.towns.block.bestRes({town:town})}}</span>
					<span>{{=tmplMgr.towns.block.town({town:town})}}</span>
					<span class="town-item">{{=tmplMgr.towns.block.population({pop:town.pop, town:town})}}</span>
					<span class="town-item">Военный бонус: {{=Math.round((town.getWarBonus()-1) * 100)}}%</span>
					<span class="town-item">
						{{?town.slots.wonderEffect && (town.slots.wonderEffect[WonderEffect.ids.pillage] || town.slots.wonderEffect[WonderEffect.ids.warbonus] || town.slots.wonderEffect[WonderEffect.ids.unitProf] || town.slots.wonderEffect[WonderEffect.ids.unitDamage])}}
							{{var wonder = town.slots.getWonder();}}
							Чудо света: <a href="{{=HashMgr.getHref('#/slot/'+wonder.getId()+'&town='+town.id)}}">{{=wonder.getName()}}</a>
						{{?}}
					</span>
				</div>
				
				<div class="perimeter-block">
					{{var perimeter = town.getSlot(Build.slotGroup.perimetr);}}
					{{?perimeter.id != lib.build.nobuild}}
						<span class="perimeter-view-block">
							{{=tmplMgr.towns.block.slot({slot:perimeter})}}
						</span>
						<span class="perimeter-info-block">
							<span class="perimeter-info-item">
								<img class="icnb ic10" src="https://test.waysofhistory.com/img/_.gif" title="Перед боем атакующая армия получает урон от ловушек.">
							</span>
							<span class="perimeter-info-item">
								{{=snip.pop(~~perimeter.getTrapDamage())}}
							</span>
						</span>
					{{?}}
				</div>
				
				{{
					var train = [];
					var hasTrainedUnit = false;
					for(var slot in town.getSlots().getList()){
						slot = town.getSlot(slot);
						
						if( slot.isActive() && slot.canTrainUnits() && lib.builds[slot.getId()].type == Build.type.train ){
							if( slot.haveActions() ){
								if( slot.getEvent().getType() == EventCommon.type.buildI ){
									continue;
								};
							};
							train.push(slot.clone());
						};
					};
				}}
				
				<span class="train-block">
					{{@train: slot}}
						<span class="train-build" data-slot="{{=slot.getPos()}}">
							{{var trainEvents = wofh.events.getTrainQueue(slot);}}
							
							{{=tmplMgr.towns.block.slot({slot:slot})}}
							
							<div class="train-unit-top">
								{{?trainEvents.length}}
									{{
										var train = trainEvents[0];
										if( !hasTrainedUnit ){
											hasTrainedUnit = !!train.getTrainedUnitCount();
										};
									}}
									
									{{=snip.unitIconLink(train.getUnit().getId())}}
									<br>
									<span>{{=train.getTrainedUnitCount()}}/{{=train.getUnit().getCount()}}</span>
									<br>
									{{=snip.timer(train.time, 'dec')}}
								{{?}}
							</div>
							<div class="train-units">
								{{~trainEvents: train: trainPos}}
									{{?trainPos != 0}}
										{{=snip.nobr(snip.unitIcon(train.getUnit(), false, true) + train.getUnit().getCount())}}&nbsp;
									{{?}}
								{{~}}
							</div>
						</span>
					{{@}}
				</span>
				
				{{?hasTrainedUnit}}
					<button class="train-takeaway js-train-takeaway" title="Забрать все подготовленные войска из всех обучающих строений" data-town="{{=town.id}}"></button>
				{{?}}

				<span class="army-block">
					<span class="army-units">
						{{=snip.army(town.army.intown)}}
					</span>
					<span class="army-events">
						{{=tmplMgr.towns.block.events({town: town, events: wofh.events.getTownEvents(town).leaveEventTypes([EventCommon.type.attack, EventCommon.type.spy, EventCommon.type.defence, EventCommon.type.battle]), all: true})}}
					</span>
				</span>
			</li>
		{{@}}
	</ol>
</script>

<script type="text/plain" id="towns.block.town">
	{{=snip.townLink(it.town)}}
</script>

<script type="text/plain" id="towns.block.bestRes">
	{{var bestRes = it.town.calcFeatureRes();}}
	{{?bestRes}}
		<img class='icnr ic{{=bestRes.getId()}} crH fL' src='https://test.waysofhistory.com/img/_.gif' title="{{=bestRes.getName()}}"/>
	{{?}}		
</script>

<script type="text/plain" id="towns.block.deposit">
	{{var deposit = it.town.getDeposit();}}
	{{?!deposit.isEmpty()}}
		<div class="deposit-block">
			<img class="makeres fN" src="https://test.waysofhistory.com/img/_.gif" title="Месторождение города">
			&nbsp;
			<span>{{=deposit.getName()}}</span>
		</div>
	{{?}}
</script>

<script type="text/plain" id="towns.block.population">
	<div class="population-block">
		{{=snip.pop()}}
		<span class="clr{{=it.pop.has >= it.pop.culture ? 0 : (it.pop.has + it.pop.incReal/2 >= it.pop.culture ? 1 : 2)}}">
			{{=utils.formatNum(it.pop.has, {int:true, stages: true})}}/{{=utils.formatNum(it.pop.culture, {int:true, stages: true})}}
		</span> 
		({{=utils.formatNum(it.pop.incReal, {sign: true, mixed: true, fixed: 1})}}) 
		{{var fillTime = it.town.calcPopFillTime();}}
		{{?fillTime}}
			<span class="-warn -type-{{?it.town.getPopInc() > 0}}black{{??}}red{{?}}">{{=timeMgr.fPeriodShort(fillTime)}}</span>
		{{?}}
	</div>
</script>

<script type="text/plain" id="towns.block.corruption">
	<div class="corruption-block">
		{{=snip.icon(snip.c.anyIcon, 'corruption', 'Коррупция: Зависит от числа городов и суда')}} 
		<span class="js-show-court" data-town="{{=it.town.id}}">
			{{var corruption = it.town.getCorruption();}}
			<span class="clr-cor{{=corruption<0.5?5:(corruption<0.7?4:(corruption<0.8?3:(corruption<0.9?2:1)))}} fakelink">{{=utils.toInt(corruption*100)}}%</span>
		</span>
	</div>
</script>

<script type="text/plain" id="towns.block.corruption.court">
	<div class="tooltip-block">
		<span class="court-view-block towns-block"> 
			{{=snip.slotFrame(it.court, snip.slotLevel(it.court), {noTitle:true, grey: !it.court.isActive()})}}
		</span>
		
		<span class="court-info-block">
			<div class="court-name">{{=it.court.getName()}} - {{=it.court.getLevel()}}  уровень </div>
			{{=snip.icon(snip.c.anyIcon, 'corruption', 'Уменьшает коррупцию', false, 'vaT')}}
			<span class="corr-text">
				Уменьшает коррупцию<br>
				в  {{=it.court.getEffect().toFixed(2)}}  раз
				{{?it.court.canUp()}}
					&nbsp;(+{{=it.court.getEffectUp().toFixed(2)}})
				{{?}}
			</span>
		</span>
	</div>
</script>

<script type="text/plain" id="towns.block.slot">
	{{?it.slot.isEmpty()}}
		<span class="-empty-slot-view">
			{{?it.slot.isWonder()}}
				<a class="slot-view -empty-wonder" href="{{=HashMgr.getHref('#/slot/'+it.slot.getPos()+'&town='+it.slot.town.id)}}" data-title="Чудо Света"></a>
			{{??}}
				<a class="slot-view" href="{{=HashMgr.getHref('#/slot/'+it.slot.getPos()+'&town='+it.slot.town.id)}}" data-pos="{{=it.slot.getPos()}}">
					{{=snip.emptySlot2(it.slot)}}
				</a>
			{{?}}
		</span>
	{{??}}
		{{var isOff = it.slot.isOff();}}
		
		<a class="slot-view {{?isOff}}-state-off{{?}} js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=it.slot.id}}" data-pos="{{=it.slot.getPos()}}" data-head="{{=snip.slotTitle(it.slot)}}" data-town="{{=it.slot.town.id}}" href="{{=HashMgr.getHref('#/slot/'+it.slot.getPos()+'&town='+it.slot.town.id)}}"  {{=snip.buildImgPath(it.slot, {checkActions: false, grey: isOff})}}>
			{{=snip.slotLevel(it.slot)}}
		</a>
	{{?}}
</script>

<script type="text/plain" id="towns.block.events">
	{{
		var isFirstBuildQueue = true;
		var slot;
		var slotAfterEvent;
		var slotEventQueue = {};
	}}
	{{@it.events.getSortList('time', true).getList(): event: index}}
		{{?it.all || index < wTowns.eventsExtPanelCount}}
			{{?event.getType() == EventCommon.type.buildI}}
				{{
					slot = slotEventQueue[event.data.pos]||it.town.slots.getElem(event.data.pos).clone();
					slotAfterEvent = slot.applyEvent(event);
				}}
				<div class="event-block">
					<div class="block-left">
						<div class="event-cont">
							<span class="event-time">
								{{=timeMgr.fMoment(event.time)}}
								{{?wofh.account.isSuperAdmin() && isFirstBuildQueue}}
									{{isFirstBuildQueue = false;}}
									&nbsp;<a class="js-towns-eventImm" data-event="{{=event.getId()}}">+++</a>
								{{?}}
							</span>
							
							{{?event.data.action == Slot.actionsIds.destroy || event.data.action == Slot.actionsIds.destroylevel}}
								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}
								
								{{=snip.slotEventArrow('destroy')}}
							{{??event.data.action == Slot.actionsIds.build}}
								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}
								
								{{=snip.slotEventArrow('build')}}
							{{??event.data.action == Slot.actionsIds.rebuild}}
								{{=tmplMgr.towns.block.slot({slot:slot})}}
								
								{{=snip.slotEventArrow('rebuild')}}
								
								{{=tmplMgr.towns.block.slot({slot:slotAfterEvent})}}
							{{?}}
						</div>
					</div>
				</div>
				
				{{slotEventQueue[event.data.pos] = slotAfterEvent;}}
			{{??}}
				<div class="event-block {{?index >= tabTownsTrade.showEventCount}}-brief-hidden{{?}}"> /* -brief-hidden используется только на вкладке торговли */
					<div class="block-right">
						<div class="event-cont {{?event.isAttack() && event.isGoingTo(it.town.id)}}-warn{{?}}">
							<span class="event-time">
								{{?event.time}}{{=timeMgr.fMoment(event.time)}}{{?}}
								{{?wofh.account.isSuperAdmin() && !(event instanceof EventFleet || event instanceof EventBattle)}}
									&nbsp;<a class="js-towns-eventImm" data-event="{{=event.getId()}}">+++</a>
								{{?}}
							</span>
							
							{{?event.type == EventCommon.type.battle && event.data.state == EventCommon.battleState.active && event.key != lib.war.nodefsession}}
								<a class="js-battleLink" target="_blank" href="{{=snip.getBattleLink({session: event.key, secret: event.data.secret})}}">
									<img 
											data-title="{{=wTowns.eventsData[utils.cnstName(EventCommon.type, event.type)][event.isGoingTo(it.town.id)?'in':'out']}}" 
											src="https://test.waysofhistory.com/img/_.gif" 
											class="{{=wTowns.eventsData[utils.cnstName(EventCommon.type, event.type)].cls + (event.isGoingTo(it.town.id)?'in':'out')}} fRi">
								</a>
							{{??}}
								<img 
										data-title="{{=wTowns.eventsData[utils.cnstName(EventCommon.type, event.type)][event.isGoingTo(it.town.id)?'in':'out']}}" 
										src="https://test.waysofhistory.com/img/_.gif" 
										class="{{=wTowns.eventsData[utils.cnstName(EventCommon.type, event.type)].cls + (event.isGoingTo(it.town.id)?'in':'out') + (event.data.fleet?'w':'')}} fRi">
							{{?}}
							
							{{?event.isAttack()}}
								<span class="event-armySpeed-block"><img class="icnu ic8 event-armySpeed" src="https://test.waysofhistory.com/img/_.gif" data-title="Скорость">{{=Math.round(event.data.speed)}}</span>
							{{?}}
							
							{{?event.data.army}}
								{{=snip.army(event.data.army)}}
							{{?}}
							
							{{?event.data.fleet}}
								<div class="fR">
									{{=snip.army(new Army(wofh.fleets.getElem(event.data.fleet).transport))}}
								</div>
							{{?}}
							
							{{?event.data.res !== undefined}}
								<div>
									{{?event.data.res instanceof ResList}}
										{{=snip.resList(event.data.res)}}
									{{??event.data.res instanceof Object}}
										{{=snip.resList(new ResList(event.data.res))}}
									{{??event.data.res instanceof Resource}} /*На будущее*/
										{{=snip.resCount(event.data.res)}}
									{{??event.data.count}} /*Для потоков*/
										{{=snip.resCount(event.data.res, event.data.count)}}
									{{?}}
								</div>
							{{?}}
						</div>
					</div>
				</div>
			{{?}}
		{{?}}
	{{@}}
</script>

<script type="text/plain" id="towns.block.stockStatic">
	{{?Quest.isAvail(Quest.ids.sciSelect)}}
		<div>
			{{var res = it.town.stock.getElem(Resource.ids.science);}}
			{{=snip.resBig(res.getId())}}
			<div class="stock-static-val">
				<span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>
			</div>
		</div>
	{{?}}
	{{?wofh.account.knowsMoney()}}
		<div>
			{{var res = it.town.stock.getElem(Resource.ids.money);}}
			{{=snip.resBig(res.getId())}}

			<div class="stock-static-val">
				<span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>
			</div>
		</div>
	{{?}}
	{{var res = it.town.stock.getElem(Resource.ids.food);}}
	<div class="stock-food">
		{{=snip.resBig(res.getId())}}
		<div class="stock-static-val stock-highlight -grown">
			<span class="stock-rest">
				{{?res.updateHour < 0}}
					{{=snip.hintWrp('До исчерпания осталось: ' + snip.timer(res.calcStockFillTime() + timeMgr.getNow(), 'dec'), utils.formatNum(res.has, {floor: true, stages: true}))}}
				{{??}}
					{{=~~res.has}}
				{{?}}
			</span>
			{{?res.updateHour}} <span class="stock-alter" data-title=" в час">{{=snip.resStockWarnUpd(res)}}</span>{{?}}
		</div>
	</div>
</script>

<script type="text/plain" id="towns.block.res">
	{{@it.resGroup.list: res}}
		{{=tmplMgr.stock.item({data: it, res: res})}}
	{{@}}
</script>

<script type="text/plain" id="towns.block.barterOfferList">
	{{var index = 0;}}
	{{@wofh.barterOffers.getTownOffers(it.town).getSortList('id').getList(): offer}}
		<li class="{{?++index > tabTownsTrade.showOffersCount}}-brief-hidden{{?}}">
			<a class="market-item" href="{{=HashMgr.getHref('#/barterOffer/id='+offer.getId()+'&town='+it.town.id)}}">
				{{=snip.resCount(offer.res1, offer.count1)}}
				{{=snip.resCount(offer.res2, offer.count2)}}
			</a>
		</li>
	{{@}}
	
	{{?it.town.traders.count - it.town.traders.busy > 0}}
		<li class="market-create"><a class="link button1 -type-green -own-width {{?!Ability.isBarterAvailable()}}-disabled{{?}}" href="{{=HashMgr.getHref('#/barterOffer/town='+it.town.id)}}">Создать</a></li>
	{{?}}
</script>

<script type="text/plain" id="towns.block.tradeOfferList">
	{{var index = 0;}}
	{{@wofh.tradeOffers.getTownOffers(it.town).getSortList('id').getList(): offer}}
		{{?offer.sell == it.sell}}
			<li class="{{?++index > tabTownsTrade.showOffersCount}}-brief-hidden{{?}}">
				<a class="market-item" href="{{=HashMgr.getHref('#/tradeOffer/id='+offer.getId()+'&town='+it.town.id)}}">
					{{var res = new Resource(offer.res).sciToLuck();}}
					{{=snip.res(res)}}
					{{=snip.resCount(Resource.ids.money, Trade.roundCost(offer.cost))}}
				</a>
			</li>
		{{?}}
	{{@}}
	<li class="market-create"><a class="link button1 -type-green -own-width" href="{{=HashMgr.getHref('#/tradeOffer/town='+it.town.id+(!it.sell?'&buy':''))}}">Создать</a></li>
</script>

<script type="text/plain" id="towns.block.streamOfferList">
	{{var index = 0;}}
	{{@wofh.streamOffers.getTownOffers(it.town).getSortList('id').getList(): offer}}
		{{?offer.sell == it.sell}}
			<li class="{{?++index > tabTownsTrade.showOffersCount}}-brief-hidden{{?}}" >
				<a class="market-item" href="{{=HashMgr.getHref('#/streamOffer/id='+offer.getId()+'&town='+it.town.id)}}">
					{{var res = new Resource(offer.res);}}
					
					{{=snip.res(res)}}
					
					<span class="{{?offer.cost && offer.tcost}}-resTradeCost{{?}}" data-title="{{?offer.cost}}{{=utils.escapeHtml(snip.wrp('nobr', 'За ресурс: ' + Trade.roundCost(offer.cost), 'div'))}}{{?}}{{?offer.tcost}}{{=utils.escapeHtml(snip.wrp('nobr', ' За торговца: ' + Trade.roundCost(offer.tcost), 'div'))}}{{?}}">
						{{=snip.resCount(Resource.ids.money, Trade.roundCost(Trade.calcStreamPrice(offer.cost, 1, offer.tcost, 1), 1))}}
					</span>
				</a>
			</li>
		{{?}}
	{{@}}
	<li class="market-create"><a class="link button1 -type-green -own-width" href="{{=HashMgr.getHref('#/streamOffer/town='+it.town.id+(!it.sell?'&buy':''))}}">Создать</a></li>
</script>

<script type="text/plain" id="towns.block.streamList">
	{{var index = 0;}}
	{{@wofh.streamPersonalOffers.getTownPersonalOffers(it.town).getSortList('id').getList(): personalOffer}}
		{{?personalOffer.getDir(it.town) == it.dir}}
			<li class="{{?++index > tabTownsTrade.streamCount}}-brief-hidden{{?}}">
				<a class="market-item personalOffer" href="{{=HashMgr.getHref('#/streamOffer/id='+personalOffer.getId()+'&town='+it.town.id+'&personalOffer')}}">
					{{
						var res = new Resource(personalOffer.res, personalOffer.count);
						var price = Trade.calcStreamPrice(personalOffer.cost, personalOffer.count, personalOffer.tcost, personalOffer.traders);
					}}
					{{=snip.resCount(res)}}
					<span data-title='{{=snip.resCount(Resource.ids.money, Trade.roundCost(price, 1))}}'>
						{{=snip.resCount(Resource.ids.money, ~~price)}}
					</span>
				</a>
			</li>
		{{?}}
	{{@}}
	
	{{@wofh.streams.getTownStreams(it.town).getSortList('id').getList(): stream}}
		{{?stream.getDir(it.town) == it.dir}}
			<li class="{{?++index > tabTownsTrade.streamCount}}-brief-hidden{{?}}" >
				<a class="market-item" href="{{=HashMgr.getHref('#/streamChange/id='+stream.getId()+'&town='+it.town.id)}}">
					{{
						var res = new Resource(stream.res, stream.getCount());
						var price = Trade.calcStreamPrice(stream.cost, stream.getCount(), stream.tcost, stream.traders);
					}}
					{{=snip.resCount(res)}}
					<span data-title='{{=snip.resCount(Resource.ids.money, Trade.roundCost(price, 1))}}'>
						{{=snip.resCount(Resource.ids.money, ~~price)}}
					</span>
				</a>
			</li>
		{{?}}
	{{@}}
</script><script type="text/plain" id="trade.header">
	Торговля
</script>

<script type="text/plain" id="trade">
	<div class="view-trade">
		<div class="market-panel-wrp"></div>
		
		<div class="market-tabs-wrp"></div>
		
		<div class="tabs-cont"></div>
	</div>
</script>

<script type="text/plain" id="trade.sell">
    <div>
		<div class="trade-sell">
			<a class="button1" href="{{=HashMgr.getHref('#/tradeOffer')}}">Выставить предложение</a>
		</div>
		<div class="tbl trade-sell-offers js-trade-sell-offers">
			<div class="tbl-thead">
				<div class="tbl-tr trade-sell-offers-tr">
					<div class="tbl-th trade-sell-offers-col-availability">{{=snip.btnTable('availability', snip.hint('Ручное управление присутствием предложения на рынке'),'')}}</div>
					<div class="tbl-th trade-sell-offers-col-res">{{=snip.btnTable('res')}}</div>
					<div class="tbl-th trade-sell-offers-col-type">{{=snip.btnTable('sell','Операция','')}}</div>
					<div class="tbl-th trade-sell-offers-col-cost">{{=snip.btnTable('cost','Цена','')}}</div>
					<div class="tbl-th trade-sell-offers-col-distance">{{=snip.btnTable('distance', snip.ruler(),'')}}</div>
					<div class="tbl-th trade-sell-offers-col-limit">{{=snip.btnTable('limit','Лимит','')}}</div>
					<div class="tbl-th trade-sell-offers-col-options"></div>
				</div>
			</div>
			<div class="tbl-tbody js-trade-offers" style="max-height: {{=Math.max(utils.getWindowHeight(-205, 0), 100)}}px;"></div>
		</div>
    </div>
</script>

<script type="text/plain" id="trade.tableSellOffers">
	{{~it.list: offer}}
		<div class="tbl-tr trade-sell-offersData-tr {{?!offer.isAvail()}}-unAvail{{?}} js-editOffer" data-id="{{=offer.id}}">
			<div class="tbl-td trade-sell-offers-col-availability">
				<span class="availability-wrp">
					{{=snip.checkbox1({cls: 'js-changeOfferAvailability', attrs: {'data-id': offer.id}, checked: offer.isAvail()})}}
				</span>
			</div>
			<div class="tbl-td trade-sell-offers-col-res">
				{{=snip.res(offer.res)}}
			</div>
			<div class="tbl-td trade-sell-offers-col-type -lenLim">
				{{var ally = wofh.tradeAllies.getElem(offer.ally);}}
				{{?offer.sell}}
					{{?offer.ally == 0}}
						продаю
					{{??offer.ally == lib.tradeally.blackmarket}}
						продаю на черном рынке
					{{??offer.ally > 0}}
						{{?ally.country}}
							продаю в стране
						{{??}}
							продаю в {{=snip.tradeUnion(ally.name)}}
						{{?}}
					{{?}}
				{{??}}
					{{?offer.ally == 0}}
						покупаю
					{{??}}
						{{?ally.country}}
							покупаю в стране
						{{??}}
							покупаю в {{=snip.tradeUnion(ally.name)}}
						{{?}}
					{{?}}
				{{?}}
			</div>
			<div class="tbl-td trade-sell-offers-col-cost">
				{{=snip.resCount(Resource.ids.money, utils.toFixed(offer.cost * 0.001, 3))}}
			</div>
			<div class="tbl-td trade-sell-offers-col-distance">
				{{=offer.distance}}
			</div>
			<div class="tbl-td trade-sell-offers-col-limit">
				{{?offer.isAvail()}}
					{{?!offer.isPresent()}}{{=snip.alert(offer.sell ? 'Это предложение сейчас на рынке не выводится. Причиной тому недостаточное количество ресурса на складе. Убедись что, ресурса больше лимита установленного в предложении.' : 'Это предложение сейчас на рынке не выводится. Причиной тому недостаток выделенного места на складе. Убедись что, места для ресурса больше выделенного лимита установленного в предложении.')}} {{?}}
					
					{{=snip.resCount(offer.res, offer.limit)}}
				{{?}}
			</div>
			<div class="tbl-td trade-sell-offers-col-options">
				<button class="button2 -type-menu" data-id="{{=offer.id}}"></button>
				<button class="button2 -type-delete js-delOffer" data-id="{{=offer.id}}"></button>
			</div>
		</div>
	{{~}}
</script>


<script type="text/plain" id="trade.buy">
	<form class="js-trade-buy">
		<div class="trade-buy-resFilter-wrp js-trade-buy-resFilter-wrp">
			<div class="trade-buy-resFilter-block-res js-resFilter-block">
				{{=snip.resFilter.inline({type: ResList.filter.type.extend, showLuck: true, showAll:true, select: ls.getTradeFilter(Trade.getTradeFilter()).res})}}
				<input class="js-resFilterVal" type="hidden" name="res" value="{{=ls.getTradeFilter(Trade.getTradeFilter()).res}}">
			</div>
			
			<div class='trade-buy-trade'>
				<label class="crP" data-title="Продавать">{{=snip.radio1({cls:'js-resFilterVal', title:'Продавать', name:'type', value: Trade.type.sell, checked: Trade.isSell(ls.getTradeFilter(Trade.getTradeFilter()).type)})}}Продавать</label>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<label class="crP">{{=snip.radio1({cls:'js-resFilterVal', title:'Покупать', name:'type', value: Trade.type.buy, checked: Trade.isBuy(ls.getTradeFilter(Trade.getTradeFilter()).type)})}}Покупать</label>
				&nbsp;&nbsp;&nbsp;&nbsp;
				
				<select name="ally" class="trade-buy-ally select1">
					<option value="{{=TradeAlly.undif}}" {{?ls.getTradeFilter(Trade.getTradeFilter()).ally == TradeAlly.undif}}selected="selected"{{?}}>Все предложения</option>
					<option value="{{=TradeAlly.no}}" {{?ls.getTradeFilter(Trade.getTradeFilter()).ally == TradeAlly.no}}selected="selected"{{?}}>Без союзов</option>
					<option value="{{=TradeAlly.blackMarket}}" {{?ls.getTradeFilter(Trade.getTradeFilter()).ally == TradeAlly.blackMarket}}selected="selected"{{?}}>Черный рынок</option>
					{{@wofh.tradeAllies.getList():ally}}
						<option value="{{=ally.id}}" {{?ls.getTradeFilter(Trade.getTradeFilter()).ally == ally.id}}selected="selected"{{?}}>{{?ally.country}}Страна{{??}}{{=ally.name}}{{?}}</option>
					{{@}}
				</select>
			</div>
		</div>
	</form>
	
	<div class="list-page-nav-wrp">
		<a class="page-nav-prev"></a>
		<a class="page-nav-next"></a>

		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-170, 0), 100)}}px;">
			<div class="buy-list-wrp"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="trade.buy.list">
	<table class="table01 trade-buy-offersTable" cellspacing="0">
		<colgroup>
			<col class="trade-offersTable-col1">
			<col class="trade-offersTable-col2">
			<col class="trade-offersTable-col3">
			<col class="trade-offersTable-col4">
			<col class="trade-offersTable-col5">
			<col class="trade-offersTable-col6">
			<col class="trade-offersTable-col7">
			<col class="trade-offersTable-col8">
		</colgroup>
		
		<thead>
			<tr class="cw_head_tr">
				<td></td>
				<td>
					<div>
						<a class="js-allySort">
							<span class="trade-buy-sorting">{{=snip.tradeUnion(false, 'Торговый союз')}}</span><br>
							<img class='icsort -black' src='https://test.waysofhistory.com/img/_.gif' title='Сортировать'>
						</a>
					</div>
				</td>
				<td><div>Город</div></td>
				<td><div class="t_cw_sep_l">Ресурс</div></td>
				<td><div class="t_cw_sep_l nobr"><a class="js-costSort"><span class="trade-buy-sorting">Цена</span><br><img class='icsort -black' src='https://test.waysofhistory.com/img/_.gif' title='Сортировать'></a></div></td>
				<td><div class="t_cw_sep_l nobr"><a class="js-distSort"><span class="trade-buy-sorting">{{=snip.ruler()}}</span><br><img class='icsort -black' src='https://test.waysofhistory.com/img/_.gif' title='Сортировать'></a></div></td>
				<td><div class="t_cw_sep_l">Время</div></td>
				<td>
					{{var filteredRes = ls.getTradeFilter(Trade.getTradeFilter()).res;}}
					{{?!(it.prev === undefined && (it.offers||[]).length < 10) && filteredRes != ResList.filter.resType.all && filteredRes != Resource.ids.luck}}
						<div class="t_cw_sep_l trade-buy-massMarket-wrp">
							{{=snip.wndLink('tradeFreeMarket', {type:it.type, res:ls.getTradeFilter(Trade.getTradeFilter()).res}, 'Массовая ' + (Trade.isBuy(it.type)?'закупка':'продажа'), 'trade-buy-massMarket button1s -type-green', {noLink:true})}}
						</div>
					{{?}}
				</td>
			</tr>
		</thead>
		
		<tbody>
			{{~it.offers: offer: pos}}
				{{?!offer.count}}
					{{continue;}}
				{{?}}
				<tr class='trow js-trade-buy-offer' data-pos="{{=pos}}">
					<td class="aC">
						{{?offer.inCountry}}
							{{=snip.crown('Предложение в стране')}}
						{{?}}
					</td>
					<td>
						{{?offer.ally}}
							<div class="lenLim aC indent">
								{{?offer.ally == it.countryAlly}}
									{{=snip.countryFlag(wofh.country, {flag:'normal'})}}
								{{??}}
									{{=snip.tradeUnion(offer.ally == lib.tradeally.blackmarket ? 'продаю на черном рынке' : wofh.tradeAllies.getElem(offer.ally).name)}}
								{{?}}
							</div>
						{{?}}
					</td>
					<td>
						{{?offer.town}}
							<div class="lenLim trade-buy-town indent">
								{{=snip.townAccUnder(offer.town)}}
							</div>
						{{??}}
							<div class="indent">
								{{=snip.townLink()}}
							</div>
						{{?}}
					</td>
					<td class="nobr"><div class="indent">{{=snip.resCount(offer.res, offer.count)}}</div></td>
					<td class="nobr"><div class="indent">{{=snip.resCount(Resource.ids.money, utils.toFixed(offer.cost * 0.001, 3))}}</div></td>
					<td class="aC">
						{{?offer.distance}}
							{{=snip.distPath(offer.distance, offer.path)}}
						{{??}}
							?
						{{?}}
					</td>
					<td class="aC">
						<span class="pR">
							{{?offer.noSpeedUpTime && Trade.isBuy(it.type)}}
								{{=snip.icon(snip.c.anyIcon, 'fuel', utils.escapeHtml(tmplMgr.alert.offerSpeedUp({noSpeedUpTime:offer.noSpeedUpTime})), false, 'trade-buy-alertTime')}}
							{{?}}
							{{?offer.time || offer.res == Resource.ids.luck}}
								{{?offer.noSpeedUpTime && Trade.isSell(it.type)}}
									{{=snip.title(timeMgr.fPeriod(offer.time), 'Расчетное время без ресурсов ускорения составит '+timeMgr.fPeriod(offer.noSpeedUpTime), '-type-underline')}}
								{{??}}
									{{=timeMgr.fPeriod(offer.time)}}
								{{?}}
							{{??}}
								?
							{{?}}
						</span>
					</td>
					<td class="aC">
						{{=snip.res(offer.res)}} 
						{{=snip.input1({cls: 'trade-buy-offerCount spinbox', name: 'count', disabled: !offer.limit, value: offer.limit, attrs: {'data-limit': offer.limit, 'data-spinbox-step': lib.trade.capacity, 'data-res': offer.res}, autocomplete: 'off'})}} 
						
						<input type="submit" class="trade-buy-buyOffer {{?!offer.limit}}-disabled{{?}} {{?Trade.isSell(it.type)}}-sell{{?}}" value="{{?Trade.isSell(it.type)}}Продать{{??}}Купить{{?}}">
					</td>
				</tr>
			{{~}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="trade.limitSliderCount">
	<span class="tradePopup-offerLimit-slider-countWrp js-limit-slider-countWrp">
		<span class="js-limit-res"></span>
		<span class="js-limit-count"></span> 
		<span class="js-limit-hint"></span>
	</span>
</script>

<script type="text/plain" id="trade.offerTax">
	Налог {{=snip.res(Resource.ids.money) + utils.toFixed(it.tax, 2)}}{{?!it.inCountry && it.tax}} или менее{{?}}
</script>





<script type="text/plain" id="tradeOffer.header">
	{{?it.offer.id}}Изменение предложения{{??}}Выставить свое предложение{{?}}
</script>

<script type="text/plain" id="tradeOffer">
	<form class="tradePopup-sell-offer js-tradePopup-sell-offer">
		<div class="tradePopup-luck-wrp">
			{{=snip.luck(~~wofh.account.getCoinsBought())}} {{=snip.hint('Количество доступных для торговли Монет Удачи. <br/>Для совершения торговых операций можно использовать только купленные, ранее не переводимые и не использованные в торговых операциях Монеты Удачи.')}}
		</div>
		
		<div class="tradePopup-resFilter-wrp">
			<div class="tradePopup-resFilter-type">
				<label class="button1 {{?it.offer.sell != undefined && it.offer.sell}}-active{{??it.offer.id}}-disabled{{?}} {{?!it.offer.id}}crP{{?}}">
					<input type="radio" name="type" value="{{=Trade.type.sell}}" class="operation-type -hidden js-operation-type" {{?it.offer.sell != undefined && it.offer.sell}}checked="checked"{{?}}>
					Продать
					</label>
				<br><br>
				<label class="button1 {{?it.offer.sell != undefined && !it.offer.sell}}-active{{??it.offer.id}}-disabled{{?}} {{?!it.offer.id}}crP{{?}}">
					<input type="radio" name="type" value="{{=Trade.type.buy}}" class="operation-type -hidden js-operation-type" {{?it.offer.sell != undefined && !it.offer.sell}}checked="checked"{{?}}>
					Купить
				</label>
			</div>
			
			<div class="tradePopup-resFilter js-tradePopup-resFilter js-resFilter-block">
				{{=snip.resFilter({type: ResList.filter.type.select, disabled: it.disabled, select: it.offer.res, showLuck: it.offer.id && it.offer.res != Resource.ids.luck ? false : true})}}
				<input class="js-resFilterVal" type="hidden" name="res" value="{{=it.offer.res}}">
			</div>
		</div>
		
		<div class="tradePopup-offerCost-wrp">
			<div>Цена</div>
			<div class="tradePopup-offerCost-slider js-tradePopup-offerCost-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="tradePopup-offerLimit-wrp js-tradePopup-offerLimit-wrp {{?it.offer.id && it.offer.res == Resource.ids.luck}}-hidden{{?}}">
			<div>Граница объема</div>
			<div class="tradePopup-offerLimit-slider js-tradePopup-offerLimit-slider">
				<div class="slider">
					<div class="tradePopup-offerLimit-slider-mark js-limit-mark"></div>
					<div class="tradePopup-offerLimit-slider-areaOwn js-limit-areaOwn"></div>
					<div class="tradePopup-offerLimit-slider-areaSelected js-limit-areaSelected"></div>
					<div class="tradePopup-offerLimit-slider-selectedTitle js-limit-selectedTitle">
						<span class="js-limit-selected-res"></span> 
						<span class="js-limit-selected-count"></span> 
						<span class="js-limit-selected-hint">
							{{=snip.hint('Столько ресурса будет сразу доступно в предложении')}}
						</span>
					</div>
				</div>
			</div>
		</div>
		
		<div class="tradePopup-offerLuck-wrp js-tradePopup-offerLuck-wrp {{?!it.offer.id || it.offer.res != Resource.ids.luck}}-hidden{{?}}">
			<div>Лимит</div>
			<div class="tradePopup-offerLuck-slider js-tradePopup-offerLuck-slider">
				<div class="slider"></div>
			</div>
		</div>
		
		<div class="tradePopup-offerDist-wrp js-tradePopup-offerDist-wrp">
			<div>
				Расстояние
			</div>
			
			<div class="tradePopup-offerDist-slider js-tradePopup-offerDist-slider">
				<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
			</div>
		</div>
		
		<div class="tradePopup-offerAlly-wrp">
			{{?it.offer.id}}
				{{var ally = wofh.tradeAllies.getElem(it.offer.ally);}}
				{{?it.offer.ally == 0}}
					{{=snip.tradeUnion('Для всех')}}
				{{??it.offer.ally == lib.tradeally.blackmarket}}
					{{=snip.tradeUnion('На черном рынкe')}}
				{{??ally.country}}
					{{=snip.tradeUnion('Страна')}}
				{{??}}
					{{=snip.tradeUnion(ally.name)}}
				{{?}}
				<input type="hidden" name="ally" value="{{=it.offer.ally}}">
			{{??}}
				<select name="ally" class="select1 js-tradePopup-offerAlly">
					<option value="0">Для всех</option>
					<option value="{{=lib.tradeally.blackmarket}}">На черном рынкe</option>
					{{@wofh.tradeAllies.getList():ally}}
						<option value="{{=ally.id}}" {{?it.offer.ally == ally.id}}selected="selected"{{?}}>{{?ally.country}}Страна{{??}}{{=ally.name}}{{?}}</option>
					{{@}}
				</select>
			{{?}}
		</div>
		<p>
			<button type='submit' class="button1 tradePopup-setOffer js-setOffer">Выставить предложение</button>
			{{?it.offer.id}} 
				<a class="button1 -type-red js-delOffer">Удалить</a>
			{{?}}
		</p>
	</form>
</script>





<script type="text/plain" id="tradeFreeMarket.header">
	Массовая {{?Trade.isBuy(it.type)}}закупка{{??}}продажа{{?}} ресурсов
</script>

<script type="text/plain" id="tradeFreeMarket.main">
	<div class="tradeFreeMarket-view">	
		<form id="tradeFreeMarket-form" class="tradeFreeMarket-form">
			<div class="tradeFreeMarket-resFilter-wrp js-resFilter-block">
				{{=snip.resFilter.inline({type: ResList.filter.type.select, select: it.res, showFood:Trade.isBuy(it.type)})}}
				<input class="js-resFilterVal" type="hidden" name="res" value="{{=it.res}}">
			</div>
			
			{{?Trade.isBuy(it.type)}}
				<div class="tradeFreeMarket-stockOpt-wrp">
					{{=snip.title(snip.checkbox1({cls: 'js-allowStock-toggle', checked: Trade.getFreeMarketFilterProp('stock')})+snip.capacityIcon(), 'Учитывать вместимость хранилищ города', '', {tag: 'label'})}}
					 
					{{=snip.title(snip.checkbox1({cls: 'js-allowSending-toggle', checked: Trade.getFreeMarketFilterProp('sending')})+snip.sendIcon(), 'Учитывать входящих торговцев', '', {tag: 'label'})}}
				</div>
			{{?}}
			
			<div class="tradeFreeMarket-res-wrp">
				<div>Объем</div>
				<div class="tradeFreeMarket-slider tradeFreeMarket-res-slider">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
			
			<div class="tradeFreeMarket-cost-wrp">
				<div>
					{{?Trade.isBuy(it.type)}}Максимальная цена{{??}}Минимальная цена{{?}}
				</div>
				<div class="tradeFreeMarket-slider tradeFreeMarket-cost-slider">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
			
			<div class="tradeFreeMarket-dist-wrp {{?!Trade.getFreeMarketFilterProp('dist')}}-disabled{{?}}">
				<div>
					<label>
						{{=snip.checkbox1({cls: 'js-dist-toggle', title:'Расстояние', checked: Trade.getFreeMarketFilterProp('dist')})}} Расстояние
					</label>
				</div>
				<div class="tradeFreeMarket-slider tradeFreeMarket-dist-slider">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
			
			<div class="tradeFreeMarket-path-wrp {{?!Trade.getFreeMarketFilterProp('path')}}-disabled{{?}}">
				<div>
					<label>
						{{=snip.checkbox1({cls: 'js-path-toggle', title:'Максимальные путь и время', checked: Trade.getFreeMarketFilterProp('path')})}} Максимальные путь и время
					</label>
				</div>
				<div class="tradeFreeMarket-slider tradeFreeMarket-path-slider">
					<div class="slider">/*Инпут добавляется в DOM при ините*/</div>
				</div>
			</div>
			
			<div class="tradeFreeMarket-ally-wrp">
				<div>
					Охват предложений
				</div>
				<select class="select1" name="ally">
					<option value="">Все предложения</option>
					<option value="{{=lib.tradeally.blackmarket}}">На черном рынкe</option>
					{{@wofh.tradeAllies.getList():ally}}
						<option value="{{=ally.id}}">{{?ally.country}}Страна{{??}}{{=ally.name}}{{?}}</option>
					{{@}}
				</select>
			</div>
		</form>
		
		<div class="wnd-footer">
			<button type="submit" form="tradeFreeMarket-form" class="button1 js-doFreeMarketBtn">
				{{?Trade.isSell(it.type)}}Продать{{??}}Купить{{?}}
			</button>
			<div class="trade-freeMarket-result-wrp"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="tradeFreeMarket.result">
	<div class="trade-freeMarket-result">
		Результат операции:
		
		{{?it.traded}}
			<div class="trade-freeMarket-resultTraded">
				{{=snip.resBigCount(it.res, it.traded)}}
				<br>
				на сумму 
				{{=snip.resBigCount(Resource.ids.money, utils.servRound(it.paid))}} ({{=snip.tooltip(utils.formatNum(it.paid/it.traded, {fixed: 3}), 'Средняя цена')}})
			</div>
		{{?}}
		
		{{?it.rest}}
			<div class="trade-freeMarket-resultRest">
				{{?Trade.isSell(it.type)}}
					не продано
				{{??}}
					не куплено
				{{?}}
				: 
				<br>
				{{=snip.resBigCount(it.res, it.rest)}}
			</div>
		{{?}}
		
		<div class="trade-freeMarket-resultClose">
			<button class="trade-freeMarket-close button1 -type-red" data-traded="{{=(+it.traded)||''}}">Закрыть</button>
		</div>
	</div>
</script><script type="text/plain" id="tradeCons.header">
	Ускорение доставки грузов
</script>

<script type="text/plain" id="tradeCons">
	<div class="view-tradeCons">
		<div class="js-scroll-wrp" style="max-height: {{=Math.max(utils.getWindowHeight(-150), 200)}}px;">
			<form>
				<table class="tradeCons-towns">
					<thead>
						<tr>
							<th class="tradeCons-townNum"></th>
							<th></th>
							<th>По суше</th>
							<th>По воде</th>
						</tr>
					</thead>
					<tbody>
						{{@it.consumption: cons}}
							<tr class="js-tradeCons-town" data-id="{{=cons.town.id}}">
								<td class="tradeCons-townNum tradeCons-townCounter"></td>
								<td class="tradeCons-townName">{{=snip.townLink(cons.town)}}</td>
								<td>
									<select class="tradeCons-select js-select-styled select1" data-pathtype="l" data-tid="{{=cons.town.id}}">
										{{@ wofh.account.getAvailFuel(Trade.wayType.l).sortByCount(true).getList(): res}}
											<option value="{{=res.id}}" {{?res.id == cons.l}}selected{{?}} class="select-{{?res.id == 0}}default{{??}}normal{{?}}">
												{{?res.id == 0}}Ничего
												{{??}}{{=res.getName()}}
												{{?}}
											</option>
										{{@}}
									</select>
								</td>
								<td>
									<select class="tradeCons-select js-select-styled select1" data-pathtype="w" data-tid="{{=cons.town.id}}">
										{{@ wofh.account.getAvailFuel(Trade.wayType.w).sortByCount(true).getList(): res}}
											<option value="{{=res.id}}" {{?res.id == cons.w}}selected{{?}} class="select-{{?res.id == 0}}default{{??}}normal{{?}}">
												{{?res.id == 0}}Ничего
												{{??}}{{=res.getName()}}
												{{?}}
											</option>
										{{@}}
									</select>
								</td>
							</tr>
						{{@}}
					</tbody>
				</table>
			</form>
		</div>
		
		<div class="tradeCons-comment">Для ускорения перемещения грузов можно использовать дополнительные ресурсы.</div>
		
		<button class="button1 js-setTradeConsumption -disabled">Сохранить</button>
	</div>
</script><script type="text/plain" id="tradersMove.header">
	Передвижение торговцев
</script>

<script type="text/plain" id="tradersMove">
	<div class="view-tradersMove">
		<div class="market-panel-wrp"></div>
		
		<div class="tradersMove-resIncome js-resIncome"></div>
		
		<div class="tbl tradersMove-movings">
			<div class="tbl-thead">
				<div class="tbl-tr">
					<div class="tbl-th tradersMove-movings-col-dir">{{=snip.btnTable('dir')}}</div>
					<div class="tbl-th tradersMove-movings-col-traders">{{=snip.btnTable('traders', snip.trader())}}</div>
					<div class="tbl-th tradersMove-movings-col-acc">{{=snip.btnTable('account', snip.nobr(snip.townIcon() + snip.accIcon()), '')}}</div>
					<div class="tbl-th tradersMove-movings-col-country">{{=snip.btnTable('country', '')}}</div>
					<div class="tbl-th tradersMove-movings-col-res">Товар</div>
					<div class="tbl-th tradersMove-movings-col-time">{{=snip.btnTable('time', 'Время')}}</div>
				</div>
			</div>
			<div class="tbl-tbody" style="max-height: {{=Math.max(utils.getWindowHeight(-200, 0), 150)}}px;"></div>
		</div>
	</div>
</script>

<script type="text/plain" id="tradersMove.tableTradersMove">
	{{~it.list: move}}
		{{var resIncom = utils.escapeHtml(tmplMgr.tradersMove.resIncome({resources:move.resThisMoment, time:move.time}));}}
		<div class="tbl-tr tradersMove-movings-tr -dir-{{=move.dir}}" data-id="{{=move.id}}" {{?resIncom}}data-title="{{=resIncom}}"{{?}}>
			<div class="tbl-td tradersMove-movings-col-dir">
				<div class="tradersMove-dir -dir-{{=move.dir}}" data-title="{{?move.dir == 'in'}}В{{??}}Из{{?}}"></div>
			</div>
			<div class="tbl-td tradersMove-movings-col-traders">
				{{=move.traders}}
			</div>
			<div class="tbl-td tradersMove-movings-col-acc">
				{{?move.town}}
					{{=snip.townAccUnder(move.town)}}
				{{??}}
					{{=snip.townLink()}}
				{{?}}
			</div>
			<div class="tbl-td tradersMove-movings-col-country">
				{{?move.country}}
					{{=snip.country(move.country, {link: true, text: false, flag: 'normal'})}}
				{{?}}
			</div>
			<div class="tbl-td tradersMove-movings-col-res">
				{{~move.res: count: res}}
					{{?count !== undefined}}
						<span class="dIB">
							{{=snip.resCount(res, count)}}
						</span>
					{{?}}
				{{~}}
			</div>
			
			{{var canImm = move.type == wTradersMove.moveType.sendres || move.type == wTradersMove.moveType.sendresret;}}
			
			<div class="tbl-td tradersMove-movings-col-time {{?canImm}}-type-immediate{{?}}">
				<span class="tradersMove-time">
					 {{=snip.timer(move.time, 'dec')}}
					 {{=snip.wrp('tradersMove-arrive', '(в  ' + timeMgr.fMoment(move.time) + ')')}}
				</span>
				{{?canImm}} 
					<a class="tradersMove-immediate js-tradersMove-imm" style="vertical-align: -8px;" data-event="{{=move.id}}">
						<span class="button2 -type-immediate js-immediate" data-title='{{=tmplMgr.tradersMove.immediate({luck: move.luck})}}'></span>
					</a>
				{{?}}
			</div>
		</div>
	{{~}}
</script>

<script type="text/plain" id="tradersMove.immediate">
	{{?wofh.account.getCoinsAll() < it.luck && !wofh.account.isAdmin()}}
		{{=tmplMgr.snipet.noCoins({popUp:true})}}
		<br>
		<br>
	{{?}}
	
	Доставить немедленно за {{=it.luck}} Мон. Удачи
</script>

<script type="text/plain" id="tradersMove.resIncome">
	{{?it.resources && !it.resources.isEmpty()}}
		<div class="resIncome-title">
			Ожидаемые ресурсы
			{{?it.time}}
				&nbsp;в {{=timeMgr.fMoment(it.time)}}
			{{?}}
		</div>
		:
		&nbsp;
		{{=snip.resIncome(it)}}
	{{?}}
</script>

<script type="text/plain" id="train">   
	<div class="view-train">
		<div class="train-work-wrp"></div>
		<div class="train-select-wrp"></div>
	</div>
</script>

<script type="text/plain" id="train.work">
	<div class="train-work">
		{{?it.queue.length}}
			<table class="train-queue">
				<colgroup>
					<col width="34">
					<col width="180">
					<col width="175">
					<col width="89">
					<col width="67">
				</colgroup>
				<tbody>
					{{~it.queue: train: trainPos}}
						<tr class="train-queue-row js-train-queue-item" data-pos="{{=trainPos}}">
							<td>{{=trainPos+1}}</td>
							<td class="train-queue-units">
								{{=snip.unitLink(train.getUnit(), snip.unitIcon(train.getUnit(), {countryPayments: [Unit.countryPayments.train.name]}))}}&nbsp;
								
								{{?trainPos == 0}}
									<span class="train-queue-ready">
										{{=tmplMgr.train.work.ready({train: train})}}
									</span>
								{{??}}
									{{=train.getUnit().getCount()}}
								{{?}}
							</td>
							<td class="train-queue-timer">{{=snip.timer(train.time, 'dec')}}</td>
							<td class="train-queue-date">{{=timeMgr.fMoment(train.time)}}</td>
							<td><a class="link js-train-queue-delBtn train-queue-del">Уничтожить</a></td>
						</tr>
					{{~}}
				</tbody>
			</table>
		{{?}}
	</div>
</script>

<script type="text/plain" id="train.work.ready">
	{{var unitTrained = it.train.getTrainedUnitCount();}}
	{{=unitTrained}} / {{=it.train.getUnit().getCount()}} {{?unitTrained}}<button class="train-takeaway" data-title="Забрать все подготовленные войска из всех обучающих строений"></button>{{?}}
</script>

<script type="text/plain" id="train.work.takeawayAlert">
	<p>Ты действительно хочешь забрать все подготовленные войска из всех обучающих строений? Все подготовленные войска, в том числе {{=snip.unitNameLink(Unit.ids.settler)}}</span>,  {{=snip.unitNameLink(Unit.ids.worker)}} и {{=snip.unitNameLink(Unit.ids.spy)}}, будут выведены из всех обучающих зданий этого города.</p>
</script>

<script type="text/plain" id="train.work.removeAlert">
	<p>
		Ты уверен, что хочешь отменить обучение? 
		<b>Все затраченные ресурсы и население будут безвозвратно утрачены!</b>
	</p>
	
	<p>Ты это осознаешь?</p>
	
	<button class="button1 -type-green js-allow-ok">Да</button>
	
	<p>Ресурсы и население, теряемые в результате отмены обучения:</p>
	<p>
		{{=snip.resList(it.unit.getCost().mult(it.unit.getCount()))}}
		{{=snip.pop(it.unit.getPopCost() * it.unit.getCount())}}
	</p>
</script>


<script type="text/plain" id="train.select">
	<div class="tabs tabs-wrp {{?!(it.build.getLength() && it.rebuild.getLength())}}-hidden{{?}}"></div>

	<form class="train-select">
		{{?wofh.account.isPremium()}}
			{{var hiddenUnitsText = 'Перечень скрытых';}}
		{{??it.build.hasHiddenUnits}}
			{{var hiddenUnitsText = 'Показывать скрытых';}}
		{{?}}

		<div class="train-select-list-hide">
			{{=snip.wndLink('trainUnitsHide', false, hiddenUnitsText||'')}}
		</div>

		<div class="select-build-wrp"></div>

		<div class="select-rebuild-wrp"></div>

		{{?it.build.getLength() || it.rebuild.getLength()}}
			<div class="train-select-submit">
				<div class="slider train-select-slider"></div>

				<div class="train-select-blk">
					<div class="train-select-info"></div>

					<div class="train-select-btns">
						{{=snip.input1({cls: 'spinbox js-train-select-count', autocomplete: 'off', name: 'count', value: it.unitCount, disabled: !it.enabled})}}

						<button class="button1 -disabled train_select_submit" 
								{{?!it.enabled}}data-title="
									{{?it.slotBusy}}Здание находится в очереди на строительные работы.<br>{{?}}
									{{?it.maxLen}}Очередь обучения войск в этом здании заполнена.<br>{{?}}
									{{?it.slotDisabled}}Здание отключено от финансирования и не функционирует.<br>{{?}}"{{?}}>
							Обучить
						</button>
					</div>
				</div>
			</div>
		{{?}}
	</form>
</script>

<script type="text/plain" id="train.select.build">
	<table class="train-select-list -type-build">
		<tbody>
			{{@it.build.getList(): unit}}
				<tr class="train-select-row {{?unit.unknown}}-disabled{{?}}" data-pos="{{=unit.getId()}}">
					<td class="train-select-sel">
						{{?!unit.unknown}}
							{{=snip.radio1({name: 'unit', disabled: !it.enabled})}}
						{{?}}
					</td>
					<td class="train-select-uImg">
						{{=snip.unitLink2(unit, {name: '', grey: unit.unknown, countryPayments: [Unit.countryPayments.train.name]})}}
					</td>
					<td class="train-select-uName">
						<span class="-snip-unit">{{=unit.getName()}}</span>
						
						<div class="train-select-hide button2-small -type-delete"></div>
					</td>
					{{?!unit.unknown}}
						<td class="train-select-res">
							<span>
								{{=snip.resList(unit.getCost())}}
								{{=snip.pop(unit.getPopCost())}}
							</span>
						</td>
						<td class="train-select-time">{{=timeMgr.fPeriod(it.slot.calcTrainTime(unit))}}</td>
						<td class="train-select-max">
							<a class="train-select-allBtn" data-title="Максимум этих войск"></a>
							<span class="train-select-max-val">{{=unit.getCount()}}</span>
						</td>
					{{??}}
						<td colspan="3" class="train-select-science -lenLim">
							{{
								var sciencesList = unit.getSciences().filterKnown([Science.known.avail, Science.known.unavail], false);
								var science = sciencesList.getMaxElemByCost();
							}}
							Требуется: 
							{{=snip.scienceLink(science, {text: science.getName() + (sciencesList.getLength() > 1?'...':''), highlight: true})}}
						</td>
					{{?}}
				</tr>
			{{@}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="train.select.rebuild">
	<table class="train-select-list -type-rebuild">
		<tbody>
			{{@it.rebuild.getList(): unit}}
				<tr class="train-select-row" data-pos="{{=unit.getId()}}">
					<td class="train-select-sel">{{=snip.radio1({name: 'unit', disabled: !it.enabled})}}</td>
					<td class="train-select-uImg">{{=snip.unitIconLink(unit, {countryPayments: [Unit.countryPayments.train.name]})}}</td>
					<td class="train-select-rebuild">
						<span class="train-select-rebuild-arrow">&#10132;</span>
						{{=snip.unitIconLink(unit.getNext(), {countryPayments: [Unit.countryPayments.train.name]})}}
					</td>
					<td class="train-select-res">
						<span>
							{{=snip.resList(unit.getRebuildCost())}}
							{{var pop = unit.getRebuildPopCost();}}
							{{?pop}}
								{{=snip.pop(pop)}}
							{{?}}
						</span>
					</td>
					<td class="train-select-time">{{=timeMgr.fPeriod(it.slot.calcRetrainTime(unit))}}</td>
					<td class="train-select-max">
						<a class="train-select-allBtn" data-title="Максимум этих войск"></a>
						<span class="train-select-max-val">{{=unit.getCount()}}</span>
					</td>
				</tr>
			{{@}}
		</tbody>
	</table>
</script>

<script type="text/plain" id="train.select.info">
	{{?!it.unit}}
        Не выбран тип войск для обучения.
	{{??}}
		{{?it.count}}
			<div>
				Обучение продлится <span class="-nobr">{{=timeMgr.fPeriod(it.time)}}</span> 
				<span class="-nobr"> до 
					{{?it.first}}
                        {{=snip.timer(it.time + it.start - timeMgr.getNow(), 'inc', false, false, {cls: 'train_select_timer'})}}
					{{??}}
						{{?it.start}}
							{{=timeMgr.fMoment(it.time + it.start)}}
						{{??}}
                            {{=snip.timer(it.time, 'inc', false, false, {cls: 'train_select_timer'})}}
						{{?}}
					{{?}}
				</span>
			</div>
			<div>Стоимость обучения: </div>
			<div>
				{{var resList = (it.mode == 'build' ? it.unit.getCost() : it.unit.getRebuildCost()).mult(it.count);}}
				{{=snip.resList(resList)}}
				{{var pop = (it.mode == 'build' ? it.unit.getPopCost() : it.unit.getRebuildPopCost()) * it.count;}}
				{{?pop}}{{=snip.pop(pop)}}{{?}}
			</div>
		{{?}}
	{{?}}
</script>


<script type="text/plain" id="train.select.sbmAlert">
	<div class="" style="text-align: center;width">
		{{=snip.unitLink(it.unit, snip.unitCount(it.unit))}}
		{{=it.text}}
	</div>
</script>


<script type="text/plain" id="trainUnitsHide">
	<div class="trainUnitsHide-view">
		<form class="trainUnitsHide-form">
			<div class="trainUnitsHide-title">Отображение войск доступных для обучения</div>

			<div class="trainUnitsHide-list">
				{{
					var armyGroups = Army.getAll().getEraTacticGroups({includeKK: true});
				}}
				{{@armyGroups: eraGroup: eraIndex}}
					<div class="trainUnitsHide-era">
						<div class="trainUnitsHide-unit">
							<div class="-invis">{{=snip.unitIconLink(0)}}</div>
							{{=snip.checkbox1({cls: 'js-hideUnits', checked: true})}}
						</div>

						<span class="trainUnitsHide-units">
							{{@eraGroup: tacticGroup}}
								{{@tacticGroup.getList(): unit}}
									{{var checked = !servBuffer.getTemp().hiddenUnits[unit.getId()];}}
									<div class="trainUnitsHide-unit {{?!checked}}-type-hidden{{?}}">
										<div>{{=snip.unitIconLink(unit, {grey: !unit.isAvailAcc()})}}</div>

										{{=snip.checkbox1({name: '' + unit.getId(), cls: 'js-hideUnit', checked: checked})}}
									</div>
								{{@}}
							{{@}}
						</span>
					</div>
				{{@}}
			</div>

			<div class="wnd-footer">
				<button class="button1">Установить</button>
			</div>
		</form>
	</div>
</script><script type="text/plain" id="visibleTowns.header">
	Информация о видимых городах
</script>

<script type="text/plain" id="visibleTowns">
	<div class="view-visibleTowns">
		<div class="visibleTowns-view-wrp"></div>
	</div>
</script>

<script type="text/plain" id="visibleTowns.view">
	{{
		var clipboardText = '';

		try{clipboardText = utils.escapeHtml(it.json)}catch(e){};
	}}
	
	<textarea class="visibleTowns-textarea textarea1" readonly="readonly">{{=clipboardText}}</textarea>
	
	<div class="visibleTowns-copy m10">
		<button class="button1 -type-green js-clipboard-tag-block" data-clipboard-text="{{=clipboardText}}">
			Скопировать
			<span class="js-clipboard-status"></span>
		</button>
	</div>
</script><script type="text/plain" id="wonders.header">
	Чудеса света в мире
</script>

<script type="text/plain" id="wonders">
    <div class="view-wonders">
		<div class="wonders-filter-wrp">
			{{=tmplMgr.wonders.filter(it)}}
		</div>
		
		<div class="wonders-list-wrp"></div>
	</div>
</script>

<script type="text/plain" id="wonders.list">
	<div class="space-tbl-wrp"></div>
	
	<div class="wonders-tbl-wrp"></div>
</script>

<script type="text/plain" id="wonders.filter">
	<div class="wonders-options -noSel">
		<label class="wonders-options-rivalToggle-wrp">
			{{=snip.checkbox1({cls: 'wonders-options-rivalToggle', checked: it.rivalMode})}}
			Только конкурирующие Чудеса
		</label>

		<label>
			{{=snip.checkbox1({cls: 'wonders-options-filterUnavail', checked: true})}}
			Недоступные для данного города
		</label>
		 
		 
		 
		<label>
			{{=snip.checkbox1({cls: 'wonders-options-filterUnknown', checked: true})}}
			Неизвестные
		</label>
	</div>
	
	<div class="wonders-filter-list-wrp"></div>
</script>

<script type="text/plain" id="wonders.filter.list">
	{{@it.allWondersList.getList(): wonder}}
		{{var data = {wonder: wonder, town: it.town};}}
		
		{{?it.rivalMode}}
			{{
				data.isRival = true;
				data.isActive = it.filterRival[wonder.getId()] !== undefined;
				data.isChecked = it.filterRival[wonder.getId()];
				data.cls = 'wonders-filter-wonderRival';
			}}
		{{??}}
			{{
				data.isActive = it.selectedId == wonder.getId();
				data.cls = 'wonders-filter-wonderLink';
			}}
		{{?}}
		
		<div class="wonders-filter-wonder {{?!data.isActive}}-type-unselected{{?}} {{?!wonder.canBuildOnTerrain()}}-type-unavail{{?}} {{?!wonder.getLevel()}}-type-unknown{{?}}" data-id="{{=wonder.getId()}}">
			{{=tmplMgr.wonders.filter.wonder(data)}}
		</div>
	{{@}}
</script>

<script type="text/plain" id="wonders.filter.wonder">
	{{?it.isRival}}
		<label class="wonders-filter-rival-wrp">
			{{?it.isActive}}
				{{=snip.checkbox1({cls: 'wonders-filter-rival', checked: it.isChecked})}}
			{{?}}
		</label>
	{{?}}
	
	{{?it.town.getWonder().getId() == it.wonder.getId()}}
		<div class="wonders-filter-inTown">
			{{=snip.townIcon(false, Tile.relation.self)}}
		</div>
	{{?}}
	
	{{=snip.slotWonder(it.wonder, {grey: !it.isActive, noText: true, cls: it.cls, attrs: !it.isActive ? {head: it.wonder.getName()+'<br>Этого Чуда Света нет на конкурирующем расстоянии от города'} : false})}}
</script>	

<script type="text/plain" id="wonders.launchSpaceShips.table.wrp">
	<div class="tbl space-tbl">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-td space-tbl-col-country">{{=snip.btnTable('country', 'Страна')}}</div>
				<div class="tbl-td space-tbl-col-time">{{=snip.btnTable('time', 'Время до выхода на курс')}}</div>
				<div class="tbl-td space-tbl-col-status">{{=snip.btnTable('status', 'Статус')}}</div>
			</div>
		</div>
		<div class="tbl-tbody" style="max-height: 100px;"></div>
	</div>
</script>

<script type="text/plain" id="wonders.launchSpaceShips.table">
    {{@it.list: ship}}
        <div class="tbl-tr">
            <div class="tbl-td space-tbl-col-country">{{=snip.countryLink(ship.country)}}</div>
            <div class="tbl-td space-tbl-col-time">
                {{?ship.status == Build.spaceship.goes && ship.time+lib.spaceship.launchtime > timeMgr.getNow()}}
                    {{=snip.hintWrp(
                        'Запуск состоялся ' + timeMgr.fMoment(ship.time) + '', 
                        snip.timer(ship.time+lib.spaceship.launchtime,'dec'))}}
                {{?}}
            </div>
            <div class="tbl-td space-tbl-col-status">
                {{?ship.status == Build.spaceship.goes}}
                    {{?ship.time+lib.spaceship.launchtime > timeMgr.getNow()}}
                        <span style="color: blue">Стабилизация курса</span>
                    {{??}}
                        <span style="color: green">Курс стабилен</span>
                    {{?}}
                {{??ship.status == Build.spaceship.win}}
                    <span style="color: green">Курс стабилен</span>
                {{??ship.status == Build.spaceship.lost}}
                    <span style="color: grey">Связь потеряна</span>
                {{?}}
            </div>
        </div>
    {{@}}
</script>

<script type="text/plain" id="wonders.table.wrp">
	<div class="tbl wonders-tbl">
		<div class="tbl-thead">
			<div class="tbl-tr">
				<div class="tbl-th wonders-tbl-col-town">{{=snip.btnTable('town', '','')}}</div>
				<div class="tbl-th wonders-tbl-col-account">{{=snip.btnTable('account')}}</div>
				<div class="tbl-th wonders-tbl-col-country">{{=snip.btnTable('country','','')}}</div>
				<div class="tbl-th wonders-tbl-col-status">{{=snip.btnTable('status', '','')}}</div>
				<div class="tbl-th wonders-tbl-col-wonder">{{=snip.btnTable('wonder', '','')}}</div>
				<div class="tbl-th wonders-tbl-col-level">{{=snip.btnTable('level','','')}}</div>
			</div>
		</div>
		<div class="tbl-tbody" style="max-height: {{=it.wondersListMaxHeight}}px;"></div>
	</div>
</script>

<script type="text/plain" id="wonders.table">
    {{@it.blocks: block: id}}
        <div class="tbl-block" data-id="{{=id}}" style="height: {{=block.height}}px"></div>
    {{@}}
</script>

<script type="text/plain" id="wonders.table.block">
	{{@it.block.list: wonder}}
		{{
			var level = wonder.getLevel()||0;
			var levelColor = '-warn ';
		}}
		{{?level < 11}}
			{{levelColor += '-type-red';}}
		{{??level < 16}}
			{{levelColor += '-type-black';}}
		{{??level < 20}}
			{{levelColor += '-type-green';}}
		{{??level < 21}}
			{{levelColor += '-type-blue';}}
		{{??level < 22}}
			{{level = '*';}}
			{{levelColor += '-type-lblue';}}
		{{?}}
		
		<div class="tbl-tr wonders-wonderRow {{?wonder.launch}}-type-launch{{?}}">
			<div class="tbl-td wonders-tbl-col-town">{{=snip.townLink(wonder.town)}}</div>
			<div class="tbl-td wonders-tbl-col-account">{{=snip.accLink(wonder.town.account)}}</div>
			<div class="tbl-td wonders-tbl-col-country">{{=snip.countryLink(wonder.town.account.country, {text:false, flag:'normal'})}}</div>
			<div class="tbl-td wonders-tbl-col-status">{{=snip.wonderIcon(wonder.isActive())}}</div>
			<div class="tbl-td wonders-tbl-col-wonder {{=levelColor}}">
				{{=snip.slotWonder(wonder, {noIcon: true, cls: 's-link'})}}
				
				{{?wonder.launch}}
					<div>
						Идет сборка: 
						{{=snip.timer(wonder.launch, 'dec', timeMgr.fPeriod(wonder.launch - timeMgr.getNow()))}}
					</div>
				{{?}}
			</div>
			<div class="tbl-td wonders-tbl-col-level {{=levelColor}}">{{=level}}</div>
		</div>
	{{@}}
</script><script type="text/plain" id="wnd.layer">
	<div class="main-layer"></div>
</script>

<script type="text/plain" id="wnd.wrp">
	{{var wnd = it.wnd;}}
	
	<div class="{{=wnd.getTypeClass()}} {{=wnd.getTmplClass()}} {{=wnd.getExtClass()}}">
		{{?wnd.options.showBack}}
			<div class="wnd-back-wrp"></div>
		{{?}}
		
		{{?wnd.options.showBorders}}
			{{=tmplMgr.wnd.borders()}}
		{{?}}
		
		{{?wnd.options.showButtons}}
			{{=tmplMgr.wnd.buttons({canClose: wnd.options.canClose, noCloseAll: wnd.options.noCloseAll, showMinimize: wnd.options.showMinimize})}}
		{{?}}
		
		{{?wnd.options.clipboard}}
			<div class="wnd-clipboard-wrp">
				{{=snip.clipboardWrp(wnd.options.clipboard.text, wnd.options.clipboard.short)}}
			</div>
		{{?}}
		
		{{?wnd.hasHeader()}}
			<div class="wnd-header-wrp">{{=wnd.getHeaderCont()}}</div>
		{{?}}
		
		{{=tmplMgr.wnd.cont(it)}}
		
		{{?!wnd.options.noShadow}}
			<div class="wnd-shadow-wrp"></div>
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.borders">
	<div class="wnd-borders-wrp">
		<div class="wnd-brd wnd-brd-t"></div>
		<div class="wnd-brd wnd-brd-b"></div>
		<div class="wnd-brd wnd-brd-l"></div>
		<div class="wnd-brd wnd-brd-r"></div>
		<div class="wnd-brd wnd-brd-tl"></div>
		<div class="wnd-brd wnd-brd-tr"></div>
		<div class="wnd-brd wnd-brd-bl"></div>
		<div class="wnd-brd wnd-brd-br"></div>
		<div class="wnd-brd wnd-brd-c"></div>
	</div>
</script>

<script type="text/plain" id="wnd.buttons">
	<div class="wnd-buttons-wrp">
		{{?it.canClose && !it.noCloseAll}}
			<button class="wnd-button-closeAll button2 -type-delete js-wnd-closeAll" data-title="Закрыть все открытые окна"></button>
		{{?}}
		
		{{?it.showMinimize}}
			<button class="wnd-button-minimize button2 -type-minimize js-wnd-minimize" data-title="Свернуть"></button>
		{{?}}
		
		{{?it.canClose}}
			<button class="wnd-button-close button2 -type-cancel js-wnd-close" data-title="Закрыть окно"></button>
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.cont">
	<div class="wnd-cont-wrp">
		{{=it.cont}}
	</div>
</script>	

<script type="text/plain" id="wnd.tmpl">
	{{=it.cont}}
</script>

<script type="text/plain" id="wnd.tmpl.popup">
	{{=it.cont}}
	
	<div class="popup-buttons">
		{{?it.isAlert}}
			<button class="button1 js-popup-close">Закрыть</button>
		{{??}}
			<button class="button1 -type-green js-popup-ok">{{=it.okText||'Да'}}</button>
			<span class="popup-buttonsSpacer"></span>
			<button class="button1 -type-red js-popup-cancel">{{=it.cancelText||'Нет'}}</button>
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.tmpl.textEdit">
	<div class="wnd-textEdit">
		<textarea class="wnd-textEdit-textarea" maxlength="{{=it.maxlength||''}}">{{=it.cont||''}}</textarea>
		<br>
		<button class="wnd-textEdit-saveBtn button1 -type-green">Сохранить</button>
		{{?it.alert}}
			 {{=snip.wrp('wnd-textEdit-alert', snip.alert(it.alert))}}
		{{?}}
	</div>
</script>

<script type="text/plain" id="wnd.tmpl.select">
	<div class="wnd-select js-scroll-wrp">
		<ul class="wnd-select-list">
			{{@it.list: elem: key}}
				<li class="wnd-select-elem {{?it.isEqual(elem, it.defElem)}}-defElem{{?}} link -lenLim js-select-elem" data-key="{{=key}}">{{=it.elemTmpl(elem)}}</li>
			{{@}}
		</ul>
	</div>
</script><script type="text/plain" id="bar.wrp">
    <div class="{{=it.bar.getTypeClass('-cont')}} {{=it.bar.getName()}}-cont">
        {{=it.cont}}
    </div>
</script>

<script type="text/plain" id="statusBar">
    <div class="statusBar-info-wrp"></div>
</script>

    <script type="text/plain" id="statusBar.info">
        <div class="info-controls-wrp">
            <span class="info-bars button2 -type-minimize {{?ls.getLandscapeNoPanels()}}-state-minimized{{?}}"></span>

            {{?utils.isFullScreenAvail()}}
                <span class="info-fullScreen button2 -type-fullScreen"></span>
            {{?}}

            <div class="info-mute-wrp"></div>

            <div class="info-clock-wrp"></div>

            <a class="info-menu button2 -type-menu" href="{{=hashMgr.getWndHref('systmenu')}}"></a>

            {{?debug.isAdmin() || debug.isTest() || debug.isNA()}}
                <div class="test-reload" onclick="appl.reload();">↺</div>

                <div class="test-mobileApp" onclick="ls.setMobileApp(!ls.getMobileApp(false)); appl.reload();">📱</div>

                <div class="test-consoleErrors" onclick="wndMgr.addPopupWnd(wConsoleErrors);"></div>

                <div class="test-na {{?debug.isNA()}}-bgColor-green{{?}}" onclick="location = appl.getOriginHost()+'/'+hashMgr.addAccountToHref(wofh.account.id)+(debug.isNA()?'':'&na')+location.hash;">NA</div>
            {{?}}
        </div>
        /*
        <div class="test-showSize" onclick="wndMgr.addAlert(JSON.stringify(wndMgr.getWindowSize()) + '<br>' + JSON.stringify({y: window.innerHeight}))">S</div>
        */
        <div class="info-towns-wrp"></div>
    </script>

<script type="text/plain" id="menuBar">
    <div class="menuBar-trade-wrp"></div>

    <div class="menuBar-smmenu-wrp"></div>

    <div class="menuBar-questlist-wrp" tabindex="0"></div>
</script>

    <script type="text/plain" id="smmenu">
        <div class="smmenu-btns-wrp"></div>
    </script>

<script type="text/plain" id="navBar">
    <div class="navBar-action navBar-swipeRight">
        {{=tmplMgr.navBar.swipeArrow({type: 'right'})}}
    </div>
    <div class="navBar-actionGroup">
        <div class="navBar-action navBar-toLeft">
            {{=tmplMgr.navBar.contArrow({type: 'left'})}}
        </div>
        <div class="navBar-action navBar-toTop">
            {{=tmplMgr.navBar.contArrow({type: 'top'})}}
        </div>
        <div class="navBar-action navBar-toCenter">
            {{=tmplMgr.navBar.contArrow({type: 'middle'})}}

            <div class="homeCircle"></div>
        </div>
        <div class="navBar-action navBar-toBottom">
            {{=tmplMgr.navBar.contArrow({type: 'bottom'})}}
        </div>
        <div class="navBar-action navBar-toRight">
            {{=tmplMgr.navBar.contArrow({type: 'right'})}}
        </div>
    </div>
    <div class="navBar-action navBar-swipeLeft">
        {{=tmplMgr.navBar.swipeArrow({type: 'left'})}}
    </div>
</script>

    <script type="text/plain" id="navBar.swipeArrow">
        <div class="swipeArrow -type-{{=it.type}}">
            <div></div><div></div><div></div>
        </div>
    </script>

    <script type="text/plain" id="navBar.contArrow">
        <div class="contArrow -type-{{=it.type}}"></div>
    </script><script type="text/plain" id="wchat">
    <div class="wchat-chat-wrp"></div>
</script>

<script type="text/plain" id="chat.search"></script><script type="text/plain" id="map">
    <div class="map-loadIndicator-wrp"></div>

    <div class="map-back-wrp"></div>
</script>

<script type="text/plain" id="map.outer">
    <div class="panel-map-info-wrp"></div>
    <div class="panel-map-filters-wrp"></div>
    <div class="panel-map-mapR-wrp"></div>
    <div class="panel-map-actions-wrp"></div>
    <div class="panel-map-mini-wrp"></div>
    <div class="map-events-wrp"></div>
    <div class="map-nav-wrp"></div>
    <div class="map-version-wrp"></div>
</script>

<script type="text/plain" id="map.actions">
    <div class="actions-mode-wrp"></div>
</script>

<script type="text/plain" id="iMap.mapTL.mode">
    {{=tmplMgr.iMap.mapTL.mode.build(it)}}
</script>

<script type="text/plain" id="map.version">
    <div class="map-version">
        {{=tmplMgr.iMap.mapTL.mode.map()}}
    </div>
</script>

<script type="text/plain" id="map.mini">
    <div class="mini-mini-wrp"></div>
</script>

<script type="text/plain" id="map.mapR">
    <div class="mapR-mapR-wrp"></div>
</script>

<script type="text/plain" id="map.filters">
    <div class="map_filter">
        <div class="filters-aura-wrp -type-aura"></div>
        <div class="filters-iface-wrp -type-iface"></div>
        <div class="filters-filter-wrp -type-filter"></div>
    </div>
    <div class="filters-zoom-wrp"></div>
</script><script type="text/plain" id="tmenu">
    /*<div class="tmenu-luck-wrp"></div>*/
    <div class="tmenu-pop-wrp"></div>
    <div class="tmenu-trade-wrp"></div>
    <div class="tmenu-attacks-wrp"></div>
</script>

<script type="text/plain" id="systmenu.additional">
    <li>
        <br>
        <a class="smenu-itemBtn button1 -type-blue" onclick="appl.reload();">Перезагрузить</a> 
    </li>
</script>

















































<script type="text/plain" id="panel.wrp">
    <div class="{{=it.panel.getTypeClass()}} {{=it.panel.getBaseType()}}-{{=it.panel.getName()}} {{=it.panel.getTmplClass()}} {{=it.panel.getExtClass()}}" data-side="{{=it.panel.getSide()}}">
        {{=tmplMgr.panel.expButton(it)}}

        {{=tmplMgr.panel.contBlk(it)}}

        {{=tmplMgr.panel.outer(it)}}
    </div>
</script>

    <script type="text/plain" id="panel.contBlk">
        <div class="panel-cont-blk">
            {{=tmplMgr.panel.header(it)}}

            {{=tmplMgr.panel.cont(it)}}

            {{=tmplMgr.panel.footer(it)}}
        </div>
    </script>

        <script type="text/plain" id="panel.cont">
            <div class="panel-cont-wrp">
                <div class="panel-cont">
                    {{=it.cont}}
                </div>
            </div>
        </script>

<script type="text/plain" id="panel.outer">
    {{var wrps = it.panel.getOuterWrps();}}
    {{?wrps}}
        <div class="panel-outer-wrp">{{=wrps}}</div>
    {{?}}
</script><script type="text/plain" id="town">
    <div class="town-zoom-wrp">
        <div class="town-back-wrp"></div>

        <div class="town-oldtown-wrp"></div>
    </div>
</script>

<script type="text/plain" id="town.clickers">
    <div class="view-clickers">
        {{@it.clickers: clicker}}
            {{=tmplMgr.town.clicker({clicker: clicker})}}
        {{@}}
    </div>
</script>

<script type="text/plain" id="town.clicker">
    <a class="town-clicker -res{{=it.clicker.res.getId()}}" data-pos="{{=it.clicker.i}}"></a>
</script>

<script type="text/plain" id="town.back">
    <div class="view-town">
        <canvas class="town-canvas" id="town-canvas0" aria-labelledby="tooltip-voiceHelperCont"></canvas>
        <canvas class="town-canvas" id="town-canvas" aria-labelledby="tooltip-voiceHelperCont"></canvas>
    </div>
</script>

<script type="text/plain" id="town.slot">
    <div class="town-slot">
        {{?it.slot.getActions().getLength()}}
            {{=tmplMgr.town.bldEvents({slot: it.slot})}}
        {{?}}

        <a href="{{=hashMgr.getWndHref('slot', it.slot.getPos())}}" data-pos="{{=it.slot.getPos()}}" data-id="{{=it.slot.getId()}}">
            {{=snip.slotFrame2(it.slot, {allowEmpty: true, showLabel: true, noLink: true})}}
        </a>
    </div>
</script>

<script type="text/plain" id="town.outer">
    <div class="town-loadIndicator-wrp"></div>

    <div class="town-swapSlot-wrp"></div>

    <div class="town-info-wrp"></div>

    <div class="panel-town-info-wrp"></div>

    <div class="town-luck-wrp"></div>

    <div class="town-defBon-wrp">
        <div class="town-defence-wrp"></div>
        <div class="town-bonus-wrp"></div>
    </div>

    <div class="panel-town-tmenu-wrp"></div>
    <div class="panel-town-stock-wrp"></div>
    <div class="panel-town-garrison-wrp"></div>
    <div class="panel-town-bldqueue-wrp"></div>
</script>

<script type="text/plain" id="town.info">
    <div class="info-attacks-wrp"></div>

    <div class="info-pop-wrp"></div>
</script>

<script type="text/plain" id="mmenu.attacks.before"></script>

<script type="text/plain" id="mmenu.attacks.after">
    {{=tmplMgr.mmenu.attacks.battle(it)}}
</script><script type="text/plain" id="announce.form.cont">
    <div>
        {{
            var iconsGroups = wAnnounce.getIconsGroups();
        }}

        {{@iconsGroups: iconsGroup}}
            <div class="announce-iconsGroup">
                {{@iconsGroup: icon}}
                    {{=tmplMgr.announce.form.icon({icon: icon})}}
                {{@}}
            </div>
        {{@}}
    </div>

    <div>
        {{=tmplMgr.announce.form.text(it)}}
    </div>
</script><script type="text/plain" id="army.events.header">
    <td id="move_city">Цель</td>
    <td style="width:80px; color:#000" class="def_table_cw_th">
        <div class="dIB underline">Время в пути</div>
        <div>Прибытие</div>
    </td>
    <td class="def_table_cw_th3" colspan="2">Войска и добыча</td>
</script>

<script type="text/plain" id="army.event">																																																																																																							
    <td class="aL">
        {{=tmplMgr.army.event.aim(it)}}
    </td>
    <td>
        <div class="t_cw_sep_l">
            <div class="dIB underline">{{=tmplMgr.army.event.time(it)}}</div>
            <div>{{=tmplMgr.army.event.moment(it)}}</div>
            <div class="army-event-speed">{{=tmplMgr.army.event.speed(it)}}</div>
        </div>
    </td>

    {{=tmplMgr.army.event.army(it)}}
</script>

<script type="text/plain" id="army.event.armyInfo">
    {{var commanderTmpl = tmplMgr.army.event.commander(it);}}
    {{?commanderTmpl}}
        <div class="army-event-commander">
            <span>Командующий: {{=commanderTmpl}}</span>
        </div>
    {{?}}
</script>

<script type="text/plain" id="army.oper.aimAddInfo">
    <div class="oper-col2-time">
        {{=tmplMgr.army.oper.time(it)}}
    </div>
</script>

<script type="text/plain" id="army.oper.colTime"></script><script type="text/plain" id="barter.buy.list">
    <table class="table01 barter-buy-offersTable" cellspacing="0">
        <colgroup>
            <col class="barter-offersTable-col1">
            <col class="barter-offersTable-col2">
            <col class="barter-offersTable-col3">
            <col class="barter-offersTable-col4">
            <col class="barter-offersTable-col5">
            <col class="barter-offersTable-col6">
        </colgroup>

        <thead>
            <tr class="cw_head_tr">
                <td></td>
                <td><div>Город</div></td>
                <td>
                    <div class="t_cw_sep_l">
                        <span class="underline">Продает</span>
                        <div>Покупает</div>
                    </div>
                </td>
                <td><div class="t_cw_sep_l nobr"><a class="js-profitSort"><span class="barter-buy-sorting">Выгода</span><br>{{=snip.sort('profit', 0, '-black')}}</a></div></td>
                <td>
                    <div class="t_cw_sep_l">
                        <a class="js-distSort underline nobr">
                            <span class="barter-buy-sorting">{{=snip.ruler()}}</span>

                            {{=snip.sort('dist', 0, '-black')}}
                        </a>
                        <div>Время</div>
                    </div>
                </td>
                <td><div class="t_cw_sep_l barter-buy-actions">Предложений</div></td>
            </tr>
        </thead>

        <tbody class="-sel">
            {{~it.offers: offer: pos}}
                <tr class="trow js-barter-buy-offer" data-pos="{{=pos}}">
                    <td class="aC">
                        {{?offer.inCountry}}
                            {{=snip.crown('Предложение в стране')}}
                        {{?}}
                    </td>
                    <td>
                        <div class="lenLim barter-buy-town">
                            {{?offer.town}}
                                {{=snip.townAccUnder(offer.town)}}
                            {{??}}
                                {{=snip.townLink()}}
                            {{?}}
                        </div>
                    </td>
                    <td>
                        <span class="underline">
                            {{=snip.resCount(offer.res1, offer.sum1)}}
                        </span>
                        <div>
                            {{=snip.resCount(offer.res2, offer.sum2)}}
                        </div>
                    </td>
                    <td>{{=offer.profit}}%</td>
                    <td>
                        <span class="lenLim underline">
                            {{?offer.distance}}
                                {{=snip.distPath(offer.distance, offer.path)}}
                            {{??}}
                                ?
                            {{?}}
                        </span>

                        <div>
                            {{?offer.time}}
                                {{=timeMgr.fPeriod(offer.time)}}
                            {{??}}
                                ?
                            {{?}}
                        </div>
                    </td>
                    <td class="aR">
                        <span class="barter-buy-offerQuantity-wrp -nobr">
                            <span class="crP js-barter-buy-offerMaxQuantity">×{{=offer.quantity}}</span> 
                            {{=snip.input1({cls: 'barter-buy-offerQuantity spinbox', name: 'quantity', value: 1})}}
                        </span>

                        <input type="button" class="barter-buy-buyOffer" value="Купить">
                    </td>
                </tr>
            {{~}}
        </tbody>
    </table>
</script><script type="text/plain" id="bonus.specialists">
    <table class="bonus-table bonus-accSpecialists">
        <thead>
            <tr>
                <td>Твои свободные Великие Граждане</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    {{@wofh.account.getSpecialists().getList(): specialist}}
                        {{=tmplMgr.bonus.specialists.specialist({specialist: specialist, hasNew: it.newSpecialists[specialist.getId()]})}}
                    {{@}}
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/plain" id="bonus.bonusTowns">
    <table class="bonus-table bonus-towns">
        <thead>
            {{?LuckBonus.subscription.isOn() && (it.subscription.isActive() || debug.isAdmin())}}
                <tr>
                    <td colspan="2">
                        Царь-бонус всех городов — {{=timeMgr.fPeriod(it.subscription.time - timeMgr.getNow())}}
                    </td>
                </tr>
            {{??}}
                <tr>
                    <td colspan="2"></td>
                </tr>
            {{?}}
        </thead>
        <tbody>
            {{@it.towns: town: pos}}
                <tr class='row{{=pos%2}}'>
                    <td class="bonus-towns-town bonus-town-wrp" data-town="{{=town.id}}">
                        {{=tmplMgr.bonus.town.info({town: town})}}
                    </td>
                    <td class="bonus-town-wrp">
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Население ' + snip.hint('Увеличивает темпы роста населения'))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.grown})}}
                        </div>			
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Культура ' + snip.hint('Увеличивает культуру'))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.culture})}}
                        </div>
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Наука ' + snip.hint('Увеличивает производство' + snip.res(Resource.ids.science)))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.science})}}
                        </div>
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Производство ' + snip.hint('Увеличивает производство всех ресурсов, кроме' + snip.res(Resource.ids.science)))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.production})}}
                        </div>
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Торговцы ' + snip.hint('Увеличивает число торговцев'))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.traders})}}
                        </div>
                        <div class="bonus-town-cell-wrp">
                            <div class="bonus-town-cell-name">
                                {{=snip.nobr('Война ' + snip.hint('Увеличивает силу армии как в атаке, так и в защите'))}}
                            </div>
                            {{=tmplMgr.bonus.town.cell({town: town, type: LuckBonus.ids.war, right: true})}}
                        </div>
                    </td>
                </tr>
            {{@}}
            {{?LuckBonus.subscription.isOn()}}
                <tr>
                    <td colspan="2">
                        {{?it.subscription.isActive() || debug.isAdmin()}}
                            <div class="bonusSpecial-selection-block" data-type="{{=wBonusSpecial.selectionType.bonus}}">
                                <div class="bonusSpecial-selection">
                                    <div class="bonusSpecial-selection-accept spage-button">Продлить</div>
                                </div>
                            </div>
                        {{?}}
                    </td>
                </tr>
            {{?}}
        </tbody>
    </table>
</script><script type="text/plain" id="country.info.accounts">
    <div class="country-accounts-block">
        <table class="country-accounts-table" cellpadding="0" cellspacing="0">
            {{=tmplMgr.country.info.accounts.table(it)}}
        </table>
    </div>

    {{=tmplMgr.country.info.accounts.invited(it)}}
</script><script type="text/plain" id="countryOrders.list.colgroup">
    {{var colsWidth = it.colsWidth||[15, 5, 15, 15, 15, 20, 15];}}

    <colgroup>
        {{@colsWidth: colWidth}}
            <col style="width: {{=colWidth}}%">
        {{@}}
    </colgroup>
</script><script type="text/plain" id="countryAdviser.view.town">
    <div class="countryAdviser-res">
        <div class="cAdv-town-filterWrp">
            <div>Фильтры:</div>
            <div class="cAdv-town-filter"></div>
        </div>
        <div class="tbl tbl-cAdv-town">
            <div class="tbl-thead">
                <div class="tbl-tr">
                    <div class="tbl-th cAdv-towns-col0">#</div>
                    <div class="tbl-th cAdv-towns-col3">{{=snip.btnTable('acc','','Игрок')}}</div>
                    <div class="tbl-th cAdv-towns-col4">{{=snip.btnTable('spec','','Специализация города')}}</div>
                    <div class="tbl-th cAdv-towns-col11">{{=snip.btnTable('pop','Население','Население города')}}</div>
                    <div class="tbl-th cAdv-towns-col9">{{=snip.btnTable('deposit','','Колония города и её климат')}}</div>
                    <div class="tbl-th cAdv-towns-col13">{{=snip.btnTable('wonder','','Чудо света')}}</div>
                    <div class="tbl-th cAdv-towns-col6">{{=snip.btnTable('terrWater','','Количество водных кварталов города')}}</div>
                    <div class="tbl-th cAdv-towns-col7">{{=snip.btnTable('terrHill','','Дополнительные холмовые кварталы города')}}</div>

                    <div class="tbl-th cAdv-towns-col2">{{=snip.btnTable('control','','Избранное')}}</div>
                    <div class="tbl-th cAdv-towns-col5">{{=snip.btnTable('town','','Город')}}</div>
                    <div class="tbl-th cAdv-towns-col1">{{=snip.btnTable('dist',snip.ruler(),'Расстояние')}}</div>
                    <div class="tbl-th cAdv-towns-col12">{{=snip.btnTable('army','Армия','Численность армии города')}}</div>
                    <div class="tbl-th cAdv-towns-col10">{{=snip.btnTable('depRes','','Ресурс, добываемый колонией города')}}</div>
                    <div class="tbl-th cAdv-towns-col15">{{=snip.btnTable('comment','','Комментарии')}}</div>
                    <div class="tbl-th cAdv-towns-col14">{{=snip.btnTable('aad','ПВО',"Максимально возможный урон вражеской авиации от любых построенных и работающих строений противовоздушной обороны.")}}</div>
                    <div class="tbl-th cAdv-towns-col8">{{=snip.btnTable('climate','','Климат города')}}</div>
                </div>
            </div>

            <div class="tbl-tbody cAdv-town-table-data" style="max-height:450px"></div>
        </div>
    </div>
</script>

<script type="text/plain" id="countryAdviser.town.table.block">
    {{var prevFilter = true;}}
    {{@it.block.list: town: i}}
        {{?prevFilter != town.filter}}
            {{prevFilter = town.filter;}}
        {{?}}
        <div class="tbl-tr cAdv-towns-town {{?!town.filter}}-type-filtered{{?}}" data-id="{{=town.id}}" >
            {{var selected = it.townSelect.id == town.id;}}

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col0">{{=it.options.blockSize * it.block.i + (+i) + 1}}</div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col3 cAdv-towns-filter-wrp">
                {{=snip.accLink(town.account)}}
                <a class="cAdv-towns-filter -type-left" data-field="acc" data-val="{{=town.account.id}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col4 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-spec">
                    {{=snip.icon(snip.c.townSpec, 'townSpec'+town.specIcon)}}
                    {{?town.specRes}}
                        <span class="cAdv-towns-spec-res">{{=snip.res(town.specRes)}}</span>
                    {{?}}
                </a>
                <a class="cAdv-towns-filter" data-field="spec" data-val="{{=town.spec}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col11 cAdv-towns-filter-wrp">
                {{=snip.pop(town.pop)}}
                <a class="cAdv-towns-filter" data-field="pop">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col9 cAdv-towns-filter-wrp">
                {{? !town.deposit.isEmpty() }}
                    <div class="nobr">
                        <span class="adviserIcon -type-depClim{{=town.deposit.getClimate()-1}}" data-title="Климат колонии — {{=Tile.climate[town.deposit.getClimate()].title}}"></span>

                        {{=snip.depositLink(town.deposit)}}
                    </div>

                    <a class="cAdv-towns-filter -type-left" data-field="deposit" data-val="{{=town.deposit.id}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col13 cAdv-towns-filter-wrp">
                {{?town.wonder}}
                    {{=snip.buildLink(town.wonder, snip.slotName(town.wonder, {level: true, lenLim: '-snip-textWonder'}))}}

                    <a class="cAdv-towns-filter -type-left" data-field="wonder" data-val="{{=town.wonder.id}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col6 cAdv-towns-filter-wrp">
                {{var val = town.getType().water;}}
                {{?val}}
                    <span 
                        class="adviserIcon -type-water{{=val}}" 
                        data-title="{{?val==1}}1 водный квартал{{??val==2}}2 водных квартала{{??val==3}}3 водных квартала{{??}}4 водных квартала{{?}}">
                    </span>
                    <a class="cAdv-towns-filter" data-field="terrWater" data-val="{{=val}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col7 cAdv-towns-filter-wrp">
                {{var val = town.getType().hill;}}
                {{?val == 3}}
                    <span class="adviserIcon -type-hill" data-title="Дополнительные холмовые кварталы"></span>
                    <a class="cAdv-towns-filter" data-field="terrHill" data-val="{{=val}}">
                        <span class="adviserIcon -type-filter"></span>
                    </a>
                {{?}}
            </div>

            <div class="tbl-td cAdv-towns-cell cAdv-towns-col2 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-control adviserIcon -type-fav {{?town.control}}-active{{?}}" data-title="Выбрать"></a>

                <a class="cAdv-towns-filter" data-field="control" data-val="{{=+town.control}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col5 cAdv-towns-filter-wrp">
                {{=snip.townLink(town)}}

                <a class="cAdv-towns-filter -type-left" data-field="town" data-val="{{=town.id}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col1 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-dist {{?selected}}-active{{?}}" data-title="Расстояние">
                    {{?selected}}<span class="adviserIcon -type-origin"></span>
                    {{??}}{{=town.dist.toFixed(1)}}{{?}}    
                </a>
                <a class="cAdv-towns-filter" data-field="dist">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col12 cAdv-towns-filter-wrp">
                {{?town.armypop}}{{=snip.pop(town.armypop)}}{{?}}
                <a class="cAdv-towns-filter" data-field="army">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col10">
                {{@town.deposit.getRes().getList(): res}}
                    <span class="cAdv-towns-filter-wrp">
                        {{=snip.resBig(res)}}
                        <a class="cAdv-towns-filter" data-field="depRes" data-val="{{=res.getId()}}">
                            <span class="adviserIcon -type-filter"></span>
                        </a>
                    </span>
                {{@}}
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col15 cAdv-towns-filter-wrp">
                <a class="cAdv-towns-comment -lenLim" 
                        data-title="{{?town.comment}}Открыть комментарий{{??}}Добавить комментарий{{?}}">
                    {{=town.comment||'…'}}
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col14 cAdv-towns-filter-wrp">
                {{?town.ad}}
                    {{=town.ad}}
                {{?}}
                <a class="cAdv-towns-filter" data-field="aad">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
            <div class="tbl-td cAdv-towns-cell cAdv-towns-col8 cAdv-towns-filter-wrp">
                <span class="adviserIcon -type-clim{{=town.climate-1}}" data-title="Климат города — {{=Tile.climate[town.climate].title}}"></span>
                <a class="cAdv-towns-filter" data-field="climate" data-val="{{=town.climate}}">
                    <span class="adviserIcon -type-filter"></span>
                </a>
            </div>
        </div>
    {{@}}
</script><script type="text/plain" id="countryInfo.info">
    <tr>
        <td class="countryInfo-info-flag vaT">
            <span class="aC">{{=snip.countryFlag(it.country, {flag:'biggest'})}}</span>
        </td>

        <td class="countryInfo-info-actions vaT aR">
            {{=tmplMgr.countryInfo.info.actions(it)}}
        </td>
    </tr>
    <tr>
        <td class="countryInfo-info-desc vaT aC" colspan="2">
            <div class="countryInfo-info-descText js-scroll-wrp">{{=TextParser.prepare(it.country.about)}}</div>
        </td>
    </tr>
</script><script type="text/plain" id="economics.pop.totalGrown">
    {{var table = tabEconomicsPop.getTableLayout();}}

    {{=table()}}
        {{=table.thead()}}
            {{=tmplMgr.economics.pop.totalGrown.header(it)}}
        {{=table.thead.end()}}

        {{=table.tbody()}}
            {{=tmplMgr.economics.pop.totalGrown.body(it)}}
        {{=table.tbody.end()}}
    {{=table.end()}}
</script>

<script type="text/plain" id="economics.pop.totalCult">
    {{var table = tabEconomicsPop.getTableLayout();}}

    {{=table()}}
        {{=table.thead()}}
            {{=tmplMgr.economics.pop.totalCult.header(it)}}
        {{=table.thead.end()}}

        {{=table.tbody()}}
            {{=tmplMgr.economics.pop.totalCult.body(it)}}
        {{=table.tbody.end()}}
    {{=table.end()}}
</script><script type="text/plain" id="buildinfo.desc">
    <div class="pedia-text">
        <div class="pedia-info -type-buildInfo">
            {{=tmplMgr.buildinfo.img(it)}}

            {{=it.slot.getDesc()}}
        </div>

        <div class="cB"></div>

        {{=tmplMgr.buildinfo.features(it)}}

        {{=it.slot.getSpeciale()}}

        {{=tmplMgr.buildinfo.info(it)}}
    </div>
</script>

<script type="text/plain" id="buildinfo.features">
    <table class="pedia-features">
        <colgroup>
            <col class="pedia-features-col1">
            <col class="pedia-features-col2">
            <col class="pedia-features-col3">
        </colgroup>

        {{=snip.buildParams(it.slot, false)}}
    </table>
</script><script type="text/plain" id="scienceinfo">
    <div class="page-pedia pedia-text view-scienceinfo">
        <div class="pedia-info -type-scienceInfo">
            {{=tmplMgr.scienceinfo.img(it)}}

            {{=it.science.getDesc()}}
        </div>

        <div class="cB"></div>

        {{=tmplMgr.scienceinfo.info(it)}}
    </div>
</script><script type="text/plain" id="unitinfo">
    <div class="page-pedia pedia-text">
        <div class="pedia-info -type-unitInfo">
            {{=tmplMgr.unitinfo.img(it)}}

            {{=it.unit.getDesc()}}
        </div>

        <div class="cB"></div>

        {{=tmplMgr.unitinfo.features(it)}}
    </div>
</script><script type="text/plain" id="money.bank">
    <div class="money-credites-wrp"></div>

    <div class="money-deposites-wrp"></div>
</script><script type="text/plain" id="options.general.mobile">
    <div class="options-cell-wrp"></div>

    <label class="options-cell-wrp">
        <div class="options-cell">Скорость анимации окон:</div>
        <div class="options-cell">
            {{var animTime = ls.getWndSwipeTime(300);}}

            <select class="select1 options-input options-wndSwipeTime">
                <option value="0" {{?animTime == 0}}selected{{?}}>Без анимации</option>
                <option value="150" {{?animTime == 150}}selected{{?}}>Анимация 0.5x</option>
                <option value="300" {{?animTime == 300}}selected{{?}}>Анимация 1x</option>
                <option value="450" {{?animTime == 450}}selected{{?}}>Анимация 1.5x</option>
                <option value="600" {{?animTime == 600}}selected{{?}}>Анимация 2x</option>
            </select>
        </div>
    </label>

    <label class="options-cell-wrp">
        <div class="options-cell">Скорость анимации панелей:</div>
        <div class="options-cell">
            {{var animTime = ls.getBarAnimTime(500);}}

            <select class="select1 options-input options-barAnimTime">
                <option value="-1" {{?animTime == -1}}selected{{?}}>Без анимации</option>
                <option value="250" {{?animTime == 250}}selected{{?}}>Анимация 0.5x</option>
                <option value="500" {{?animTime == 500}}selected{{?}}>Анимация 1x</option>
                <option value="750" {{?animTime == 750}}selected{{?}}>Анимация 1.5x</option>
                <option value="1000" {{?animTime == 1000}}selected{{?}}>Анимация 2x</option>
            </select>
        </div>
    </label>

    <label class="options-cell-wrp -type-switcher">
        <div class="options-cell">Плавная прокрутка карты:</div>
        <div class="options-cell">
            {{=snip.checkbox1({name: 'smoothMapScroll', checked: ls.getSmoothMapScroll(true)})}}
        </div>
    </label>

    {{=tmplMgr.options.general.mobile.ext()}}

    <div class="options-cell-wrp">
        <span class="fB">Портретный режим:</span>
    </div>

    <label class="options-cell-wrp -type-switcher">
        <div class="options-cell">Скрывать статические панели:</div>
        <div class="options-cell">
            {{=snip.checkbox1({name: 'hideBar', checked: ls.getLandscapeNoPanels(false)})}}
        </div>
    </label>
</script>

    <script type="text/plain" id="options.general.mobile.ext">
        <label class="options-cell-wrp -type-switcher">
            <div class="options-cell">Старый город:</div>
            <div class="options-cell">
                {{=snip.checkbox1({name: 'oldTown', checked: ls.getOldTown(false)})}}
            </div>
        </label>

        <label class="options-cell-wrp -type-switcher -type-navBar">
            <div class="options-cell">Скрывать навигационную панель:</div>
            <div class="options-cell">
                {{=snip.checkbox1({name: 'noNavBar', checked: ls.getNoNavBar(debug.isMobileApp())})}}
            </div>
        </label>

        <div class="options-cell-wrp -type-switcher">
            <div class="options-cell">Положение меню:</div>
            <div class="options-cell">
                <label>
                    {{=snip.radio1({name: 'menuSide', value: 'top', checked: ls.getMenuSide('top') == 'top'})}}
                     Сверху
                </label>
                   
                <label>
                    {{=snip.radio1({name: 'menuSide', value: 'bottom', checked: ls.getMenuSide('top') == 'bottom'})}}
                     Снизу
                </label>
            </div>
        </div>
    </script><script type="text/plain" id="report.info">
    <table class="report-topic-left">
        <colgroup>
            <col width="8%">
            <col width="69%">
        </colgroup>

        {{?debug.isAdmin()}}
            <tr>
                <td>Чей:</td>
                <td colspan="3">
                    {{=snip.accCountry(it.owner)}}
                </td>
            </tr>
        {{?}}
        <tr>
            <td>Тема:</td>
            <td>
                <span>{{=tmplMgr.report.topic(it)}}</span>
            </td>
        </tr>

        {{=tmplMgr.report.view.right({report:it})}}
    </table>
</script>

<script type="text/plain" id="report.bottom">
    {{=tmplMgr.report.bottom.left(it)}}

    {{=tmplMgr.report.bottom.center(it)}}

    {{=tmplMgr.report.bottom.right(it)}}
</script>

<script type="text/plain" id="report.access.cont">
    <table class="ri-share">
        <colgroup>
            <col width="33%">
            <col width="33%">
            <col width="33%">
        </colgroup>
        <tr>
            <td colspan="2">
                <label>
                    {{=snip.checkbox1({name: 'open', checked: it.share && !it.isShare(Report.accessIds.open, true)})}}
                    &nbsp;
                    Открыть доступ к отчету
                </label>
            </td>
            <td rowspan="3" class="ri-share-submit">
                <button class="button1 -type-green">Применить</button>
            </td>
        </tr>
        <tr>
            <td>
                <label>
                    {{=snip.checkbox1({name: 'ha', checked: !it.share || !it.isShare(Report.accessIds.ha, true)})}}
                     Нападающие
                </label>
            </td>
            <td>
                <label>
                    {{=snip.checkbox1({name: 'hd', checked: !it.share || !it.isShare(Report.accessIds.hd, true)})}}
                     Защищающиеся
                </label>
            </td>
        </tr>
        <tr>
            <td>
                <label>
                    {{=snip.checkbox1({name: 'haa', checked: !it.share || !it.isShare(Report.accessIds.haa, true)})}}
                     Армия атаки
                </label>
            </td>
            <td>
                <label>
                    {{=snip.checkbox1({name: 'hda', checked: !it.share || !it.isShare(Report.accessIds.hda, true)})}}
                     Армия защиты
                </label>
            </td>
        </tr>
    </table>

    <div>
        {{?it.share && !it.isShare(Report.accessIds.open, true) && !wofh.platform.noreportlink}}
            <div class="aL">
                <input class="share-url" type="text" readonly="readonly" value="{{=location.protocol}}//{{=lib.main.domain||document.location.host}}/report#{{= it.id }}{{?it.code }}-{{= it.code }}{{?}}"> {{=snip.hint('Используй этот адрес в тексте для ссылки на этот отчет')}}
            </div>
        {{?}}
        {{?it.data.logs}}
            <div class="aC">
                <a class="link js-report-battle-log">Открыть лог боя</a>
            </div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="report.infoReport.acc.cols">
    <col width="35%">
    <col width="10%">
    <col width="5%">
    <col width="5%">
    <col width="10%">
    <col width="35%">
</script><script type="text/plain" id="stream.buy.list">
    <table class="table01 stream-buy-offersTable" cellspacing="0">
        <colgroup>
            <col class="stream-offersTable-col1">
            <col class="stream-offersTable-col2">
            <col class="stream-offersTable-col3">
            <col class="stream-offersTable-col4">
            <col class="stream-offersTable-col5">
            <col class="stream-offersTable-col6">
            <col class="stream-offersTable-col7">
        </colgroup>

        <thead>
            <tr class="cw_head_tr">
                <td></td>
                <td></td>
                <td>Город</td>
                <td>
                    <div class="t_cw_sep_l">
                        <span class="underline">Ресурс</span>

                        <div>Стоимость</div>
                    </div>
                </td>
                <td><div class="t_cw_sep_l">Время</div></td>
                <td></td>
                <td></td>
            </tr>
        </thead>

        <tbody>
            {{~it.offers: offer: pos}}
                <tr class="trow js-stream-buy-offer {{?!+offer.count}}cl-grey{{?}}" data-pos="{{=pos}}">
                    <td class="aC">
                        {{?offer.inCountry}}
                            {{=snip.crown('Предложение в стране')}}
                        {{?}}
                    </td>
                    <td>
                        {{?offer.ally}}
                            <div class="lenLim">
                                {{?offer.ally == it.countryAlly}}
                                    {{=snip.countryFlag(wofh.country, {flag:'normal'})}}
                                {{??}}
                                    {{=snip.tradeUnion(wofh.tradeAllies.getElem(offer.ally).name)}}
                                {{?}}
                            </div>
                        {{?}}
                    </td>
                    <td>
                        <div class="lenLim stream-buy-town">
                            {{?offer.town}}
                                {{=snip.townAccUnder(offer.town)}}
                            {{??}}
                                <span class="fwN">{{=snip.townLink()}}</span>
                            {{?}}
                        </div>
                    </td>
                    <td class="nobr aC">
                        <span class="underline">
                            {{=snip.resCount(offer.res, offer.count)}}
                        </span>

                        <div>{{=snip.resCount(Resource.ids.money, utils.toFixed((offer.cost + offer.tSum) * 0.001, 3))}}</div>
                    </td>
                    <td class="aC">
                        {{?offer.time}}
                            {{=timeMgr.fPeriod(offer.time)}}
                        {{??}}
                            ?
                        {{?}}
                    </td>
                    <td class="aL">
                        {{=utils.lenLim(offer.text, {length: 20})}}
                    </td>
                    <td class="aC">
                        <input type="submit" class="stream-buy-buyOffer {{?it.type != 'buy'}}-sell{{?}}" value="{{?it.type=='buy'}}Купить{{??}}Продать{{?}}">
                    </td>
                </tr>
            {{~}}
        </tbody>
    </table>
</script>

<script type="text/plain" id="stream.tableSellOffers.text">
    {{=utils.lenLim(it.offer.text, {length: 100})}}
</script><script type="text/plain" id="townInfo.header">
    {{=tmplMgr.townInfo.headerCont(it)}}
</script><script type="text/plain" id="trade.buy.list">
    <table class="table01 trade-buy-offersTable" cellspacing="0">
        <colgroup>
            <col class="trade-offersTable-col1">
            <col class="trade-offersTable-col2">
            <col class="trade-offersTable-col3">
            <col class="trade-offersTable-col4">
            <col class="trade-offersTable-col5">
            <col class="trade-offersTable-col6">
        </colgroup>

        <thead>
            <tr class="cw_head_tr">
                <td></td>
                <td>
                    <div>
                        <a class="js-allySort">
                            <span class="trade-buy-sorting">{{=snip.tradeUnion(false, 'Торговый союз')}}</span>
                            <br>
                            {{=snip.sort('ally', 0, '-black')}}
                        </a>
                    </div>
                </td>
                <td><div>Город</div></td>
                <td>
                    <div class="t_cw_sep_l">
                        <span class="underline">Ресурс</span>

                        <div>
                            <a class="js-costSort"><span class="trade-buy-sorting">Цена</span>{{=snip.sort('ally', 0, '-black')}}</a>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="t_cw_sep_l">
                        <a class="js-distSort underline nobr">
                            <span class="trade-buy-sorting">{{=snip.ruler()}}</span>

                            {{=snip.sort('dist', 0, '-black')}}
                        </a>

                        <div>Время</div>
                    </div>
                </td>
                <td class="vaT">
                    {{var filteredRes = ls.getTradeFilter(Trade.getTradeFilter()).res;}}
                    {{?!(it.prev === undefined && (it.offers||[]).length < 10) && filteredRes != ResList.filter.resType.all && filteredRes != Resource.ids.luck}}
                        <div class="t_cw_sep_l trade-buy-massMarket-wrp">
                            {{=snip.wndLink('tradeFreeMarket', {type:it.type, res:ls.getTradeFilter(Trade.getTradeFilter()).res}, snip.wrp('', 'Массовая ' + (Trade.isBuy(it.type)?'закупка':'продажа')), 'trade-buy-massMarket button1s -type-green', {noLink:true})}}
                        </div>
                    {{?}}
                </td>
            </tr>
        </thead>

        <tbody>
            {{~it.offers: offer: pos}}
                {{?!offer.count}}
                    {{continue;}}
                {{?}}
                <tr class="trow js-trade-buy-offer" data-pos="{{=pos}}">
                    <td class="aC">
                        {{?offer.inCountry}}
                            {{=snip.crown('Предложение в стране')}}
                        {{?}}
                    </td>
                    <td>
                        {{?offer.ally}}
                            <div class="lenLim aC indent">
                                {{?offer.ally == it.countryAlly}}
                                    {{=snip.countryFlag(wofh.country, {flag:'normal'})}}
                                {{??}}
                                    {{=snip.tradeUnion(offer.ally == lib.tradeally.blackmarket ? 'продаю на черном рынке' : wofh.tradeAllies.getElem(offer.ally).name)}}
                                {{?}}
                            </div>
                        {{?}}
                    </td>
                    <td>
                        {{?offer.town}}
                            <div class="lenLim trade-buy-town indent">
                                {{=snip.townAccUnder(offer.town)}}
                            </div>
                        {{??}}
                            <div class="indent">
                                {{=snip.townLink()}}
                            </div>
                        {{?}}
                    </td>
                    <td class="nobr aC">
                        <div class="-nobr underline">{{=snip.resCount(offer.res, offer.count)}}</div>

                        <div class="nobr">{{=snip.resCount(Resource.ids.money, utils.toFixed(offer.cost * 0.001, 3))}}</div>
                    </td>
                    <td class="aC">
                        <span class="lenLim underline">
                            {{?offer.distance}}
                                {{=snip.distPath(offer.distance, offer.path)}}
                            {{??}}
                                ?
                            {{?}}
                        </span>

                        <div>
                            <span class="pR">
                                {{?offer.noSpeedUpTime && Trade.isBuy(it.type)}}
                                    {{=snip.icon(snip.c.anyIcon, 'fuel', utils.escapeHtml(tmplMgr.alert.offerSpeedUp({noSpeedUpTime:offer.noSpeedUpTime})), false, 'trade-buy-alertTime')}}
                                {{?}}
                                {{?offer.time || offer.res == Resource.ids.luck}}
                                    {{?offer.noSpeedUpTime && Trade.isSell(it.type)}}
                                        {{=snip.title(timeMgr.fPeriod(offer.time), 'Расчетное время без ресурсов ускорения составит '+timeMgr.fPeriod(offer.noSpeedUpTime), '-type-underline')}}
                                    {{??}}
                                        {{=timeMgr.fPeriod(offer.time)}}
                                    {{?}}
                                {{??}}
                                    ?
                                {{?}}
                            </span>
                        </div>
                    </td>
                    <td class="aR">
                        {{=snip.res(offer.res)}} 
                        {{=snip.input1({cls: 'trade-buy-offerCount spinbox', name: 'count', disabled: !offer.limit, value: offer.limit, attrs: {'data-limit': offer.limit, 'data-spinbox-step': lib.trade.capacity, 'data-res': offer.res}, autocomplete: 'off'})}} 

                        <input type="submit" class="trade-buy-buyOffer {{?!offer.limit}}-disabled{{?}} {{?Trade.isSell(it.type)}}-sell{{?}}" value="{{?Trade.isSell(it.type)}}Продать{{??}}Купить{{?}}">
                    </td>
                </tr>
            {{~}}
        </tbody>
    </table>
</script><script type="text/plain" id="wnd.layer">
    {{?debug.useTransformZoom()}}
        <div class="zoom-layer">
            <div class="main-layer">
                <div class="wnd-layer"></div>
            </div>
        </div>
    {{??}}
        <div class="main-layer">
            <div class="wnd-layer"></div>
        </div>
    {{?}}
</script>

<script type="text/plain" id="wnd.wrpMob">
    {{var wnd = it.wnd;}}

    <div class="{{=wnd.getTypeClass()}} {{=wnd.getTmplClass()}} {{=wnd.getExtClass()}}">
        {{?wnd.options.allowBack}}
            <div class="wnd-back-wrp"></div>
        {{?}}

        <div class="wnd-topic-wrp">
            {{?wnd.options.showButtons}}
                {{=tmplMgr.wnd.buttons({canClose: wnd.options.canClose, noCloseAll: wnd.options.noCloseAll, showMinimize: wnd.options.showMinimize})}}
            {{?}}

            {{?wnd.options.clipboard}}
                <div class="wnd-clipboard-wrp">
                    {{=snip.clipboardWrp(wnd.options.clipboard.text, wnd.options.clipboard.short)}}
                </div>
            {{?}}

            {{=tmplMgr.wnd.header(it)}}
        </div>

        {{=tmplMgr.wnd.contMob(it)}}

        {{=tmplMgr.wnd.outer(it)}}

        {{?!wnd.options.noShadow}}
            <div class="wnd-shadow-wrp"></div>
        {{?}}
    </div>
</script>

<script type="text/plain" id="wnd.header">
    {{?it.wnd.hasHeader()}}
        <div class="wnd-header-wrp">
            <div class="wnd-header">
                {{=it.wnd.getHeaderCont()}}
            </div>
        </div>
    {{?}}
</script>

<script type="text/plain" id="wnd.buttons">
    <div class="wnd-buttons-wrp">
        {{?it.canClose}}
            <button class="wnd-button-close button2 -type-cancel js-wnd-close" data-title="Закрыть окно"></button>
        {{?}}
    </div>
</script>

<script type="text/plain" id="wnd.contMob">
    <div class="wnd-cont-wrp">
        <div class="wnd-cont">
            {{=it.cont}}
        </div>
    </div>
</script>

<script type="text/plain" id="wnd.outer">
    {{var wrps = it.wnd.getOuterWrps();}}
    {{?wrps}}
        <div class="wnd-outer-wrp">{{=wrps}}</div>
    {{?}}
</script><script type="text/plain" id="mini">
    <div class="view-mini">
        <div class="mini-mini-wrp"></div>
    </div>
</script>


<script type="text/plain" id="map.outer">
    <div class="panel-map-info-wrp"></div>
    <div class="panel-map-infoExt-wrp"></div>
    <div class="panel-map-actions-wrp"></div>
    <div class="panel-map-mini-wrp"></div>
    <div class="map-events-wrp"></div>
    <div class="map-nav-wrp"></div>
    <div class="map-towns-wrp"></div>
    <div class="map-version-wrp"></div>
</script>

<script type="text/plain" id="map.info">
    <div class="info-tile-wrp bgDark"></div>

    <div class="__tmpArrow"></div>
</script>

    <script type="text/plain" id="map.info.tile">
        {{var tile = it.tile;}}

        <div class="view-tile">
            <div class="tile-row -type-static">
                <span class="tile-clim">
                    {{=tile.climate.name}}
                    {{?tile.climate.id != Tile.climateIds.water && tile.climate.id != Tile.climateIds.deepwater}}
                         - {{?tile.river}}Река{{??}}{{=tile.terrain.name}}{{?}}
                    {{?}}
                </span>

                {{?tile.dist}}
                    <span class="tile-dist">
                        {{=snip.distance(tile.dist)}}
                    </span>
                {{?}}

                {{var canBuildTown = !(it.tile.tile[Tile.param.dep] != lib.map.nodeposit || it.tile.tile[Tile.param.climate] == Tile.climateIds.water || it.tile.tile[Tile.param.terrain] == Tile.terrainIds.mountains);}}

                <span class="tile-slots">{{=snip.townSlots(canBuildTown ? it.tile.slots : false, {showEmpty: true})}}</span>

                <span class="tile-roads">{{=snip.roadIcon()}}<span>{{=Tile.getRealRoadsCount(tile.tile)}}</span></span>

                <span class="tile-bridge">
                    {{?tile.hasImp(MapImp.ids.bridge)}}
                        {{=snip.bridgeIcon()}}
                    {{?}}
                </span>

                <span class="tile-comments">{{=snip.commentsIcon()}}<span>{{=tile.comments ? it.tile.comments.length : 0}}</span></span>
            </div>

            {{var cont = tmplMgr.map.info.tile.vary(it).trim();}}

            {{?cont}}
                <div class="tile-row -type-vary">{{=cont}}</div>
            {{?}}
        </div>
    </script>

        <script type="text/plain" id="map.info.tile.vary">
            {{var tile = it.tile;}}

            {{~tile.improves: imp}}
                {{?imp.getEffect()}}
                    <span class="tile-imp-effect">
                        {{=snip.mapImpEffect(imp, tile.mapImpUsers)}}

                        {{?imp.getEffectUngrown()}}
                            &nbsp;{{=snip.mapImpEffectUngrown(imp, {effect:imp.calcRealEffect(tile.mapImpUsers)})}}
                        {{??imp.getEffectProd()}}
                            &nbsp;{{=snip.mapImpEffectProd(imp, {effect:imp.calcRealEffect(tile.mapImpUsers), fixed: 1, postFix: '%'})}}
                        {{?}}
                    </span>
                {{?}}
            {{~}}

            {{?tile.deposit}}
                <span class="tile-deposit {{?tile.town}} -type-colonized{{?}}">
                    {{@tile.deposit.getRes().getList(): res}}
                        {{=snip.resEffect(res.id)}}
                    {{@}}

                    {{=snip.deposit(tile.deposit)}}

                    {{?tile.deposit.strength}}
                        <span class="tile-deposit-strength">
                            ({{=utils.formatNum(tile.deposit.strength, snip.getShortNumFormatOpt(tile.deposit.strength))}})
                        </span>
                    {{?}}

                    {{var canColonize = tile.deposit.canColonize();}}

                    <span class="tile-deposit-status-wrp">
                        <span> — </span>
                        <span class="tile-deposit-status {{?canColonize}}-type-avail{{?}}">
                            {{?!canColonize}}
                                не 
                            {{?}}
                            подходит для колонизации
                        </span>
                    </span>
                </span>
            {{?}}

            {{?tile.town}}
                <span class="tile-town">
                    {{?tile.wonder}}
                        <span class="tile-wonder">{{=snip.wonderIcon(tile.wonder)}}</span>
                    {{?}}

                    {{?Town.hasDefMoment(tile.town)}}
                        <span class="tile-defmoment">{{=snip.defIcon()}}</span>
                    {{?}}

                    {{=snip.town(tile.town, {rel: tile.diplomacy})}}

                    <span class="tile-town-pop">
                        {{?tile.town.pop}}
                            ({{=utils.formatNum(tile.town.pop.hasall, snip.getShortNumFormatOpt(tile.town.pop.hasall))}})
                        {{??}}
                            (<span class="loader-container-icon-small"></span>)
                        {{?}}
                    </span>

                </span>
            {{?}}

            {{?tile.player}}
                <span class="tile-player">
                    {{?tile.country}}
                        <span class="tile-country">
                            {{=snip.country(tile.country, {text: false, flag: 'mini'})}}
                        </span>
                    {{?}}

                    {{=snip.acc(tile.player)}}
                </span>
            {{?}}
        </script>

    <script type="text/plain" id="map.info.outer">
        <div class="info-towns-wrp"></div>
    </script>

        <script type="text/plain" id="map.info.towns">
            <div class="info-towns-list">
                {{@it.towns: town}}
                    {{var active = town.id == wofh.town.id;}}

                    <a href="{{=hashMgr.getMapHref(it.links[town.id].link)}}" class="button1 {{?active}}-active{{?}}">
                        {{?active}}<span class="">S</span>{{?}}

                        {{=town.name}}
                    </a>
                {{@}}
            </div>
        </script>

<script type="text/plain" id="map.infoExt">
    <div class="infoExt-tile-wrp bgDark"></div>

    <div class="__tmpArrow"></div>
</script>

    <script type="text/plain" id="map.infoExt.tile">
        {{var tile = it.tile;}}

        <div class="view-tile">
            <div class="tile-cell -type-static">
                <div class="tile-climDist">
                    <div class="tile-clim">
                        {{=tile.climate.name}}
                        {{?tile.climate.id != Tile.climateIds.water && tile.climate.id != Tile.climateIds.deepwater}}
                             - {{?tile.river}}Река{{??}}{{=tile.terrain.name}}{{?}}
                        {{?}}
                    </div>

                    {{?tile.dist}}
                        <div class="tile-dist">
                            {{=snip.distance(tile.dist)}}
                        </div>
                    {{?}}
                </div>

                <div class="tile-shortcut">
                    <a class="tile-comments" href="{{=hashMgr.getWndHref('mapComments')}}">
                        {{=tile.comments ? it.tile.comments.length : 0}}
                    </a>

                    {{var canBuildTown = !(it.tile.tile[Tile.param.dep] != lib.map.nodeposit || it.tile.tile[Tile.param.climate] == Tile.climateIds.water || it.tile.tile[Tile.param.terrain] == Tile.terrainIds.mountains);}}

                    <div class="tile-slots">{{=snip.townSlots(canBuildTown ? it.tile.slots : false, {showEmpty: true})}}</div>
                </div>
            </div>

            <div class="tile-cell -type-vary">
                {{?tile.deposit}}
                    <div class="tile-deposit -type-trimmed">
                        {{@tile.deposit.getRes().getList(): res}}
                            {{=snip.resEffect(res.id)}}
                        {{@}}

                        {{=snip.depositLink(tile.deposit)}}

                        {{?tile.deposit.strength}}
                            <span class="tile-deposit-strength">
                                ({{=utils.formatNum(tile.deposit.strength, {mixed: true})}})
                            </span>
                        {{?}}
                    </div>
                {{?}}

                {{?tile.town}}
                    <div class="tile-town -type-trimmed">
                        {{=snip.townLink(tile.town, {rel: tile.diplomacy})}}

                        {{?tile.town.pop}}
                            <span class="tile-town-pop">({{=utils.formatNum(tile.town.pop.hasall, {mixed: true})}})</span>
                        {{?}}
                    </div>
                {{?}}

                {{?tile.player}}
                    <div class="tile-player -type-trimmed">
                        {{=snip.accLink(tile.player)}}
                    </div>
                {{?}}

                {{?tile.country}}
                    <div class="tile-country -type-trimmed">
                        {{=snip.countryLink(tile.country, {flag: 'mini'})}}
                    </div>
                {{?}}        

                {{?tile.wonder}}
                    <div class="tile-wonder -type-trimmed">
                        {{=snip.buildLink(tile.wonder)}}
                    </div>
                {{?}}        

                {{?Town.hasDefMoment(tile.town)}}
                    <div class="tile-defmoment">{{=snip.defMoment(tile.town.defmoment)}}</div>
                {{?}}

                {{?(tile.improves||[]).length}}
                    <div class="tile-imps">
                        {{~tile.improves: imp}}
                            <div class="tile-imp">
                                <span class="tile-imp-name -type-trimmed">{{=snip.mapImpLevel(imp)}}</span>

                                {{?imp.getEffect()}}
                                    {{=snip.nobr(snip.mapImpEffect(imp) + ' ('+ snip.accIcon() + tile.mapImpUsers + '×' + snip.mapImpEffect(imp, tile.mapImpUsers, {noEffectIcon:true}) +')', false, imp.allowLuckBonus() ? 'fakelink' : '')}}

                                    {{?imp.getEffectUngrown()}}
                                        {{=snip.nobr(snip.mapImpEffectUngrown(imp, {effect:imp.calcRealEffect()}) + ' ('+ snip.accIcon() + tile.mapImpUsers + '×' + snip.mapImpEffectUngrown(imp, {effect:imp.calcRealEffect(tile.mapImpUsers)})+')')}}
                                    {{??imp.getEffectProd()}}
                                        {{=snip.nobr(snip.mapImpEffectProd(imp, {effect:imp.calcRealEffect(), fixed: 1, postFix: '%'}) + ' ('+ snip.accIcon() + tile.mapImpUsers + '×' + snip.mapImpEffectProd(imp, {effect:imp.calcRealEffect(tile.mapImpUsers), fixed: 1, postFix: '%'})+')')}}
                                    {{?}}
                                {{?}}
                            </div>
                        {{~}}
                    </div>
                {{?}}

                {{=snip.roads(tile.tile, 'tile-roads')}}
            </div>
        </div>
    </script>

<script type="text/plain" id="map.towns">
    {{=tmplMgr.map.info.towns(it)}}
</script>

    <script type="text/plain" id="map.infoExt.outer">
        <div class="infoExt-towns-wrp"></div>
    </script>

        <script type="text/plain" id="map.infoExt.towns">
            {{=tmplMgr.map.info.towns(it)}}
        </script>

    <script type="text/plain" id="map.infoOld">
        <div class="info-menu-wrp">
            <a class="buttonLabel -type-options" onclick="notifMgr.runEvent(Notif.ids.mapToggleFilters)"></a>

            <a class="buttonLabel -type-stock" onclick="notifMgr.runEvent(Notif.ids.mapToggleMapR)"></a>

            {{?Ability.mapBuild()}}
                <a class="buttonLabel -type-garisson" onclick="notifMgr.runEvent(Notif.ids.mapToggleActions)"></a>
            {{?}}

            {{?Ability.mapMini()}}
                <a class="buttonLabel -type-trade" onclick="notifMgr.runEvent(Notif.ids.mapToggleMapMini)"></a>
            {{?}}    
        </div>
    </script>
    
    
<script type="text/plain" id="mapComments">
    <div class="mapComments-comments-wrp"></div>
</script><script type="text/plain" id="screenBar">
    <div class="screenPage-wrp screenBar-luck-wrp -hidden"></div>
    <div class="screenPage-wrp screenBar-map-wrp -hidden"></div>
    <div class="screenPage-wrp screenBar-town-wrp -hidden"></div>
    <div class="screenPage-wrp screenBar-communication-wrp -hidden"></div>
    <div class="screenPage-wrp screenBar-different-wrp -hidden"></div>
</script>

<script type="text/plain" id="screenPage">
    <div class="screenPage-options-wrp -type-hidden">
        {{=tmplMgr.screenPage.options(it)}}
    </div>

    <div class="screenPage">
        <div class="screenPage-multyLabel"></div>

        /*<div class="screenPage-title -type-selectable">{{=it.title||''}}</div>*/

        <div class="{{=it.pageName}}-other-wrp"></div>

        <div class="screenPage-notices-wrp"></div>

        <div class="screenPage-notices-info -type-special -state-hidden"></div>

        <div class="screenPage-notices-info -state-hidden"></div>

        <div class="screenPage-screen-wrp">
            <div class="screenPage-screenImg-wrp"></div>

            <div class="screenPage-screenTitle-wrp"></div>

            /*<div class="screenPage-screenTitle"></div>*/
        </div>
    </div>

    {{?it.curScreenInfo.getMark}}
        <div class="screenPage-mark-wrp">
            {{=it.curScreenInfo.getMark()}}
        </div>
    {{?}}
</script>

    <script type="text/plain" id="screenPage.luck.galaxy">
        <a class="screenPage-luck-chest">
            {{=tmplMgr.chest.galaxy()}}
        </a>
    </script>
    
<!-- screenPage.options -->
<script type="text/plain" id="screenPage.options">
    <div class="screenPage-options">
        {{?it.options.length > 1}}
            {{@it.options: option}}
                {{=tmplMgr.screenPage.option({option: option})}}
            {{@}}
        {{?}}
    </div>
</script>

<!-- screenPage.option -->
<script type="text/plain" id="screenPage.option">
    <div class="screenPage-option {{=it.option.getCls()}}" data-id="{{=it.option.getId()}}">
        <div class="screenPage-option-cont">
            {{=it.option.getTmpl()({option: it.option})}}

            <div class="screenPage-optNotices-wrp"></div>

            <div class="screenPage-optNotices-info -state-hidden"></div>
        </div>
    </div>
</script>

<!-- screenPage.option.screen -->
<script type="text/plain" id="screenPage.option.screen">
    <div class="screenPage-screenImg-wrp">
        {{=snip.wrp('screenPage-screenImg', '', '', {type: it.option.getScreenInfo().getImg()})}}
    </div>

    <div class="screenPage-screenTitle-wrp">
        {{=snip.wrp('screenPage-screenTitle', it.option.getScreenInfo().getTitle())}}
    </div>
</script>

<!-- screenPage.option.town -->
<script type="text/plain" id="screenPage.option.town">
    <div class="screenPage-screenImg-wrp">
        {{=snip.townImg({town: it.option.getTown(), sizeType: 'full'})}}
    </div>

    <div class="screenPage-screenTitle-wrp">
        {{=snip.wrp('screenPage-screenTitle', it.option.getTown().getName())}}
     </div>   
</script>

<script type="text/plain" id="screenPage.notices">
    {{@it.notices: notice}}
        {{=tmplMgr.screenPage.notice({notice: notice, param: it.param})}}
    {{@}}
</script>

<script type="text/plain" id="screenPage.notice">
    {{?it.notice.isActual(it.param)}}
        <div class="screenPage-notice" data-id="{{=it.notice.getId()}}">
            {{=it.notice.getLabel()}}
        </div>
    {{?}}
</script><script type="text/plain" id="town.outer">
    <div class="town-loadIndicator-wrp"></div>

    <div class="town-swapSlot-wrp"></div>

    <div class="panel-town-infoExt-wrp"></div>
</script>


<script type="text/plain" id="town.info">
    <div class="info-stockGarrison-wrp">
        <div class="info-stock-wrp"></div>

        <div class="info-garrison-wrp"></div>

        <div class="__tmpArrow"></div>
    </div>

    <div class="info-menu-wrp">
        <div class="info-market-wrp buttonBack -type-hidden"></div>

        <a class="info-pop-wrp -type-hidden" href="{{=hashMgr.getWndHref('economics')}}"></a>

        <div class="info-attacks-wrp buttonBack -type-hidden"></div>
    </div>
</script>

    <script type="text/plain" id="stock">
        <div class="view-stock">
            <div class="stock-list"></div>

            <div class="info-list-overflow -state-blockTransition"></div>
        </div>
    </script>

        <script type="text/plain" id="stock.list">
            {{=tmplMgr.stock.res({res: it.stock.getElem(Resource.ids.food)})}}

            {{@it.resGroups: resGroup}}
                {{?resGroup.list.length}}
                    <div class="stock-resGroup" data-id="{{=resGroup.id}}">
                        {{@resGroup.list: res}}
                            {{=tmplMgr.stock.res({res: res})}}
                        {{@}}
                    </div>
                {{?}}
            {{@}}
        </script>

            <script type="text/plain" id="stock.res">
                <div class="stock-list-res" data-id="{{=it.res.getId()}}">
                    <span class="stock-list-resIcon">{{=snip.resBig(it.res)}}</span>

                    <span class="stock-list-resHas">{{=snip.resStockWarnHas(it.res, true)}}</span>
                </div>
            </script>

    <script type="text/plain" id="town.info.garrison">
        <div class="view-garrison">
            <div class="garrison-list"></div>

            <div class="info-list-overflow -state-blockTransition"></div>
        </div>
    </script>

        <script type="text/plain" id="garrison.list">
            {{@it.list.getList(): unit}}
                {{=tmplMgr.garrison.unit({unit: unit})}}
            {{@}}
        </script>

            <script type="text/plain" id="garrison.unit">
                <div class="garrison-list-unit" data-id="{{=it.unit.getId()}}">
                    {{=snip.unitCount(it.unit, utils.formatNum(it.unit.getCount(), snip.getShortNumFormatOpt(it.unit.getCount())))}}
                </div>
            </script>

    <script type="text/plain" id="town.info.attacks">
        <div class="info-attacks">
            <a class="info-attacks-icon {{?it.battle.state != EventCommon.battleState.delete}}-type-battle{{?}}" href="{{=hashMgr.getWndHref('army')}}"></a>

            <div class="info-attacks-list">
                {{=tmplMgr.town.info.attacks.label({data:it, type:'attackIn'})}}

                {{=tmplMgr.town.info.attacks.label({data:it, type:'attackOut'})}}

                {{=tmplMgr.town.info.attacks.label({data:it, type:'defenceIn'})}}

                {{=tmplMgr.town.info.attacks.label({data:it, type:'defenceOut'})}}
            </div>
        </div>
    </script>

        <script type="text/plain" id="town.info.attacks.label">
            {{var event = it.data[it.type];}}

            {{?event}}
                <div class="iconAttacks -type-{{=it.type}}"></div>
            {{?}}
        </script>

    <script type="text/plain" id="town.info.pop"></script>

        <script type="text/plain" id="mmenu.pop">
            <div class="info-pop {{?it.ext.blink}}-state-blink {{?wofh.town.pop.has < 100}}-type-rainbow{{??}}-type-green{{?}}{{?}}" {{?it.ext.blink && wofh.town.pop.has >= 100}}style="animation-duration: {{=(it.ext.townWorkPop/0.9*3+1).toFixed(1)}}s;"{{?}}>
                {{var res = wofh.town.calcFeatureRes();}}

                {{?res}}
                    <div class="info-pop-res">{{=snip.resBig(res)}}</div>
                {{?}}

                <div class="info-pop-info">
                    <div class="info-pop-stat">
                        <span class="info-pop-has" data-color="{{?!it.incReal}}white{{??it.incReal > 0}}green{{??}}red{{?}}">
                            <div class="contArrow"></div>

                            {{=utils.formatNum(it.has, {int: true, stages: true})}}
                        </span>
                        <span class="info-pop-sep"> / </span>
                        <span class="info-pop-culture">
                            {{=utils.formatNum(it.culture, {int: true, stages: true})}}
                        </span>
                    </div>
                    <div class="info-pop-brief">
                        {{?it.ext.lessPop}}Распределить{{?}}
                    </div>
                </div>
            </div>
        </script>

    <script type="text/plain" id="town.info.market">
        <a class="info-market" href="{{=hashMgr.getWndHref('market')}}">
            <div class="info-market-icon"></div>

            <div class="info-market-info">
                {{=wofh.town.traders.count-wofh.town.traders.busy}}/{{=wofh.town.traders.count}}
            </div>
        </a>
    </script>

<script type="text/plain" id="town.info.outer">
    <div class="town-defBon-wrp">
        <div class="town-defence-wrp"></div>

        <div class="town-bonus-wrp"></div>
    </div>

    <div class="town-questlist-wrp"></div>
</script>

<script type="text/plain" id="town.infoExt">
    <div class="infoExt-stockExt-wrp"></div>

    <div class="infoExt-garrisonExt-wrp"></div>

    <div class="infoExt-attacks-wrp"></div>
</script>

    <script type="text/plain" id="stockExt">
        <div class="view-stock">
            <div class="stock-title">
                Городские хранилища: {{=utils.formatNum(it.stock.getMax(), {int: true, stages: true})}}
            </div>

            <div class="infoExt-sep"></div>

            <div class="stock-list"></div>

            <div class="stockExt-foodpriority-wrp"></div>
        </div>
    </script>

        <script type="text/plain" id="stockExt.list">
            {{@it.resGroups: resGroup}}
                {{?resGroup.list.length || resGroup.id == ResList.groupType.grown}}
                    <div class="stock-resGroup" data-id="{{=resGroup.id}}">
                        {{?resGroup.id == ResList.groupType.grown}}
                            {{=tmplMgr.stockExt.res({res: it.stock.getElem(Resource.ids.food)})}}
                        {{?}}
                        {{@resGroup.list: res}}
                            {{=tmplMgr.stockExt.res({res: res})}}
                        {{@}}
                    </div><br>
                {{?}}
            {{@}}
        </script>

            <script type="text/plain" id="stockExt.res">
                <div class="stock-list-res" data-id="{{=it.res.getId()}}">
                    <span class="stock-list-resIcon">{{=snip.resBig(it.res)}}</span>

                    <span class="stock-list-resHas">
                        {{=snip.resStockWarnHas(it.res)}}
                    </span>

                    {{?it.res.updateHour}}
                        <span class="stock-list-resUpd">
                            {{=snip.resStockWarnUpd(it.res)}}
                        </span>
                    {{?}}
                </div>
            </script>

        <script type="text/plain" id="stockExt.foodpriority">
            <div class="view-foodpriority">
                <div class="foodpriority-list">
                    {{@wofh.town.getStock().foodpriority: resId: resIndex}}
                        {{var res = new Resource(resId);}}

                        <div class="foodpriority-res" data-id="{{=resId}}">
                            <div class="foodpriority-res-icon">{{=snip.resBig(res)}}</div>
                        </div>
                    {{@}}
                </div>
            </div>
        </script>

    <script type="text/plain" id="garrisonExt">
        <div class="view-garrison">
            <div class="infoExt-sep"></div>

            <div class="garrison-title">Военные дела в городе</div>

            <div class="infoExt-sep"></div>

            <div class="garrison-list"></div>
        </div>
    </script>

        <script type="text/plain" id="garrisonExt.list">
            {{@it.list.getList(): unit}}
                {{=tmplMgr.garrison.unit({unit: unit})}}
            {{@}}
        </script>

            <script type="text/plain" id="garrisonExt.unit">
                <div class="garrison-list-unit" data-id="{{=it.unit.getId()}}">
                    {{=snip.unitCount(it.unit, utils.formatNum(it.unit.getCount()))}}
                </div>
            </script>

    <script type="text/plain" id="town.infoExt.attacks">
        <div class="infoExt-attacks">
            <div class="infoExt-sep"></div>

            <div class="attacks-title">
                Перемещение войск
            </div>

            <div class="infoExt-sep"></div>

            <div class="attacks-list">
                {{=tmplMgr.town.infoExt.attacks.label({data:it, type:'attackIn'})}}

                {{=tmplMgr.town.infoExt.attacks.label({data:it, type:'attackOut'})}}

                {{=tmplMgr.town.infoExt.attacks.label({data:it, type:'defenceIn'})}}

                {{=tmplMgr.town.infoExt.attacks.label({data:it, type:'defenceOut'})}}
            </div>
        </div>
    </script>

        <script type="text/plain" id="town.infoExt.attacks.label">
            {{var event = it.data[it.type];}}

            {{?event}}
                <div class="attacks-label">
                    <span class="iconAttacksTrans -type-{{=it.type}}"></span>

                    ×{{=event.count}} {{=snip.timer(event.time, 'dec', false, false, {attrs: utils.makeDataAttrStr({alerttime: 60})})}}  в  {{=timeMgr.fMoment(event.time)}}
                </div>
            {{?}}
        </script> 

    <script type="text/plain" id="town.infoExt.army">
        <a class="button8 -type-war" href="{{=hashMgr.getWndHref('army')}}"></a>
    </script>

<script type="text/plain" id="town.infoExt.footer">
    <div class="infoExt-sep"></div>

    <div class="infoExt-army-wrp"></div>

    <div class="__tmpArrow" data-dir="up"></div>
</script><script type="text/plain" id="bonus.shares">
    /*
    <div class="bonus-shares-wrp">
        <div class="bonus-shares-title">Акции</div>

        <div class="info-luck-wrp"></div>
        <div class="info-bonus-wrp"></div>
    </div>
    */
</script><script type="text/plain" id="economics">
    <div class="view-economics">
        <div class="tabs-cont"></div>
    </div>
</script>

    <script type="text/plain" id="economics.rule.townRename">
        <form class="economics-rule-rename">
            <span class="input-blinkWrp">
                {{?Quest.isActive(Quest.ids.townRename)}}
                    <span class="input-blink -anim-blink"></span>
                {{?}}

                {{?debug.isTest('later')}}
                    {{=snip.button('R', {cls: 'renameBtns economics-rule-random-btn', tabindex: -1})}}
                {{?}}

                {{=snip.input1({cls: 'economics-rule-rename-name -type-big', value: wofh.town.name, maxlength: lib.town.namelimit[1]})}}

                <button class="renameBtns button2 -type-accept economics-rule-rename-btn"></button>
            </span>

            {{?!wofh.account.canMessage()}}
                 {{=snip.alert(snip.alertTmpl.blocked.message())}}
            {{?}}
        </form>
    </script>

    <script type="text/plain" id="economics.budget.pop">
        {{=snip.pop()}}<span class="js-budget-popWork" data-title="Безработное население города"></span>  из  <span class="-defVal" data-title="Общее население города">{{=it.maxPop}}</span>
    </script>
    
    <script type="text/plain" id="economics.budget.footer"></script>
    
    
    <script type="text/plain" id="economics.stock">
        <form>
            {{var table = tblEconomicsStock.getTableLayout();}}

            {{=table({cls: 'tbl-econ-stock'})}}
                {{=table.thead()}}
                    {{=table.tr()}}
                        {{=table.th({cls: 'econ-stock-col0'})}}{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col1'})}}{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col2'})}}Запас{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col3'})}}Добыча{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col4'})}}Расход{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col5'})}}Снабжение{{=table.th.end()}}
                        {{=table.th({cls: 'econ-stock-col6'})}}Прибыль{{=table.th.end()}}
                    {{=table.tr.end()}}
                {{=table.thead.end()}}
                {{=table.tbody()}}{{=table.tbody.end()}}
            {{=table.end()}}
        </form>
    </script>

        <script type="text/plain" id="economics.table.stock">
            {{var table = tblEconomicsStock.getTableLayout(), td = table.td, allowCons;}}

            {{@it.list: stockRes}}
                {{allowCons = stockRes.calcEffect > 0 && it.canSubmit && stockRes.effectType;}}

                {{=table.tr({cls: allowCons ? 'econ-row-cons' : ''})}}
                    {{=td({cls: 'econ-cell econ-stock-col0'})}}
                        {{?allowCons}}
                            <div class="stock-resCons-layer">
                                <input class="stock-resCons" type="checkbox" name="r{{=stockRes.getId()}}" {{?stockRes.consBin == 1}}checked="checked"{{?}}>

                                <div class="stock-resCons-overlay"></div>

                                <div class="stock-resCons-layer nobr">
                                    {{var stockResEffects = [];}}

                                    {{?stockRes.effectType == 1}}
                                        {{stockResEffects.push({type: '0', title: 'Рост', val: stockRes.calcEffect});}}
                                    {{??stockRes.effectType == 2}}
                                        {{stockResEffects.push({type: '1', title: 'Культура', val: stockRes.calcEffect});}}
                                    {{??stockRes.effectType == 3}}
                                        {{stockResEffects.push({type: '2', title: 'Знания', val: stockRes.calcEffect});}}
                                    {{??stockRes.effectType == 4}}
                                        {{stockResEffects.push({type: '3', title: 'Промышленность', val: stockRes.calcEffect});}}
                                    {{??stockRes.effectType == 5}}
                                        {{stockResEffects.push({type: '0', title: 'Рост', val: stockRes.calcEffect});}}
                                        {{stockResEffects.push({type: '2', title: 'Знания', val: Resource.getEffectType(stockRes.getId()) == Resource.types.grownScience ? utils.toPercent(Resource.getEffect_(stockRes.getId(), 2)) : 0});}}
                                    {{?}}

                                    {{~stockResEffects: effect: index}}
                                        {{?index}}<br>{{?}}<img src="https://test.waysofhistory.com/img/_.gif" class="consRes -type-{{=effect.type}}" data-title="{{=effect.title}}"><span class="sp01">{{=effect.val}}%</span>
                                    {{~}}
                                </div>
                            </div>
                        {{?}}
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col1'})}}
                        <div class="stock-resCons-layer">
                            {{=snip.res(stockRes, {backgrounded: true})}}
                        </div>
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col2'})}}
                        <div class="stock-resCons-layer">
                            {{=utils.formatNum(stockRes.getHas(), {stages: true, int: true})}}
                        </div>
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col3'})}}
                        <div class="stock-resCons-layer" data-title="{{=utils.formatNum(stockRes.incom, {fixed:3})}}">
                            <div class="econ-stock-short-info">
                                {{=snip.coloredNum(stockRes.incom, snip.getShortNumFormatOpt(stockRes.incom, {noPosSignColor: true, sign: stockRes.incom < 1}))}}
                            </div>
                            <div class="econ-stock-full-info">
                                {{=snip.coloredNum(stockRes.incom, {noPosSignColor: true, stages: true, int: true, sign: stockRes.incom < 1})}}
                            </div>
                        </div>
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col4'})}}
                        <div class="stock-resCons-layer" data-title="{{=utils.formatNum(stockRes.dec, {fixed:3})}}">
                            <div class="econ-stock-short-info">
                                {{=snip.coloredNum(stockRes.dec, snip.getShortNumFormatOpt(stockRes.dec, {noPosSignColor: true, sign: stockRes.dec > -1}))}}
                            </div>
                            <div class="econ-stock-full-info">
                                {{=snip.coloredNum(stockRes.dec, {noPosSignColor: true, stages: true, int: true, sign: stockRes.dec > -1})}}
                            </div>
                        </div>
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col5'})}}
                        {{var streamRes = stockRes.stream, streamResFuel = false;}}

                        {{?stockRes.streamfuel}}
                            {{
                                streamRes = stockRes.streaminc + stockRes.streamdec;
                                streamResFuel = snip.coloredNum(stockRes.streamfuel, {stages: true, int: true, sign:true, negative:true, noZeroColor:true, signPostFix:snip.icon(snip.c.anyIcon, 'fuel', '', '', 'va-5')});
                            }}
                        {{?}}

                        <div class="stock-resCons-layer" data-title="{{=utils.formatNum(stockRes.stream, {mixed: true, fixed: 3})}}">
                            <div class="econ-stock-short-info">
                                {{=snip.coloredNum(stockRes.stream, snip.getShortNumFormatOpt(stockRes.stream, {noPosSignColor: true, sign: Math.abs(stockRes.stream) < 1}))}}
                            </div>
                            <div class="econ-stock-full-info">
                                <span data-title="{{=utils.formatNum(stockRes.streamdec, {mixed:true, fixed:3})}}">{{=snip.coloredNum(stockRes.streamdec, {stages: true, int: true, sign: true, negative:true, noZeroColor:true})}}</span>
                                <span data-title="{{=utils.formatNum(stockRes.streaminc, {mixed:true, fixed:3})}}">{{=snip.coloredNum(stockRes.streaminc, {stages: true, int: true, sign: true, positive:true, noZeroColor:true})}}</span>
                                {{?streamResFuel}}
                                    <span data-title="{{=utils.formatNum(stockRes.streamfuel, {mixed:true,fixed:3})}}">
                                        {{=snip.nobr('(' + streamResFuel + ')')}}
                                    </span>
                                {{?}}
                            </div>
                        </div>
                    {{=td.end()}}

                    {{=td({cls: 'econ-cell econ-stock-col6'})}}
                        <div class="stock-resCons-layer" data-title="{{=utils.formatNum(stockRes.updateHour, {fixed:3})}}">
                            {{=snip.coloredNum(stockRes.updateHour, {noPosSignColor: true, stages: true, int: true, sign: Math.abs(stockRes.updateHour) < 1})}}
                        </div>
                    {{=td.end()}}
                {{=table.tr.end()}}
            {{@}}
        </script>

        
    
    <script type="text/plain" id="economics.prod">
        {{
            var roundFunc = it.roundFunc;
            var defVal = it.defVal;
            var dim = it.dim;
            var tmpVal;
        }}

        <div class="econ-stats-corruption">
            <span data-title="Зависит от числа городов и суда">Коррупция:</span>
             
            <span data-title="{{=utils.toPercent(it.corruptionData.corruption, 2)}}%">
                {{?it.corruptionData.punish > 0}}
                    {{=utils.toPercent(it.corruptionData.corruption)}}% +<a title="Наказание">{{=utils.toPercent(it.corruptionData.punish)}}</a>%
                {{??}}
                    {{=utils.toPercent(it.corruptionData.corruption)}}%
                {{?}}
            </span>
        </div>

        <div class="econ-prod-list">
            {{@it.resArr : res}}
                <div class="econ-prod-column econ-prod-res">
                    <div>{{=snip.res(res)}}</div>
                    <div>{{=res.buildPop}}</div>
                    <div data-title="{{=roundFunc(res.averageEfficiency, 2) + dim}}">{{=roundFunc(res.averageEfficiency) + dim}}</div>
                    <div>
                        <span data-title="{{=roundFunc(res.workCorruptionEfficiency, 2) + dim}}">{{=roundFunc(res.workCorruptionEfficiency) + dim}}</span>

                        {{tmpVal = roundFunc(res.scienceEffect);}}
                        {{?tmpVal != defVal}} * {{=tmpVal + dim}}{{?}}

                        {{tmpVal = roundFunc(res.raceBonus);}}
                        {{?tmpVal != defVal}} * {{=tmpVal + dim}}{{?}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.incBase);}}

                        {{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.climateBonus);}}

                        {{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.scienceBonus);}}

                        {{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.specBonus);}}

                        {{=snip.title(snip.defVal(roundFunc(res.specBonus, 1) + dim, roundFunc(res.specBonus), defVal), roundFunc(res.specBonus, 2) + dim)}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.luckBonus);}}

                        {{=snip.defVal(tmpVal + dim, tmpVal, defVal, '-warn -type-blue')}}
                    </div>
                    <div>
                        {{tmpVal = roundFunc(res.mapBonus);}}

                        {{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}

                        {{?res.mapBonusInc}}
                            {{=' + ' + utils.formatNum(res.mapBonusInc, {int:true})}}
                        {{?}}
                    </div>

                    <span class="econ-prod-res-sep"></span>

                    <div class="econ-prod-res-total" data-title="{{=utils.formatNum(res.total, {mixed: true, fixed: 2})}}">
                        {{=utils.formatNum(res.total, {stages: true, int: true})}}

                        {{?res.wonderEffect != 0 }}+{{=res.wonderEffect}}{{?}}
                    </div>
                </div>
            {{@}}
        </div>
    </script>

        <script type="text/plain" id="economics.prod.desc">
            <div class="econ-prod-column econ-prod-desc">
                <div></div>

                <div>Занятое<br>население</div>
                <div>Эффективность<br>строений</div>
                <div>Базовое<br>производство</div>
                <div>Климатическая<br>зона</div>
                <div>Бонус<br>наук</div>
                <div>Великий<br>гражданин</div>
                <div>Бонус<br>удачи</div>
                <div>Улчшение<br>местности</div>

                <div></div>
            </div>
        </script>
    
        
    
    <script type="text/plain" id="economics.pop">
        <label class="econ-pop-block">
            <input type="checkbox" class="econ-pop-visibility -hidden">

            <div class="econ-pop-header">
                <span class="econ-pop-title">Прирост: {{=snip.fixedHint(it.grownUpSum, {sign: true}, {sign: true}, {formatFunc: snip.coloredNum})}}{{=snip.landscapeCont('  в день')}}</span>
                <span class="contArrow"></span>
            </div>

            <div class="econ-pop-body-wrp">
                <div class="econ-pop-body">
                    <div class="econ-pop-row">
                        <div class="econ-pop-col">Базовый рост</div>
                        <div class="econ-pop-col">{{=snip.fixedHint(it.grownUpBase)}}</div>
                    </div>

                    {{?it.grownUpScience > 0}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Научные достижения</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.grownUpScience)}}</div>
                        </div>
                    {{?}}

                    {{@it.grownUpBuilds : build}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">
                                <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                    {{=build.name}}{{?build.level}} ({{=build.level}}){{?}}
                                </a>
                            </div>
                            <div class="econ-pop-col">{{=snip.fixedHint(build.effect)}}</div>
                        </div>
                    {{@}}
                </div>
            </div>
        </label>

        {{?it.grownDownBuilds || it.grownDownImps}}
            <label class="econ-pop-block">
                <input type="checkbox" class="econ-pop-visibility -hidden">

                <div class="econ-pop-header">
                    <span class="econ-pop-title">Спад: {{=snip.fixedHint(-it.grownDownSum, {sign: true}, {sign: true}, {formatFunc: snip.coloredNum})}}{{=snip.landscapeCont('  в день')}}</span>
                    <span class="contArrow"></span>
                </div>

                <div class="econ-pop-body-wrp">
                    <div class="econ-pop-body">
                        {{@it.grownDownBuilds: build}}
                            <div class="econ-pop-row">
                                <div class="econ-pop-col">
                                    <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                        {{=build.name}}{{?build.level}} ({{=build.level}}){{?}}
                                    </a>
                                </div>
                                <div class="econ-pop-col">{{=snip.fixedHint(build.effect)}}</div>
                            </div>
                        {{@}}

                        {{@it.grownDownImps: imp}}
                            <div class="econ-pop-row">
                                <div class="econ-pop-col">{{=imp.getName()}}</div>
                                <div class="econ-pop-col">{{=snip.fixedHint(imp.effectUngrown)}}</div>
                            </div>
                        {{@}}
                    </div>
                </div>
            </label>
        {{?}}

        {{?it.grownConsSum}}
            <label class="econ-pop-block">
                <input type="checkbox" class="econ-pop-visibility -hidden">

                <div class="econ-pop-header">
                    <span class="econ-pop-title">Потребление: {{=utils.toPercent(it.grownConsSum)}}%</span>
                    <span class="contArrow"></span>
                </div>

                <div class="econ-pop-body-wrp">
                    <div class="econ-pop-body">
                        {{~it.grownConsRes : res}}
                            <div class="econ-pop-row">
                                <div class="econ-pop-col">{{=snip.resName(res, {backgrounded: true})}}</div>
                                <div class="econ-pop-col">{{=utils.toPercent(res.getEffect())}}%</div>
                            </div>
                        {{~}}
                    </div>
                </div>
            </label>
        {{?}}

        {{=tmplMgr.economics.pop.totalGrown(it)}}
    </script>

        <script type="text/plain" id="economics.pop.totalGrown">
            {{
                var roundFunc = it.roundFunc;
                var defVal = it.defVal;
                var dim = it.dim;
                var tmpVal;
            }}

            <label class="econ-pop-block">
                <input type="checkbox" checked="checked" class="econ-pop-visibility -hidden">

                <div class="econ-pop-header" data-flow="{{?it.grownSum > 0}}inc{{??it.grownSum < 0}}dec{{??}}none{{?}}">
                    <span class="econ-pop-title">Итого: {{=snip.fixedHint(it.grownSum, {sign: true}, {sign: true})}}{{=snip.landscapeCont('  в день')}}</span>
                    <span class="contArrow"></span>
                </div>

                <div class="econ-pop-body-wrp">
                    <div class="econ-pop-body">
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Рост</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.grownUpSum, {toNum: true})}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col"></div>
                            <div class="econ-pop-col">x</div>
                        </div>

                        {{tmpVal = +roundFunc(it.grownRace);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Раса</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Ресурсы</div>
                            <div class="econ-pop-col">{{=snip.defVal(+roundFunc(it.grownConsSum + 1) + dim, it.grownConsSum, 1)}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Великие граждане</div>
                            <div class="econ-pop-col">{{=snip.defVal(snip.title(+roundFunc(it.grownSpec, 1) + dim, roundFunc(it.grownSpec, 2) + dim), it.grownSpec, 1, 'fakelink')}}</div>
                        </div>

                        {{tmpVal = +roundFunc(it.grownDeposit);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Месторождение</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        {{tmpVal = +roundFunc(it.grownMap, 1);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Улучшение местности</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        {{tmpVal = +roundFunc(it.grownLuck);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Удача</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col"></div>
                            <div class="econ-pop-col">-</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Спад</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.grownDownSum)}}</div>
                        </div>

                        <div class="econ-pop-row -hidden">
                            <div class="econ-pop-col"></div>
                            <div class="econ-pop-col -type-total">{{=snip.coloredNum(it.grownSum, {mixed: true, uFixed: 1, sign: true})}}</div>
                        </div>

                        {{?it.growReal < 0}}
                            <div class="econ-pop-row -type-title">
                                {{?it.town.pop.has > it.town.pop.culture}}Население достигло культурного предела. {{?}}Происходит спад населения: &nbsp;{{=snip.pop(snip.fixedHint(it.growReal, false, false, {formatFunc: snip.coloredNum}))}}&nbsp; в день
                            </div>
                        {{?}}
                    </div>
                </div>
            </label>
        </script>

    
        
        
    <script type="text/plain" id="economics.cult">
        <label class="econ-pop-block">
            <input type="checkbox" class="econ-pop-visibility -hidden">

            <div class="econ-pop-header">
                <span class="econ-pop-title">Культура: {{=snip.fixedHint(it.cultUpSum)}}</span>
                <span class="contArrow"></span>
            </div>

            <div class="econ-pop-body-wrp">
                <div class="econ-pop-body">
                    <div class="econ-pop-row">
                        <div class="econ-pop-col">Базовая культура</div>
                        <div class="econ-pop-col">{{=snip.fixedHint(it.cultBase, {int: true, stages: true})}}</div>
                    </div>

                    {{?it.cultScience > 0}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Научные достижения</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.cultScience)}}</div>
                        </div>
                    {{?}}

                    {{@it.cultBuild : build}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">
                                <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                    {{=build.name}}{{?build.level}} ({{=build.level}}){{?}}
                                </a>
                            </div>
                            <div class="econ-pop-col">{{=snip.fixedHint(build.effect)}}</div>
                        </div>
                    {{@}}
                </div>
            </div>
        </label>

        {{?it.cultConsSum > 0}}
            <label class="econ-pop-block">
                <input type="checkbox" class="econ-pop-visibility -hidden">

                <div class="econ-pop-header">
                    <span class="econ-pop-title">Потребление ресурсов: {{=utils.toPercent(it.cultConsSum)}}%</span>
                    <span class="contArrow"></span>
                </div>

                <div class="econ-pop-body-wrp">
                    <div class="econ-pop-body">
                        {{~it.cultConsRes : res}}
                            <div class="econ-pop-row">
                                <div class="econ-pop-col">{{=snip.resName(res, {backgrounded: true})}}</div>
                                <div class="econ-pop-col">{{=utils.toPercent(res.getEffect())}}%</div>
                            </div>
                        {{~}}
                    </div>
                </div>
            </label>
        {{?}}

        {{=tmplMgr.economics.pop.totalCult(it)}}
    </script>

        <script type="text/plain" id="economics.pop.totalCult">
            {{
                var roundFunc = it.roundFunc;
                var defVal = it.defVal;
                var dim = it.dim;
                var tmpVal;
            }}

            <label class="econ-pop-block">
                <input type="checkbox" checked="checked" class="econ-pop-visibility -hidden">

                <div class="econ-pop-header">
                    <span class="econ-pop-title">Итого: {{=snip.fixedHint(it.cultSum)}}</span>
                    <span class="contArrow"></span>
                </div>

                <div class="econ-pop-body-wrp">
                    <div class="econ-pop-body">
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Культура</div>
                            <div class="econ-pop-col">{{=utils.formatNum(it.cultUpSum, {int: true, mixed: true})}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col"></div>
                            <div class="econ-pop-col">x</div>
                        </div>

                        {{tmpVal = +roundFunc(it.cultRace);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Раса</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Ресурсы</div>
                            <div class="econ-pop-col">{{=snip.defVal(+roundFunc(it.cultConsSum + 1) + dim, it.cultConsSum, 1)}}</div>
                        </div>

                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Великие граждане</div>
                            <div class="econ-pop-col">{{=snip.defVal(snip.title(roundFunc(it.cultSpec, 1) + dim, roundFunc(it.cultSpec, 2) + dim), it.cultSpec, 1, 'fakelink')}}</div>
                        </div>

                        {{tmpVal = +roundFunc(it.cultMap, 1);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Улучшение местности</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        {{tmpVal = +roundFunc(it.cultLuck);}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Удача</div>
                            <div class="econ-pop-col">{{=snip.defVal(tmpVal + dim, tmpVal, defVal)}}</div>
                        </div>

                        <div class="econ-pop-row -hidden">
                            <div class="econ-pop-col"></div>
                            <div class="econ-pop-col -type-total">{{=snip.coloredNum(it.cultSum, {mixed: true, uFixed: 1, sign: true})}}</div>
                        </div>
                    </div>
                </div>
            </label>
        </script>

        
        
    <script type="text/plain" id="economics.money">
        <label class="econ-pop-block">
            <input type="checkbox" class="econ-pop-visibility -hidden">

            <div class="econ-pop-header">
                <span class="econ-pop-title">Доход: {{=snip.fixedHint(it.sGet, {sign: true}, {sign: true}, {formatFunc: snip.coloredNum})}}{{=snip.landscapeCont('  в час')}}</span>
                <span class="contArrow"></span>
            </div>

            <div class="econ-pop-body-wrp">
                <div class="econ-pop-body">
                    {{?it.streaminc != 0}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Снабжение</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.streaminc)}}</div>
                        </div>
                    {{?}}

                    {{?it.mapBonusInc}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">УМ</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.mapBonusInc)}}</div>
                        </div>
                    {{?}}

                    {{@it.buildEssectsInc: build}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">
                                <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                    {{=build.name}}{{?build.level}} ({{=build.level}}){{?}}
                                </a>
                            </div>
                            <div class="econ-pop-col">{{=snip.fixedHint(build.effect)}}</div>
                        </div>
                    {{@}}
                </div>
            </div>
        </label>

        <label class="econ-pop-block">
            <input type="checkbox" class="econ-pop-visibility -hidden">

            <div class="econ-pop-header">
                <span class="econ-pop-title">Расход: {{=snip.fixedHint(-it.sPay, {sign: true}, {sign: true}, {formatFunc: snip.coloredNum})}}{{=snip.landscapeCont('  в час')}}</span>
                <span class="contArrow"></span>
            </div>

            <div class="econ-pop-body-wrp">
                <div class="econ-pop-body">
                    {{?it.streamdec != 0}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">Снабжение</div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.streamdec)}}</div>
                        </div>
                    {{?}}

                    {{?it.lasVegas.effect != 0}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">
                                <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=it.lasVegas.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+it.lasVegas.id)}}">
                                    Лас-Вегас
                                </a>
                            </div>
                            <div class="econ-pop-col">{{=snip.fixedHint(it.lasVegas.effect)}}</div>
                        </div>
                    {{?}}

                    {{@it.buildEssectsCons: build}}
                        <div class="econ-pop-row">
                            <div class="econ-pop-col">
                                <a class="link js-tooltip" data-tooltip-wnd="buildinfo" data-id="{{=build.id}}" href="{{=HashMgr.getHref('#/buildinfo/'+build.id)}}">
                                    {{=build.name}}{{?build.level}} ({{=build.level}}){{?}}
                                </a>
                            </div>
                            <div class="econ-pop-col">{{=snip.fixedHint(build.effect)}}</div>
                        </div>
                    {{@}}

                    <div class="econ-pop-row -type-title">
                        Денежное содержание строений уменьшено на {{=utils.toPercent(it.economy, 1)}}%
                    </div>
                </div>
            </div>
        </label>

        <div class="econ-pop-block">
            <div class="econ-pop-header" data-flow="{{?it.dGetPay > 0}}inc{{??it.dGetPay < 0}}dec{{??}}none{{?}}">
                <span class="econ-pop-title">Итого: {{=snip.fixedHint(it.dGetPay, {sign: true}, {sign: true})}}{{=snip.landscapeCont('  в час')}}</span>
            </div>
        </div>
    </script>
    
    
    
    <script type="text/plain" id="economics.info">
        <div>
            <form class="econ-info-acc-block js-collectData" data-type="{{=tabEconomicsInfo.types.acc}}">
                <span class="econ-info-acc-title">Научное состояние игрока</span>
                
                <span class="econ-info-collectBtn-wrp"></span>
            </form>
            
            <div class="econ-info-towns-block">
                {{@it.towns: town: index}}
                    {{=tmplMgr.economics.info.town({town: town, townInfo: it.townInfo, index: index})}}
                {{@}}
            </div>
        </div>
    </script>
        
        <script type="text/plain" id="economics.info.town">
            <div class="econ-info-town-block" data-town="{{=it.town.id}}">
                <div class="econ-info-town-cont">
                    <div class="econ-info-town-name">{{=snip.townLink(it.town)}}</div>
                    <div class="econ-info-town">
                        <div class="econ-info-townPosBlock">
                            <span class="econ-info-townPos">{{=(+it.index + 1)}}</span>
                        </div>
                        <div class="econ-info-town-btn -type-town">
                            {{=snip.townImg({town:it.town, sizeType: 'full'})}}
                        </div>
                        <div class="econ-info-town-btn">
                            <button class="econ-info-town-collect button8 -type-text" data-type="all">Всё</button>
                        </div>
                        <div class="econ-info-town-btn">
                            <button class="econ-info-town-collect button8 -type-text" data-type="world">Мир</button>
                        </div>
                        <div class="econ-info-town-btn">
                            <button class="econ-info-town-collect button8 -type-text" data-type="battle">Бой</button>
                        </div>
                    </div>
                    <form class="econ-info-townInfo-block -disabled js-collectData" data-index="{{=it.index}}" data-type="{{=tabEconomicsInfo.types.town}}">
                        <div class="econ-info-townInfo">
                            {{@it.townInfo: tInfo}}
                                <div class="econ-info-townInfo-param-block">
                                    {{=snip.checkbox1({cls: 'js-econ-info-townInfo-param', attrs: {'data-paramtype': tInfo.paramType}, name: 'type'+tInfo.paramType, value: tInfo.paramType, checked: tabEconomicsInfo.isTownCollectedType(it.town.id, tInfo.paramType)})}}

                                    {{=snip.wrp('fakelink js-econ-info-townInfo-paramTowns', tInfo.text)}}

                                    {{?tInfo.subParam}}
                                        {{?tInfo.subParam.parent == 'army'}}
                                            {{=snip.checkbox1({wrpCls: 'econ-info-townInfo-subParam -type-armyType', cls: 'js-econ-info-townInfo-subParam', helperText: ['в городe', 'вся'], helperTextCls: 'fakelink', attrs: {'data-paramtype': tInfo.subParam.paramType, 'data-parent': tInfo.subParam.parent}, name: 'type'+tInfo.subParam.paramType, value: tInfo.subParam.paramType, checked: tabEconomicsInfo.isTownCollectedType(it.town.id, tInfo.subParam.paramType, true)})}}
                                        {{?}}
                                    {{?}}
                                </div>
                            {{@}}
                        </div>
                    </form>
                </div>
                <div class="econ-info-repLink-wrp"></div>
            </div>
        </script>
        
        <script type="text/plain" id="economics.info.collectBtn">
            {{?it.time > timeMgr.getNow()}}
                <span class="button8 -type-text -disabled">{{=snip.timer(it.time, 'dec')}}</span>
            {{??it.needPremium}}
                <a class="button8 -type-text js-econ-info-buyPremium">Включить Царь-Аккаунт</a>
            {{??it.town}}
                <button class="button8 -type-text {{?it.town}}-disabled{{?}}">Собрать данные</button>
            {{??}}
                <button class="button8 -type-text"></button>
            {{?}}
        </script><script type="text/plain" id="options.general.mobile.ext">
    <label class="options-cell-wrp">
        <div class="options-cell">Карта:</div>

        <div class="options-cell">
            <select class="select1 options-input options-mapVersion">
                <option value="{{=iMap.version.full}}" {{?iMap.isFull()}}selected{{?}}>Полная</option>
                <option value="{{=iMap.version.simplified}}" {{?iMap.isSimplified()}}selected{{?}}>Урощенная</option>
            </select>
        </div>
    </label>
</script>